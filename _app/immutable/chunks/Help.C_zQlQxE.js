var bm=Object.defineProperty;var ym=(o,e,t)=>e in o?bm(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var rr=(o,e,t)=>ym(o,typeof e!="symbol"?e+"":e,t);import{s as Ye,r as Ft,v as Kt,w as Gt,x as Wt,j as fe,l as qe,i as U,d as p,V as $t,W as wt,X as eo,y as ze,e as M,c as O,a as A,a3 as Sn,Z as wn,u as we,H as cn,P as Do,F as An,q as Kn,k as $,o as ee,f as g,S as lt,A as tt,p as fn,C as it,Q as Fn,g as E,D as Me,t as Ie,E as Oe,b as Te,h as Pe,n as Le,N as yt,a0 as xo,M as ur,al as ye,z as Os,B as uo,ao as gt,J as In,a2 as yi,ap as ls,ai as Sf,$ as cs,aq as Mt,ak as vm,ar as wm,am as km,I as $l,an as ec,R as tc,O as Ki,T as Cm,U as Em,m as Im}from"./scheduler.u6_2Foza.js";import{S as Ge,i as We,t as T,a as N,g as De,c as He,k as Af,j as Ur,h as nc,b as oe,d as ae,m as re,e as ie,f as nt}from"./index.TaJ1J9Bt.js";import{g as Rf}from"./globals.D0QH3NT1.js";import{e as Ct,u as Ps,o as Ns}from"./each.CpR_wfW1.js";import{t as $e,a as Ja,e as Tm,f as Sm}from"./apiInterceptor.DLiqrKdo.js";import{D as Am,F as Rm,a as Mf,b as Mm,P as Om}from"./FilesOverlay.DpQ7dLHC.js";import{g as rs}from"./entry.BGCGGKLX.js";import{p as Pm}from"./stores.Cwz7fbSK.js";import{n as va,t as yr,u as er,c as ti,p as Of,k as Pf,m as Tr,a as qo,i as Mi,T as wa,e as vi,h as so,a2 as oc,a3 as Zn,J as dn,G as us,M as Mr,j as qr,V as oa,a4 as Nm,a5 as Dm,a6 as jo,H as Lo,W as Nf,s as ka,F as Hm,f as rc,w as Lm,x as Or,o as Um,_ as Gi,N as Bm,y as Pr,Q as ra,Y as zm,S as Vm,X as Fm}from"./index.m-M8DqUY.js";import{d as br,w as st,a as bo}from"./index.gn-jsrgW.js";import{v as Go,a as Km,A as Gm,B as Wm,C as qm,D as Ym,E as jm,F as is,G as ic,t as Qm,b as ao,H as Xm,s as Jm,f as Yr,k as Za,n as Zm,I as xm,J as $m,K as ep,d as tp,w as ia}from"./index.DsBjPjtu.js";import{y as np,z as op,u as ds,e as Ca,A as rp,a as Ea,b as di,x as ip}from"./index.DaEOZcUv.js";import{d as sp}from"./index.GV3eouyv.js";import{p as ap,h as lp}from"./index.cmLa_BXY.js";import{S as cp,P as up,q as dp}from"./index.BypvS9qB.js";import{i as sc,j as ac}from"./index.BJPq8anr.js";import{q as fp,g as hp,r as gp,s as mp,t as pp,v as _p}from"./index.VeSd2tUp.js";import{g as xa,j as bp,k as yp,l as vp}from"./index.peTCFZ67.js";import{W as wp,B as $a}from"./WrenchSolid.CQFVoW9h.js";import{c as kp,d as Cp,e as Ep,h as Ip,s as Tp,t as Sp}from"./index.ClapeVXJ.js";import{b as Ap,u as Rp}from"./index.9S7YkFcP.js";import{c as Df,d as Mp}from"./updater.DMCgqkGV.js";import{D as el,M as co}from"./Dropdown.gycVlJIW.js";import{s as Op,c as Pp,u as Np,d as Dp,b as Ds,M as Hp,a as Lp}from"./menu-trigger.BlezJqHv.js";import{f as Oi}from"./index.BFuekP1B.js";import{T as qt}from"./Tooltip.3kB_H6zI.js";import{S as Hf}from"./Switch.pLAWisIs.js";import{V as Up,R as Bp}from"./RichTextInput.B9YVpRNz.js";import{g as zp}from"./index.qXJUX2hH.js";import{g as Vp}from"./index.CA_plPtf.js";import{F as tl}from"./fuse.CU2r43ac.js";import{d as Fp,r as Kp}from"./relativeTime.9q8y7K30.js";import{S as Hs}from"./Spinner.BfJDCPnB.js";import{F as Lf}from"./FileItem.Cjfq6r6Q.js";import{h as vo,ba as Uf,bb as nl,bc as sa,bd as aa,ah as Gp,be as Wp,bf as qp,af as Bf,bg as Yp}from"./Markdown.DOcXJV3R.js";import{X as Ls}from"./XMark.DzmDuvr9.js";import{G as jp}from"./GlobeAlt.iWYO1y8O.js";import{K as Qp,S as Xp,E as Jp,M as Zp}from"./Messages.DVqL0ZuQ.js";import{m as jr}from"./marked.esm._0_gBwjO.js";import{C as xp}from"./ChevronDown.BdfXPb0q.js";import{C as $p}from"./Check.DdGE4lbh.js";import{g as e_,p as t_,d as n_}from"./index.vrDA1pue.js";import{C as o_}from"./ChatBubbleOval.DXGZr-yu.js";import{g as Yn,a as wi}from"./spread.CgU5AtxT.js";import{f as r_}from"./FileSaver.min.BseE1B50.js";import{a as i_}from"./index.BWjgQBxI.js";import{T as s_}from"./Tags.DOLLJ2NI.js";import{M as a_}from"./MenuLines.CLXb6fAt.js";import{M as l_}from"./Modal.BE09wbh8.js";import{A as c_}from"./AdvancedParams.H_7EaZG-.js";import{g as u_,j as d_,k as f_,l as h_}from"./index.-DoZw4I1.js";import{V as g_,H as m_}from"./Heart.D4z8nk2c.js";import{C as ss}from"./Collapsible.BlvfD2B_.js";import{D as p_}from"./Drawer.D8wfpNYo.js";import{E as __}from"./EllipsisVertical.Cm68ont1.js";import{C as b_}from"./ConfirmDialog.k0xjQhtS.js";import{f as Wi}from"./index.EYQgLDYX.js";function y_(o){let e;for(;e=o.sourceEvent;)o=e;return o}function Oo(o,e){if(o=y_(o),e===void 0&&(e=o.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var n=t.createSVGPoint();return n.x=o.clientX,n.y=o.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[o.clientX-r.left-e.clientLeft,o.clientY-r.top-e.clientTop]}}return[o.pageX,o.pageY]}const v_={passive:!1},ki={capture:!0,passive:!1};function la(o){o.stopImmediatePropagation()}function Fr(o){o.preventDefault(),o.stopImmediatePropagation()}function zf(o){var e=o.document.documentElement,t=vo(o).on("dragstart.drag",Fr,ki);"onselectstart"in e?t.on("selectstart.drag",Fr,ki):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Vf(o,e){var t=o.document.documentElement,n=vo(o).on("dragstart.drag",null);e&&(n.on("click.drag",Fr,ki),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in t?n.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const qi=o=>()=>o;function Ia(o,{sourceEvent:e,subject:t,target:n,identifier:r,active:i,x:s,y:a,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:o,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}Ia.prototype.on=function(){var o=this._.on.apply(this._,arguments);return o===this._?this:o};function w_(o){return!o.ctrlKey&&!o.button}function k_(){return this.parentNode}function C_(o,e){return e??{x:o.x,y:o.y}}function E_(){return navigator.maxTouchPoints||"ontouchstart"in this}function I_(){var o=w_,e=k_,t=C_,n=E_,r={},i=Uf("start","drag","end"),s=0,a,l,c,u,d=0;function f(I){I.on("mousedown.drag",h).filter(n).on("touchstart.drag",v).on("touchmove.drag",m,v_).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(I,S){if(!(u||!o.call(this,I,S))){var k=w(this,e.call(this,I,S),I,S,"mouse");k&&(vo(I.view).on("mousemove.drag",_,ki).on("mouseup.drag",b,ki),zf(I.view),la(I),c=!1,a=I.clientX,l=I.clientY,k("start",I))}}function _(I){if(Fr(I),!c){var S=I.clientX-a,k=I.clientY-l;c=S*S+k*k>d}r.mouse("drag",I)}function b(I){vo(I.view).on("mousemove.drag mouseup.drag",null),Vf(I.view,c),Fr(I),r.mouse("end",I)}function v(I,S){if(o.call(this,I,S)){var k=I.changedTouches,C=e.call(this,I,S),R=k.length,D,H;for(D=0;D<R;++D)(H=w(this,C,I,S,k[D].identifier,k[D]))&&(la(I),H("start",I,k[D]))}}function m(I){var S=I.changedTouches,k=S.length,C,R;for(C=0;C<k;++C)(R=r[S[C].identifier])&&(Fr(I),R("drag",I,S[C]))}function y(I){var S=I.changedTouches,k=S.length,C,R;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),C=0;C<k;++C)(R=r[S[C].identifier])&&(la(I),R("end",I,S[C]))}function w(I,S,k,C,R,D){var H=i.copy(),z=Oo(D||k,S),W,K,P;if((P=t.call(I,new Ia("beforestart",{sourceEvent:k,target:f,identifier:R,active:s,x:z[0],y:z[1],dx:0,dy:0,dispatch:H}),C))!=null)return W=P.x-z[0]||0,K=P.y-z[1]||0,function V(L,q,Z){var Q=z,Y;switch(L){case"start":r[R]=V,Y=s++;break;case"end":delete r[R],--s;case"drag":z=Oo(Z||q,S),Y=s;break}H.call(L,I,new Ia(L,{sourceEvent:q,subject:P,target:f,identifier:R,active:Y,x:z[0]+W,y:z[1]+K,dx:z[0]-Q[0],dy:z[1]-Q[1],dispatch:H}),C)}}return f.filter=function(I){return arguments.length?(o=typeof I=="function"?I:qi(!!I),f):o},f.container=function(I){return arguments.length?(e=typeof I=="function"?I:qi(I),f):e},f.subject=function(I){return arguments.length?(t=typeof I=="function"?I:qi(I),f):t},f.touchable=function(I){return arguments.length?(n=typeof I=="function"?I:qi(!!I),f):n},f.on=function(){var I=i.on.apply(i,arguments);return I===i?f:I},f.clickDistance=function(I){return arguments.length?(d=(I=+I)*I,f):Math.sqrt(d)},f}var T_=1e-12;function lc(o){return((o=Math.exp(o))+1/o)/2}function S_(o){return((o=Math.exp(o))-1/o)/2}function A_(o){return((o=Math.exp(2*o))-1)/(o+1)}const R_=function o(e,t,n){function r(i,s){var a=i[0],l=i[1],c=i[2],u=s[0],d=s[1],f=s[2],h=u-a,_=d-l,b=h*h+_*_,v,m;if(b<T_)m=Math.log(f/c)/e,v=function(C){return[a+C*h,l+C*_,c*Math.exp(e*C*m)]};else{var y=Math.sqrt(b),w=(f*f-c*c+n*b)/(2*c*t*y),I=(f*f-c*c-n*b)/(2*f*t*y),S=Math.log(Math.sqrt(w*w+1)-w),k=Math.log(Math.sqrt(I*I+1)-I);m=(k-S)/e,v=function(C){var R=C*m,D=lc(S),H=c/(t*y)*(D*A_(e*R+S)-S_(S));return[a+H*h,l+H*_,c*D/lc(e*R+S)]}}return v.duration=m*1e3*e/Math.SQRT2,v}return r.rho=function(i){var s=Math.max(.001,+i),a=s*s,l=a*a;return o(s,a,l)},r}(Math.SQRT2,2,4),Yi=o=>()=>o;function M_(o,{sourceEvent:e,target:t,transform:n,dispatch:r}){Object.defineProperties(this,{type:{value:o,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:r}})}function ca(o){o.stopImmediatePropagation()}function fi(o){o.preventDefault(),o.stopImmediatePropagation()}function O_(o){return(!o.ctrlKey||o.type==="wheel")&&!o.button}function P_(){var o=this;return o instanceof SVGElement?(o=o.ownerSVGElement||o,o.hasAttribute("viewBox")?(o=o.viewBox.baseVal,[[o.x,o.y],[o.x+o.width,o.y+o.height]]):[[0,0],[o.width.baseVal.value,o.height.baseVal.value]]):[[0,0],[o.clientWidth,o.clientHeight]]}function cc(){return this.__zoom||nl}function N_(o){return-o.deltaY*(o.deltaMode===1?.05:o.deltaMode?1:.002)*(o.ctrlKey?10:1)}function D_(){return navigator.maxTouchPoints||"ontouchstart"in this}function H_(o,e,t){var n=o.invertX(e[0][0])-t[0][0],r=o.invertX(e[1][0])-t[1][0],i=o.invertY(e[0][1])-t[0][1],s=o.invertY(e[1][1])-t[1][1];return o.translate(r>n?(n+r)/2:Math.min(0,n)||Math.max(0,r),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}function L_(){var o=O_,e=P_,t=H_,n=N_,r=D_,i=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,l=R_,c=Uf("start","zoom","end"),u,d,f,h=500,_=150,b=0,v=10;function m(P){P.property("__zoom",cc).on("wheel.zoom",R,{passive:!1}).on("mousedown.zoom",D).on("dblclick.zoom",H).filter(r).on("touchstart.zoom",z).on("touchmove.zoom",W).on("touchend.zoom touchcancel.zoom",K).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(P,V,L,q){var Z=P.selection?P.selection():P;Z.property("__zoom",cc),P!==Z?S(P,V,L,q):Z.interrupt().each(function(){k(this,arguments).event(q).start().zoom(null,typeof V=="function"?V.apply(this,arguments):V).end()})},m.scaleBy=function(P,V,L,q){m.scaleTo(P,function(){var Z=this.__zoom.k,Q=typeof V=="function"?V.apply(this,arguments):V;return Z*Q},L,q)},m.scaleTo=function(P,V,L,q){m.transform(P,function(){var Z=e.apply(this,arguments),Q=this.__zoom,Y=L==null?I(Z):typeof L=="function"?L.apply(this,arguments):L,te=Q.invert(Y),F=typeof V=="function"?V.apply(this,arguments):V;return t(w(y(Q,F),Y,te),Z,s)},L,q)},m.translateBy=function(P,V,L,q){m.transform(P,function(){return t(this.__zoom.translate(typeof V=="function"?V.apply(this,arguments):V,typeof L=="function"?L.apply(this,arguments):L),e.apply(this,arguments),s)},null,q)},m.translateTo=function(P,V,L,q,Z){m.transform(P,function(){var Q=e.apply(this,arguments),Y=this.__zoom,te=q==null?I(Q):typeof q=="function"?q.apply(this,arguments):q;return t(nl.translate(te[0],te[1]).scale(Y.k).translate(typeof V=="function"?-V.apply(this,arguments):-V,typeof L=="function"?-L.apply(this,arguments):-L),Q,s)},q,Z)};function y(P,V){return V=Math.max(i[0],Math.min(i[1],V)),V===P.k?P:new sa(V,P.x,P.y)}function w(P,V,L){var q=V[0]-L[0]*P.k,Z=V[1]-L[1]*P.k;return q===P.x&&Z===P.y?P:new sa(P.k,q,Z)}function I(P){return[(+P[0][0]+ +P[1][0])/2,(+P[0][1]+ +P[1][1])/2]}function S(P,V,L,q){P.on("start.zoom",function(){k(this,arguments).event(q).start()}).on("interrupt.zoom end.zoom",function(){k(this,arguments).event(q).end()}).tween("zoom",function(){var Z=this,Q=arguments,Y=k(Z,Q).event(q),te=e.apply(Z,Q),F=L==null?I(te):typeof L=="function"?L.apply(Z,Q):L,j=Math.max(te[1][0]-te[0][0],te[1][1]-te[0][1]),x=Z.__zoom,J=typeof V=="function"?V.apply(Z,Q):V,ve=l(x.invert(F).concat(j/x.k),J.invert(F).concat(j/J.k));return function(le){if(le===1)le=J;else{var me=ve(le),X=j/me[2];le=new sa(X,F[0]-me[0]*X,F[1]-me[1]*X)}Y.zoom(null,le)}})}function k(P,V,L){return!L&&P.__zooming||new C(P,V)}function C(P,V){this.that=P,this.args=V,this.active=0,this.sourceEvent=null,this.extent=e.apply(P,V),this.taps=0}C.prototype={event:function(P){return P&&(this.sourceEvent=P),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(P,V){return this.mouse&&P!=="mouse"&&(this.mouse[1]=V.invert(this.mouse[0])),this.touch0&&P!=="touch"&&(this.touch0[1]=V.invert(this.touch0[0])),this.touch1&&P!=="touch"&&(this.touch1[1]=V.invert(this.touch1[0])),this.that.__zoom=V,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(P){var V=vo(this.that).datum();c.call(P,this.that,new M_(P,{sourceEvent:this.sourceEvent,target:m,type:P,transform:this.that.__zoom,dispatch:c}),V)}};function R(P,...V){if(!o.apply(this,arguments))return;var L=k(this,V).event(P),q=this.__zoom,Z=Math.max(i[0],Math.min(i[1],q.k*Math.pow(2,n.apply(this,arguments)))),Q=Oo(P);if(L.wheel)(L.mouse[0][0]!==Q[0]||L.mouse[0][1]!==Q[1])&&(L.mouse[1]=q.invert(L.mouse[0]=Q)),clearTimeout(L.wheel);else{if(q.k===Z)return;L.mouse=[Q,q.invert(Q)],aa(this),L.start()}fi(P),L.wheel=setTimeout(Y,_),L.zoom("mouse",t(w(y(q,Z),L.mouse[0],L.mouse[1]),L.extent,s));function Y(){L.wheel=null,L.end()}}function D(P,...V){if(f||!o.apply(this,arguments))return;var L=P.currentTarget,q=k(this,V,!0).event(P),Z=vo(P.view).on("mousemove.zoom",F,!0).on("mouseup.zoom",j,!0),Q=Oo(P,L),Y=P.clientX,te=P.clientY;zf(P.view),ca(P),q.mouse=[Q,this.__zoom.invert(Q)],aa(this),q.start();function F(x){if(fi(x),!q.moved){var J=x.clientX-Y,ve=x.clientY-te;q.moved=J*J+ve*ve>b}q.event(x).zoom("mouse",t(w(q.that.__zoom,q.mouse[0]=Oo(x,L),q.mouse[1]),q.extent,s))}function j(x){Z.on("mousemove.zoom mouseup.zoom",null),Vf(x.view,q.moved),fi(x),q.event(x).end()}}function H(P,...V){if(o.apply(this,arguments)){var L=this.__zoom,q=Oo(P.changedTouches?P.changedTouches[0]:P,this),Z=L.invert(q),Q=L.k*(P.shiftKey?.5:2),Y=t(w(y(L,Q),q,Z),e.apply(this,V),s);fi(P),a>0?vo(this).transition().duration(a).call(S,Y,q,P):vo(this).call(m.transform,Y,q,P)}}function z(P,...V){if(o.apply(this,arguments)){var L=P.touches,q=L.length,Z=k(this,V,P.changedTouches.length===q).event(P),Q,Y,te,F;for(ca(P),Y=0;Y<q;++Y)te=L[Y],F=Oo(te,this),F=[F,this.__zoom.invert(F),te.identifier],Z.touch0?!Z.touch1&&Z.touch0[2]!==F[2]&&(Z.touch1=F,Z.taps=0):(Z.touch0=F,Q=!0,Z.taps=1+!!u);u&&(u=clearTimeout(u)),Q&&(Z.taps<2&&(d=F[0],u=setTimeout(function(){u=null},h)),aa(this),Z.start())}}function W(P,...V){if(this.__zooming){var L=k(this,V).event(P),q=P.changedTouches,Z=q.length,Q,Y,te,F;for(fi(P),Q=0;Q<Z;++Q)Y=q[Q],te=Oo(Y,this),L.touch0&&L.touch0[2]===Y.identifier?L.touch0[0]=te:L.touch1&&L.touch1[2]===Y.identifier&&(L.touch1[0]=te);if(Y=L.that.__zoom,L.touch1){var j=L.touch0[0],x=L.touch0[1],J=L.touch1[0],ve=L.touch1[1],le=(le=J[0]-j[0])*le+(le=J[1]-j[1])*le,me=(me=ve[0]-x[0])*me+(me=ve[1]-x[1])*me;Y=y(Y,Math.sqrt(le/me)),te=[(j[0]+J[0])/2,(j[1]+J[1])/2],F=[(x[0]+ve[0])/2,(x[1]+ve[1])/2]}else if(L.touch0)te=L.touch0[0],F=L.touch0[1];else return;L.zoom("touch",t(w(Y,te,F),L.extent,s))}}function K(P,...V){if(this.__zooming){var L=k(this,V).event(P),q=P.changedTouches,Z=q.length,Q,Y;for(ca(P),f&&clearTimeout(f),f=setTimeout(function(){f=null},h),Q=0;Q<Z;++Q)Y=q[Q],L.touch0&&L.touch0[2]===Y.identifier?delete L.touch0:L.touch1&&L.touch1[2]===Y.identifier&&delete L.touch1;if(L.touch1&&!L.touch0&&(L.touch0=L.touch1,delete L.touch1),L.touch0)L.touch0[1]=this.__zoom.invert(L.touch0[0]);else if(L.end(),L.taps===2&&(Y=Oo(Y,this),Math.hypot(d[0]-Y[0],d[1]-Y[1])<v)){var te=vo(this).on("dblclick.zoom");te&&te.apply(this,arguments)}}}return m.wheelDelta=function(P){return arguments.length?(n=typeof P=="function"?P:Yi(+P),m):n},m.filter=function(P){return arguments.length?(o=typeof P=="function"?P:Yi(!!P),m):o},m.touchable=function(P){return arguments.length?(r=typeof P=="function"?P:Yi(!!P),m):r},m.extent=function(P){return arguments.length?(e=typeof P=="function"?P:Yi([[+P[0][0],+P[0][1]],[+P[1][0],+P[1][1]]]),m):e},m.scaleExtent=function(P){return arguments.length?(i[0]=+P[0],i[1]=+P[1],m):[i[0],i[1]]},m.translateExtent=function(P){return arguments.length?(s[0][0]=+P[0][0],s[1][0]=+P[1][0],s[0][1]=+P[0][1],s[1][1]=+P[1][1],m):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},m.constrain=function(P){return arguments.length?(t=P,m):t},m.duration=function(P){return arguments.length?(a=+P,m):a},m.interpolate=function(P){return arguments.length?(l=P,m):l},m.on=function(){var P=c.on.apply(c,arguments);return P===c?m:P},m.clickDistance=function(P){return arguments.length?(b=(P=+P)*P,m):Math.sqrt(b)},m.tapDistance=function(P){return arguments.length?(v=+P,m):v},m}const U_=o=>({subIds:o&1}),uc=o=>({subIds:o[0]});function B_(o){let e;const t=o[6].default,n=Ft(t,o,o[5],uc);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,[i]){n&&n.p&&(!e||i&33)&&Kt(n,t,r,r[5],e?Wt(t,r[5],i,U_):Gt(r[5]),uc)},i(r){e||(T(n,r),e=!0)},o(r){N(n,r),e=!1},d(r){n&&n.d(r)}}}function z_(o,e,t){let n,{$$slots:r={},$$scope:i}=e,{disabled:s=void 0}=e,{open:a=void 0}=e,{onOpenChange:l=void 0}=e;const{updateOption:c,ids:u,states:{subOpen:d}}=Op({disabled:s,onOpenChange:({next:h})=>(a!==h&&(l==null||l(h),t(2,a=h)),h)}),f=br([u.menu,u.trigger],([h,_])=>({menu:h,trigger:_}));return fe(o,f,h=>t(0,n=h)),o.$$set=h=>{"disabled"in h&&t(3,s=h.disabled),"open"in h&&t(2,a=h.open),"onOpenChange"in h&&t(4,l=h.onOpenChange),"$$scope"in h&&t(5,i=h.$$scope)},o.$$.update=()=>{o.$$.dirty&4&&a!==void 0&&d.set(a),o.$$.dirty&8&&c("disabled",s)},[n,f,a,s,l,i,r]}class V_ extends Ge{constructor(e){super(),We(this,e,z_,B_,Ye,{disabled:3,open:2,onOpenChange:4})}}const F_=o=>({builder:o[0]&256}),dc=o=>({builder:o[8]}),K_=o=>({builder:o[0]&256}),fc=o=>({builder:o[8]}),G_=o=>({builder:o[0]&256}),hc=o=>({builder:o[8]}),W_=o=>({builder:o[0]&256}),gc=o=>({builder:o[8]}),q_=o=>({builder:o[0]&256}),mc=o=>({builder:o[8]}),Y_=o=>({builder:o[0]&256}),pc=o=>({builder:o[8]});function j_(o){let e,t,n,r;const i=o[28].default,s=Ft(i,o,o[27],dc);let a=[o[8],o[13]],l={};for(let c=0;c<a.length;c+=1)l=wt(l,a[c]);return{c(){e=M("div"),s&&s.c(),this.h()},l(c){e=O(c,"DIV",{});var u=A(e);s&&s.l(u),u.forEach(p),this.h()},h(){Sn(e,l)},m(c,u){U(c,e,u),s&&s.m(e,null),o[33](e),t=!0,n||(r=[wn(o[8].action(e)),we(e,"m-focusout",o[12]),we(e,"m-keydown",o[12]),we(e,"m-pointermove",o[12])],n=!0)},p(c,u){s&&s.p&&(!t||u[0]&134217984)&&Kt(s,i,c,c[27],t?Wt(i,c[27],u,F_):Gt(c[27]),dc),Sn(e,l=Yn(a,[u[0]&256&&c[8],u[0]&8192&&c[13]]))},i(c){t||(T(s,c),t=!0)},o(c){N(s,c),t=!1},d(c){c&&p(e),s&&s.d(c),o[33](null),n=!1,cn(r)}}}function Q_(o){let e,t,n,r,i;const s=o[28].default,a=Ft(s,o,o[27],fc);let l=[o[8],o[13]],c={};for(let u=0;u<l.length;u+=1)c=wt(c,l[u]);return{c(){e=M("div"),a&&a.c(),this.h()},l(u){e=O(u,"DIV",{});var d=A(e);a&&a.l(d),d.forEach(p),this.h()},h(){Sn(e,c)},m(u,d){U(u,e,d),a&&a.m(e,null),o[32](e),n=!0,r||(i=[wn(o[8].action(e)),we(e,"m-focusout",o[12]),we(e,"m-keydown",o[12]),we(e,"m-pointermove",o[12])],r=!0)},p(u,d){o=u,a&&a.p&&(!n||d[0]&134217984)&&Kt(a,s,o,o[27],n?Wt(s,o[27],d,K_):Gt(o[27]),fc),Sn(e,c=Yn(l,[d[0]&256&&o[8],d[0]&8192&&o[13]]))},i(u){n||(T(a,u),t&&t.end(1),n=!0)},o(u){N(a,u),u&&(t=Af(e,o[5],o[6])),n=!1},d(u){u&&p(e),a&&a.d(u),o[32](null),u&&t&&t.end(),r=!1,cn(i)}}}function X_(o){let e,t,n,r,i;const s=o[28].default,a=Ft(s,o,o[27],hc);let l=[o[8],o[13]],c={};for(let u=0;u<l.length;u+=1)c=wt(c,l[u]);return{c(){e=M("div"),a&&a.c(),this.h()},l(u){e=O(u,"DIV",{});var d=A(e);a&&a.l(d),d.forEach(p),this.h()},h(){Sn(e,c)},m(u,d){U(u,e,d),a&&a.m(e,null),o[31](e),n=!0,r||(i=[wn(o[8].action(e)),we(e,"m-focusout",o[12]),we(e,"m-keydown",o[12]),we(e,"m-pointermove",o[12])],r=!0)},p(u,d){o=u,a&&a.p&&(!n||d[0]&134217984)&&Kt(a,s,o,o[27],n?Wt(s,o[27],d,G_):Gt(o[27]),hc),Sn(e,c=Yn(l,[d[0]&256&&o[8],d[0]&8192&&o[13]]))},i(u){n||(T(a,u),u&&(t||Do(()=>{t=Ur(e,o[3],o[4]),t.start()})),n=!0)},o(u){N(a,u),n=!1},d(u){u&&p(e),a&&a.d(u),o[31](null),r=!1,cn(i)}}}function J_(o){let e,t,n,r,i,s;const a=o[28].default,l=Ft(a,o,o[27],gc);let c=[o[8],o[13]],u={};for(let d=0;d<c.length;d+=1)u=wt(u,c[d]);return{c(){e=M("div"),l&&l.c(),this.h()},l(d){e=O(d,"DIV",{});var f=A(e);l&&l.l(f),f.forEach(p),this.h()},h(){Sn(e,u)},m(d,f){U(d,e,f),l&&l.m(e,null),o[30](e),r=!0,i||(s=[wn(o[8].action(e)),we(e,"m-focusout",o[12]),we(e,"m-keydown",o[12]),we(e,"m-pointermove",o[12])],i=!0)},p(d,f){o=d,l&&l.p&&(!r||f[0]&134217984)&&Kt(l,a,o,o[27],r?Wt(a,o[27],f,W_):Gt(o[27]),gc),Sn(e,u=Yn(c,[f[0]&256&&o[8],f[0]&8192&&o[13]]))},i(d){r||(T(l,d),d&&Do(()=>{r&&(n&&n.end(1),t=Ur(e,o[3],o[4]),t.start())}),r=!0)},o(d){N(l,d),t&&t.invalidate(),d&&(n=Af(e,o[5],o[6])),r=!1},d(d){d&&p(e),l&&l.d(d),o[30](null),d&&n&&n.end(),i=!1,cn(s)}}}function Z_(o){let e,t,n,r,i;const s=o[28].default,a=Ft(s,o,o[27],mc);let l=[o[8],o[13]],c={};for(let u=0;u<l.length;u+=1)c=wt(c,l[u]);return{c(){e=M("div"),a&&a.c(),this.h()},l(u){e=O(u,"DIV",{});var d=A(e);a&&a.l(d),d.forEach(p),this.h()},h(){Sn(e,c)},m(u,d){U(u,e,d),a&&a.m(e,null),o[29](e),n=!0,r||(i=[wn(o[8].action(e)),we(e,"m-focusout",o[12]),we(e,"m-keydown",o[12]),we(e,"m-pointermove",o[12])],r=!0)},p(u,d){o=u,a&&a.p&&(!n||d[0]&134217984)&&Kt(a,s,o,o[27],n?Wt(s,o[27],d,q_):Gt(o[27]),mc),Sn(e,c=Yn(l,[d[0]&256&&o[8],d[0]&8192&&o[13]]))},i(u){n||(T(a,u),u&&Do(()=>{n&&(t||(t=nc(e,o[1],o[2],!0)),t.run(1))}),n=!0)},o(u){N(a,u),u&&(t||(t=nc(e,o[1],o[2],!1)),t.run(0)),n=!1},d(u){u&&p(e),a&&a.d(u),o[29](null),u&&t&&t.end(),r=!1,cn(i)}}}function x_(o){let e;const t=o[28].default,n=Ft(t,o,o[27],pc);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i[0]&134217984)&&Kt(n,t,r,r[27],e?Wt(t,r[27],i,Y_):Gt(r[27]),pc)},i(r){e||(T(n,r),e=!0)},o(r){N(n,r),e=!1},d(r){n&&n.d(r)}}}function $_(o){let e,t,n,r;const i=[x_,Z_,J_,X_,Q_,j_],s=[];function a(l,c){return l[7]&&l[9]?0:l[1]&&l[9]?1:l[3]&&l[5]&&l[9]?2:l[3]&&l[9]?3:l[5]&&l[9]?4:l[9]?5:-1}return~(e=a(o))&&(t=s[e]=i[e](o)),{c(){t&&t.c(),n=qe()},l(l){t&&t.l(l),n=qe()},m(l,c){~e&&s[e].m(l,c),U(l,n,c),r=!0},p(l,c){let u=e;e=a(l),e===u?~e&&s[e].p(l,c):(t&&(De(),N(s[u],1,1,()=>{s[u]=null}),He()),~e?(t=s[e],t?t.p(l,c):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n)):t=null)},i(l){r||(T(t),r=!0)},o(l){N(t),r=!1},d(l){l&&p(n),~e&&s[e].d(l)}}}function e1(o,e,t){let n;const r=["transition","transitionConfig","inTransition","inTransitionConfig","outTransition","outTransitionConfig","asChild","id","side","align","sideOffset","alignOffset","collisionPadding","avoidCollisions","collisionBoundary","sameWidth","fitViewport","strategy","overlap","el"];let i=$t(e,r),s,a,{$$slots:l={},$$scope:c}=e,{transition:u=void 0}=e,{transitionConfig:d=void 0}=e,{inTransition:f=void 0}=e,{inTransitionConfig:h=void 0}=e,{outTransition:_=void 0}=e,{outTransitionConfig:b=void 0}=e,{asChild:v=!1}=e,{id:m=void 0}=e,{side:y="right"}=e,{align:w="start"}=e,{sideOffset:I=0}=e,{alignOffset:S=0}=e,{collisionPadding:k=8}=e,{avoidCollisions:C=!0}=e,{collisionBoundary:R=void 0}=e,{sameWidth:D=!1}=e,{fitViewport:H=!1}=e,{strategy:z="absolute"}=e,{overlap:W=!1}=e,{el:K=void 0}=e;const{elements:{subMenu:P},states:{subOpen:V},ids:L,getAttrs:q}=Pp();fe(o,P,J=>t(26,s=J)),fe(o,V,J=>t(9,a=J));const Z=Df(),Q=q("sub-content");function Y(J){ze[J?"unshift":"push"](()=>{K=J,t(0,K)})}function te(J){ze[J?"unshift":"push"](()=>{K=J,t(0,K)})}function F(J){ze[J?"unshift":"push"](()=>{K=J,t(0,K)})}function j(J){ze[J?"unshift":"push"](()=>{K=J,t(0,K)})}function x(J){ze[J?"unshift":"push"](()=>{K=J,t(0,K)})}return o.$$set=J=>{e=wt(wt({},e),eo(J)),t(13,i=$t(e,r)),"transition"in J&&t(1,u=J.transition),"transitionConfig"in J&&t(2,d=J.transitionConfig),"inTransition"in J&&t(3,f=J.inTransition),"inTransitionConfig"in J&&t(4,h=J.inTransitionConfig),"outTransition"in J&&t(5,_=J.outTransition),"outTransitionConfig"in J&&t(6,b=J.outTransitionConfig),"asChild"in J&&t(7,v=J.asChild),"id"in J&&t(14,m=J.id),"side"in J&&t(15,y=J.side),"align"in J&&t(16,w=J.align),"sideOffset"in J&&t(17,I=J.sideOffset),"alignOffset"in J&&t(18,S=J.alignOffset),"collisionPadding"in J&&t(19,k=J.collisionPadding),"avoidCollisions"in J&&t(20,C=J.avoidCollisions),"collisionBoundary"in J&&t(21,R=J.collisionBoundary),"sameWidth"in J&&t(22,D=J.sameWidth),"fitViewport"in J&&t(23,H=J.fitViewport),"strategy"in J&&t(24,z=J.strategy),"overlap"in J&&t(25,W=J.overlap),"el"in J&&t(0,K=J.el),"$$scope"in J&&t(27,c=J.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&16384&&m&&L.menu.set(m),o.$$.dirty[0]&67108864&&t(8,n=s),o.$$.dirty[0]&256&&Object.assign(n,Q),o.$$.dirty[0]&67076096&&Np({side:y,align:w,sideOffset:I,alignOffset:S,collisionPadding:k,avoidCollisions:C,collisionBoundary:R,sameWidth:D,fitViewport:H,strategy:z,overlap:W})},[K,u,d,f,h,_,b,v,n,a,P,V,Z,i,m,y,w,I,S,k,C,R,D,H,z,W,s,c,l,Y,te,F,j,x]}class t1 extends Ge{constructor(e){super(),We(this,e,e1,$_,Ye,{transition:1,transitionConfig:2,inTransition:3,inTransitionConfig:4,outTransition:5,outTransitionConfig:6,asChild:7,id:14,side:15,align:16,sideOffset:17,alignOffset:18,collisionPadding:19,avoidCollisions:20,collisionBoundary:21,sameWidth:22,fitViewport:23,strategy:24,overlap:25,el:0},null,[-1,-1])}}const n1=o=>({builder:o&4}),_c=o=>({builder:o[2]}),o1=o=>({builder:o&4}),bc=o=>({builder:o[2]});function r1(o){let e,t,n,r;const i=o[13].default,s=Ft(i,o,o[12],_c);let a=[o[2],o[6]],l={};for(let c=0;c<a.length;c+=1)l=wt(l,a[c]);return{c(){e=M("div"),s&&s.c(),this.h()},l(c){e=O(c,"DIV",{});var u=A(e);s&&s.l(u),u.forEach(p),this.h()},h(){Sn(e,l)},m(c,u){U(c,e,u),s&&s.m(e,null),o[14](e),t=!0,n||(r=[wn(o[2].action(e)),we(e,"m-click",o[5]),we(e,"m-focusin",o[5]),we(e,"m-focusout",o[5]),we(e,"m-keydown",o[5]),we(e,"m-pointerleave",o[5]),we(e,"m-pointermove",o[5])],n=!0)},p(c,u){s&&s.p&&(!t||u&4100)&&Kt(s,i,c,c[12],t?Wt(i,c[12],u,n1):Gt(c[12]),_c),Sn(e,l=Yn(a,[u&4&&c[2],u&64&&c[6]]))},i(c){t||(T(s,c),t=!0)},o(c){N(s,c),t=!1},d(c){c&&p(e),s&&s.d(c),o[14](null),n=!1,cn(r)}}}function i1(o){let e;const t=o[13].default,n=Ft(t,o,o[12],bc);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i&4100)&&Kt(n,t,r,r[12],e?Wt(t,r[12],i,o1):Gt(r[12]),bc)},i(r){e||(T(n,r),e=!0)},o(r){N(n,r),e=!1},d(r){n&&n.d(r)}}}function s1(o){let e,t,n,r;const i=[i1,r1],s=[];function a(l,c){return l[1]?0:1}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=qe()},l(l){t.l(l),n=qe()},m(l,c){s[e].m(l,c),U(l,n,c),r=!0},p(l,[c]){let u=e;e=a(l),e===u?s[e].p(l,c):(De(),N(s[u],1,1,()=>{s[u]=null}),He(),t=s[e],t?t.p(l,c):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){N(t),r=!1},d(l){l&&p(n),s[e].d(l)}}}function a1(o,e,t){let n,r;const i=["disabled","asChild","id","el"];let s=$t(e,i),a,l,{$$slots:c={},$$scope:u}=e,{disabled:d=!1}=e,{asChild:f=!1}=e,{id:h=void 0}=e,{el:_=void 0}=e;const{elements:{subTrigger:b},ids:v,getAttrs:m,options:y}=Dp();fe(o,b,k=>t(11,l=k));const{disabled:w}=y;fe(o,w,k=>t(10,a=k));const I=Df();function S(k){ze[k?"unshift":"push"](()=>{_=k,t(0,_)})}return o.$$set=k=>{e=wt(wt({},e),eo(k)),t(6,s=$t(e,i)),"disabled"in k&&t(7,d=k.disabled),"asChild"in k&&t(1,f=k.asChild),"id"in k&&t(8,h=k.id),"el"in k&&t(0,_=k.el),"$$scope"in k&&t(12,u=k.$$scope)},o.$$.update=()=>{o.$$.dirty&256&&h&&v.trigger.set(h),o.$$.dirty&2048&&t(2,n=l),o.$$.dirty&1152&&t(9,r={...m("sub-trigger"),...Mp(d||a)}),o.$$.dirty&516&&Object.assign(n,r)},[_,f,n,b,w,I,s,d,h,r,a,l,u,c,S]}class l1 extends Ge{constructor(e){super(),We(this,e,a1,s1,Ye,{disabled:7,asChild:1,id:8,el:0})}}function c1(o){let e,t;return e=new s_({props:{tags:o[0]}}),e.$on("delete",o[4]),e.$on("add",o[5]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,[r]){const i={};r&1&&(i.tags=n[0]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function u1(o,e,t){const n=An();let{chatId:r=""}=e,i=[];const s=async()=>await np().catch(async d=>[]),a=async d=>{await op(localStorage.token,r,d).catch(async h=>($e.error(`${h}`),null))&&(t(0,i=await s()),await ds(localStorage.token,r,{tags:i}),await va.set(await Ca(localStorage.token)),n("add",{name:d}))},l=async d=>{await rp(localStorage.token,r,d),t(0,i=await s()),await ds(localStorage.token,r,{tags:i}),await va.set(await Ca(localStorage.token)),n("delete",{name:d})};Kn(async()=>{r&&t(0,i=await s())});const c=d=>{l(d.detail)},u=d=>{a(d.detail)};return o.$$set=d=>{"chatId"in d&&t(3,r=d.chatId)},[i,a,l,r,c,u]}class d1 extends Ge{constructor(e){super(),We(this,e,u1,c1,Ye,{chatId:3})}}class f1{constructor(e,t){rr(this,"controller");rr(this,"stream",null);rr(this,"reader",null);rr(this,"messages",st([]));rr(this,"error",st(null));rr(this,"url");rr(this,"token");this.url=e,this.token=t}async connect(){this.stream&&await this.disconnect(),this.controller=new AbortController;let e=0;const t=3;for(;e<t;)try{const i=await fetch(this.url,{method:"GET",headers:{Authorization:`Bearer ${this.token}`},signal:this.controller.signal});if(i.ok){this.stream=i.body;break}e++,e<t&&await new Promise(s=>setTimeout(s,1e3))}catch{e++,e<t&&await new Promise(s=>setTimeout(s,1e3))}if(this.stream===null){console.log(`[parseMessages]SSE connection failed after ${t} retries`);return}this.reader=this.stream.getReader();const n=new TextDecoder;let r="";for(;;){const{done:i,value:s}=await this.reader.read();if(i)break;const a=n.decode(s,{stream:!0});r+=a;const l=this.parseMessages(r);r=r.slice(l.length*a.length),l.forEach(c=>{this.messages.update(u=>[...u,c])})}}parseMessages(e){const t=[],n=/event: (connected|user_message|message_start|new_token|message_end|langfuse_url|attached_context|message_ready)\r\ndata: (.*?)\r\n\r\n/gs;let r;for(;(r=n.exec(e))!==null;){const[,i,s]=r,a=JSON.parse(s);t.push({type:i,data:a})}return t}async disconnect(){try{if(this.reader&&(await this.reader.cancel(),this.reader=null),this.controller){try{this.controller.signal&&!this.controller.signal.aborted&&this.controller.abort()}catch(e){console.warn("AbortController was already aborted:",e)}this.controller=null}this.stream=null}catch(e){console.error("Error during disconnect:",e)}}retryConnection(e=5e3){setTimeout(()=>{this.connect()},e)}}function h1(o){let e,t,n,r,i,s,a;return l(),{feed:c,reset:l};function l(){e=!0,t="",n=0,r=-1,i=void 0,s=void 0,a=""}function c(d){t=t?t+d:d,e&&g1(t)&&(t=t.slice(Ff.length)),e=!1;const f=t.length;let h=0,_=!1;for(;h<f;){_&&(t[h]===`
`&&++h,_=!1);let b=-1,v=r,m;for(let y=n;b<0&&y<f;++y)m=t[y],m===":"&&v<0?v=y-h:m==="\r"?(_=!0,b=y-h):m===`
`&&(b=y-h);if(b<0){n=f-h,r=v;break}else n=0,r=-1;u(t,h,v,b),h+=b+1}h===f?t="":h>0&&(t=t.slice(h))}function u(d,f,h,_){if(_===0){a.length>0&&(o({type:"event",id:i,event:s||void 0,data:a.slice(0,-1)}),a="",i=void 0),s=void 0;return}const b=h<0,v=d.slice(f,f+(b?_:h));let m=0;b?m=_:d[f+h+1]===" "?m=h+2:m=h+1;const y=f+m,w=_-m,I=d.slice(y,y+w).toString();if(v==="data")a+=I?"".concat(I,`
`):`
`;else if(v==="event")s=I;else if(v==="id"&&!I.includes("\0"))i=I;else if(v==="retry"){const S=parseInt(I,10);Number.isNaN(S)||o({type:"reconnect-interval",value:S})}}}const Ff=[239,187,191];function g1(o){return Ff.every((e,t)=>o.charCodeAt(t)===e)}class m1 extends TransformStream{constructor(){let e;super({start(t){e=h1(n=>{n.type==="event"&&t.enqueue(n)})},transform(t){e.feed(t)}})}}async function p1(o,e){const t=o.pipeThrough(new TextDecoderStream).pipeThrough(new m1).getReader();let n=_1(t);return e&&(n=b1(n)),n}async function*_1(o){var e,t,n;for(;;){const{value:r,done:i}=await o.read();if(i){yield{done:!0,value:""};break}if(!r)continue;const s=r.data;if(s.startsWith("[DONE]")){yield{done:!0,value:""};break}try{const a=JSON.parse(s);if(console.log(a),a.error){yield{done:!0,value:"",error:a.error};break}if(a.sources){yield{done:!1,value:"",sources:a.sources};continue}if(a.selected_model_id){yield{done:!1,value:"",selectedModelId:a.selected_model_id};continue}if(a.usage){yield{done:!1,value:"",usage:a.usage};continue}yield{done:!1,value:((n=(t=(e=a.choices)==null?void 0:e[0])==null?void 0:t.delta)==null?void 0:n.content)??""}}catch(a){console.error("Error extracting delta from SSE event:",a)}}}async function*b1(o){for await(const e of o){if(e.done){yield e;return}if(e.error){yield e;continue}if(e.sources){yield e;continue}if(e.selectedModelId){yield e;continue}if(e.usage){yield e;continue}let t=e.value;if(t.length<5){yield{done:!1,value:t};continue}for(;t!="";){const n=Math.min(Math.floor(Math.random()*3)+1,t.length);yield{done:!1,value:t.slice(0,n)},(document==null?void 0:document.visibilityState)!=="hidden"&&await y1(5),t=t.slice(n)}}}const y1=o=>new Promise(e=>setTimeout(e,o));let Ci="",Ei="";async function v1(){var t,n;const o=await Ja("/api/config");if(!o.ok)throw new Error("Failed to fetch Google Drive credentials");const e=await o.json();if(Ci=(t=e.google_drive)==null?void 0:t.api_key,Ei=(n=e.google_drive)==null?void 0:n.client_id,!Ci||!Ei)throw new Error("Google Drive API credentials not configured")}const w1=["https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/drive.file"],k1=()=>{if(!Ci||!Ei)throw new Error("Google Drive API credentials not configured");if(Ci===""||Ei==="")throw new Error("Please configure valid Google Drive API credentials")};let ji=null,yc=!1;const C1=()=>new Promise((o,e)=>{if(typeof gapi>"u"){const t=document.createElement("script");t.src="https://apis.google.com/js/api.js",t.onload=()=>{gapi.load("picker",()=>{o(!0)})},t.onerror=e,document.body.appendChild(t)}else gapi.load("picker",()=>{o(!0)})}),E1=()=>new Promise((o,e)=>{if(typeof google>"u"){const t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.onload=o,t.onerror=e,document.body.appendChild(t)}else o(!0)}),I1=async()=>ji||new Promise((o,e)=>{google.accounts.oauth2.initTokenClient({client_id:Ei,scope:w1.join(" "),callback:n=>{n.access_token?(ji=n.access_token,o(ji)):e(new Error("Failed to get access token"))},error_callback:n=>{e(new Error(n.message||"OAuth error occurred"))}}).requestAccessToken()}),T1=async()=>{yc||(await v1(),k1(),await Promise.all([C1(),E1()]),yc=!0)},S1=()=>new Promise(async(o,e)=>{try{console.log("Initializing Google Drive Picker..."),await T1(),console.log("Getting auth token...");const t=await I1();if(!t)throw console.error("Failed to get OAuth token"),new Error("Unable to get OAuth token");console.log("Auth token obtained successfully"),new google.picker.PickerBuilder().enableFeature(google.picker.Feature.NAV_HIDDEN).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).addView(new google.picker.DocsView().setIncludeFolders(!1).setSelectFolderEnabled(!1).setMimeTypes("application/pdf,text/plain,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.google-apps.document,application/vnd.google-apps.spreadsheet,application/vnd.google-apps.presentation")).setOAuthToken(t).setDeveloperKey(Ci).setCallback(async r=>{if(r[google.picker.Response.ACTION]===google.picker.Action.PICKED)try{const i=r[google.picker.Response.DOCUMENTS][0],s=i[google.picker.Document.ID],a=i[google.picker.Document.NAME],l=i[google.picker.Document.URL];if(!s||!a)throw new Error("Required file details missing");const c=i[google.picker.Document.MIME_TYPE];let u,d;c.includes("google-apps")?(c.includes("document")?d="text/plain":c.includes("spreadsheet")?d="text/csv":c.includes("presentation")?d="text/plain":d="application/pdf",u=`https://www.googleapis.com/drive/v3/files/${s}/export?mimeType=${encodeURIComponent(d)}`):u=`https://www.googleapis.com/drive/v3/files/${s}?alt=media`;const f=await Ja(u,{headers:{Authorization:`Bearer ${t}`,Accept:"*/*"}});if(!f.ok){const b=await f.text();throw console.error("Download failed:",{status:f.status,statusText:f.statusText,error:b}),new Error(`Failed to download file (${f.status}): ${b}`)}const h=await f.blob(),_={id:s,name:a,url:u,blob:h,headers:{Authorization:`Bearer ${t}`,Accept:"*/*"}};o(_)}catch(i){e(i)}else r[google.picker.Response.ACTION]===google.picker.Action.CANCEL&&o(null)}).build().setVisible(!0)}catch(t){console.error("Google Drive Picker error:",t),e(t)}});/*! @azure/msal-common v15.2.0 2025-02-18 */const _e={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},Qi={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},Pi=[_e.OPENID_SCOPE,_e.PROFILE_SCOPE,_e.OFFLINE_ACCESS_SCOPE],vc=[...Pi,_e.EMAIL_SCOPE],zn={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},wc={ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},sr={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},Xi={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},Tn={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},kc={PLAIN:"plain",S256:"S256"},Ni={QUERY:"query",FRAGMENT:"fragment"},A1={...Ni,FORM_POST:"form_post"},Kf={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},Ji={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},Hn={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},bt={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},ol="appmetadata",R1="client_info",gi="1",fs={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},Xn={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},On={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},Vt={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},mi={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},Cc={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},Ec={username:"username",password:"password"},Zi={httpSuccess:200,httpBadRequest:400},Nr={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},ua={CONFIGURED_MATCHES_DETECTED:"1",CONFIGURED_NO_AUTO_DETECTION:"2",CONFIGURED_NOT_DETECTED:"3",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},pr={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},M1={Jwt:"JWT",Jwk:"JWK",Pop:"pop"},O1=300;/*! @azure/msal-common v15.2.0 2025-02-18 */const rl="unexpected_error",P1="post_request_failed";/*! @azure/msal-common v15.2.0 2025-02-18 */const Ic={[rl]:"Unexpected error in authentication.",[P1]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class ln extends Error{constructor(e,t,n){const r=t?`${e}: ${t}`:e;super(r),Object.setPrototypeOf(this,ln.prototype),this.errorCode=e||_e.EMPTY_STRING,this.errorMessage=t||_e.EMPTY_STRING,this.subError=n||_e.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function Gf(o,e){return new ln(o,e?`${Ic[o]} ${e}`:Ic[o])}/*! @azure/msal-common v15.2.0 2025-02-18 */const il="client_info_decoding_error",Wf="client_info_empty_error",sl="token_parsing_error",qf="null_or_empty_token",Wo="endpoints_resolution_error",Yf="network_error",jf="openid_config_error",Qf="hash_not_deserialized",Qr="invalid_state",Xf="state_mismatch",hs="state_not_found",Jf="nonce_mismatch",al="auth_time_not_found",Zf="max_age_transpired",N1="multiple_matching_tokens",D1="multiple_matching_accounts",xf="multiple_matching_appMetadata",$f="request_cannot_be_made",eh="cannot_remove_empty_scope",th="cannot_append_scopeset",Ta="empty_input_scopeset",H1="device_code_polling_cancelled",L1="device_code_expired",U1="device_code_unknown_error",ll="no_account_in_silent_request",nh="invalid_cache_record",cl="invalid_cache_environment",Sa="no_account_found",Aa="no_crypto_object",Ra="unexpected_credential_type",B1="invalid_assertion",z1="invalid_client_credential",ar="token_refresh_required",V1="user_timeout_reached",oh="token_claims_cnf_required_for_signedjwt",rh="authorization_code_missing_from_server_response",ih="binding_key_not_removed",sh="end_session_endpoint_not_supported",ul="key_id_missing",F1="no_network_connectivity",K1="user_canceled",G1="missing_tenant_id_error",kt="method_not_implemented",W1="nested_app_auth_bridge_disabled";/*! @azure/msal-common v15.2.0 2025-02-18 */const Tc={[il]:"The client info could not be parsed/decoded correctly",[Wf]:"The client info was empty",[sl]:"Token cannot be parsed",[qf]:"The token is null or empty",[Wo]:"Endpoints cannot be resolved",[Yf]:"Network request failed",[jf]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[Qf]:"The hash parameters could not be deserialized",[Qr]:"State was not the expected format",[Xf]:"State mismatch error",[hs]:"State not found",[Jf]:"Nonce mismatch error",[al]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[Zf]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[N1]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[D1]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[xf]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[$f]:"Token request cannot be made without authorization code or refresh token.",[eh]:"Cannot remove null or empty scope from ScopeSet",[th]:"Cannot append ScopeSet",[Ta]:"Empty input ScopeSet cannot be processed",[H1]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[L1]:"Device code is expired.",[U1]:"Device code stopped polling for unknown reasons.",[ll]:"Please pass an account object, silent flow is not supported without account information",[nh]:"Cache record object was null or undefined.",[cl]:"Invalid environment when attempting to create cache entry",[Sa]:"No account found in cache for given key.",[Aa]:"No crypto object detected.",[Ra]:"Unexpected credential type.",[B1]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[z1]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[ar]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[V1]:"User defined timeout for device code polling reached",[oh]:"Cannot generate a POP jwt if the token_claims are not populated",[rh]:"Server response does not contain an authorization code to proceed",[ih]:"Could not remove the credential's binding key from storage.",[sh]:"The provided authority does not support logout",[ul]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[F1]:"No network connectivity. Check your internet connection.",[K1]:"User cancelled the flow.",[G1]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[kt]:"This method has not been implemented",[W1]:"The nested app auth bridge is disabled"};class dl extends ln{constructor(e,t){super(e,t?`${Tc[e]}: ${t}`:Tc[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,dl.prototype)}}function Ee(o,e){return new dl(o,e)}/*! @azure/msal-common v15.2.0 2025-02-18 */const gs={createNewGuid:()=>{throw Ee(kt)},base64Decode:()=>{throw Ee(kt)},base64Encode:()=>{throw Ee(kt)},base64UrlEncode:()=>{throw Ee(kt)},encodeKid:()=>{throw Ee(kt)},async getPublicKeyThumbprint(){throw Ee(kt)},async removeTokenBindingKey(){throw Ee(kt)},async clearKeystore(){throw Ee(kt)},async signJwt(){throw Ee(kt)},async hashString(){throw Ee(kt)}};/*! @azure/msal-common v15.2.0 2025-02-18 */var an;(function(o){o[o.Error=0]="Error",o[o.Warning=1]="Warning",o[o.Info=2]="Info",o[o.Verbose=3]="Verbose",o[o.Trace=4]="Trace"})(an||(an={}));class lr{constructor(e,t,n){this.level=an.Info;const r=()=>{},i=e||lr.createDefaultLoggerOptions();this.localCallback=i.loggerCallback||r,this.piiLoggingEnabled=i.piiLoggingEnabled||!1,this.level=typeof i.logLevel=="number"?i.logLevel:an.Info,this.correlationId=i.correlationId||_e.EMPTY_STRING,this.packageName=t||_e.EMPTY_STRING,this.packageVersion=n||_e.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:an.Info}}clone(e,t,n){return new lr({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:n||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const i=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${an[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,i,t.containsPii||!1)}executeCallback(e,t,n){this.localCallback&&this.localCallback(e,t,n)}error(e,t){this.logMessage(e,{logLevel:an.Error,containsPii:!1,correlationId:t||_e.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:an.Error,containsPii:!0,correlationId:t||_e.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:an.Warning,containsPii:!1,correlationId:t||_e.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:an.Warning,containsPii:!0,correlationId:t||_e.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:an.Info,containsPii:!1,correlationId:t||_e.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:an.Info,containsPii:!0,correlationId:t||_e.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:an.Verbose,containsPii:!1,correlationId:t||_e.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:an.Verbose,containsPii:!0,correlationId:t||_e.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:an.Trace,containsPii:!1,correlationId:t||_e.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:an.Trace,containsPii:!0,correlationId:t||_e.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}/*! @azure/msal-common v15.2.0 2025-02-18 */const ah="@azure/msal-common",fl="15.2.0";/*! @azure/msal-common v15.2.0 2025-02-18 */const hl={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"};/*! @azure/msal-common v15.2.0 2025-02-18 */function ni(o,e){const t=q1(o);try{const n=e(t);return JSON.parse(n)}catch{throw Ee(sl)}}function q1(o){if(!o)throw Ee(qf);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(o);if(!t||t.length<4)throw Ee(sl);return t[2]}function lh(o,e){if(e===0||Date.now()-3e5>o+e)throw Ee(Zf)}/*! @azure/msal-common v15.2.0 2025-02-18 */function zo(){return Math.round(new Date().getTime()/1e3)}function Ma(o,e){const t=Number(o)||0;return zo()+e>t}function Y1(o){return Number(o)>zo()}/*! @azure/msal-common v15.2.0 2025-02-18 */function pi(o){return[J1(o),Z1(o),x1(o),$1(o),e0(o)].join(Hn.CACHE_KEY_SEPARATOR).toLowerCase()}function Us(o,e,t,n,r){return{credentialType:bt.ID_TOKEN,homeAccountId:o,environment:e,clientId:n,secret:t,realm:r}}function Bs(o,e,t,n,r,i,s,a,l,c,u,d,f,h,_){var v,m;const b={homeAccountId:o,credentialType:bt.ACCESS_TOKEN,secret:t,cachedAt:zo().toString(),expiresOn:s.toString(),extendedExpiresOn:a.toString(),environment:e,clientId:n,realm:r,target:i,tokenType:u||Vt.BEARER};if(d&&(b.userAssertionHash=d),c&&(b.refreshOn=c.toString()),h&&(b.requestedClaims=h,b.requestedClaimsHash=_),((v=b.tokenType)==null?void 0:v.toLowerCase())!==Vt.BEARER.toLowerCase())switch(b.credentialType=bt.ACCESS_TOKEN_WITH_AUTH_SCHEME,b.tokenType){case Vt.POP:const y=ni(t,l);if(!((m=y==null?void 0:y.cnf)!=null&&m.kid))throw Ee(oh);b.keyId=y.cnf.kid;break;case Vt.SSH:b.keyId=f}return b}function ch(o,e,t,n,r,i,s){const a={credentialType:bt.REFRESH_TOKEN,homeAccountId:o,environment:e,clientId:n,secret:t};return i&&(a.userAssertionHash=i),r&&(a.familyId=r),s&&(a.expiresOn=s.toString()),a}function gl(o){return o.hasOwnProperty("homeAccountId")&&o.hasOwnProperty("environment")&&o.hasOwnProperty("credentialType")&&o.hasOwnProperty("clientId")&&o.hasOwnProperty("secret")}function j1(o){return o?gl(o)&&o.hasOwnProperty("realm")&&o.hasOwnProperty("target")&&(o.credentialType===bt.ACCESS_TOKEN||o.credentialType===bt.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function Q1(o){return o?gl(o)&&o.hasOwnProperty("realm")&&o.credentialType===bt.ID_TOKEN:!1}function X1(o){return o?gl(o)&&o.credentialType===bt.REFRESH_TOKEN:!1}function J1(o){return[o.homeAccountId,o.environment].join(Hn.CACHE_KEY_SEPARATOR).toLowerCase()}function Z1(o){const e=o.credentialType===bt.REFRESH_TOKEN&&o.familyId||o.clientId;return[o.credentialType,e,o.realm||""].join(Hn.CACHE_KEY_SEPARATOR).toLowerCase()}function x1(o){return(o.target||"").toLowerCase()}function $1(o){return(o.requestedClaimsHash||"").toLowerCase()}function e0(o){return o.tokenType&&o.tokenType.toLowerCase()!==Vt.BEARER.toLowerCase()?o.tokenType.toLowerCase():""}function t0(o,e){const t=o.indexOf(On.CACHE_KEY)===0;let n=!0;return e&&(n=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&n}function n0(o,e){let t=!1;o&&(t=o.indexOf(mi.THROTTLING_PREFIX)===0);let n=!0;return e&&(n=e.hasOwnProperty("throttleTime")),t&&n}function o0({environment:o,clientId:e}){return[ol,o,e].join(Hn.CACHE_KEY_SEPARATOR).toLowerCase()}function r0(o,e){return e?o.indexOf(ol)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function i0(o,e){return e?o.indexOf(fs.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function Sc(){return zo()+fs.REFRESH_TIME_SECONDS}function xi(o,e,t){o.authorization_endpoint=e.authorization_endpoint,o.token_endpoint=e.token_endpoint,o.end_session_endpoint=e.end_session_endpoint,o.issuer=e.issuer,o.endpointsFromNetwork=t,o.jwks_uri=e.jwks_uri}function da(o,e,t){o.aliases=e.aliases,o.preferred_cache=e.preferred_cache,o.preferred_network=e.preferred_network,o.aliasesFromNetwork=t}function Ac(o){return o.expiresAt<=zo()}/*! @azure/msal-common v15.2.0 2025-02-18 */const uh="redirect_uri_empty",s0="claims_request_parsing_error",dh="authority_uri_insecure",hi="url_parse_error",fh="empty_url_error",hh="empty_input_scopes_error",gh="invalid_prompt_value",ml="invalid_claims",mh="token_request_empty",ph="logout_request_empty",_h="invalid_code_challenge_method",pl="pkce_params_missing",_l="invalid_cloud_discovery_metadata",bh="invalid_authority_metadata",yh="untrusted_authority",zs="missing_ssh_jwk",vh="missing_ssh_kid",a0="missing_nonce_authentication_header",l0="invalid_authentication_header",wh="cannot_set_OIDCOptions",kh="cannot_allow_platform_broker",Ch="authority_mismatch";/*! @azure/msal-common v15.2.0 2025-02-18 */const c0={[uh]:"A redirect URI is required for all calls, and none has been set.",[s0]:"Could not parse the given claims request object.",[dh]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[hi]:"URL could not be parsed into appropriate segments.",[fh]:"URL was empty or null.",[hh]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[gh]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[ml]:"Given claims parameter must be a stringified JSON object.",[mh]:"Token request was empty and not found in cache.",[ph]:"The logout request was null or undefined.",[_h]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[pl]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[_l]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[bh]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[yh]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[zs]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[vh]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[a0]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[l0]:"Invalid authentication header provided",[wh]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[kh]:"Cannot set allowPlatformBroker parameter to true when not in AAD protocol mode.",[Ch]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class bl extends ln{constructor(e){super(e,c0[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,bl.prototype)}}function Jt(o){return new bl(o)}/*! @azure/msal-common v15.2.0 2025-02-18 */class Uo{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},n=e.split("&"),r=i=>decodeURIComponent(i.replace(/\+/g," "));return n.forEach(i=>{if(i.trim()){const[s,a]=i.split(/=(.+)/g,2);s&&a&&(t[r(s)]=r(a))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class bn{constructor(e){const t=e?Uo.trimArrayEntries([...e]):[],n=t?Uo.removeEmptyStringsFromArray(t):[];if(!n||!n.length)throw Jt(hh);this.scopes=new Set,n.forEach(r=>this.scopes.add(r))}static fromString(e){const n=(e||_e.EMPTY_STRING).split(" ");return new bn(n)}static createSearchScopes(e){const t=new bn(e);return t.containsOnlyOIDCScopes()?t.removeScope(_e.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}containsScope(e){const t=this.printScopesLowerCase().split(" "),n=new bn(t);return e?n.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return vc.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw Ee(th)}}removeScope(e){if(!e)throw Ee(eh);this.scopes.delete(e.trim())}removeOIDCScopes(){vc.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw Ee(Ta);const t=new Set;return e.scopes.forEach(n=>t.add(n.toLowerCase())),this.scopes.forEach(n=>t.add(n.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw Ee(Ta);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),n=e.getScopeCount(),r=this.getScopeCount();return t.size<r+n}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):_e.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}/*! @azure/msal-common v15.2.0 2025-02-18 */function ms(o,e){if(!o)throw Ee(Wf);try{const t=e(o);return JSON.parse(t)}catch{throw Ee(il)}}function Br(o){if(!o)throw Ee(il);const e=o.split(Hn.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?_e.EMPTY_STRING:e[1]}}/*! @azure/msal-common v15.2.0 2025-02-18 */function Rc(o,e){return!!o&&!!e&&o===e.split(".")[1]}function yl(o,e,t,n){if(n){const{oid:r,sub:i,tid:s,name:a,tfp:l,acr:c}=n,u=s||l||c||"";return{tenantId:u,localAccountId:r||i||"",name:a,isHomeTenant:Rc(u,o)}}else return{tenantId:t,localAccountId:e,isHomeTenant:Rc(t,o)}}function vl(o,e,t,n){let r=o;if(e){const{isHomeTenant:i,...s}=e;r={...o,...s}}if(t){const{isHomeTenant:i,...s}=yl(o.homeAccountId,o.localAccountId,o.tenantId,t);return r={...r,...s,idTokenClaims:t,idToken:n},r}return r}/*! @azure/msal-common v15.2.0 2025-02-18 */const yo={Default:0,Adfs:1,Dsts:2,Ciam:3};/*! @azure/msal-common v15.2.0 2025-02-18 */function Eh(o){return o&&(o.tid||o.tfp||o.acr)||null}/*! @azure/msal-common v15.2.0 2025-02-18 */const Qo={AAD:"AAD",OIDC:"OIDC"};/*! @azure/msal-common v15.2.0 2025-02-18 */class Vn{generateAccountId(){return[this.homeAccountId,this.environment].join(Hn.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return Vn.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){const t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(Hn.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,n){var c,u,d,f,h,_;const r=new Vn;t.authorityType===yo.Adfs?r.authorityType=Ji.ADFS_ACCOUNT_TYPE:t.protocolMode===Qo.AAD?r.authorityType=Ji.MSSTS_ACCOUNT_TYPE:r.authorityType=Ji.GENERIC_ACCOUNT_TYPE;let i;e.clientInfo&&n&&(i=ms(e.clientInfo,n)),r.clientInfo=e.clientInfo,r.homeAccountId=e.homeAccountId,r.nativeAccountId=e.nativeAccountId;const s=e.environment||t&&t.getPreferredCache();if(!s)throw Ee(cl);r.environment=s,r.realm=(i==null?void 0:i.utid)||Eh(e.idTokenClaims)||"",r.localAccountId=(i==null?void 0:i.uid)||((c=e.idTokenClaims)==null?void 0:c.oid)||((u=e.idTokenClaims)==null?void 0:u.sub)||"";const a=((d=e.idTokenClaims)==null?void 0:d.preferred_username)||((f=e.idTokenClaims)==null?void 0:f.upn),l=(h=e.idTokenClaims)!=null&&h.emails?e.idTokenClaims.emails[0]:null;if(r.username=a||l||"",r.name=((_=e.idTokenClaims)==null?void 0:_.name)||"",r.cloudGraphHostName=e.cloudGraphHostName,r.msGraphHost=e.msGraphHost,e.tenantProfiles)r.tenantProfiles=e.tenantProfiles;else{const b=yl(e.homeAccountId,r.localAccountId,r.realm,e.idTokenClaims);r.tenantProfiles=[b]}return r}static createFromAccountInfo(e,t,n){var i;const r=new Vn;return r.authorityType=e.authorityType||Ji.GENERIC_ACCOUNT_TYPE,r.homeAccountId=e.homeAccountId,r.localAccountId=e.localAccountId,r.nativeAccountId=e.nativeAccountId,r.realm=e.tenantId,r.environment=e.environment,r.username=e.username,r.name=e.name,r.cloudGraphHostName=t,r.msGraphHost=n,r.tenantProfiles=Array.from(((i=e.tenantProfiles)==null?void 0:i.values())||[]),r}static generateHomeAccountId(e,t,n,r,i){if(!(t===yo.Adfs||t===yo.Dsts)){if(e)try{const s=ms(e,r.base64Decode);if(s.uid&&s.utid)return`${s.uid}.${s.utid}`}catch{}n.warning("No client info in response")}return(i==null?void 0:i.sub)||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,n){if(!e||!t)return!1;let r=!0;if(n){const i=e.idTokenClaims||{},s=t.idTokenClaims||{};r=i.iat===s.iat&&i.nonce===s.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&r}}/*! @azure/msal-common v15.2.0 2025-02-18 */function Ih(o){return o.startsWith("#/")?o.substring(2):o.startsWith("#")||o.startsWith("?")?o.substring(1):o}function ps(o){if(!o||o.indexOf("=")<0)return null;try{const e=Ih(o),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.error||t.error_description||t.state)return t}catch{throw Ee(Qf)}return null}/*! @azure/msal-common v15.2.0 2025-02-18 */class Ot{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw Jt(fh);e.includes("#")||(this._urlString=Ot.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return Uo.endsWith(t,"?")?t=t.slice(0,-1):Uo.endsWith(t,"?/")&&(t=t.slice(0,-2)),Uo.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw Jt(hi)}if(!e.HostNameAndPort||!e.PathSegments)throw Jt(hi);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw Jt(dh)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return Ot.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),n=t.PathSegments;return e&&n.length!==0&&(n[0]===sr.COMMON||n[0]===sr.ORGANIZATIONS)&&(n[0]=e),Ot.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw Jt(hi);const n={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let r=n.AbsolutePath.split("/");return r=r.filter(i=>i&&i.length>0),n.PathSegments=r,n.QueryString&&n.QueryString.endsWith("/")&&(n.QueryString=n.QueryString.substring(0,n.QueryString.length-1)),n}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),n=e.match(t);if(!n)throw Jt(hi);return n[2]}static getAbsoluteUrl(e,t){if(e[0]===_e.FORWARD_SLASH){const r=new Ot(t).getUrlComponents();return r.Protocol+"//"+r.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new Ot(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!ps(e)}}/*! @azure/msal-common v15.2.0 2025-02-18 */const Th={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},Mc=Th.endpointMetadata,wl=Th.instanceDiscoveryMetadata,Sh=new Set;wl.metadata.forEach(o=>{o.aliases.forEach(e=>{Sh.add(e)})});function u0(o,e){var r;let t;const n=o.canonicalAuthority;if(n){const i=new Ot(n).getUrlComponents().HostNameAndPort;t=Oc(i,(r=o.cloudDiscoveryMetadata)==null?void 0:r.metadata,Xn.CONFIG,e)||Oc(i,wl.metadata,Xn.HARDCODED_VALUES,e)||o.knownAuthorities}return t||[]}function Oc(o,e,t,n){if(n==null||n.trace(`getAliasesFromMetadata called with source: ${t}`),o&&e){const r=_s(e,o);if(r)return n==null||n.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),r.aliases;n==null||n.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function d0(o){return _s(wl.metadata,o)}function _s(o,e){for(let t=0;t<o.length;t++){const n=o[t];if(n.aliases.includes(e))return n}return null}/*! @azure/msal-common v15.2.0 2025-02-18 */const Ah="cache_quota_exceeded",kl="cache_error_unknown";/*! @azure/msal-common v15.2.0 2025-02-18 */const fa={[Ah]:"Exceeded cache storage capacity.",[kl]:"Unexpected error occurred when using cache storage."};class Kr extends Error{constructor(e,t){const n=t||(fa[e]?fa[e]:fa[kl]);super(`${e}: ${n}`),Object.setPrototypeOf(this,Kr.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=n}}/*! @azure/msal-common v15.2.0 2025-02-18 */class Oa{constructor(e,t,n,r){this.clientId=e,this.cryptoImpl=t,this.commonLogger=n.clone(ah,fl),this.staticAuthorityOptions=r}getAllAccounts(e){return this.buildTenantProfiles(this.getAccountsFilteredBy(e||{}),e)}getAccountInfoFilteredBy(e){const t=this.getAllAccounts(e);return t.length>1?t.sort(r=>r.idTokenClaims?-1:1)[0]:t.length===1?t[0]:null}getBaseAccountInfo(e){const t=this.getAccountsFilteredBy(e);return t.length>0?t[0].getAccountInfo():null}buildTenantProfiles(e,t){return e.flatMap(n=>this.getTenantProfilesFromAccountEntity(n,t==null?void 0:t.tenantId,t))}getTenantedAccountInfoByFilter(e,t,n,r){let i=null,s;if(r&&!this.tenantProfileMatchesFilter(n,r))return null;const a=this.getIdToken(e,t,n.tenantId);return a&&(s=ni(a.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(s,r))?null:(i=vl(e,n,s,a==null?void 0:a.secret),i)}getTenantProfilesFromAccountEntity(e,t,n){const r=e.getAccountInfo();let i=r.tenantProfiles||new Map;const s=this.getTokenKeys();if(t){const l=i.get(t);if(l)i=new Map([[t,l]]);else return[]}const a=[];return i.forEach(l=>{const c=this.getTenantedAccountInfoByFilter(r,s,l,n);c&&a.push(c)}),a}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t,n){var r,i,s,a;if(!e)throw Ee(nh);try{e.account&&await this.setAccount(e.account,t),e.idToken&&(n==null?void 0:n.idToken)!==!1&&await this.setIdTokenCredential(e.idToken,t),e.accessToken&&(n==null?void 0:n.accessToken)!==!1&&await this.saveAccessToken(e.accessToken,t),e.refreshToken&&(n==null?void 0:n.refreshToken)!==!1&&await this.setRefreshTokenCredential(e.refreshToken,t),e.appMetadata&&this.setAppMetadata(e.appMetadata)}catch(l){throw(r=this.commonLogger)==null||r.error("CacheManager.saveCacheRecord: failed"),l instanceof Error?((i=this.commonLogger)==null||i.errorPii(`CacheManager.saveCacheRecord: ${l.message}`,t),l.name==="QuotaExceededError"||l.name==="NS_ERROR_DOM_QUOTA_REACHED"||l.message.includes("exceeded the quota")?((s=this.commonLogger)==null||s.error("CacheManager.saveCacheRecord: exceeded storage quota",t),new Kr(Ah)):new Kr(l.name,l.message)):((a=this.commonLogger)==null||a.errorPii(`CacheManager.saveCacheRecord: ${l}`,t),new Kr(kl))}}async saveAccessToken(e,t){const n={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},r=this.getTokenKeys(),i=bn.fromString(e.target),s=[];r.accessToken.forEach(a=>{if(!this.accessTokenKeyMatchesFilter(a,n,!1))return;const l=this.getAccessTokenCredential(a);l&&this.credentialMatchesFilter(l,n)&&bn.fromString(l.target).intersectingScopeSets(i)&&s.push(this.removeAccessToken(a))}),await Promise.all(s),await this.setAccessTokenCredential(e,t)}getAccountsFilteredBy(e){const t=this.getAccountKeys(),n=[];return t.forEach(r=>{var l;if(!this.isAccountKey(r,e.homeAccountId))return;const i=this.getAccount(r,this.commonLogger);if(!i||e.homeAccountId&&!this.matchHomeAccountId(i,e.homeAccountId)||e.username&&!this.matchUsername(i.username,e.username)||e.environment&&!this.matchEnvironment(i,e.environment)||e.realm&&!this.matchRealm(i,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(i,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(i,e.authorityType))return;const s={localAccountId:e==null?void 0:e.localAccountId,name:e==null?void 0:e.name},a=(l=i.tenantProfiles)==null?void 0:l.filter(c=>this.tenantProfileMatchesFilter(c,s));a&&a.length===0||n.push(i)}),n}isAccountKey(e,t,n){return!(e.split(Hn.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||n&&!e.toLowerCase().includes(n.toLowerCase()))}isCredentialKey(e){if(e.split(Hn.CACHE_KEY_SEPARATOR).length<6)return!1;const t=e.toLowerCase();if(t.indexOf(bt.ID_TOKEN.toLowerCase())===-1&&t.indexOf(bt.ACCESS_TOKEN.toLowerCase())===-1&&t.indexOf(bt.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())===-1&&t.indexOf(bt.REFRESH_TOKEN.toLowerCase())===-1)return!1;if(t.indexOf(bt.REFRESH_TOKEN.toLowerCase())>-1){const n=`${bt.REFRESH_TOKEN}${Hn.CACHE_KEY_SEPARATOR}${this.clientId}${Hn.CACHE_KEY_SEPARATOR}`,r=`${bt.REFRESH_TOKEN}${Hn.CACHE_KEY_SEPARATOR}${gi}${Hn.CACHE_KEY_SEPARATOR}`;if(t.indexOf(n.toLowerCase())===-1&&t.indexOf(r.toLowerCase())===-1)return!1}else if(t.indexOf(this.clientId.toLowerCase())===-1)return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===bt.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===Vt.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){const t=this.getKeys(),n={};return t.forEach(r=>{if(!this.isAppMetadata(r))return;const i=this.getAppMetadata(r);i&&(e.environment&&!this.matchEnvironment(i,e.environment)||e.clientId&&!this.matchClientId(i,e.clientId)||(n[r]=i))}),n}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let n=null;return t.forEach(r=>{if(!this.isAuthorityMetadata(r)||r.indexOf(this.clientId)===-1)return;const i=this.getAuthorityMetadata(r);i&&i.aliases.indexOf(e)!==-1&&(n=i)}),n}async removeAllAccounts(){const e=this.getAccountKeys(),t=[];e.forEach(n=>{t.push(this.removeAccount(n))}),await Promise.all(t)}async removeAccount(e){const t=this.getAccount(e,this.commonLogger);t&&(await this.removeAccountContext(t),this.removeItem(e))}async removeAccountContext(e){const t=this.getTokenKeys(),n=e.generateAccountId(),r=[];t.idToken.forEach(i=>{i.indexOf(n)===0&&this.removeIdToken(i)}),t.accessToken.forEach(i=>{i.indexOf(n)===0&&r.push(this.removeAccessToken(i))}),t.refreshToken.forEach(i=>{i.indexOf(n)===0&&this.removeRefreshToken(i)}),await Promise.all(r)}async removeAccessToken(e){const t=this.getAccessTokenCredential(e);if(t){if(t.credentialType.toLowerCase()===bt.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&t.tokenType===Vt.POP){const r=t.keyId;if(r)try{await this.cryptoImpl.removeTokenBindingKey(r)}catch{throw Ee(ih)}}return this.removeItem(e)}}removeAppMetadata(){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t)}),!0}readAccountFromCache(e){const t=Vn.generateAccountCacheKey(e);return this.getAccount(t,this.commonLogger)}getIdToken(e,t,n,r,i){this.commonLogger.trace("CacheManager - getIdToken called");const s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:bt.ID_TOKEN,clientId:this.clientId,realm:n},a=this.getIdTokensByFilter(s,t),l=a.size;if(l<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(l>1){let c=a;if(!n){const u=new Map;a.forEach((f,h)=>{f.realm===e.tenantId&&u.set(h,f)});const d=u.size;if(d<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),a.values().next().value;if(d===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),u.values().next().value;c=u}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),c.forEach((u,d)=>{this.removeIdToken(d)}),r&&i&&r.addFields({multiMatchedID:a.size},i),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),a.values().next().value}getIdTokensByFilter(e,t){const n=t&&t.idToken||this.getTokenKeys().idToken,r=new Map;return n.forEach(i=>{if(!this.idTokenKeyMatchesFilter(i,{clientId:this.clientId,...e}))return;const s=this.getIdTokenCredential(i);s&&this.credentialMatchesFilter(s,e)&&r.set(i,s)}),r}idTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e){this.removeItem(e)}removeRefreshToken(e){this.removeItem(e)}getAccessToken(e,t,n,r,i,s){this.commonLogger.trace("CacheManager - getAccessToken called");const a=bn.createSearchScopes(t.scopes),l=t.authenticationScheme||Vt.BEARER,c=l&&l.toLowerCase()!==Vt.BEARER.toLowerCase()?bt.ACCESS_TOKEN_WITH_AUTH_SCHEME:bt.ACCESS_TOKEN,u={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:c,clientId:this.clientId,realm:r||e.tenantId,target:a,tokenType:l,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},d=n&&n.accessToken||this.getTokenKeys().accessToken,f=[];d.forEach(_=>{if(this.accessTokenKeyMatchesFilter(_,u,!0)){const b=this.getAccessTokenCredential(_);b&&this.credentialMatchesFilter(b,u)&&f.push(b)}});const h=f.length;return h<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):h>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),f.forEach(_=>{this.removeAccessToken(pi(_))}),i&&s&&i.addFields({multiMatchedAT:f.length},s),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),f[0])}accessTokenKeyMatchesFilter(e,t,n){const r=e.toLowerCase();if(t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&r.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&r.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){const i=t.target.asArray();for(let s=0;s<i.length;s++){if(n&&!r.includes(i[s].toLowerCase()))return!1;if(!n&&r.includes(i[s].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e){const t=this.getTokenKeys(),n=[];return t.accessToken.forEach(r=>{if(!this.accessTokenKeyMatchesFilter(r,e,!0))return;const i=this.getAccessTokenCredential(r);i&&this.credentialMatchesFilter(i,e)&&n.push(i)}),n}getRefreshToken(e,t,n,r,i){this.commonLogger.trace("CacheManager - getRefreshToken called");const s=t?gi:void 0,a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:bt.REFRESH_TOKEN,clientId:this.clientId,familyId:s},l=n&&n.refreshToken||this.getTokenKeys().refreshToken,c=[];l.forEach(d=>{if(this.refreshTokenKeyMatchesFilter(d,a)){const f=this.getRefreshTokenCredential(d);f&&this.credentialMatchesFilter(f,a)&&c.push(f)}});const u=c.length;return u<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(u>1&&r&&i&&r.addFields({multiMatchedRT:u},i),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),c[0])}refreshTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.familyId&&n.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},n=this.getAppMetadataFilteredBy(t),r=Object.keys(n).map(s=>n[s]),i=r.length;if(i<1)return null;if(i>1)throw Ee(xf);return r[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===gi)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){const n=e.oid||e.sub;return t===n}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){var n;return t.toLowerCase()===((n=e.name)==null?void 0:n.toLowerCase())}matchUsername(e,t){return!!(e&&typeof e=="string"&&(t==null?void 0:t.toLowerCase())===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const r=u0(this.staticAuthorityOptions,this.commonLogger);if(r.includes(t)&&r.includes(e.environment))return!0}const n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){var n;return((n=e.realm)==null?void 0:n.toLowerCase())===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==bt.ACCESS_TOKEN&&e.credentialType!==bt.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:bn.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(ol)!==-1}isAuthorityMetadata(e){return e.indexOf(fs.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${fs.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const n in t)e[n]=t[n];return e}}class f0 extends Oa{async setAccount(){throw Ee(kt)}getAccount(){throw Ee(kt)}async setIdTokenCredential(){throw Ee(kt)}getIdTokenCredential(){throw Ee(kt)}async setAccessTokenCredential(){throw Ee(kt)}getAccessTokenCredential(){throw Ee(kt)}async setRefreshTokenCredential(){throw Ee(kt)}getRefreshTokenCredential(){throw Ee(kt)}setAppMetadata(){throw Ee(kt)}getAppMetadata(){throw Ee(kt)}setServerTelemetry(){throw Ee(kt)}getServerTelemetry(){throw Ee(kt)}setAuthorityMetadata(){throw Ee(kt)}getAuthorityMetadata(){throw Ee(kt)}getAuthorityMetadataKeys(){throw Ee(kt)}setThrottlingCache(){throw Ee(kt)}getThrottlingCache(){throw Ee(kt)}removeItem(){throw Ee(kt)}getKeys(){throw Ee(kt)}getAccountKeys(){throw Ee(kt)}getTokenKeys(){throw Ee(kt)}}/*! @azure/msal-common v15.2.0 2025-02-18 */const Rh={tokenRenewalOffsetSeconds:O1,preventCorsPreflight:!1},h0={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:an.Info,correlationId:_e.EMPTY_STRING},g0={claimsBasedCachingEnabled:!1},m0={async sendGetRequestAsync(){throw Ee(kt)},async sendPostRequestAsync(){throw Ee(kt)}},p0={sku:_e.SKU,version:fl,cpu:_e.EMPTY_STRING,os:_e.EMPTY_STRING},_0={clientSecret:_e.EMPTY_STRING,clientAssertion:void 0},b0={azureCloudInstance:hl.None,tenant:`${_e.DEFAULT_COMMON_TENANT}`},y0={application:{appName:"",appVersion:""}};function v0({authOptions:o,systemOptions:e,loggerOptions:t,cacheOptions:n,storageInterface:r,networkInterface:i,cryptoInterface:s,clientCredentials:a,libraryInfo:l,telemetry:c,serverTelemetryManager:u,persistencePlugin:d,serializableCache:f}){const h={...h0,...t};return{authOptions:w0(o),systemOptions:{...Rh,...e},loggerOptions:h,cacheOptions:{...g0,...n},storageInterface:r||new f0(o.clientId,gs,new lr(h)),networkInterface:i||m0,cryptoInterface:s||gs,clientCredentials:a||_0,libraryInfo:{...p0,...l},telemetry:{...y0,...c},serverTelemetryManager:u||null,persistencePlugin:d||null,serializableCache:f||null}}function w0(o){return{clientCapabilities:[],azureCloudOptions:b0,skipAuthorityMetadataCache:!1,instanceAware:!1,...o}}function Pa(o){return o.authOptions.authority.options.protocolMode===Qo.OIDC}/*! @azure/msal-common v15.2.0 2025-02-18 */const $n={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};/*! @azure/msal-common v15.2.0 2025-02-18 */const vr="client_id",Mh="redirect_uri",Pc="response_type",k0="response_mode",C0="grant_type",E0="claims",I0="scope",T0="refresh_token",S0="state",A0="nonce",R0="prompt",M0="code",O0="code_challenge",P0="code_challenge_method",N0="code_verifier",D0="client-request-id",H0="x-client-SKU",L0="x-client-VER",U0="x-client-OS",B0="x-client-CPU",z0="x-client-current-telemetry",V0="x-client-last-telemetry",F0="x-ms-lib-capability",K0="x-app-name",G0="x-app-ver",W0="post_logout_redirect_uri",q0="id_token_hint",Y0="device_code",j0="client_secret",Q0="client_assertion",X0="client_assertion_type",Nc="token_type",Dc="req_cnf",J0="assertion",Z0="requested_token_use",Hc="return_spa_code",x0="nativebroker",$0="logout_hint",eb="sid",tb="login_hint",nb="domain_hint",ob="x-client-xtra-sku",Cl="brk_client_id",Na="brk_redirect_uri";/*! @azure/msal-common v15.2.0 2025-02-18 */class Dr{static validateRedirectUri(e){if(!e)throw Jt(uh)}static validatePrompt(e){const t=[];for(const n in Tn)t.push(Tn[n]);if(t.indexOf(e)<0)throw Jt(gh)}static validateClaims(e){try{JSON.parse(e)}catch{throw Jt(ml)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw Jt(pl);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([kc.PLAIN,kc.S256].indexOf(e)<0)throw Jt(_h)}}/*! @azure/msal-common v15.2.0 2025-02-18 */function rb(o,e,t){if(!e)return;const n=o.get(vr);n&&o.has(Cl)&&(t==null||t.addFields({embeddedClientId:n,embeddedRedirectUri:o.get(Mh)},e))}class _i{constructor(e,t){this.parameters=new Map,this.performanceClient=t,this.correlationId=e}addResponseTypeCode(){this.parameters.set(Pc,encodeURIComponent(_e.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(Pc,encodeURIComponent(`${_e.TOKEN_RESPONSE_TYPE} ${_e.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(e){this.parameters.set(k0,encodeURIComponent(e||A1.QUERY))}addNativeBroker(){this.parameters.set(x0,encodeURIComponent("1"))}addScopes(e,t=!0,n=Pi){t&&!n.includes("openid")&&!e.includes("openid")&&n.push("openid");const r=t?[...e||[],...n]:e||[],i=new bn(r);this.parameters.set(I0,encodeURIComponent(i.printScopes()))}addClientId(e){this.parameters.set(vr,encodeURIComponent(e))}addRedirectUri(e){Dr.validateRedirectUri(e),this.parameters.set(Mh,encodeURIComponent(e))}addPostLogoutRedirectUri(e){Dr.validateRedirectUri(e),this.parameters.set(W0,encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set(q0,encodeURIComponent(e))}addDomainHint(e){this.parameters.set(nb,encodeURIComponent(e))}addLoginHint(e){this.parameters.set(tb,encodeURIComponent(e))}addCcsUpn(e){this.parameters.set(zn.CCS_HEADER,encodeURIComponent(`UPN:${e}`))}addCcsOid(e){this.parameters.set(zn.CCS_HEADER,encodeURIComponent(`Oid:${e.uid}@${e.utid}`))}addSid(e){this.parameters.set(eb,encodeURIComponent(e))}addClaims(e,t){const n=this.addClientCapabilitiesToClaims(e,t);Dr.validateClaims(n),this.parameters.set(E0,encodeURIComponent(n))}addCorrelationId(e){this.parameters.set(D0,encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set(H0,e.sku),this.parameters.set(L0,e.version),e.os&&this.parameters.set(U0,e.os),e.cpu&&this.parameters.set(B0,e.cpu)}addApplicationTelemetry(e){e!=null&&e.appName&&this.parameters.set(K0,e.appName),e!=null&&e.appVersion&&this.parameters.set(G0,e.appVersion)}addPrompt(e){Dr.validatePrompt(e),this.parameters.set(`${R0}`,encodeURIComponent(e))}addState(e){e&&this.parameters.set(S0,encodeURIComponent(e))}addNonce(e){this.parameters.set(A0,encodeURIComponent(e))}addCodeChallengeParams(e,t){if(Dr.validateCodeChallengeParams(e,t),e&&t)this.parameters.set(O0,encodeURIComponent(e)),this.parameters.set(P0,encodeURIComponent(t));else throw Jt(pl)}addAuthorizationCode(e){this.parameters.set(M0,encodeURIComponent(e))}addDeviceCode(e){this.parameters.set(Y0,encodeURIComponent(e))}addRefreshToken(e){this.parameters.set(T0,encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set(N0,encodeURIComponent(e))}addClientSecret(e){this.parameters.set(j0,encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set(Q0,encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set(X0,encodeURIComponent(e))}addOboAssertion(e){this.parameters.set(J0,encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set(Z0,encodeURIComponent(e))}addGrantType(e){this.parameters.set(C0,encodeURIComponent(e))}addClientInfo(){this.parameters.set(R1,"1")}addExtraQueryParameters(e){Object.entries(e).forEach(([t,n])=>{!this.parameters.has(t)&&n&&this.parameters.set(t,n)})}addClientCapabilitiesToClaims(e,t){let n;if(!e)n={};else try{n=JSON.parse(e)}catch{throw Jt(ml)}return t&&t.length>0&&(n.hasOwnProperty(Xi.ACCESS_TOKEN)||(n[Xi.ACCESS_TOKEN]={}),n[Xi.ACCESS_TOKEN][Xi.XMS_CC]={values:t}),JSON.stringify(n)}addUsername(e){this.parameters.set(Ec.username,encodeURIComponent(e))}addPassword(e){this.parameters.set(Ec.password,encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(Nc,Vt.POP),this.parameters.set(Dc,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(Nc,Vt.SSH),this.parameters.set(Dc,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set(z0,e.generateCurrentRequestHeaderValue()),this.parameters.set(V0,e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set(F0,mi.X_MS_LIB_CAPABILITY_VALUE)}addLogoutHint(e){this.parameters.set($0,encodeURIComponent(e))}addBrokerParameters(e){const t={};t[Cl]=e.brokerClientId,t[Na]=e.brokerRedirectUri,this.addExtraQueryParameters(t)}createQueryString(){const e=new Array;return this.parameters.forEach((t,n)=>{e.push(`${n}=${t}`)}),rb(this.parameters,this.correlationId,this.performanceClient),e.join("&")}}/*! @azure/msal-common v15.2.0 2025-02-18 */function ib(o){return o.hasOwnProperty("authorization_endpoint")&&o.hasOwnProperty("token_endpoint")&&o.hasOwnProperty("issuer")&&o.hasOwnProperty("jwks_uri")}/*! @azure/msal-common v15.2.0 2025-02-18 */function sb(o){return o.hasOwnProperty("tenant_discovery_endpoint")&&o.hasOwnProperty("metadata")}/*! @azure/msal-common v15.2.0 2025-02-18 */function ab(o){return o.hasOwnProperty("error")&&o.hasOwnProperty("error_description")}/*! @azure/msal-common v15.2.0 2025-02-18 */const ce={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",InitializeCache:"initializeCache",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",ImportExistingCache:"importExistingCache",SetUserData:"setUserData",LocalStorageUpdated:"localStorageUpdated",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues",GenerateHKDF:"generateHKDF",GenerateBaseKey:"generateBaseKey",Base64Decode:"base64Decode",UrlEncodeArr:"urlEncodeArr",Encrypt:"encrypt",Decrypt:"decrypt"},lb={NotStarted:0,InProgress:1,Completed:2};/*! @azure/msal-common v15.2.0 2025-02-18 */const $o=(o,e,t,n,r)=>(...i)=>{t.trace(`Executing function ${e}`);const s=n==null?void 0:n.startMeasurement(e,r);if(r){const a=e+"CallCount";n==null||n.incrementFields({[a]:1},r)}try{const a=o(...i);return s==null||s.end({success:!0}),t.trace(`Returning result from ${e}`),a}catch(a){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw s==null||s.end({success:!1},a),a}},Se=(o,e,t,n,r)=>(...i)=>{t.trace(`Executing function ${e}`);const s=n==null?void 0:n.startMeasurement(e,r);if(r){const a=e+"CallCount";n==null||n.incrementFields({[a]:1},r)}return n==null||n.setPreQueueTime(e,r),o(...i).then(a=>(t.trace(`Returning result from ${e}`),s==null||s.end({success:!0}),a)).catch(a=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw s==null||s.end({success:!1},a),a})};/*! @azure/msal-common v15.2.0 2025-02-18 */class Vs{constructor(e,t,n,r){this.networkInterface=e,this.logger=t,this.performanceClient=n,this.correlationId=r}async detectRegion(e,t){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(ce.RegionDiscoveryDetectRegion,this.correlationId);let n=e;if(n)t.region_source=Nr.ENVIRONMENT_VARIABLE;else{const i=Vs.IMDS_OPTIONS;try{const s=await Se(this.getRegionFromIMDS.bind(this),ce.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(_e.IMDS_VERSION,i);if(s.status===Zi.httpSuccess&&(n=s.body,t.region_source=Nr.IMDS),s.status===Zi.httpBadRequest){const a=await Se(this.getCurrentVersion.bind(this),ce.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(i);if(!a)return t.region_source=Nr.FAILED_AUTO_DETECTION,null;const l=await Se(this.getRegionFromIMDS.bind(this),ce.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(a,i);l.status===Zi.httpSuccess&&(n=l.body,t.region_source=Nr.IMDS)}}catch{return t.region_source=Nr.FAILED_AUTO_DETECTION,null}}return n||(t.region_source=Nr.FAILED_AUTO_DETECTION),n||null}async getRegionFromIMDS(e,t){var n;return(n=this.performanceClient)==null||n.addQueueMeasurement(ce.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${_e.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,_e.IMDS_TIMEOUT)}async getCurrentVersion(e){var t;(t=this.performanceClient)==null||t.addQueueMeasurement(ce.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const n=await this.networkInterface.sendGetRequestAsync(`${_e.IMDS_ENDPOINT}?format=json`,e);return n.status===Zi.httpBadRequest&&n.body&&n.body["newest-versions"]&&n.body["newest-versions"].length>0?n.body["newest-versions"][0]:null}catch{return null}}}Vs.IMDS_OPTIONS={headers:{Metadata:"true"}};/*! @azure/msal-common v15.2.0 2025-02-18 */class Dn{constructor(e,t,n,r,i,s,a,l){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=r,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=i,this.performanceClient=a,this.correlationId=s,this.managedIdentity=l||!1,this.regionDiscovery=new Vs(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(_e.CIAM_AUTH_URL))return yo.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case _e.ADFS:return yo.Adfs;case _e.DSTS:return yo.Dsts}return yo.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new Ot(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw Ee(Wo)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw Ee(Wo)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw Ee(Wo)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw Ee(sh);return this.replacePath(this.metadata.end_session_endpoint)}else throw Ee(Wo)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw Ee(Wo)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw Ee(Wo)}canReplaceTenant(e){return e.PathSegments.length===1&&!Dn.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===yo.Default&&this.protocolMode===Qo.AAD}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const r=new Ot(this.metadata.canonical_authority).getUrlComponents(),i=r.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((a,l)=>{let c=i[l];if(l===0&&this.canReplaceTenant(r)){const u=new Ot(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];c!==u&&(this.logger.verbose(`Replacing tenant domain name ${c} with id ${u}`),c=u)}a!==c&&(t=t.replace(`/${c}/`,`/${a}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===yo.Adfs||this.protocolMode!==Qo.AAD&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){var r,i;(r=this.performanceClient)==null||r.addQueueMeasurement(ce.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await Se(this.updateCloudDiscoveryMetadata.bind(this),ce.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const n=await Se(this.updateEndpointMetadata.bind(this),ce.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:n}),(i=this.performanceClient)==null||i.addFields({cloudDiscoverySource:t,authorityEndpointSource:n},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:Sc(),jwks_uri:""}),e}updateCachedMetadata(e,t,n){t!==Xn.CACHE&&(n==null?void 0:n.source)!==Xn.CACHE&&(e.expiresAt=Sc(),e.canonical_authority=this.canonicalAuthority);const r=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(r,e),this.metadata=e}async updateEndpointMetadata(e){var r,i,s;(r=this.performanceClient)==null||r.addQueueMeasurement(ce.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===Xn.HARDCODED_VALUES&&(i=this.authorityOptions.azureRegionConfiguration)!=null&&i.azureRegion&&t.metadata){const a=await Se(this.updateMetadataWithRegionalInformation.bind(this),ce.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);xi(e,a,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let n=await Se(this.getEndpointMetadataFromNetwork.bind(this),ce.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return(s=this.authorityOptions.azureRegionConfiguration)!=null&&s.azureRegion&&(n=await Se(this.updateMetadataWithRegionalInformation.bind(this),ce.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(n)),xi(e,n,!0),Xn.NETWORK;throw Ee(jf,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),xi(e,t,!1),{source:Xn.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const r=this.getEndpointMetadataFromHardcodedValues();if(r)return xi(e,r,!1),{source:Xn.HARDCODED_VALUES,metadata:r};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const n=Ac(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("Found endpoint metadata in the cache."),{source:Xn.CACHE}):(n&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new Ot(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw Jt(bh)}return null}async getEndpointMetadataFromNetwork(){var n;(n=this.performanceClient)==null||n.addQueueMeasurement(ce.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const r=await this.networkInterface.sendGetRequestAsync(t,e);return ib(r.body)?r.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(r){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${r}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in Mc?Mc[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){var n,r,i;(n=this.performanceClient)==null||n.addQueueMeasurement(ce.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=(r=this.authorityOptions.azureRegionConfiguration)==null?void 0:r.azureRegion;if(t){if(t!==_e.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=ua.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,Dn.replaceWithRegionalInformation(e,t);const s=await Se(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),ce.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)((i=this.authorityOptions.azureRegionConfiguration)==null?void 0:i.environmentRegion,this.regionDiscoveryMetadata);if(s)return this.regionDiscoveryMetadata.region_outcome=ua.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=s,Dn.replaceWithRegionalInformation(e,s);this.regionDiscoveryMetadata.region_outcome=ua.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(ce.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const n=await Se(this.getCloudDiscoveryMetadataFromNetwork.bind(this),ce.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return da(e,n,!0),Xn.NETWORK;throw Jt(yh)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||_e.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||_e.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||_e.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),da(e,t,!1),Xn.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const r=d0(this.hostnameAndPort);if(r)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),da(e,r,!1),Xn.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const n=Ac(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!n?(this.logger.verbose("Found cloud discovery metadata in the cache."),Xn.CACHE):(n&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===yo.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),Dn.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=_s(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),Jt(_l)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),Dn.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(ce.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${_e.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let n=null;try{const i=await this.networkInterface.sendGetRequestAsync(e,t);let s,a;if(sb(i.body))s=i.body,a=s.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${s.tenant_discovery_endpoint}`);else if(ab(i.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${i.status}`),s=i.body,s.error===_e.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${s.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${s.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),a=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),n=_s(a,this.hostnameAndPort)}catch(i){if(i instanceof ln)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${i.errorCode}
Error Description: ${i.errorMessage}`);else{const s=i;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${s.name}
Error Description: ${s.message}`)}return null}return n||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),n=Dn.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),n}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&Ot.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let n;if(t&&t.azureCloudInstance!==hl.None){const r=t.tenant?t.tenant:_e.DEFAULT_COMMON_TENANT;n=`${t.azureCloudInstance}/${r}/`}return n||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return _e.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw Ee(Wo)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return Sh.has(e)}static isPublicCloudAuthority(e){return _e.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,n){const r=new Ot(e);r.validateAsUri();const i=r.getUrlComponents();let s=`${t}.${i.HostNameAndPort}`;this.isPublicCloudAuthority(i.HostNameAndPort)&&(s=`${t}.${_e.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const a=Ot.constructAuthorityUriFromObject({...r.getUrlComponents(),HostNameAndPort:s}).urlString;return n?`${a}?${n}`:a}static replaceWithRegionalInformation(e,t){const n={...e};return n.authorization_endpoint=Dn.buildRegionalAuthorityString(n.authorization_endpoint,t),n.token_endpoint=Dn.buildRegionalAuthorityString(n.token_endpoint,t),n.end_session_endpoint&&(n.end_session_endpoint=Dn.buildRegionalAuthorityString(n.end_session_endpoint,t)),n}static transformCIAMAuthority(e){let t=e;const r=new Ot(e).getUrlComponents();if(r.PathSegments.length===0&&r.HostNameAndPort.endsWith(_e.CIAM_AUTH_URL)){const i=r.HostNameAndPort.split(".")[0];t=`${t}${i}${_e.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}Dn.reservedTenantDomains=new Set(["{tenant}","{tenantid}",sr.COMMON,sr.CONSUMERS,sr.ORGANIZATIONS]);function cb(o){var r;const n=(r=new Ot(o).getUrlComponents().PathSegments.slice(-1)[0])==null?void 0:r.toLowerCase();switch(n){case sr.COMMON:case sr.ORGANIZATIONS:case sr.CONSUMERS:return;default:return n}}function Oh(o){return o.endsWith(_e.FORWARD_SLASH)?o:`${o}${_e.FORWARD_SLASH}`}function ub(o){const e=o.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw Jt(_l)}return{canonicalAuthority:o.authority?Oh(o.authority):void 0,knownAuthorities:o.knownAuthorities,cloudDiscoveryMetadata:t}}/*! @azure/msal-common v15.2.0 2025-02-18 */async function Ph(o,e,t,n,r,i,s){s==null||s.addQueueMeasurement(ce.AuthorityFactoryCreateDiscoveredInstance,i);const a=Dn.transformCIAMAuthority(Oh(o)),l=new Dn(a,e,t,n,r,i,s);try{return await Se(l.resolveEndpointsAsync.bind(l),ce.AuthorityResolveEndpointsAsync,r,s,i)(),l}catch{throw Ee(Wo)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class cr extends ln{constructor(e,t,n,r,i){super(e,t,n),this.name="ServerError",this.errorNo=r,this.status=i,Object.setPrototypeOf(this,cr.prototype)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class Po{static generateThrottlingStorageKey(e){return`${mi.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t){var i;const n=Po.generateThrottlingStorageKey(t),r=e.getThrottlingCache(n);if(r){if(r.throttleTime<Date.now()){e.removeItem(n);return}throw new cr(((i=r.errorCodes)==null?void 0:i.join(" "))||_e.EMPTY_STRING,r.errorMessage,r.subError)}}static postProcess(e,t,n){if(Po.checkResponseStatus(n)||Po.checkResponseForRetryAfter(n)){const r={throttleTime:Po.calculateThrottleTime(parseInt(n.headers[zn.RETRY_AFTER])),error:n.body.error,errorCodes:n.body.error_codes,errorMessage:n.body.error_description,subError:n.body.suberror};e.setThrottlingCache(Po.generateThrottlingStorageKey(t),r)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(zn.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){const t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(Math.min(n+(t||mi.DEFAULT_THROTTLE_TIME_SECONDS),n+mi.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,n,r){const i={clientId:t,authority:n.authority,scopes:n.scopes,homeAccountIdentifier:r,claims:n.claims,authenticationScheme:n.authenticationScheme,resourceRequestMethod:n.resourceRequestMethod,resourceRequestUri:n.resourceRequestUri,shrClaims:n.shrClaims,sshKid:n.sshKid},s=this.generateThrottlingStorageKey(i);e.removeItem(s)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class Fs extends ln{constructor(e,t,n){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Fs.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=n}}function Lc(o,e,t){return new Fs(o,e,t)}/*! @azure/msal-common v15.2.0 2025-02-18 */class El{constructor(e,t){this.config=v0(e),this.logger=new lr(this.config.loggerOptions,ah,fl),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[zn.CONTENT_TYPE]=_e.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case $n.HOME_ACCOUNT_ID:try{const n=Br(e.credential);t[zn.CCS_HEADER]=`Oid:${n.uid}@${n.utid}`}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case $n.UPN:t[zn.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}async executePostToTokenEndpoint(e,t,n,r,i,s){var l;s&&((l=this.performanceClient)==null||l.addQueueMeasurement(s,i));const a=await this.sendPostRequest(r,e,{body:t,headers:n},i);return this.config.serverTelemetryManager&&a.status<500&&a.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),a}async sendPostRequest(e,t,n,r){var s,a,l;Po.preProcess(this.cacheManager,e);let i;try{i=await Se(this.networkClient.sendPostRequestAsync.bind(this.networkClient),ce.NetworkClientSendPostRequestAsync,this.logger,this.performanceClient,r)(t,n);const c=i.headers||{};(a=this.performanceClient)==null||a.addFields({refreshTokenSize:((s=i.body.refresh_token)==null?void 0:s.length)||0,httpVerToken:c[zn.X_MS_HTTP_VERSION]||"",requestId:c[zn.X_MS_REQUEST_ID]||""},r)}catch(c){if(c instanceof Fs){const u=c.responseHeaders;throw u&&((l=this.performanceClient)==null||l.addFields({httpVerToken:u[zn.X_MS_HTTP_VERSION]||"",requestId:u[zn.X_MS_REQUEST_ID]||"",contentTypeHeader:u[zn.CONTENT_TYPE]||void 0,contentLengthHeader:u[zn.CONTENT_LENGTH]||void 0,httpStatus:c.httpStatus},r)),c.error}throw c instanceof ln?c:Ee(Yf)}return Po.postProcess(this.cacheManager,e,i),i}async updateAuthority(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(ce.UpdateTokenEndpointAuthority,t);const n=`https://${e}/${this.authority.tenant}/`,r=await Ph(n,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=r}createTokenQueryParameters(e){const t=new _i(e.correlationId,this.performanceClient);return e.embeddedClientId&&t.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.addCorrelationId(e.correlationId),t.createQueryString()}}/*! @azure/msal-common v15.2.0 2025-02-18 */const bs="no_tokens_found",Nh="native_account_unavailable",Il="refresh_token_expired",db="interaction_required",fb="consent_required",hb="login_required",Ks="bad_token";/*! @azure/msal-common v15.2.0 2025-02-18 */const Uc=[db,fb,hb,Ks],gb=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],mb={[bs]:"No refresh token found in the cache. Please sign-in.",[Nh]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[Il]:"Refresh token has expired.",[Ks]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class Co extends ln{constructor(e,t,n,r,i,s,a,l){super(e,t,n),Object.setPrototypeOf(this,Co.prototype),this.timestamp=r||_e.EMPTY_STRING,this.traceId=i||_e.EMPTY_STRING,this.correlationId=s||_e.EMPTY_STRING,this.claims=a||_e.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=l}}function Bc(o,e,t){const n=!!o&&Uc.indexOf(o)>-1,r=!!t&&gb.indexOf(t)>-1,i=!!e&&Uc.some(s=>e.indexOf(s)>-1);return n||i||r}function Da(o){return new Co(o,mb[o])}/*! @azure/msal-common v15.2.0 2025-02-18 */class ko{static setRequestState(e,t,n){const r=ko.generateLibraryState(e,n);return t?`${r}${_e.RESOURCE_DELIM}${t}`:r}static generateLibraryState(e,t){if(!e)throw Ee(Aa);const n={id:e.createNewGuid()};t&&(n.meta=t);const r=JSON.stringify(n);return e.base64Encode(r)}static parseRequestState(e,t){if(!e)throw Ee(Aa);if(!t)throw Ee(Qr);try{const n=t.split(_e.RESOURCE_DELIM),r=n[0],i=n.length>1?n.slice(1).join(_e.RESOURCE_DELIM):_e.EMPTY_STRING,s=e.base64Decode(r),a=JSON.parse(s);return{userRequestState:i||_e.EMPTY_STRING,libraryState:a}}catch{throw Ee(Qr)}}}/*! @azure/msal-common v15.2.0 2025-02-18 */const pb={SW:"sw",UHW:"uhw"};class Xr{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(ce.PopTokenGenerateCnf,e.correlationId);const n=await Se(this.generateKid.bind(this),ce.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),r=this.cryptoUtils.base64UrlEncode(JSON.stringify(n));return{kid:n.kid,reqCnfString:r}}async generateKid(e){var n;return(n=this.performanceClient)==null||n.addQueueMeasurement(ce.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:pb.SW}}async signPopToken(e,t,n){return this.signPayload(e,t,n)}async signPayload(e,t,n,r){const{resourceRequestMethod:i,resourceRequestUri:s,shrClaims:a,shrNonce:l,shrOptions:c}=n,u=s?new Ot(s):void 0,d=u==null?void 0:u.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:zo(),m:i==null?void 0:i.toUpperCase(),u:d==null?void 0:d.HostNameAndPort,nonce:l||this.cryptoUtils.createNewGuid(),p:d==null?void 0:d.AbsolutePath,q:d!=null&&d.QueryString?[[],d.QueryString]:void 0,client_claims:a||void 0,...r},t,c,n.correlationId)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class _b{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}/*! @azure/msal-common v15.2.0 2025-02-18 */function bb(o){var n,r;const e="code=",t=(n=o.error_uri)==null?void 0:n.lastIndexOf(e);return t&&t>=0?(r=o.error_uri)==null?void 0:r.substring(t+e.length):void 0}class wr{constructor(e,t,n,r,i,s,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=r,this.serializableCache=i,this.persistencePlugin=s,this.performanceClient=a}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw e.state?Ee(hs,"Cached State"):Ee(hs,"Server State");let n,r;try{n=decodeURIComponent(e.state)}catch{throw Ee(Qr,e.state)}try{r=decodeURIComponent(t)}catch{throw Ee(Qr,e.state)}if(n!==r)throw Ee(Xf);if(e.error||e.error_description||e.suberror){const i=bb(e);throw Bc(e.error,e.error_description,e.suberror)?new Co(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",i):new cr(e.error||"",e.error_description,e.suberror,i)}}validateTokenResponse(e,t){var n;if(e.error||e.error_description||e.suberror){const r=`Error(s): ${e.error_codes||_e.NOT_AVAILABLE} - Timestamp: ${e.timestamp||_e.NOT_AVAILABLE} - Description: ${e.error_description||_e.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||_e.NOT_AVAILABLE} - Trace ID: ${e.trace_id||_e.NOT_AVAILABLE}`,i=(n=e.error_codes)!=null&&n.length?e.error_codes[0]:void 0,s=new cr(e.error,r,e.suberror,i,e.status);if(t&&e.status&&e.status>=Qi.SERVER_ERROR_RANGE_START&&e.status<=Qi.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${s}`);return}else if(t&&e.status&&e.status>=Qi.CLIENT_ERROR_RANGE_START&&e.status<=Qi.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${s}`);return}throw Bc(e.error,e.error_description,e.suberror)?new Co(e.error,e.error_description,e.suberror,e.timestamp||_e.EMPTY_STRING,e.trace_id||_e.EMPTY_STRING,e.correlation_id||_e.EMPTY_STRING,e.claims||_e.EMPTY_STRING,i):s}}async handleServerTokenResponse(e,t,n,r,i,s,a,l,c){var _;(_=this.performanceClient)==null||_.addQueueMeasurement(ce.HandleServerTokenResponse,e.correlation_id);let u;if(e.id_token){if(u=ni(e.id_token||_e.EMPTY_STRING,this.cryptoObj.base64Decode),i&&i.nonce&&u.nonce!==i.nonce)throw Ee(Jf);if(r.maxAge||r.maxAge===0){const b=u.auth_time;if(!b)throw Ee(al);lh(b,r.maxAge)}}this.homeAccountIdentifier=Vn.generateHomeAccountId(e.client_info||_e.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,u);let d;i&&i.state&&(d=ko.parseRequestState(this.cryptoObj,i.state)),e.key_id=e.key_id||r.sshKid||void 0;const f=this.generateCacheRecord(e,t,n,r,u,s,i);let h;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),h=new _b(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(h)),a&&!l&&f.account){const b=f.account.generateAccountKey();if(!this.cacheStorage.getAccount(b))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await wr.generateAuthenticationResult(this.cryptoObj,t,f,!1,r,u,d,void 0,c)}await this.cacheStorage.saveCacheRecord(f,r.correlationId,r.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&h&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(h))}return wr.generateAuthenticationResult(this.cryptoObj,t,f,!1,r,u,d,e,c)}generateCacheRecord(e,t,n,r,i,s,a){const l=t.getPreferredCache();if(!l)throw Ee(cl);const c=Eh(i);let u,d;e.id_token&&i&&(u=Us(this.homeAccountIdentifier,l,e.id_token,this.clientId,c||""),d=Tl(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,i,e.client_info,l,c,a,void 0,this.logger));let f=null;if(e.access_token){const b=e.scope?bn.fromString(e.scope):new bn(r.scopes||[]),v=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,m=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,y=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,w=n+v,I=w+m,S=y&&y>0?n+y:void 0;f=Bs(this.homeAccountIdentifier,l,e.access_token,this.clientId,c||t.tenant||"",b.printScopes(),w,I,this.cryptoObj.base64Decode,S,e.token_type,s,e.key_id,r.claims,r.requestedClaimsHash)}let h=null;if(e.refresh_token){let b;if(e.refresh_token_expires_in){const v=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;b=n+v}h=ch(this.homeAccountIdentifier,l,e.refresh_token,this.clientId,e.foci,s,b)}let _=null;return e.foci&&(_={clientId:this.clientId,environment:l,familyId:e.foci}),{account:d,idToken:u,accessToken:f,refreshToken:h,appMetadata:_}}static async generateAuthenticationResult(e,t,n,r,i,s,a,l,c){var w,I,S,k,C;let u=_e.EMPTY_STRING,d=[],f=null,h,_,b=_e.EMPTY_STRING;if(n.accessToken){if(n.accessToken.tokenType===Vt.POP&&!i.popKid){const R=new Xr(e),{secret:D,keyId:H}=n.accessToken;if(!H)throw Ee(ul);u=await R.signPopToken(D,H,i)}else u=n.accessToken.secret;d=bn.fromString(n.accessToken.target).asArray(),f=new Date(Number(n.accessToken.expiresOn)*1e3),h=new Date(Number(n.accessToken.extendedExpiresOn)*1e3),n.accessToken.refreshOn&&(_=new Date(Number(n.accessToken.refreshOn)*1e3))}n.appMetadata&&(b=n.appMetadata.familyId===gi?gi:"");const v=(s==null?void 0:s.oid)||(s==null?void 0:s.sub)||"",m=(s==null?void 0:s.tid)||"";l!=null&&l.spa_accountid&&n.account&&(n.account.nativeAccountId=l==null?void 0:l.spa_accountid);const y=n.account?vl(n.account.getAccountInfo(),void 0,s,(w=n.idToken)==null?void 0:w.secret):null;return{authority:t.canonicalAuthority,uniqueId:v,tenantId:m,scopes:d,account:y,idToken:((I=n==null?void 0:n.idToken)==null?void 0:I.secret)||"",idTokenClaims:s||{},accessToken:u,fromCache:r,expiresOn:f,extExpiresOn:h,refreshOn:_,correlationId:i.correlationId,requestId:c||_e.EMPTY_STRING,familyId:b,tokenType:((S=n.accessToken)==null?void 0:S.tokenType)||_e.EMPTY_STRING,state:a?a.userRequestState:_e.EMPTY_STRING,cloudGraphHostName:((k=n.account)==null?void 0:k.cloudGraphHostName)||_e.EMPTY_STRING,msGraphHost:((C=n.account)==null?void 0:C.msGraphHost)||_e.EMPTY_STRING,code:l==null?void 0:l.spa_code,fromNativeBroker:!1}}}function Tl(o,e,t,n,r,i,s,a,l,c,u){u==null||u.verbose("setCachedAccount called");const f=o.getAccountKeys().find(m=>m.startsWith(t));let h=null;f&&(h=o.getAccount(f));const _=h||Vn.createAccount({homeAccountId:t,idTokenClaims:r,clientInfo:i,environment:s,cloudGraphHostName:l==null?void 0:l.cloud_graph_host_name,msGraphHost:l==null?void 0:l.msgraph_host,nativeAccountId:c},e,n),b=_.tenantProfiles||[],v=a||_.realm;if(v&&!b.find(m=>m.tenantId===v)){const m=yl(t,_.localAccountId,v,r);b.push(m)}return _.tenantProfiles=b,_}/*! @azure/msal-common v15.2.0 2025-02-18 */async function Dh(o,e,t){return typeof o=="string"?o:o({clientId:e,tokenEndpoint:t})}/*! @azure/msal-common v15.2.0 2025-02-18 */class Hh extends El{constructor(e,t){var n;super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=(n=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:n.defaultScopes}async getAuthCodeUrl(e){var n;(n=this.performanceClient)==null||n.addQueueMeasurement(ce.GetAuthCodeUrl,e.correlationId);const t=await Se(this.createAuthCodeUrlQueryString.bind(this),ce.AuthClientCreateQueryString,this.logger,this.performanceClient,e.correlationId)(e);return Ot.appendQueryString(this.authority.authorizationEndpoint,t)}async acquireToken(e,t){var a,l;if((a=this.performanceClient)==null||a.addQueueMeasurement(ce.AuthClientAcquireToken,e.correlationId),!e.code)throw Ee($f);const n=zo(),r=await Se(this.executeTokenRequest.bind(this),ce.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),i=(l=r.headers)==null?void 0:l[zn.X_MS_REQUEST_ID],s=new wr(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return s.validateTokenResponse(r.body),Se(s.handleServerTokenResponse.bind(s),ce.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,n,e,t,void 0,void 0,void 0,i)}handleFragmentResponse(e,t){if(new wr(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw Ee(rh);return e}getLogoutUri(e){if(!e)throw Jt(ph);const t=this.createLogoutUrlQueryString(e);return Ot.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){var c,u;(c=this.performanceClient)==null||c.addQueueMeasurement(ce.AuthClientExecuteTokenRequest,t.correlationId);const n=this.createTokenQueryParameters(t),r=Ot.appendQueryString(e.tokenEndpoint,n),i=await Se(this.createTokenRequestBody.bind(this),ce.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let s;if(t.clientInfo)try{const d=ms(t.clientInfo,this.cryptoUtils.base64Decode);s={credential:`${d.uid}${Hn.CLIENT_INFO_SEPARATOR}${d.utid}`,type:$n.HOME_ACCOUNT_ID}}catch(d){this.logger.verbose("Could not parse client info for CCS Header: "+d)}const a=this.createTokenRequestHeaders(s||t.ccsCredential),l={clientId:((u=t.tokenBodyParameters)==null?void 0:u.clientId)||this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return Se(this.executePostToTokenEndpoint.bind(this),ce.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(r,i,a,l,t.correlationId,ce.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var r,i;(r=this.performanceClient)==null||r.addQueueMeasurement(ce.AuthClientCreateTokenRequestBody,e.correlationId);const t=new _i(e.correlationId,this.performanceClient);if(t.addClientId(e.embeddedClientId||((i=e.tokenBodyParameters)==null?void 0:i[vr])||this.config.authOptions.clientId),this.includeRedirectUri?t.addRedirectUri(e.redirectUri):Dr.validateRedirectUri(e.redirectUri),t.addScopes(e.scopes,!0,this.oidcDefaultScopes),t.addAuthorizationCode(e.code),t.addLibraryInfo(this.config.libraryInfo),t.addApplicationTelemetry(this.config.telemetry.application),t.addThrottling(),this.serverTelemetryManager&&!Pa(this.config)&&t.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&t.addCodeVerifier(e.codeVerifier),this.config.clientCredentials.clientSecret&&t.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const s=this.config.clientCredentials.clientAssertion;t.addClientAssertion(await Dh(s.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),t.addClientAssertionType(s.assertionType)}if(t.addGrantType(Kf.AUTHORIZATION_CODE_GRANT),t.addClientInfo(),e.authenticationScheme===Vt.POP){const s=new Xr(this.cryptoUtils,this.performanceClient);let a;e.popKid?a=this.cryptoUtils.encodeKid(e.popKid):a=(await Se(s.generateCnf.bind(s),ce.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,t.addPopToken(a)}else if(e.authenticationScheme===Vt.SSH)if(e.sshJwk)t.addSshJwk(e.sshJwk);else throw Jt(zs);(!Uo.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities);let n;if(e.clientInfo)try{const s=ms(e.clientInfo,this.cryptoUtils.base64Decode);n={credential:`${s.uid}${Hn.CLIENT_INFO_SEPARATOR}${s.utid}`,type:$n.HOME_ACCOUNT_ID}}catch(s){this.logger.verbose("Could not parse client info for CCS Header: "+s)}else n=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&n)switch(n.type){case $n.HOME_ACCOUNT_ID:try{const s=Br(n.credential);t.addCcsOid(s)}catch(s){this.logger.verbose("Could not parse home account ID for CCS Header: "+s)}break;case $n.UPN:t.addCcsUpn(n.credential);break}return e.embeddedClientId&&t.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenBodyParameters&&t.addExtraQueryParameters(e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[Hc])&&t.addExtraQueryParameters({[Hc]:"1"}),t.createQueryString()}async createAuthCodeUrlQueryString(e){var i,s,a,l,c,u,d,f,h,_;const t=e.correlationId||this.config.cryptoInterface.createNewGuid();(i=this.performanceClient)==null||i.addQueueMeasurement(ce.AuthClientCreateQueryString,t);const n=new _i(t,this.performanceClient);n.addClientId(e.embeddedClientId||((s=e.extraQueryParameters)==null?void 0:s[vr])||this.config.authOptions.clientId);const r=[...e.scopes||[],...e.extraScopesToConsent||[]];if(n.addScopes(r,!0,this.oidcDefaultScopes),n.addRedirectUri(e.redirectUri),n.addCorrelationId(t),n.addResponseMode(e.responseMode),n.addResponseTypeCode(),n.addLibraryInfo(this.config.libraryInfo),Pa(this.config)||n.addApplicationTelemetry(this.config.telemetry.application),n.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&n.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&n.addPrompt(e.prompt),e.domainHint&&(n.addDomainHint(e.domainHint),(a=this.performanceClient)==null||a.addFields({domainHintFromRequest:!0},t)),(l=this.performanceClient)==null||l.addFields({prompt:e.prompt},t),e.prompt!==Tn.SELECT_ACCOUNT)if(e.sid&&e.prompt===Tn.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),n.addSid(e.sid),(c=this.performanceClient)==null||c.addFields({sidFromRequest:!0},t);else if(e.account){const b=this.extractAccountSid(e.account);let v=this.extractLoginHint(e.account);if(v&&e.domainHint&&(this.logger.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),v=null),v){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),n.addLoginHint(v),(u=this.performanceClient)==null||u.addFields({loginHintFromClaim:!0},t);try{const m=Br(e.account.homeAccountId);n.addCcsOid(m)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(b&&e.prompt===Tn.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),n.addSid(b),(d=this.performanceClient)==null||d.addFields({sidFromClaim:!0},t);try{const m=Br(e.account.homeAccountId);n.addCcsOid(m)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),n.addLoginHint(e.loginHint),n.addCcsUpn(e.loginHint),(f=this.performanceClient)==null||f.addFields({loginHintFromRequest:!0},t);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),n.addLoginHint(e.account.username),(h=this.performanceClient)==null||h.addFields({loginHintFromUpn:!0},t);try{const m=Br(e.account.homeAccountId);n.addCcsOid(m)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),n.addLoginHint(e.loginHint),n.addCcsUpn(e.loginHint),(_=this.performanceClient)==null||_.addFields({loginHintFromRequest:!0},t));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&n.addNonce(e.nonce),e.state&&n.addState(e.state),(e.claims||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,this.config.authOptions.clientCapabilities),e.embeddedClientId&&n.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),this.addExtraQueryParams(e,n),e.platformBroker&&(n.addNativeBroker(),e.authenticationScheme===Vt.POP)){const b=new Xr(this.cryptoUtils);let v;e.popKid?v=this.cryptoUtils.encodeKid(e.popKid):v=(await Se(b.generateCnf.bind(b),ce.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,n.addPopToken(v)}return n.createQueryString()}createLogoutUrlQueryString(e){const t=new _i(e.correlationId,this.performanceClient);return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),this.addExtraQueryParams(e,t),t.createQueryString()}addExtraQueryParams(e,t){!(e.extraQueryParameters&&e.extraQueryParameters.hasOwnProperty("instance_aware"))&&this.config.authOptions.instanceAware&&(e.extraQueryParameters=e.extraQueryParameters||{},e.extraQueryParameters.instance_aware="true"),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters)}extractAccountSid(e){var t;return((t=e.idTokenClaims)==null?void 0:t.sid)||null}extractLoginHint(e){var t;return((t=e.idTokenClaims)==null?void 0:t.login_hint)||null}}/*! @azure/msal-common v15.2.0 2025-02-18 */const yb=300;class vb extends El{constructor(e,t){super(e,t)}async acquireToken(e){var s,a;(s=this.performanceClient)==null||s.addQueueMeasurement(ce.RefreshTokenClientAcquireToken,e.correlationId);const t=zo(),n=await Se(this.executeTokenRequest.bind(this),ce.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),r=(a=n.headers)==null?void 0:a[zn.X_MS_REQUEST_ID],i=new wr(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(n.body),Se(i.handleServerTokenResponse.bind(i),ce.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(n.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,r)}async acquireTokenByRefreshToken(e){var n;if(!e)throw Jt(mh);if((n=this.performanceClient)==null||n.addQueueMeasurement(ce.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw Ee(ll);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await Se(this.acquireTokenWithCachedRefreshToken.bind(this),ce.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(r){const i=r instanceof Co&&r.errorCode===bs,s=r instanceof cr&&r.errorCode===Cc.INVALID_GRANT_ERROR&&r.subError===Cc.CLIENT_MISMATCH_ERROR;if(i||s)return Se(this.acquireTokenWithCachedRefreshToken.bind(this),ce.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw r}return Se(this.acquireTokenWithCachedRefreshToken.bind(this),ce.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){var i,s,a;(i=this.performanceClient)==null||i.addQueueMeasurement(ce.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const n=$o(this.cacheManager.getRefreshToken.bind(this.cacheManager),ce.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,void 0,this.performanceClient,e.correlationId);if(!n)throw Da(bs);if(n.expiresOn&&Ma(n.expiresOn,e.refreshTokenExpirationOffsetSeconds||yb))throw(s=this.performanceClient)==null||s.addFields({rtExpiresOnMs:Number(n.expiresOn)},e.correlationId),Da(Il);const r={...e,refreshToken:n.secret,authenticationScheme:e.authenticationScheme||Vt.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:$n.HOME_ACCOUNT_ID}};try{return await Se(this.acquireToken.bind(this),ce.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(r)}catch(l){if(l instanceof Co&&((a=this.performanceClient)==null||a.addFields({rtExpiresOnMs:Number(n.expiresOn)},e.correlationId),l.subError===Ks)){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const c=pi(n);this.cacheManager.removeRefreshToken(c)}throw l}}async executeTokenRequest(e,t){var l,c;(l=this.performanceClient)==null||l.addQueueMeasurement(ce.RefreshTokenClientExecuteTokenRequest,e.correlationId);const n=this.createTokenQueryParameters(e),r=Ot.appendQueryString(t.tokenEndpoint,n),i=await Se(this.createTokenRequestBody.bind(this),ce.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),s=this.createTokenRequestHeaders(e.ccsCredential),a={clientId:((c=e.tokenBodyParameters)==null?void 0:c.clientId)||this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return Se(this.executePostToTokenEndpoint.bind(this),ce.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(r,i,s,a,e.correlationId,ce.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var r,i,s;(r=this.performanceClient)==null||r.addQueueMeasurement(ce.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=e.correlationId,n=new _i(t,this.performanceClient);if(n.addClientId(e.embeddedClientId||((i=e.tokenBodyParameters)==null?void 0:i[vr])||this.config.authOptions.clientId),e.redirectUri&&n.addRedirectUri(e.redirectUri),n.addScopes(e.scopes,!0,(s=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:s.defaultScopes),n.addGrantType(Kf.REFRESH_TOKEN_GRANT),n.addClientInfo(),n.addLibraryInfo(this.config.libraryInfo),n.addApplicationTelemetry(this.config.telemetry.application),n.addThrottling(),this.serverTelemetryManager&&!Pa(this.config)&&n.addServerTelemetry(this.serverTelemetryManager),n.addRefreshToken(e.refreshToken),this.config.clientCredentials.clientSecret&&n.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const a=this.config.clientCredentials.clientAssertion;n.addClientAssertion(await Dh(a.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),n.addClientAssertionType(a.assertionType)}if(e.authenticationScheme===Vt.POP){const a=new Xr(this.cryptoUtils,this.performanceClient);let l;e.popKid?l=this.cryptoUtils.encodeKid(e.popKid):l=(await Se(a.generateCnf.bind(a),ce.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,n.addPopToken(l)}else if(e.authenticationScheme===Vt.SSH)if(e.sshJwk)n.addSshJwk(e.sshJwk);else throw Jt(zs);if((!Uo.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case $n.HOME_ACCOUNT_ID:try{const a=Br(e.ccsCredential.credential);n.addCcsOid(a)}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case $n.UPN:n.addCcsUpn(e.ccsCredential.credential);break}return e.embeddedClientId&&n.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenBodyParameters&&n.addExtraQueryParameters(e.tokenBodyParameters),n.createQueryString()}}/*! @azure/msal-common v15.2.0 2025-02-18 */class wb extends El{constructor(e,t){super(e,t)}async acquireCachedToken(e){var l;(l=this.performanceClient)==null||l.addQueueMeasurement(ce.SilentFlowClientAcquireCachedToken,e.correlationId);let t=pr.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!Uo.isEmptyObj(e.claims))throw this.setCacheOutcome(pr.FORCE_REFRESH_OR_CLAIMS,e.correlationId),Ee(ar);if(!e.account)throw Ee(ll);const n=e.account.tenantId||cb(e.authority),r=this.cacheManager.getTokenKeys(),i=this.cacheManager.getAccessToken(e.account,e,r,n,this.performanceClient,e.correlationId);if(i){if(Y1(i.cachedAt)||Ma(i.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(pr.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),Ee(ar);i.refreshOn&&Ma(i.refreshOn,0)&&(t=pr.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(pr.NO_CACHED_ACCESS_TOKEN,e.correlationId),Ee(ar);const s=e.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.readAccountFromCache(e.account),accessToken:i,idToken:this.cacheManager.getIdToken(e.account,r,n,this.performanceClient,e.correlationId),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(s)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await Se(this.generateResultFromCacheRecord.bind(this),ce.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(a,e),t]}setCacheOutcome(e,t){var n,r;(n=this.serverTelemetryManager)==null||n.setCacheOutcome(e),(r=this.performanceClient)==null||r.addFields({cacheOutcome:e},t),e!==pr.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(ce.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let n;if(e.idToken&&(n=ni(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){const i=n==null?void 0:n.auth_time;if(!i)throw Ee(al);lh(i,t.maxAge)}return wr.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,n)}}/*! @azure/msal-common v15.2.0 2025-02-18 */const kb={sendGetRequestAsync:()=>Promise.reject(Ee(kt)),sendPostRequestAsync:()=>Promise.reject(Ee(kt))};/*! @azure/msal-common v15.2.0 2025-02-18 */const zc=",",Lh="|";function Cb(o){const{skus:e,libraryName:t,libraryVersion:n,extensionName:r,extensionVersion:i}=o,s=new Map([[0,[t,n]],[2,[r,i]]]);let a=[];if(e!=null&&e.length){if(a=e.split(zc),a.length<4)return e}else a=Array.from({length:4},()=>Lh);return s.forEach((l,c)=>{var u,d;l.length===2&&((u=l[0])!=null&&u.length)&&((d=l[1])!=null&&d.length)&&Eb({skuArr:a,index:c,skuName:l[0],skuVersion:l[1]})}),a.join(zc)}function Eb(o){const{skuArr:e,index:t,skuName:n,skuVersion:r}=o;t>=e.length||(e[t]=[n,r].join(Lh))}class Ii{constructor(e,t){this.cacheOutcome=pr.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||_e.EMPTY_STRING,this.wrapperVer=e.wrapperVer||_e.EMPTY_STRING,this.telemetryCacheKey=On.CACHE_KEY+Hn.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${On.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],n=this.getNativeBrokerErrorCode();n!=null&&n.length&&t.push(`broker_error=${n}`);const r=t.join(On.VALUE_SEPARATOR),i=this.getRegionDiscoveryFields(),s=[e,i].join(On.VALUE_SEPARATOR);return[On.SCHEMA_VERSION,s,r].join(On.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=Ii.maxErrorsToSend(e),n=e.failedRequests.slice(0,2*t).join(On.VALUE_SEPARATOR),r=e.errors.slice(0,t).join(On.VALUE_SEPARATOR),i=e.errors.length,s=t<i?On.OVERFLOW_TRUE:On.OVERFLOW_FALSE,a=[i,s].join(On.VALUE_SEPARATOR);return[On.SCHEMA_VERSION,e.cacheHits,n,r,a].join(On.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=On.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof ln?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(On.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){const e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){const e=this.getLastRequests(),t=Ii.maxErrorsToSend(e),n=e.errors.length;if(t===n)this.cacheManager.removeItem(this.telemetryCacheKey);else{const r={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r)}}static maxErrorsToSend(e){let t,n=0,r=0;const i=e.errors.length;for(t=0;t<i;t++){const s=e.failedRequests[2*t]||_e.EMPTY_STRING,a=e.failedRequests[2*t+1]||_e.EMPTY_STRING,l=e.errors[t]||_e.EMPTY_STRING;if(r+=s.toString().length+a.toString().length+l.length+3,r<On.MAX_LAST_HEADER_BYTES)n+=1;else break}return n}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||_e.EMPTY_STRING),e.push(this.regionSource||_e.EMPTY_STRING),e.push(this.regionOutcome||_e.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e)}static makeExtraSkuString(e){return Cb(e)}}/*! @azure/msal-common v15.2.0 2025-02-18 */const Uh="missing_kid_error",Bh="missing_alg_error";/*! @azure/msal-common v15.2.0 2025-02-18 */const Ib={[Uh]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[Bh]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class Sl extends ln{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,Sl.prototype)}}function Vc(o){return new Sl(o,Ib[o])}/*! @azure/msal-common v15.2.0 2025-02-18 */class Al{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw Vc(Uh);if(!e.alg)throw Vc(Bh);const t=new Al({typ:e.typ||M1.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class Fc{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class Tb{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:lb.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new Fc}}startPerformanceMeasurement(){return new Fc}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const Rl="pkce_not_created",Ha="crypto_nonexistent",Gs="empty_navigate_uri",zh="hash_empty_error",Ml="no_state_in_hash",Vh="hash_does_not_contain_known_properties",Fh="unable_to_parse_state",Kh="state_interaction_type_mismatch",Gh="interaction_in_progress",Wh="popup_window_error",qh="empty_window_error",kr="user_cancelled",Sb="monitor_popup_timeout",Yh="monitor_window_timeout",jh="redirect_in_iframe",Qh="block_iframe_reload",Xh="block_nested_popups",Ab="iframe_closed_prematurely",Ws="silent_logout_unsupported",Jh="no_account_error",Rb="silent_prompt_value_error",Zh="no_token_request_cache_error",xh="unable_to_parse_token_request_cache_error",Ol="no_cached_authority_error",Mb="auth_request_not_set_error",Ob="invalid_cache_type",qs="non_browser_environment",Hr="database_not_open",ys="no_network_connectivity",$h="post_request_failed",eg="get_request_failed",La="failed_to_parse_response",tg="unable_to_load_token",Pl="crypto_key_not_found",ng="auth_code_required",og="auth_code_or_nativeAccountId_required",rg="spa_code_and_nativeAccountId_present",Nl="database_unavailable",ig="unable_to_acquire_token_from_native_platform",sg="native_handshake_timeout",ag="native_extension_not_installed",Di="native_connection_not_established",vs="uninitialized_public_client_application",lg="native_prompt_not_supported",cg="invalid_base64_string",ug="invalid_pop_token_request",dg="failed_to_build_headers",fg="failed_to_parse_headers";/*! @azure/msal-browser v4.5.0 2025-02-26 */const Ko="For more visit: aka.ms/msaljs/browser-errors",Pb={[Rl]:"The PKCE code challenge and verifier could not be generated.",[Ha]:"The crypto object or function is not available.",[Gs]:"Navigation URI is empty. Please check stack trace for more info.",[zh]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${Ko}`,[Ml]:"Hash does not contain state. Please verify that the request originated from msal.",[Vh]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${Ko}`,[Fh]:"Unable to parse state. Please verify that the request originated from msal.",[Kh]:"Hash contains state but the interaction type does not match the caller.",[Gh]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${Ko}`,[Wh]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[qh]:"window.open returned null or undefined window object.",[kr]:"User cancelled the flow.",[Sb]:`Token acquisition in popup failed due to timeout.  ${Ko}`,[Yh]:`Token acquisition in iframe failed due to timeout.  ${Ko}`,[jh]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[Qh]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${Ko}`,[Xh]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[Ab]:"The iframe being monitored was closed prematurely.",[Ws]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[Jh]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[Rb]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[Zh]:"No token request found in cache.",[xh]:"The cached token request could not be parsed.",[Ol]:"No cached authority found.",[Mb]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[Ob]:"Invalid cache type",[qs]:"Login and token requests are not supported in non-browser environments.",[Hr]:"Database is not open!",[ys]:"No network connectivity. Check your internet connection.",[$h]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[eg]:"Network request failed. Please check the network trace to determine root cause.",[La]:"Failed to parse network response. Check network trace.",[tg]:"Error loading token to cache.",[Pl]:"Cryptographic Key or Keypair not found in browser storage.",[ng]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[og]:"An authorization code or nativeAccountId must be provided to this flow.",[rg]:"Request cannot contain both spa code and native account id.",[Nl]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[ig]:`Unable to acquire token from native platform.  ${Ko}`,[sg]:"Timed out while attempting to establish connection to browser extension",[ag]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[Di]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${Ko}`,[vs]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${Ko}`,[lg]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[cg]:"Invalid base64 encoded string.",[ug]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[dg]:"Failed to build request headers object.",[fg]:"Failed to parse response headers"};class Hi extends ln{constructor(e,t){super(e,Pb[e],t),Object.setPrototypeOf(this,Hi.prototype),this.name="BrowserAuthError"}}function xe(o,e){return new Hi(o,e)}/*! @azure/msal-browser v4.5.0 2025-02-26 */const xn={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},zr={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},_r={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},Pn={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},Kc={GET:"GET",POST:"POST"},zt={AUTHORITY:"authority",ACQUIRE_TOKEN_ACCOUNT:"acquireToken.account",SESSION_STATE:"session.state",REQUEST_STATE:"request.state",NONCE_IDTOKEN:"nonce.id_token",ORIGIN_URI:"request.origin",RENEW_STATUS:"token.renew.status",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",SCOPES:"scopes",INTERACTION_STATUS_KEY:"interaction.status",CCS_CREDENTIAL:"ccs.credential",CORRELATION_ID:"request.correlationId",NATIVE_REQUEST:"request.native",REDIRECT_CONTEXT:"request.redirect.context"},ir={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys"},$i={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},tn={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var at;(function(o){o.Redirect="redirect",o.Popup="popup",o.Silent="silent",o.None="none"})(at||(at={}));const Gc={scopes:Pi},hg="jwk",Ua="msal.db",Nb=1,Db=`${Ua}.keys`,Jn={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},Hb=[Jn.Default,Jn.Skip,Jn.RefreshTokenAndNetwork],Lb="msal.browser.log.level",Ub="msal.browser.log.pii";/*! @azure/msal-browser v4.5.0 2025-02-26 */function es(o){return encodeURIComponent(Dl(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function Cr(o){return gg(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Dl(o){return gg(new TextEncoder().encode(o))}function gg(o){const e=Array.from(o,t=>String.fromCodePoint(t)).join("");return btoa(e)}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Xo(o){return new TextDecoder().decode(ws(o))}function ws(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw xe(cg)}const t=atob(e);return Uint8Array.from(t,n=>n.codePointAt(0)||0)}/*! @azure/msal-browser v4.5.0 2025-02-26 */const Bb="RSASSA-PKCS1-v1_5",Ys="AES-GCM",mg="HKDF",Hl="SHA-256",zb=2048,Vb=new Uint8Array([1,0,1]),Wc="0123456789abcdef",qc=new Uint32Array(1),pg="raw",_g="encrypt",bg="decrypt",Fb="deriveKey",Kb="crypto_subtle_undefined",Ll={name:Bb,hash:Hl,modulusLength:zb,publicExponent:Vb};function Gb(o){if(!window)throw xe(qs);if(!window.crypto)throw xe(Ha);if(!o&&!window.crypto.subtle)throw xe(Ha,Kb)}async function yg(o,e,t){e==null||e.addQueueMeasurement(ce.Sha256Digest,t);const r=new TextEncoder().encode(o);return window.crypto.subtle.digest(Hl,r)}function Wb(o){return window.crypto.getRandomValues(o)}function ha(){return window.crypto.getRandomValues(qc),qc[0]}function Eo(){const o=Date.now(),e=ha()*1024+(ha()&1023),t=new Uint8Array(16),n=Math.trunc(e/2**30),r=e&2**30-1,i=ha();t[0]=o/2**40,t[1]=o/2**32,t[2]=o/2**24,t[3]=o/2**16,t[4]=o/2**8,t[5]=o,t[6]=112|n>>>8,t[7]=n,t[8]=128|r>>>24,t[9]=r>>>16,t[10]=r>>>8,t[11]=r,t[12]=i>>>24,t[13]=i>>>16,t[14]=i>>>8,t[15]=i;let s="";for(let a=0;a<t.length;a++)s+=Wc.charAt(t[a]>>>4),s+=Wc.charAt(t[a]&15),(a===3||a===5||a===7||a===9)&&(s+="-");return s}async function qb(o,e){return window.crypto.subtle.generateKey(Ll,o,e)}async function ga(o){return window.crypto.subtle.exportKey(hg,o)}async function Yb(o,e,t){return window.crypto.subtle.importKey(hg,o,Ll,e,t)}async function jb(o,e){return window.crypto.subtle.sign(Ll,o,e)}async function Qb(){const o=await window.crypto.subtle.generateKey({name:Ys,length:256},!0,[_g,bg]);return window.crypto.subtle.exportKey(pg,o)}async function Yc(o){return window.crypto.subtle.importKey(pg,o,mg,!1,[Fb])}async function vg(o,e,t){return window.crypto.subtle.deriveKey({name:mg,salt:e,hash:Hl,info:new TextEncoder().encode(t)},o,{name:Ys,length:256},!1,[_g,bg])}async function Xb(o,e,t){const n=new TextEncoder().encode(e),r=window.crypto.getRandomValues(new Uint8Array(16)),i=await vg(o,r,t),s=await window.crypto.subtle.encrypt({name:Ys,iv:new Uint8Array(12)},i,n);return{data:Cr(new Uint8Array(s)),nonce:Cr(r)}}async function Jb(o,e,t,n){const r=ws(n),i=await vg(o,ws(e),t),s=await window.crypto.subtle.decrypt({name:Ys,iv:new Uint8Array(12)},i,r);return new TextDecoder().decode(s)}async function wg(o){const e=await yg(o),t=new Uint8Array(e);return Cr(t)}/*! @azure/msal-browser v4.5.0 2025-02-26 */const Ti="storage_not_supported",Ba="stubbed_public_client_application_called",ks="in_mem_redirect_unavailable";/*! @azure/msal-browser v4.5.0 2025-02-26 */const as={[Ti]:"Given storage configuration option was not supported.",[Ba]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[ks]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};as[Ti],as[Ba],as[ks];class Ul extends ln{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,Ul.prototype)}}function Bl(o){return new Ul(o,as[o])}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Zb(o){o.location.hash="",typeof o.history.replaceState=="function"&&o.history.replaceState(null,"",`${o.location.origin}${o.location.pathname}${o.location.search}`)}function xb(o){const e=o.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function zl(){return window.parent!==window}function $b(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${xn.POPUP_NAME_PREFIX}.`)===0}function Yo(){return typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function ey(){const e=new Ot(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function ty(){if(Ot.hashContainsKnownProperties(window.location.hash)&&zl())throw xe(Qh)}function ny(o){if(zl()&&!o)throw xe(jh)}function oy(){if($b())throw xe(Xh)}function kg(){if(typeof window>"u")throw xe(qs)}function Cg(o){if(!o)throw xe(vs)}function Vl(o){kg(),ty(),oy(),Cg(o)}function jc(o,e){if(Vl(o),ny(e.system.allowRedirectInIframe),e.cache.cacheLocation===Pn.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw Bl(ks)}function Eg(o){const e=document.createElement("link");e.rel="preconnect",e.href=new URL(o).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}function ry(){return Eo()}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Cs{navigateInternal(e,t){return Cs.defaultNavigateWindow(e,t)}navigateExternal(e,t){return Cs.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(n=>{setTimeout(()=>{n(!0)},t.timeout)})}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class iy{async sendGetRequestAsync(e,t){let n,r={},i=0;const s=Qc(t);try{n=await apiFetch(e,{method:Kc.GET,headers:s})}catch{throw xe(window.navigator.onLine?eg:ys)}r=Xc(n.headers);try{return i=n.status,{headers:r,body:await n.json(),status:i}}catch{throw Lc(xe(La),i,r)}}async sendPostRequestAsync(e,t){const n=t&&t.body||"",r=Qc(t);let i,s=0,a={};try{i=await apiFetch(e,{method:Kc.POST,headers:r,body:n})}catch{throw xe(window.navigator.onLine?$h:ys)}a=Xc(i.headers);try{return s=i.status,{headers:a,body:await i.json(),status:s}}catch{throw Lc(xe(La),s,a)}}}function Qc(o){try{const e=new Headers;if(!(o&&o.headers))return e;const t=o.headers;return Object.entries(t).forEach(([n,r])=>{e.append(n,r)}),e}catch{throw xe(dg)}}function Xc(o){try{const e={};return o.forEach((t,n)=>{e[n]=t}),e}catch{throw xe(fg)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const sy=6e4,za=1e4,ay=3e4,ly=2e3;function cy({auth:o,cache:e,system:t,telemetry:n},r){const i={clientId:_e.EMPTY_STRING,authority:`${_e.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:_e.EMPTY_STRING,authorityMetadata:_e.EMPTY_STRING,redirectUri:typeof window<"u"?Yo():"",postLogoutRedirectUri:_e.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:Qo.AAD,OIDCOptions:{serverResponseType:Ni.FRAGMENT,defaultScopes:[_e.OPENID_SCOPE,_e.PROFILE_SCOPE,_e.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:hl.None,tenant:_e.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1},s={cacheLocation:Pn.SessionStorage,temporaryCacheLocation:Pn.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===Pn.LocalStorage),claimsBasedCachingEnabled:!1},a={loggerCallback:()=>{},logLevel:an.Info,piiLoggingEnabled:!1},c={...{...Rh,loggerOptions:a,networkClient:r?new iy:kb,navigationClient:new Cs,loadFrameTimeout:0,windowHashTimeout:(t==null?void 0:t.loadFrameTimeout)||sy,iframeHashTimeout:(t==null?void 0:t.loadFrameTimeout)||za,navigateFrameWait:0,redirectNavigationTimeout:ay,asyncPopups:!1,allowRedirectInIframe:!1,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:(t==null?void 0:t.nativeBrokerHandshakeTimeout)||ly,pollIntervalMilliseconds:xn.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:(t==null?void 0:t.loggerOptions)||a},u={application:{appName:_e.EMPTY_STRING,appVersion:_e.EMPTY_STRING},client:new Tb};if((o==null?void 0:o.protocolMode)!==Qo.OIDC&&(o!=null&&o.OIDCOptions)&&new lr(c.loggerOptions).warning(JSON.stringify(Jt(wh))),o!=null&&o.protocolMode&&o.protocolMode!==Qo.AAD&&(c!=null&&c.allowPlatformBroker))throw Jt(kh);return{auth:{...i,...o,OIDCOptions:{...i.OIDCOptions,...o==null?void 0:o.OIDCOptions}},cache:{...s,...e},system:c,telemetry:{...u,...n}}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const uy="@azure/msal-browser",js="4.5.0";/*! @azure/msal-browser v4.5.0 2025-02-26 */class Fl{static loggerCallback(e,t){switch(e){case an.Error:console.error(t);return;case an.Info:console.info(t);return;case an.Verbose:console.debug(t);return;case an.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){var l;this.browserEnvironment=typeof window<"u",this.config=cy(e,this.browserEnvironment);let t;try{t=window[Pn.SessionStorage]}catch{}const n=t==null?void 0:t.getItem(Lb),r=(l=t==null?void 0:t.getItem(Ub))==null?void 0:l.toLowerCase(),i=r==="true"?!0:r==="false"?!1:void 0,s={...this.config.system.loggerOptions},a=n&&Object.keys(an).includes(n)?an[n]:void 0;a&&(s.loggerCallback=Fl.loggerCallback,s.logLevel=a),i!==void 0&&(s.piiLoggingEnabled=i),this.logger=new lr(s,uy,js),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Er extends Fl{getModuleName(){return Er.MODULE_NAME}getId(){return Er.ID}async initialize(){return this.available=typeof window<"u",this.available}}Er.MODULE_NAME="";Er.ID="StandardOperatingContext";/*! @azure/msal-browser v4.5.0 2025-02-26 */class dy{constructor(){this.dbName=Ua,this.version=Nb,this.tableName=Db,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const n=window.indexedDB.open(this.dbName,this.version);n.addEventListener("upgradeneeded",r=>{r.target.result.createObjectStore(this.tableName)}),n.addEventListener("success",r=>{const i=r;this.db=i.target.result,this.dbOpen=!0,e()}),n.addEventListener("error",()=>t(xe(Nl)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(xe(Hr));const s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);s.addEventListener("success",a=>{const l=a;this.closeConnection(),t(l.target.result)}),s.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((n,r)=>{if(!this.db)return r(xe(Hr));const a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);a.addEventListener("success",()=>{this.closeConnection(),n()}),a.addEventListener("error",l=>{this.closeConnection(),r(l)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(xe(Hr));const s=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);s.addEventListener("success",()=>{this.closeConnection(),t()}),s.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(xe(Hr));const i=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();i.addEventListener("success",s=>{const a=s;this.closeConnection(),e(a.target.result)}),i.addEventListener("error",s=>{this.closeConnection(),t(s)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(xe(Hr));const s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);s.addEventListener("success",a=>{const l=a;this.closeConnection(),t(l.target.result===1)}),s.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const n=window.indexedDB.deleteDatabase(Ua),r=setTimeout(()=>t(!1),200);n.addEventListener("success",()=>(clearTimeout(r),e(!0))),n.addEventListener("blocked",()=>(clearTimeout(r),e(!0))),n.addEventListener("error",()=>(clearTimeout(r),t(!1)))})}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Qs{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,n)=>{e.push(n)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class fy{constructor(e){this.inMemoryCache=new Qs,this.indexedDBCache=new dy,this.logger=e}handleDatabaseAccessError(e){if(e instanceof Hi&&e.errorCode===Nl)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(n){this.handleDatabaseAccessError(n)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(n){this.handleDatabaseAccessError(n)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(n){this.handleDatabaseAccessError(n)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Jr{constructor(e,t,n){this.logger=e,Gb(n??!1),this.cache=new fy(this.logger),this.performanceClient=t}createNewGuid(){return Eo()}base64Encode(e){return Dl(e)}base64Decode(e){return Xo(e)}base64UrlEncode(e){return es(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){var u;const t=(u=this.performanceClient)==null?void 0:u.startMeasurement(ce.CryptoOptsGetPublicKeyThumbprint,e.correlationId),n=await qb(Jr.EXTRACTABLE,Jr.POP_KEY_USAGES),r=await ga(n.publicKey),i={e:r.e,kty:r.kty,n:r.n},s=Jc(i),a=await this.hashString(s),l=await ga(n.privateKey),c=await Yb(l,!1,["sign"]);return await this.cache.setItem(a,{privateKey:c,publicKey:n.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),a}async removeTokenBindingKey(e){return await this.cache.removeItem(e),!await this.cache.containsKey(e)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,n,r){var w;const i=(w=this.performanceClient)==null?void 0:w.startMeasurement(ce.CryptoOptsSignJwt,r),s=await this.cache.getItem(t);if(!s)throw xe(Pl);const a=await ga(s.publicKey),l=Jc(a),c=es(JSON.stringify({kid:t})),u=Al.getShrHeaderString({...n==null?void 0:n.header,alg:a.alg,kid:c}),d=es(u);e.cnf={jwk:JSON.parse(l)};const f=es(JSON.stringify(e)),h=`${d}.${f}`,b=new TextEncoder().encode(h),v=await jb(s.privateKey,b),m=Cr(new Uint8Array(v)),y=`${h}.${m}`;return i&&i.end({success:!0}),y}async hashString(e){return wg(e)}}Jr.POP_KEY_USAGES=["sign","verify"];Jr.EXTRACTABLE=!0;function Jc(o){return JSON.stringify(o,Object.keys(o).sort())}/*! @azure/msal-browser v4.5.0 2025-02-26 */const hy=24*60*60*1e3,Va={Lax:"Lax",None:"None"};class Ig{initialize(){return Promise.resolve()}getItem(e){const t=`${encodeURIComponent(e)}`,n=document.cookie.split(";");for(let r=0;r<n.length;r++){const i=n[r],[s,...a]=decodeURIComponent(i).trim().split("="),l=a.join("=");if(s===t)return l}return""}getUserData(){throw Ee(kt)}setItem(e,t,n,r=!0,i=Va.Lax){let s=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${i};`;if(n){const a=gy(n);s+=`expires=${a};`}(r||i===Va.None)&&(s+="Secure;"),document.cookie=s}async setUserData(){return Promise.reject(Ee(kt))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(n=>{const r=decodeURIComponent(n).trim().split("=");t.push(r[0])}),t}containsKey(e){return this.getKeys().includes(e)}}function gy(o){const e=new Date;return new Date(e.getTime()+o*hy).toUTCString()}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Fa(o){const e=o.getItem(ir.ACCOUNT_KEYS);return e?JSON.parse(e):[]}function Ka(o,e){const t=e.getItem(`${ir.TOKEN_KEYS}.${o}`);if(t){const n=JSON.parse(t);if(n&&n.hasOwnProperty("idToken")&&n.hasOwnProperty("accessToken")&&n.hasOwnProperty("refreshToken"))return n}return{idToken:[],accessToken:[],refreshToken:[]}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const Zc="msal.cache.encryption",my="msal.broadcast.cache";class py{constructor(e,t,n){if(!window.localStorage)throw Bl(Ti);this.memoryStorage=new Qs,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=n,this.broadcast=new BroadcastChannel(my)}async initialize(e){this.initialized=!0;const t=new Ig,n=t.getItem(Zc);let r={key:"",id:""};if(n)try{r=JSON.parse(n)}catch{}if(r.key&&r.id){const i=$o(ws,ce.Base64Decode,this.logger,this.performanceClient,e)(r.key);this.encryptionCookie={id:r.id,key:await Se(Yc,ce.GenerateHKDF,this.logger,this.performanceClient,e)(i)},await Se(this.importExistingCache.bind(this),ce.ImportExistingCache,this.logger,this.performanceClient,e)(e)}else{this.clear();const i=Eo(),s=await Se(Qb,ce.GenerateBaseKey,this.logger,this.performanceClient,e)(),a=$o(Cr,ce.UrlEncodeArr,this.logger,this.performanceClient,e)(new Uint8Array(s));this.encryptionCookie={id:i,key:await Se(Yc,ce.GenerateHKDF,this.logger,this.performanceClient,e)(s)};const l={id:i,key:a};t.setItem(Zc,JSON.stringify(l),0,!0,Va.None)}this.broadcast.addEventListener("message",this.updateCache.bind(this))}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw xe(vs);return this.memoryStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,n){if(!this.initialized||!this.encryptionCookie)throw xe(vs);const{data:r,nonce:i}=await Se(Xb,ce.Encrypt,this.logger,this.performanceClient,n)(this.encryptionCookie.key,t,this.getContext(e)),s={id:this.encryptionCookie.id,nonce:i,data:r};this.memoryStorage.setItem(e,t),this.setItem(e,JSON.stringify(s)),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),Fa(this).forEach(n=>this.removeItem(n));const t=Ka(this.clientId,this);t.idToken.forEach(n=>this.removeItem(n)),t.accessToken.forEach(n=>this.removeItem(n)),t.refreshToken.forEach(n=>this.removeItem(n)),this.getKeys().forEach(n=>{(n.startsWith(_e.CACHE_PREFIX)||n.indexOf(this.clientId)!==-1)&&this.removeItem(n)})}async importExistingCache(e){if(!this.encryptionCookie)return;let t=Fa(this);t=await this.importArray(t,e),this.setItem(ir.ACCOUNT_KEYS,JSON.stringify(t));const n=Ka(this.clientId,this);n.idToken=await this.importArray(n.idToken,e),n.accessToken=await this.importArray(n.accessToken,e),n.refreshToken=await this.importArray(n.refreshToken,e),this.setItem(`${ir.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const n=this.getItem(e);if(!n)return null;let r;try{r=JSON.parse(n)}catch{return null}return!r.id||!r.nonce||!r.data?(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),null):r.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):Se(Jb,ce.Decrypt,this.logger,this.performanceClient,t)(this.encryptionCookie.key,r.nonce,this.getContext(e),r.data)}async importArray(e,t){const n=[],r=[];return e.forEach(i=>{const s=this.getItemFromEncryptedCache(i,t).then(a=>{a?(this.memoryStorage.setItem(i,a),n.push(i)):this.removeItem(i)});r.push(s)}),await Promise.all(r),n}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e){this.logger.trace("Updating internal cache from broadcast event");const t=this.performanceClient.startMeasurement(ce.LocalStorageUpdated);t.add({isBackground:!0});const{key:n,value:r,context:i}=e.data;if(!n){this.logger.error("Broadcast event missing key"),t.end({success:!1,errorCode:"noKey"});return}if(i&&i!==this.clientId){this.logger.trace(`Ignoring broadcast event from clientId: ${i}`),t.end({success:!1,errorCode:"contextMismatch"});return}r?(this.memoryStorage.setItem(n,r),this.logger.verbose("Updated item in internal cache")):(this.memoryStorage.removeItem(n),this.logger.verbose("Removed item from internal cache")),t.end({success:!0})}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class _y{constructor(){if(!window.sessionStorage)throw Bl(Ti)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Tg(o,e){if(!e)return null;try{return ko.parseRequestState(o,e).libraryState.meta}catch{throw Ee(Qr)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const ut={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"};/*! @azure/msal-browser v4.5.0 2025-02-26 */class Ga extends Oa{constructor(e,t,n,r,i,s,a){super(e,n,r,a),this.cacheConfig=t,this.logger=r,this.internalStorage=new Qs,this.browserStorage=xc(e,t.cacheLocation,r,i),this.temporaryCacheStorage=xc(e,t.temporaryCacheLocation,r,i),this.cookieStorage=new Ig,this.performanceClient=i,this.eventHandler=s}async initialize(e){await this.browserStorage.initialize(e)}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}getAccount(e){this.logger.trace("BrowserCacheManager.getAccount called");const t=this.browserStorage.getUserData(e);if(!t)return this.removeAccountKeyFromMap(e),null;const n=this.validateAndParseJson(t);return!n||!Vn.isAccountEntity(n)?(this.removeAccountKeyFromMap(e),null):Oa.toObject(new Vn,n)}async setAccount(e,t){this.logger.trace("BrowserCacheManager.setAccount called");const n=e.generateAccountKey();await Se(this.browserStorage.setUserData.bind(this.browserStorage),ce.SetUserData,this.logger,this.performanceClient)(n,JSON.stringify(e),t);const r=this.addAccountKeyToMap(n);this.cacheConfig.cacheLocation===Pn.LocalStorage&&r&&this.eventHandler.emitEvent(ut.ACCOUNT_ADDED,void 0,e.getAccountInfo())}getAccountKeys(){return Fa(this.browserStorage)}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const t=this.getAccountKeys();return t.indexOf(e)===-1?(t.push(e),this.browserStorage.setItem(ir.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added"),!0):(this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map"),!1)}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const t=this.getAccountKeys(),n=t.indexOf(e);n>-1?(t.splice(n,1),this.browserStorage.setItem(ir.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}async removeAccount(e){super.removeAccount(e),this.removeAccountKeyFromMap(e)}async removeAccountContext(e){await super.removeAccountContext(e),this.cacheConfig.cacheLocation===Pn.LocalStorage&&this.eventHandler.emitEvent(ut.ACCOUNT_REMOVED,void 0,e.getAccountInfo())}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,bt.ID_TOKEN)}async removeAccessToken(e){super.removeAccessToken(e),this.removeTokenKey(e,bt.ACCESS_TOKEN)}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,bt.REFRESH_TOKEN)}getTokenKeys(){return Ka(this.clientId,this.browserStorage)}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");const n=this.getTokenKeys();switch(t){case bt.ID_TOKEN:n.idToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),n.idToken.push(e));break;case bt.ACCESS_TOKEN:n.accessToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),n.accessToken.push(e));break;case bt.REFRESH_TOKEN:n.refreshToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),n.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),Ee(Ra)}this.browserStorage.setItem(`${ir.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");const n=this.getTokenKeys();switch(t){case bt.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);const r=n.idToken.indexOf(e);r>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),n.idToken.splice(r,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case bt.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);const i=n.accessToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),n.accessToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case bt.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);const s=n.refreshToken.indexOf(e);s>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),n.refreshToken.splice(s,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),Ee(Ra)}this.browserStorage.setItem(`${ir.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}getIdTokenCredential(e){const t=this.browserStorage.getUserData(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,bt.ID_TOKEN),null;const n=this.validateAndParseJson(t);return!n||!Q1(n)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,bt.ID_TOKEN),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),n)}async setIdTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const n=pi(e);await Se(this.browserStorage.setUserData.bind(this.browserStorage),ce.SetUserData,this.logger,this.performanceClient)(n,JSON.stringify(e),t),this.addTokenKey(n,bt.ID_TOKEN)}getAccessTokenCredential(e){const t=this.browserStorage.getUserData(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,bt.ACCESS_TOKEN),null;const n=this.validateAndParseJson(t);return!n||!j1(n)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,bt.ACCESS_TOKEN),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),n)}async setAccessTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const n=pi(e);await Se(this.browserStorage.setUserData.bind(this.browserStorage),ce.SetUserData,this.logger,this.performanceClient)(n,JSON.stringify(e),t),this.addTokenKey(n,bt.ACCESS_TOKEN)}getRefreshTokenCredential(e){const t=this.browserStorage.getUserData(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,bt.REFRESH_TOKEN),null;const n=this.validateAndParseJson(t);return!n||!X1(n)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,bt.REFRESH_TOKEN),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),n)}async setRefreshTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const n=pi(e);await Se(this.browserStorage.setUserData.bind(this.browserStorage),ce.SetUserData,this.logger,this.performanceClient)(n,JSON.stringify(e),t),this.addTokenKey(n,bt.REFRESH_TOKEN)}getAppMetadata(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!r0(e,n)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),n)}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");const t=o0(e);this.browserStorage.setItem(t,JSON.stringify(e))}getServerTelemetry(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!t0(e,n)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),n)}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.browserStorage.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&i0(e,n)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),n):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem($i.WRAPPER_SKU,e),this.internalStorage.setItem($i.WRAPPER_VER,t)}getWrapperMetadata(){const e=this.internalStorage.getItem($i.WRAPPER_SKU)||_e.EMPTY_STRING,t=this.internalStorage.getItem($i.WRAPPER_VER)||_e.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){const e=this.generateCacheKey(wc.ACTIVE_ACCOUNT_FILTERS),t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters found"),null;const n=this.validateAndParseJson(t);return n?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:n.homeAccountId,localAccountId:n.localAccountId,tenantId:n.tenantId})):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){const t=this.generateCacheKey(wc.ACTIVE_ACCOUNT_FILTERS);if(e){this.logger.verbose("setActiveAccount: Active account set");const n={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.browserStorage.setItem(t,JSON.stringify(n))}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t);this.eventHandler.emitEvent(ut.ACTIVE_ACCOUNT_CHANGED)}getThrottlingCache(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!n0(e,n)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),n)}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.browserStorage.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){const n=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const i=this.cookieStorage.getItem(n);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),i}const r=this.temporaryCacheStorage.getItem(n);if(!r){if(this.cacheConfig.cacheLocation===Pn.LocalStorage){const i=this.browserStorage.getItem(n);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),i}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),r}setTemporaryCache(e,t,n){const r=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(r,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(r,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}async clear(){await this.removeAllAccounts(),this.removeAppMetadata(),this.temporaryCacheStorage.getKeys().forEach(e=>{(e.indexOf(_e.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{(e.indexOf(_e.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(e)}),this.internalStorage.clear()}async clearTokensAndKeysWithClaims(e,t){e.addQueueMeasurement(ce.ClearTokensAndKeysWithClaims,t);const n=this.getTokenKeys(),r=[];n.accessToken.forEach(i=>{const s=this.getAccessTokenCredential(i);s!=null&&s.requestedClaimsHash&&i.includes(s.requestedClaimsHash.toLowerCase())&&r.push(this.removeAccessToken(i))}),await Promise.all(r),r.length>0&&this.logger.warning(`${r.length} access tokens with claims in the cache keys have been removed from the cache.`)}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):Uo.startsWith(e,_e.CACHE_PREFIX)?e:`${_e.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){const{libraryState:{id:t}}=ko.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${zt.AUTHORITY}.${t}`)}generateNonceKey(e){const{libraryState:{id:t}}=ko.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${zt.NONCE_IDTOKEN}.${t}`)}generateStateKey(e){const{libraryState:{id:t}}=ko.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${zt.REQUEST_STATE}.${t}`)}getCachedAuthority(e){const t=this.generateStateKey(e),n=this.getTemporaryCache(t);if(!n)return null;const r=this.generateAuthorityKey(n);return this.getTemporaryCache(r)}updateCacheEntries(e,t,n,r,i){this.logger.trace("BrowserCacheManager.updateCacheEntries called");const s=this.generateStateKey(e);this.setTemporaryCache(s,e,!1);const a=this.generateNonceKey(e);this.setTemporaryCache(a,t,!1);const l=this.generateAuthorityKey(e);if(this.setTemporaryCache(l,n,!1),i){const c={credential:i.homeAccountId,type:$n.HOME_ACCOUNT_ID};this.setTemporaryCache(zt.CCS_CREDENTIAL,JSON.stringify(c),!0)}else if(r){const c={credential:r,type:$n.UPN};this.setTemporaryCache(zt.CCS_CREDENTIAL,JSON.stringify(c),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{t.indexOf(e)!==-1&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(zt.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(zt.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(zt.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(zt.CORRELATION_ID)),this.removeTemporaryItem(this.generateCacheKey(zt.CCS_CREDENTIAL)),this.removeTemporaryItem(this.generateCacheKey(zt.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){const t=this.generateStateKey(e),n=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n||_e.EMPTY_STRING)}}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(t.indexOf(zt.REQUEST_STATE)===-1)return;const n=this.temporaryCacheStorage.getItem(t);if(!n)return;const r=Tg(this.cryptoImpl,n);r&&r.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n))}),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");const t=Dl(JSON.stringify(e));this.setTemporaryCache(zt.REQUEST_PARAMS,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");const t=this.getTemporaryCache(zt.REQUEST_PARAMS,!0);if(!t)throw xe(Zh);let n;try{n=JSON.parse(Xo(t))}catch(r){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${r}`),xe(xh)}if(this.removeTemporaryItem(this.generateCacheKey(zt.REQUEST_PARAMS)),!n.authority){const r=this.generateAuthorityKey(e),i=this.getTemporaryCache(r);if(!i)throw xe(Ol);n.authority=i}return n}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(zt.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${_e.CACHE_PREFIX}.${zt.INTERACTION_STATUS_KEY}`;return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){const t=`${_e.CACHE_PREFIX}.${zt.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw xe(Gh);this.setTemporaryCache(t,this.clientId,!1)}else!e&&this.getInteractionInProgress()===this.clientId&&this.removeTemporaryItem(t)}async hydrateCache(e,t){var a,l,c;const n=Us((a=e.account)==null?void 0:a.homeAccountId,(l=e.account)==null?void 0:l.environment,e.idToken,this.clientId,e.tenantId);let r;t.claims&&(r=await this.cryptoImpl.hashString(t.claims));const i=Bs((c=e.account)==null?void 0:c.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,Xo,void 0,e.tokenType,void 0,t.sshKid,t.claims,r),s={idToken:n,accessToken:i};return this.saveCacheRecord(s,e.correlationId)}async saveCacheRecord(e,t,n){try{await super.saveCacheRecord(e,t,n)}catch(r){if(r instanceof Kr&&this.performanceClient&&t)try{const i=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:i.refreshToken.length,cacheIdCount:i.idToken.length,cacheAtCount:i.accessToken.length},t)}catch{}throw r}}}function xc(o,e,t,n){try{switch(e){case Pn.LocalStorage:return new py(o,t,n);case Pn.SessionStorage:return new _y;case Pn.MemoryStorage:default:break}}catch(r){t.error(r)}return new Qs}const by=(o,e,t,n)=>{const r={cacheLocation:Pn.MemoryStorage,temporaryCacheLocation:Pn.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new Ga(o,r,gs,e,t,n)};/*! @azure/msal-browser v4.5.0 2025-02-26 */function yy(o,e,t,n){return o.verbose("getAllAccounts called"),t?e.getAllAccounts(n):[]}function vy(o,e,t){if(e.trace("getAccount called"),Object.keys(o).length===0)return e.warning("getAccount: No accountFilter provided"),null;const n=t.getAccountInfoFilteredBy(o);return n?(e.verbose("getAccount: Account matching provided filter found, returning"),n):(e.verbose("getAccount: No matching account found, returning null"),null)}function wy(o,e,t){if(e.trace("getAccountByUsername called"),!o)return e.warning("getAccountByUsername: No username provided"),null;const n=t.getAccountInfoFilteredBy({username:o});return n?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${o}`),n):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}function ky(o,e,t){if(e.trace("getAccountByHomeId called"),!o)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;const n=t.getAccountInfoFilteredBy({homeAccountId:o});return n?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${o}`),n):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function Cy(o,e,t){if(e.trace("getAccountByLocalId called"),!o)return e.warning("getAccountByLocalId: No localAccountId provided"),null;const n=t.getAccountInfoFilteredBy({localAccountId:o});return n?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${o}`),n):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function Ey(o,e){e.setActiveAccount(o)}function Iy(o){return o.getActiveAccount()}/*! @azure/msal-browser v4.5.0 2025-02-26 */const Ty="msal.broadcast.event";class Sy{constructor(e){this.eventCallbacks=new Map,this.logger=e||new lr({}),this.broadcastChannel=new BroadcastChannel(Ty),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,n){if(typeof window<"u"){const r=n||ry();return this.eventCallbacks.has(r)?(this.logger.error(`Event callback with id: ${r} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(r,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${r}`),r)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,n,r){const i={eventType:e,interactionType:t||null,payload:n||null,error:r||null,timestamp:Date.now()};switch(e){case ut.ACCOUNT_ADDED:case ut.ACCOUNT_REMOVED:case ut.ACTIVE_ACCOUNT_CHANGED:this.broadcastChannel.postMessage(i);break;default:this.invokeCallbacks(i);break}}invokeCallbacks(e){this.eventCallbacks.forEach(([t,n],r)=>{(n.length===0||n.includes(e.eventType))&&(this.logger.verbose(`Emitting event to callback ${r}: ${e.eventType}`),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){this.broadcastChannel.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel.removeEventListener("message",this.invokeCrossTabCallbacks)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Sg{constructor(e,t,n,r,i,s,a,l,c){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=i,this.navigationClient=s,this.nativeMessageHandler=l,this.correlationId=c||Eo(),this.logger=r.clone(xn.MSAL_SKU,js,this.correlationId),this.performanceClient=a}async clearCacheOnLogout(e){if(e){Vn.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null));try{await this.browserStorage.removeAccount(Vn.generateAccountCacheKey(e)),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),await this.browserStorage.clear(),await this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri;return Ot.getAbsoluteUrl(t,Yo())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const n={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Ii(n,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,n=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(ce.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const r={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},i=e.requestAuthority||this.config.auth.authority,s=n!=null&&n.length?n==="true":this.config.auth.instanceAware,a=t&&s?this.config.auth.authority.replace(Ot.getDomainFromUrl(i),t.environment):i,l=Dn.generateAuthority(a,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),c=await Se(Ph,ce.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(l,this.config.system.networkClient,this.browserStorage,r,this.logger,this.correlationId,this.performanceClient);if(t&&!c.isAlias(t.environment))throw Jt(Ch);return c}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const Ay=32;async function Ag(o,e,t){o.addQueueMeasurement(ce.GeneratePkceCodes,t);const n=$o(Ry,ce.GenerateCodeVerifier,e,o,t)(o,e,t),r=await Se(My,ce.GenerateCodeChallengeFromVerifier,e,o,t)(n,o,e,t);return{verifier:n,challenge:r}}function Ry(o,e,t){try{const n=new Uint8Array(Ay);return $o(Wb,ce.GetRandomValues,e,o,t)(n),Cr(n)}catch{throw xe(Rl)}}async function My(o,e,t,n){e.addQueueMeasurement(ce.GenerateCodeChallengeFromVerifier,n);try{const r=await Se(yg,ce.Sha256Digest,t,e,n)(o,e,n);return Cr(new Uint8Array(r))}catch{throw xe(Rl)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */async function Kl(o,e,t,n){t.addQueueMeasurement(ce.InitializeBaseRequest,o.correlationId);const r=o.authority||e.auth.authority,i=[...o&&o.scopes||[]],s={...o,correlationId:o.correlationId,authority:r,scopes:i};if(!s.authenticationScheme)s.authenticationScheme=Vt.BEARER,n.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(s.authenticationScheme===Vt.SSH){if(!o.sshJwk)throw Jt(zs);if(!o.sshKid)throw Jt(vh)}n.verbose(`Authentication Scheme set to "${s.authenticationScheme}" as configured in Auth request`)}return e.cache.claimsBasedCachingEnabled&&o.claims&&!Uo.isEmptyObj(o.claims)&&(s.requestedClaimsHash=await wg(o.claims)),s}async function Oy(o,e,t,n,r){n.addQueueMeasurement(ce.InitializeSilentRequest,o.correlationId);const i=await Se(Kl,ce.InitializeBaseRequest,r,n,o.correlationId)(o,t,n,r);return{...o,...i,account:e,forceRefresh:o.forceRefresh||!1}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class oi extends Sg{async initializeAuthorizationCodeRequest(e,t){this.performanceClient.addQueueMeasurement(ce.StandardInteractionClientInitializeAuthorizationCodeRequest,this.correlationId);const n=t||await Se(Ag,ce.GeneratePkceCodes,this.logger,this.performanceClient,this.correlationId)(this.performanceClient,this.logger,this.correlationId),r={...e,redirectUri:e.redirectUri,code:_e.EMPTY_STRING,codeVerifier:n.verifier};return e.codeChallenge=n.challenge,e.codeChallengeMethod=_e.S256_CODE_CHALLENGE_METHOD,r}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e==null?void 0:e.correlationId);const t={correlationId:this.correlationId||Eo(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=n)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=Ot.getAbsoluteUrl(e.postLogoutRedirectUri,Yo())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=Ot.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,Yo())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=Ot.getAbsoluteUrl(Yo(),Yo())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(ce.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await Se(this.getClientConfiguration.bind(this),ce.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new Hh(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:n,requestAzureCloudOptions:r,requestExtraQueryParameters:i,account:s}=e;this.performanceClient.addQueueMeasurement(ce.StandardInteractionClientGetClientConfiguration,this.correlationId);const a=await Se(this.getDiscoveredAuthority.bind(this),ce.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:n,requestAzureCloudOptions:r,requestExtraQueryParameters:i,account:s}),l=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:a,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:l.loggerCallback,piiLoggingEnabled:l.piiLoggingEnabled,logLevel:l.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:xn.MSAL_SKU,version:js,cpu:_e.EMPTY_STRING,os:_e.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(ce.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const n=this.getRedirectUri(e.redirectUri),r={interactionType:t},i=ko.setRequestState(this.browserCrypto,e&&e.state||_e.EMPTY_STRING,r),a={...await Se(Kl,ce.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:n,state:i,nonce:e.nonce||Eo(),responseMode:this.config.auth.OIDCOptions.serverResponseType};if(e.loginHint||e.sid)return a;const l=e.account||this.browserStorage.getActiveAccount();return l&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${l.homeAccountId}`,this.correlationId),a.account=l),a}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const Py="ContentError",Rg="user_switch";/*! @azure/msal-browser v4.5.0 2025-02-26 */const Ny="USER_INTERACTION_REQUIRED",Dy="USER_CANCEL",Hy="NO_NETWORK",Ly="PERSISTENT_ERROR",Uy="DISABLED",By="ACCOUNT_UNAVAILABLE";/*! @azure/msal-browser v4.5.0 2025-02-26 */const zy=-2147186943,Vy={[Rg]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class No extends ln{constructor(e,t,n){super(e,t),Object.setPrototypeOf(this,No.prototype),this.name="NativeAuthError",this.ext=n}}function Lr(o){if(o.ext&&o.ext.status&&(o.ext.status===Ly||o.ext.status===Uy)||o.ext&&o.ext.error&&o.ext.error===zy)return!0;switch(o.errorCode){case Py:return!0;default:return!1}}function Wa(o,e,t){if(t&&t.status)switch(t.status){case By:return Da(Nh);case Ny:return new Co(o,e);case Dy:return xe(kr);case Hy:return xe(ys)}return new No(o,Vy[o]||e,t)}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Mg extends oi{async acquireToken(e){this.performanceClient.addQueueMeasurement(ce.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(tn.acquireTokenSilent_silentFlow),n=await Se(this.getClientConfiguration.bind(this),ce.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),r=new wb(n,this.performanceClient);this.logger.verbose("Silent auth client created");try{const s=(await Se(r.acquireCachedToken.bind(r),ce.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),s}catch(i){throw i instanceof Hi&&i.errorCode===Pl&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),i}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t==null?void 0:t.account)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Gr extends Sg{constructor(e,t,n,r,i,s,a,l,c,u,d,f){var _;super(e,t,n,r,i,s,l,c,f),this.apiId=a,this.accountId=u,this.nativeMessageHandler=c,this.nativeStorageManager=d,this.silentCacheClient=new Mg(e,this.nativeStorageManager,n,r,i,s,l,c,f);const h=this.nativeMessageHandler.getExtensionId()===zr.PREFERRED_EXTENSION_ID?"chrome":(_=this.nativeMessageHandler.getExtensionId())!=null&&_.length?"unknown":void 0;this.skus=Ii.makeExtraSkuString({libraryName:xn.MSAL_SKU,libraryVersion:js,extensionName:h,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[ob]:this.skus}}async acquireToken(e){this.performanceClient.addQueueMeasurement(ce.NativeInteractionClientAcquireToken,e.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const t=this.performanceClient.startMeasurement(ce.NativeInteractionClientAcquireToken,e.correlationId),n=zo(),r=this.initializeServerTelemetryManager(this.apiId);try{const i=await this.initializeNativeRequest(e);try{const u=await this.acquireTokensFromCache(this.accountId,i);return t.end({success:!0,isNativeBroker:!1,fromCache:!0}),u}catch{this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const{...s}=i,a={method:_r.GetToken,request:s},l=await this.nativeMessageHandler.sendMessage(a),c=this.validateNativeResponse(l);return await this.handleNativeResponse(c,i,n).then(u=>(t.end({success:!0,isNativeBroker:!0,requestId:u.requestId}),r.clearNativeBrokerErrorCode(),u)).catch(u=>{throw t.end({success:!1,errorCode:u.errorCode,subErrorCode:u.subError,isNativeBroker:!0}),u})}catch(i){throw i instanceof No&&r.setNativeBrokerErrorCode(i.errorCode),i}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:bn.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),Ee(Sa);const n=this.browserStorage.getBaseAccountInfo({nativeAccountId:e});if(!n)throw Ee(Sa);try{const r=this.createSilentCacheRequest(t,n),i=await this.silentCacheClient.acquireToken(r),s={...n,idTokenClaims:i==null?void 0:i.idTokenClaims,idToken:i==null?void 0:i.idToken};return{...i,account:s}}catch(r){throw r}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...n}=e;delete n.onRedirectNavigate;const r=await this.initializeNativeRequest(n),i={method:_r.GetToken,request:r};try{const l=await this.nativeMessageHandler.sendMessage(i);this.validateNativeResponse(l)}catch(l){if(l instanceof No&&(this.initializeServerTelemetryManager(this.apiId).setNativeBrokerErrorCode(l.errorCode),Lr(l)))throw l}this.browserStorage.setTemporaryCache(zt.NATIVE_REQUEST,JSON.stringify(r),!0);const s={apiId:tn.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(a,s)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const n=this.browserStorage.getCachedNativeRequest();if(!n)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&(e==null||e.addFields({errorCode:"no_cached_request"},t)),null;const{prompt:r,...i}=n;r&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(zt.NATIVE_REQUEST));const s={method:_r.GetToken,request:i},a=zo();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const l=await this.nativeMessageHandler.sendMessage(s);this.validateNativeResponse(l);const c=this.handleNativeResponse(l,i,a);this.browserStorage.setInteractionInProgress(!1);const u=await c;return this.initializeServerTelemetryManager(this.apiId).clearNativeBrokerErrorCode(),u}catch(l){throw this.browserStorage.setInteractionInProgress(!1),l}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,n){var u;this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const r=ni(e.id_token,Xo),i=this.createHomeAccountIdentifier(e,r),s=(u=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId}))==null?void 0:u.homeAccountId;if(i!==s&&e.account.id!==t.accountId)throw Wa(Rg);const a=await this.getDiscoveredAuthority({requestAuthority:t.authority}),l=Tl(this.browserStorage,a,i,Xo,r,e.client_info,void 0,r.tid,void 0,e.account.id,this.logger),c=await this.generateAuthenticationResult(e,t,r,l,a.canonicalAuthority,n);return await this.cacheAccount(l),await this.cacheNativeTokens(e,t,i,r,e.access_token,c.tenantId,n),c}createHomeAccountIdentifier(e,t){return Vn.generateHomeAccountId(e.client_info||_e.EMPTY_STRING,yo.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?bn.fromString(e.scope):bn.fromString(t.scope)}async generatePopAccessToken(e,t){if(t.tokenType===Vt.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const n=new Xr(this.browserCrypto),r={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw Ee(ul);return n.signPopToken(e.access_token,t.keyId,r)}else return e.access_token}async generateAuthenticationResult(e,t,n,r,i,s){const a=this.addTelemetryFromNativeResponse(e),l=e.scope?bn.fromString(e.scope):bn.fromString(t.scope),c=e.account.properties||{},u=c.UID||n.oid||n.sub||_e.EMPTY_STRING,d=c.TenantId||n.tid||_e.EMPTY_STRING,f=vl(r.getAccountInfo(),void 0,n,e.id_token);f.nativeAccountId!==e.account.id&&(f.nativeAccountId=e.account.id);const h=await this.generatePopAccessToken(e,t),_=t.tokenType===Vt.POP?Vt.POP:Vt.BEARER;return{authority:i,uniqueId:u,tenantId:d,scopes:l.asArray(),account:f,idToken:e.id_token,idTokenClaims:n,accessToken:h,fromCache:a?this.isResponseFromCache(a):!1,expiresOn:new Date(Number(s+e.expires_in)*1e3),tokenType:_,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}async cacheAccount(e){await this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})}cacheNativeTokens(e,t,n,r,i,s,a){const l=Us(n,t.authority,e.id_token||"",t.clientId,r.tid||""),c=t.tokenType===Vt.POP?_e.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,u=a+c,d=this.generateScopes(e,t),f=Bs(n,t.authority,i,t.clientId,r.tid||s,d.printScopes(),u,0,Xo,void 0,t.tokenType,void 0,t.keyId),h={idToken:l,accessToken:f};return this.nativeStorageManager.saveCacheRecord(h,this.correlationId,t.storeInCache)}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw Gf(rl,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const n=new Ot(t);n.validateAsUri();const{scopes:r,...i}=e,s=new bn(r||[]);s.appendScopes(Pi);const a=()=>{switch(this.apiId){case tn.ssoSilent:case tn.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),Tn.NONE}if(!e.prompt){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e.prompt){case Tn.NONE:case Tn.CONSENT:case Tn.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),xe(lg)}},l={...i,accountId:this.accountId,clientId:this.config.auth.clientId,authority:n.urlString,scope:s.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:a(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(l.signPopToken&&e.popKid)throw xe(ug);if(this.handleExtraBrokerParams(l),l.extraParameters=l.extraParameters||{},l.extraParameters.telemetry=zr.MATS_TELEMETRY,e.authenticationScheme===Vt.POP){const c={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},u=new Xr(this.browserCrypto);let d;if(l.keyId)d=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:l.keyId})),l.signPopToken=!1;else{const f=await Se(u.generateCnf.bind(u),ce.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(c,this.logger);d=f.reqCnfString,l.keyId=f.kid,l.signPopToken=!0}l.reqCnf=d}return this.addRequestSKUs(l),l}handleExtraBrokerParams(e){var i;const t=e.extraParameters&&e.extraParameters.hasOwnProperty(Cl)&&e.extraParameters.hasOwnProperty(Na)&&e.extraParameters.hasOwnProperty(vr);if(!e.embeddedClientId&&!t)return;let n="";const r=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,n=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[Na],n=e.extraParameters[vr]),e.extraParameters={child_client_id:n,child_redirect_uri:r},(i=this.performanceClient)==null||i.addFields({embeddedClientId:n,embeddedRedirectUri:r},e.correlationId)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Ho{constructor(e,t,n,r){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=r,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=n,this.handshakeEvent=n.startMeasurement(ce.NativeMessageHandlerHandshake)}async sendMessage(e){this.logger.trace("NativeMessageHandler - sendMessage called.");const t={channel:zr.CHANNEL_ID,extensionId:this.extensionId,responseId:Eo(),body:e};return this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(t)}`),this.messageChannel.port1.postMessage(t),new Promise((n,r)=>{this.resolvers.set(t.responseId,{resolve:n,reject:r})})}static async createProvider(e,t,n){e.trace("NativeMessageHandler - createProvider called.");try{const r=new Ho(e,t,n,zr.PREFERRED_EXTENSION_ID);return await r.sendHandshakeRequest(),r}catch{const i=new Ho(e,t,n);return await i.sendHandshakeRequest(),i}}async sendHandshakeRequest(){this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:zr.CHANNEL_ID,extensionId:this.extensionId,responseId:Eo(),body:{method:_r.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,n)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:n}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),n(xe(sg)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;const t=e.data;if(!(!t.channel||t.channel!==zr.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===_r.HandshakeRequest){const n=this.handshakeResolvers.get(t.responseId);if(!n){this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),n.reject(xe(ag))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");const t=e.data,n=this.resolvers.get(t.responseId),r=this.handshakeResolvers.get(t.responseId);try{const i=t.body.method;if(i===_r.Response){if(!n)return;const s=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(s)}`),s.status!=="Success")n.reject(Wa(s.code,s.description,s.ext));else if(s.result)s.result.code&&s.result.description?n.reject(Wa(s.result.code,s.result.description,s.result.ext)):n.resolve(s.result);else throw Gf(rl,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(i===_r.HandshakeResponse){if(!r){this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),r.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(i){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${i}`),this.logger.errorPii(`Unable to parse ${e}`),n?n.reject(i):r&&r.reject(i)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isPlatformBrokerAvailable(e,t,n,r){if(t.trace("isPlatformBrokerAvailable called"),!e.system.allowPlatformBroker)return t.trace("isPlatformBrokerAvailable: allowPlatformBroker is not enabled, returning false"),!1;if(!n)return t.trace("isPlatformBrokerAvailable: Platform extension provider is not initialized, returning false"),!1;if(r)switch(r){case Vt.BEARER:case Vt.POP:return t.trace("isPlatformBrokerAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isPlatformBrokerAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Gl{constructor(e,t,n,r,i){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=i}async handleCodeResponse(e,t){this.performanceClient.addQueueMeasurement(ce.HandleCodeResponse,t.correlationId);let n;try{n=this.authModule.handleFragmentResponse(e,t.state)}catch(r){throw r instanceof cr&&r.subError===kr?xe(kr):r}return Se(this.handleCodeResponseFromServer.bind(this),ce.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(n,t)}async handleCodeResponseFromServer(e,t,n=!0){if(this.performanceClient.addQueueMeasurement(ce.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await Se(this.authModule.updateAuthority.bind(this.authModule),ce.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),n&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const i=this.createCcsCredentials(t);i&&(this.authCodeRequest.ccsCredential=i)}return await Se(this.authModule.acquireToken.bind(this.authModule),ce.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:$n.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:$n.UPN}:null}}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Og(o,e,t){const n=ps(o);if(!n)throw Ih(o)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${o}`),xe(Vh)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),xe(zh));return n}function Fy(o,e,t){if(!o.state)throw xe(Ml);const n=Tg(e,o.state);if(!n)throw xe(Fh);if(n.interactionType!==t)throw xe(Kh)}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Ky extends oi{constructor(e,t,n,r,i,s,a,l,c,u){super(e,t,n,r,i,s,a,c,u),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=l}acquireToken(e,t){try{const r={popupName:this.generatePopupName(e.scopes||Pi,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window};return this.performanceClient.addFields({isAsyncPopup:this.config.system.asyncPopups},this.correlationId),this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,r,t)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(e,r,t))}catch(n){return Promise.reject(n)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),n={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:(e==null?void 0:e.popupWindowAttributes)||{},popupWindowParent:(e==null?void 0:e.popupWindowParent)??window},r=e&&e.authority,i=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,n,r,i)):(this.logger.verbose("asyncPopup set to false, opening popup"),n.popup=this.openSizedPopup("about:blank",n),this.logoutPopupAsync(t,n,r,i))}catch(t){return Promise.reject(t)}}async acquireTokenPopupAsync(e,t,n){var s;this.logger.verbose("acquireTokenPopupAsync called");const r=this.initializeServerTelemetryManager(tn.acquireTokenPopup),i=await Se(this.initializeAuthorizationRequest.bind(this),ce.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,at.Popup);t.popup&&Eg(i.authority);try{const a=await Se(this.initializeAuthorizationCodeRequest.bind(this),ce.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(i,n),l=await Se(this.createAuthCodeClient.bind(this),ce.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:i.authority,requestAzureCloudOptions:i.azureCloudOptions,requestExtraQueryParameters:i.extraQueryParameters,account:i.account}),c=Ho.isPlatformBrokerAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme);let u;c&&(u=this.performanceClient.startMeasurement(ce.FetchAccountIdWithNativeBroker,e.correlationId));const d=await l.getAuthCodeUrl({...i,platformBroker:c}),f=new Gl(l,this.browserStorage,a,this.logger,this.performanceClient),h=this.initiateAuthRequest(d,t);this.eventHandler.emitEvent(ut.POPUP_OPENED,at.Popup,{popupWindow:h},null);const _=await this.monitorPopupForHash(h,t.popupWindowParent),b=$o(Og,ce.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(_,this.config.auth.OIDCOptions.serverResponseType,this.logger);if(Po.removeThrottle(this.browserStorage,this.config.auth.clientId,a),b.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),u&&u.end({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw xe(Di);const m=new Gr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,tn.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,b.accountId,this.nativeStorage,i.correlationId),{userRequestState:y}=ko.parseRequestState(this.browserCrypto,i.state);return await m.acquireToken({...i,state:y,prompt:void 0})}return await f.handleCodeResponse(b,i)}catch(a){throw(s=t.popup)==null||s.close(),a instanceof ln&&(a.setCorrelationId(this.correlationId),r.cacheFailedRequest(a)),a}}async logoutPopupAsync(e,t,n,r){var s,a,l,c;this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(ut.LOGOUT_START,at.Popup,e);const i=this.initializeServerTelemetryManager(tn.logoutPopup);try{await this.clearCacheOnLogout(e.account);const u=await Se(this.createAuthCodeClient.bind(this),ce.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:n,account:e.account||void 0});try{u.authority.endSessionEndpoint}catch{if((s=e.account)!=null&&s.homeAccountId&&e.postLogoutRedirectUri&&u.authority.protocolMode===Qo.OIDC){if(this.browserStorage.removeAccount((a=e.account)==null?void 0:a.homeAccountId),this.eventHandler.emitEvent(ut.LOGOUT_SUCCESS,at.Popup,e),r){const h={apiId:tn.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},_=Ot.getAbsoluteUrl(r,Yo());await this.navigationClient.navigateInternal(_,h)}(l=t.popup)==null||l.close();return}}const d=u.getLogoutUri(e);this.eventHandler.emitEvent(ut.LOGOUT_SUCCESS,at.Popup,e);const f=this.openPopup(d,t);if(this.eventHandler.emitEvent(ut.POPUP_OPENED,at.Popup,{popupWindow:f},null),await this.monitorPopupForHash(f,t.popupWindowParent).catch(()=>{}),r){const h={apiId:tn.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},_=Ot.getAbsoluteUrl(r,Yo());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${_}`),await this.navigationClient.navigateInternal(_,h)}else this.logger.verbose("No main window navigation requested")}catch(u){throw(c=t.popup)==null||c.close(),u instanceof ln&&(u.setCorrelationId(this.correlationId),i.cacheFailedRequest(u)),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(ut.LOGOUT_FAILURE,at.Popup,null,u),this.eventHandler.emitEvent(ut.LOGOUT_END,at.Popup),u}this.eventHandler.emitEvent(ut.LOGOUT_END,at.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),xe(Gs)}monitorPopupForHash(e,t){return new Promise((n,r)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const i=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(i),r(xe(kr));return}let s="";try{s=e.location.href}catch{}if(!s||s==="about:blank")return;clearInterval(i);let a="";const l=this.config.auth.OIDCOptions.serverResponseType;e&&(l===Ni.QUERY?a=e.location.search:a=e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),n(a)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let n;if(t.popup?(n=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),n.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),n=this.openSizedPopup(e,t)),!n)throw xe(qh);return n.focus&&n.focus(),this.currentWindow=n,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),n}catch(n){throw this.logger.error("error opening popup "+n.message),this.browserStorage.setInteractionInProgress(!1),xe(Wh)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:n,popupWindowParent:r}){var h,_,b,v;const i=r.screenLeft?r.screenLeft:r.screenX,s=r.screenTop?r.screenTop:r.screenY,a=r.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=r.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let c=(h=n.popupSize)==null?void 0:h.width,u=(_=n.popupSize)==null?void 0:_.height,d=(b=n.popupPosition)==null?void 0:b.top,f=(v=n.popupPosition)==null?void 0:v.left;return(!c||c<0||c>a)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),c=xn.POPUP_WIDTH),(!u||u<0||u>l)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),u=xn.POPUP_HEIGHT),(!d||d<0||d>l)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),d=Math.max(0,l/2-xn.POPUP_HEIGHT/2+s)),(!f||f<0||f>a)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),f=Math.max(0,a/2-xn.POPUP_WIDTH/2+i)),r.open(e,t,`width=${c}, height=${u}, top=${d}, left=${f}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(at.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${xn.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${xn.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class $c{constructor(e,t,n,r,i){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=i}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(zt.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(zt.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest),this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const n={apiId:tn.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};if(typeof t.onRedirectNavigate=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),t.onRedirectNavigate(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),await t.navigationClient.navigateExternal(e,n);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),await t.navigationClient.navigateExternal(e,n);return}}else throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),xe(Gs)}async handleCodeResponse(e,t){this.logger.verbose("RedirectHandler.handleCodeResponse called"),this.browserStorage.setInteractionInProgress(!1);const n=this.browserStorage.generateStateKey(t),r=this.browserStorage.getTemporaryCache(n);if(!r)throw Ee(hs,"Cached State");let i;try{i=this.authModule.handleFragmentResponse(e,r)}catch(c){throw c instanceof cr&&c.subError===kr?xe(kr):c}const s=this.browserStorage.generateNonceKey(r),a=this.browserStorage.getTemporaryCache(s);if(this.authCodeRequest.code=i.code,i.cloud_instance_host_name&&await Se(this.authModule.updateAuthority.bind(this.authModule),ce.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,this.authCodeRequest.correlationId)(i.cloud_instance_host_name,this.authCodeRequest.correlationId),i.nonce=a||void 0,i.state=r,i.client_info)this.authCodeRequest.clientInfo=i.client_info;else{const c=this.checkCcsCredentials();c&&(this.authCodeRequest.ccsCredential=c)}const l=await this.authModule.acquireToken(this.authCodeRequest,i);return this.browserStorage.cleanRequestByState(t),l}checkCcsCredentials(){const e=this.browserStorage.getTemporaryCache(zt.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Gy(){if(typeof window>"u"||typeof window.performance>"u"||typeof window.performance.getEntriesByType!="function")return;const o=window.performance.getEntriesByType("navigation"),e=o.length?o[0]:void 0;return e==null?void 0:e.type}class Wy extends oi{constructor(e,t,n,r,i,s,a,l,c,u){super(e,t,n,r,i,s,a,c,u),this.nativeStorage=l}async acquireToken(e){const t=await Se(this.initializeAuthorizationRequest.bind(this),ce.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,at.Redirect);this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||"",t.account||null);const n=this.initializeServerTelemetryManager(tn.acquireTokenRedirect),r=i=>{i.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.cleanRequestByState(t.state),this.eventHandler.emitEvent(ut.RESTORE_FROM_BFCACHE,at.Redirect))};try{const i=await Se(this.initializeAuthorizationCodeRequest.bind(this),ce.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(t),s=await Se(this.createAuthCodeClient.bind(this),ce.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),a=new $c(s,this.browserStorage,i,this.logger,this.performanceClient),l=await s.getAuthCodeUrl({...t,platformBroker:Ho.isPlatformBrokerAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}),c=this.getRedirectStartPage(e.redirectStartPage);return this.logger.verbosePii(`Redirect start page: ${c}`),window.addEventListener("pageshow",r),await a.initiateAuthRequest(l,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:c,onRedirectNavigate:e.onRedirectNavigate||this.config.auth.onRedirectNavigate})}catch(i){throw i instanceof ln&&(i.setCorrelationId(this.correlationId),n.cacheFailedRequest(i)),window.removeEventListener("pageshow",r),this.browserStorage.cleanRequestByState(t.state),i}}async handleRedirectPromise(e="",t){const n=this.initializeServerTelemetryManager(tn.handleRedirectPromise);try{if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const[r,i]=this.getRedirectResponse(e||"");if(!r)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(at.Redirect),Gy()!=="back_forward"?t.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const s=this.browserStorage.getTemporaryCache(zt.ORIGIN_URI,!0)||_e.EMPTY_STRING,a=Ot.removeHashFromUrl(s),l=Ot.removeHashFromUrl(window.location.href);if(a===l&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),s.indexOf("#")>-1&&xb(s),await this.handleResponse(r,n);if(this.config.auth.navigateToLoginRequestUrl){if(!zl()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(zt.URL_HASH,i,!0);const c={apiId:tn.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let u=!0;if(!s||s==="null"){const d=ey();this.browserStorage.setTemporaryCache(zt.ORIGIN_URI,d,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),u=await this.navigationClient.navigateInternal(d,c)}else this.logger.verbose(`Navigating to loginRequestUrl: ${s}`),u=await this.navigationClient.navigateInternal(s,c);if(!u)return await this.handleResponse(r,n)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(r,n);return null}catch(r){throw r instanceof ln&&(r.setCorrelationId(this.correlationId),n.cacheFailedRequest(r)),this.browserStorage.cleanRequestByInteractionType(at.Redirect),r}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(this.config.auth.OIDCOptions.serverResponseType===Ni.QUERY?t=window.location.search:t=window.location.hash);let n=ps(t);if(n){try{Fy(n,this.browserCrypto,at.Redirect)}catch(i){return i instanceof ln&&this.logger.error(`Interaction type validation failed due to ${i.errorCode}: ${i.errorMessage}`),[null,""]}return Zb(window),this.logger.verbose("Hash contains known properties, returning response hash"),[n,t]}const r=this.browserStorage.getTemporaryCache(zt.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(zt.URL_HASH)),r&&(n=ps(r),n)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[n,r]):[null,""]}async handleResponse(e,t){const n=e.state;if(!n)throw xe(Ml);const r=this.browserStorage.getCachedRequest(n);if(this.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw xe(Di);const l=new Gr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,tn.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,e.accountId,this.nativeStorage,r.correlationId),{userRequestState:c}=ko.parseRequestState(this.browserCrypto,n);return l.acquireToken({...r,state:c,prompt:void 0}).finally(()=>{this.browserStorage.cleanRequestByState(n)})}const i=this.browserStorage.getCachedAuthority(n);if(!i)throw xe(Ol);const s=await Se(this.createAuthCodeClient.bind(this),ce.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:i});return Po.removeThrottle(this.browserStorage,this.config.auth.clientId,r),new $c(s,this.browserStorage,r,this.logger,this.performanceClient).handleCodeResponse(e,n)}async logout(e){var r,i;this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),n=this.initializeServerTelemetryManager(tn.logout);try{this.eventHandler.emitEvent(ut.LOGOUT_START,at.Redirect,e),await this.clearCacheOnLogout(t.account);const s={apiId:tn.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=await Se(this.createAuthCodeClient.bind(this),ce.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:e&&e.authority,requestExtraQueryParameters:e==null?void 0:e.extraQueryParameters,account:e&&e.account||void 0});if(a.authority.protocolMode===Qo.OIDC)try{a.authority.endSessionEndpoint}catch{if((r=t.account)!=null&&r.homeAccountId){this.browserStorage.removeAccount((i=t.account)==null?void 0:i.homeAccountId),this.eventHandler.emitEvent(ut.LOGOUT_SUCCESS,at.Redirect,t);return}}const l=a.getLogoutUri(t);if(this.eventHandler.emitEvent(ut.LOGOUT_SUCCESS,at.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(l)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(l,s);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(l,s);return}}catch(s){throw s instanceof ln&&(s.setCorrelationId(this.correlationId),n.cacheFailedRequest(s)),this.eventHandler.emitEvent(ut.LOGOUT_FAILURE,at.Redirect,null,s),this.eventHandler.emitEvent(ut.LOGOUT_END,at.Redirect),s}this.eventHandler.emitEvent(ut.LOGOUT_END,at.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return Ot.getAbsoluteUrl(t,Yo())}}/*! @azure/msal-browser v4.5.0 2025-02-26 */async function qy(o,e,t,n,r){if(e.addQueueMeasurement(ce.SilentHandlerInitiateAuthRequest,n),!o)throw t.info("Navigate url is empty"),xe(Gs);return r?Se(jy,ce.SilentHandlerLoadFrame,t,e,n)(o,r,e,n):$o(Qy,ce.SilentHandlerLoadFrameSync,t,e,n)(o)}async function Yy(o,e,t,n,r,i,s){return n.addQueueMeasurement(ce.SilentHandlerMonitorIframeForHash,i),new Promise((a,l)=>{e<za&&r.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${za}ms). This may result in timeouts.`);const c=window.setTimeout(()=>{window.clearInterval(u),l(xe(Yh))},e),u=window.setInterval(()=>{let d="";const f=o.contentWindow;try{d=f?f.location.href:""}catch{}if(!d||d==="about:blank")return;let h="";f&&(s===Ni.QUERY?h=f.location.search:h=f.location.hash),window.clearTimeout(c),window.clearInterval(u),a(h)},t)}).finally(()=>{$o(Xy,ce.RemoveHiddenIframe,r,n,i)(o)})}function jy(o,e,t,n){return t.addQueueMeasurement(ce.SilentHandlerLoadFrame,n),new Promise((r,i)=>{const s=Pg();window.setTimeout(()=>{if(!s){i("Unable to load iframe");return}s.src=o,r(s)},e)})}function Qy(o){const e=Pg();return e.src=o,e}function Pg(){const o=document.createElement("iframe");return o.className="msalSilentIframe",o.style.visibility="hidden",o.style.position="absolute",o.style.width=o.style.height="0",o.style.border="0",o.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(o),o}function Xy(o){document.body===o.parentNode&&document.body.removeChild(o)}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Jy extends oi{constructor(e,t,n,r,i,s,a,l,c,u,d){super(e,t,n,r,i,s,l,u,d),this.apiId=a,this.nativeStorage=c}async acquireToken(e){this.performanceClient.addQueueMeasurement(ce.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==Tn.NONE&&t.prompt!==Tn.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${Tn.NONE}`),t.prompt=Tn.NONE):t.prompt=Tn.NONE;const n=await Se(this.initializeAuthorizationRequest.bind(this),ce.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,at.Silent);Eg(n.authority);const r=this.initializeServerTelemetryManager(this.apiId);let i;try{return i=await Se(this.createAuthCodeClient.bind(this),ce.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:n.authority,requestAzureCloudOptions:n.azureCloudOptions,requestExtraQueryParameters:n.extraQueryParameters,account:n.account}),await Se(this.silentTokenHelper.bind(this),ce.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(i,n)}catch(s){if(s instanceof ln&&(s.setCorrelationId(this.correlationId),r.cacheFailedRequest(s)),!i||!(s instanceof ln)||s.errorCode!==xn.INVALID_GRANT_ERROR)throw s;this.performanceClient.addFields({retryError:s.errorCode},this.correlationId);const a=await Se(this.initializeAuthorizationRequest.bind(this),ce.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,at.Silent);return await Se(this.silentTokenHelper.bind(this),ce.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(i,a)}}logout(){return Promise.reject(xe(Ws))}async silentTokenHelper(e,t){const n=t.correlationId;this.performanceClient.addQueueMeasurement(ce.SilentIframeClientTokenHelper,n);const r=await Se(this.initializeAuthorizationCodeRequest.bind(this),ce.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,n)(t),i=await Se(e.getAuthCodeUrl.bind(e),ce.GetAuthCodeUrl,this.logger,this.performanceClient,n)({...t,platformBroker:Ho.isPlatformBrokerAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}),s=new Gl(e,this.browserStorage,r,this.logger,this.performanceClient),a=await Se(qy,ce.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,n)(i,this.performanceClient,this.logger,n,this.config.system.navigateFrameWait),l=this.config.auth.OIDCOptions.serverResponseType,c=await Se(Yy,ce.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,n)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,n,l),u=$o(Og,ce.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(c,l,this.logger);if(u.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw xe(Di);const d=new Gr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,u.accountId,this.browserStorage,n),{userRequestState:f}=ko.parseRequestState(this.browserCrypto,t.state);return Se(d.acquireToken.bind(d),ce.NativeInteractionClientAcquireToken,this.logger,this.performanceClient,n)({...t,state:f,prompt:t.prompt||Tn.NONE})}return Se(s.handleCodeResponse.bind(s),ce.HandleCodeResponse,this.logger,this.performanceClient,n)(u,t)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Zy extends oi{async acquireToken(e){this.performanceClient.addQueueMeasurement(ce.SilentRefreshClientAcquireToken,e.correlationId);const t=await Se(Kl,ce.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),n={...e,...t};e.redirectUri&&(n.redirectUri=this.getRedirectUri(e.redirectUri));const r=this.initializeServerTelemetryManager(tn.acquireTokenSilent_silentFlow),i=await this.createRefreshTokenClient({serverTelemetryManager:r,authorityUrl:n.authority,azureCloudOptions:n.azureCloudOptions,account:n.account});return Se(i.acquireTokenByRefreshToken.bind(i),ce.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(n).catch(s=>{throw s.setCorrelationId(this.correlationId),r.cacheFailedRequest(s),s})}logout(){return Promise.reject(xe(Ws))}async createRefreshTokenClient(e){const t=await Se(this.getClientConfiguration.bind(this),ce.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new vb(t,this.performanceClient)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class xy{constructor(e,t,n,r){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=n,this.cryptoObj=r}async loadExternalTokens(e,t,n){if(!this.isBrowserEnvironment)throw xe(qs);const r=e.correlationId||Eo(),i=t.id_token?ni(t.id_token,Xo):void 0,s={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},a=e.authority?new Dn(Dn.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,s,this.logger,e.correlationId||Eo()):void 0,l=await this.loadAccount(e,n.clientInfo||t.client_info||"",r,i,a),c=await this.loadIdToken(t,l.homeAccountId,l.environment,l.realm,r),u=await this.loadAccessToken(e,t,l.homeAccountId,l.environment,l.realm,n,r),d=await this.loadRefreshToken(t,l.homeAccountId,l.environment,r);return this.generateAuthenticationResult(e,{account:l,idToken:c,accessToken:u,refreshToken:d},i,a)}async loadAccount(e,t,n,r,i){if(this.logger.verbose("TokenCache - loading account"),e.account){const c=Vn.createFromAccountInfo(e.account);return await this.storage.setAccount(c,n),c}else if(!i||!t&&!r)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),xe(tg);const s=Vn.generateHomeAccountId(t,i.authorityType,this.logger,this.cryptoObj,r),a=r==null?void 0:r.tid,l=Tl(this.storage,i,s,Xo,r,t,i.hostnameAndPort,a,void 0,void 0,this.logger);return await this.storage.setAccount(l,n),l}async loadIdToken(e,t,n,r,i){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const s=Us(t,n,e.id_token,this.config.auth.clientId,r);return await this.storage.setIdTokenCredential(s,i),s}async loadAccessToken(e,t,n,r,i,s,a){if(t.access_token)if(t.expires_in){if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null}else return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;else return this.logger.verbose("TokenCache - no access token found in response"),null;this.logger.verbose("TokenCache - loading access token");const l=t.scope?bn.fromString(t.scope):new bn(e.scopes),c=s.expiresOn||t.expires_in+new Date().getTime()/1e3,u=s.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+new Date().getTime()/1e3,d=Bs(n,r,t.access_token,this.config.auth.clientId,i,l.printScopes(),c,u,Xo);return await this.storage.setAccessTokenCredential(d,a),d}async loadRefreshToken(e,t,n,r){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const i=ch(t,n,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return await this.storage.setRefreshTokenCredential(i,r),i}generateAuthenticationResult(e,t,n,r){var u,d,f;let i="",s=[],a=null,l;t!=null&&t.accessToken&&(i=t.accessToken.secret,s=bn.fromString(t.accessToken.target).asArray(),a=new Date(Number(t.accessToken.expiresOn)*1e3),l=new Date(Number(t.accessToken.extendedExpiresOn)*1e3));const c=t.account;return{authority:r?r.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:s,account:c.getAccountInfo(),idToken:((u=t.idToken)==null?void 0:u.secret)||"",idTokenClaims:n||{},accessToken:i,fromCache:!0,expiresOn:a,correlationId:e.correlationId||"",requestId:"",extExpiresOn:l,familyId:((d=t.refreshToken)==null?void 0:d.familyId)||"",tokenType:((f=t==null?void 0:t.accessToken)==null?void 0:f.tokenType)||"",state:e.state||"",cloudGraphHostName:c.cloudGraphHostName||"",msGraphHost:c.msGraphHost||"",fromNativeBroker:!1}}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class $y extends Hh{constructor(e){super(e),this.includeRedirectUri=!1}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class ev extends oi{constructor(e,t,n,r,i,s,a,l,c,u){super(e,t,n,r,i,s,l,c,u),this.apiId=a}async acquireToken(e){if(!e.code)throw xe(ng);const t=await Se(this.initializeAuthorizationRequest.bind(this),ce.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,at.Silent),n=this.initializeServerTelemetryManager(this.apiId);try{const r={...t,code:e.code},i=await Se(this.getClientConfiguration.bind(this),ce.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),s=new $y(i);this.logger.verbose("Auth code client created");const a=new Gl(s,this.browserStorage,r,this.logger,this.performanceClient);return await Se(a.handleCodeResponseFromServer.bind(a),ce.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(r){throw r instanceof ln&&(r.setCorrelationId(this.correlationId),n.cacheFailedRequest(r)),r}}logout(){return Promise.reject(xe(Ws))}}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Ro(o){const e=o==null?void 0:o.idTokenClaims;if(e!=null&&e.tfp||e!=null&&e.acr)return"B2C";if(e!=null&&e.tid){if((e==null?void 0:e.tid)==="9188040d-6c67-4c5b-b112-36a304b66dad")return"MSA"}else return;return"AAD"}function ts(o,e){try{Vl(o)}catch(t){throw e.end({success:!1},t),t}}class Xs{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new Jr(this.logger,this.performanceClient):gs,this.eventHandler=new Sy(this.logger),this.browserStorage=this.isBrowserEnvironment?new Ga(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,ub(this.config.auth)):by(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);const t={cacheLocation:Pn.MemoryStorage,temporaryCacheLocation:Pn.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new Ga(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.tokenCache=new xy(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const n=new Xs(e);return await n.initialize(t),n}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,this.eventHandler.emitEvent(ut.INITIALIZE_END);return}const t=(e==null?void 0:e.correlationId)||this.getRequestCorrelationId(),n=this.config.system.allowPlatformBroker,r=this.performanceClient.startMeasurement(ce.InitializeClientApplication,t);if(this.eventHandler.emitEvent(ut.INITIALIZE_START),await Se(this.browserStorage.initialize.bind(this.browserStorage),ce.InitializeCache,this.logger,this.performanceClient,t)(t),n)try{this.nativeExtensionProvider=await Ho.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)}catch(i){this.logger.verbose(i)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),await Se(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),ce.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,t)(this.performanceClient,t)),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(t),this.initialized=!0,this.eventHandler.emitEvent(ut.INITIALIZE_END),r.end({allowPlatformBroker:n,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),Cg(this.initialized),this.isBrowserEnvironment){const t=e||"";let n=this.redirectResponse.get(t);return typeof n>"u"?(n=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,n),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),n}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){const t=this.getAllAccounts(),n=this.browserStorage.getCachedNativeRequest(),r=n&&Ho.isPlatformBrokerAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e,i=r?n==null?void 0:n.correlationId:this.browserStorage.getTemporaryCache(zt.CORRELATION_ID,!0)||"",s=this.performanceClient.startMeasurement(ce.AcquireTokenRedirect,i);this.eventHandler.emitEvent(ut.HANDLE_REDIRECT_START,at.Redirect);let a;if(r&&this.nativeExtensionProvider){this.logger.trace("handleRedirectPromise - acquiring token from native platform");const l=new Gr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,tn.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,n.accountId,this.nativeInternalStorage,n.correlationId);a=Se(l.handleRedirectPromise.bind(l),ce.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,s.event.correlationId)(this.performanceClient,s.event.correlationId)}else{this.logger.trace("handleRedirectPromise - acquiring token from web flow");const l=this.createRedirectClient(i);a=Se(l.handleRedirectPromise.bind(l),ce.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,s.event.correlationId)(e,s)}return a.then(l=>(l?(t.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(ut.LOGIN_SUCCESS,at.Redirect,l),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_SUCCESS,at.Redirect,l),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),s.end({success:!0,accountType:Ro(l.account)})):s.event.errorCode?s.end({success:!1}):s.discard(),this.eventHandler.emitEvent(ut.HANDLE_REDIRECT_END,at.Redirect),l)).catch(l=>{const c=l;throw t.length>0?this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_FAILURE,at.Redirect,null,c):this.eventHandler.emitEvent(ut.LOGIN_FAILURE,at.Redirect,null,c),this.eventHandler.emitEvent(ut.HANDLE_REDIRECT_END,at.Redirect),s.end({success:!1},c),l})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const n=this.performanceClient.startMeasurement(ce.AcquireTokenPreRedirect,t);n.add({accountType:Ro(e.account),scenarioId:e.scenarioId});const r=e.onRedirectNavigate;if(r)e.onRedirectNavigate=s=>{const a=typeof r=="function"?r(s):void 0;return a!==!1?n.end({success:!0}):n.discard(),a};else{const s=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=a=>{const l=typeof s=="function"?s(a):void 0;return l!==!1?n.end({success:!0}):n.discard(),l}}const i=this.getAllAccounts().length>0;try{jc(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),i?this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_START,at.Redirect,e):this.eventHandler.emitEvent(ut.LOGIN_START,at.Redirect,e);let s;return this.nativeExtensionProvider&&this.canUsePlatformBroker(e)?s=new Gr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,tn.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,n).catch(l=>{if(l instanceof No&&Lr(l))return this.nativeExtensionProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(l instanceof Co)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),l}):s=this.createRedirectClient(t).acquireToken(e),await s}catch(s){throw n.end({success:!1},s),i?this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_FAILURE,at.Redirect,null,s):this.eventHandler.emitEvent(ut.LOGIN_FAILURE,at.Redirect,null,s),s}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(ce.AcquireTokenPopup,t);n.add({scenarioId:e.scenarioId,accountType:Ro(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),ts(this.initialized,n),this.browserStorage.setInteractionInProgress(!0)}catch(a){return Promise.reject(a)}const r=this.getAllAccounts();r.length>0?this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_START,at.Popup,e):this.eventHandler.emitEvent(ut.LOGIN_START,at.Popup,e);let i;const s=this.getPreGeneratedPkceCodes(t);return this.canUsePlatformBroker(e)?i=this.acquireTokenNative({...e,correlationId:t},tn.acquireTokenPopup).then(a=>(this.browserStorage.setInteractionInProgress(!1),n.end({success:!0,isNativeBroker:!0,accountType:Ro(a.account)}),a)).catch(a=>{if(a instanceof No&&Lr(a))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e,s);if(a instanceof Co)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e,s);throw this.browserStorage.setInteractionInProgress(!1),a}):i=this.createPopupClient(t).acquireToken(e,s),i.then(a=>(r.length<this.getAllAccounts().length?this.eventHandler.emitEvent(ut.LOGIN_SUCCESS,at.Popup,a):this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_SUCCESS,at.Popup,a),n.end({success:!0,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length,accountType:Ro(a.account)}),a)).catch(a=>(r.length>0?this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_FAILURE,at.Popup,null,a):this.eventHandler.emitEvent(ut.LOGIN_FAILURE,at.Popup,null,a),n.end({success:!1},a),Promise.reject(a))).finally(()=>this.config.system.asyncPopups&&this.preGeneratePkceCodes(t))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){var i,s;const t=this.getRequestCorrelationId(e),n={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(ce.SsoSilent,t),(i=this.ssoSilentMeasurement)==null||i.add({scenarioId:e.scenarioId,accountType:Ro(e.account)}),ts(this.initialized,this.ssoSilentMeasurement),(s=this.ssoSilentMeasurement)==null||s.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(ut.SSO_SILENT_START,at.Silent,n);let r;return this.canUsePlatformBroker(n)?r=this.acquireTokenNative(n,tn.ssoSilent).catch(a=>{if(a instanceof No&&Lr(a))return this.nativeExtensionProvider=void 0,this.createSilentIframeClient(n.correlationId).acquireToken(n);throw a}):r=this.createSilentIframeClient(n.correlationId).acquireToken(n),r.then(a=>{var l;return this.eventHandler.emitEvent(ut.SSO_SILENT_SUCCESS,at.Silent,a),(l=this.ssoSilentMeasurement)==null||l.end({success:!0,isNativeBroker:a.fromNativeBroker,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length,accountType:Ro(a.account)}),a}).catch(a=>{var l;throw this.eventHandler.emitEvent(ut.SSO_SILENT_FAILURE,at.Silent,null,a),(l=this.ssoSilentMeasurement)==null||l.end({success:!1},a),a}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const n=this.performanceClient.startMeasurement(ce.AcquireTokenByCode,t);ts(this.initialized,n),this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_BY_CODE_START,at.Silent,e),n.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw xe(rg);if(e.code){const r=e.code;let i=this.hybridAuthCodeResponses.get(r);return i?(this.logger.verbose("Existing acquireTokenByCode request found",t),n.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),i=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(s=>(this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_BY_CODE_SUCCESS,at.Silent,s),this.hybridAuthCodeResponses.delete(r),n.end({success:!0,isNativeBroker:s.fromNativeBroker,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length,accountType:Ro(s.account)}),s)).catch(s=>{throw this.hybridAuthCodeResponses.delete(r),this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_BY_CODE_FAILURE,at.Silent,null,s),n.end({success:!1},s),s}),this.hybridAuthCodeResponses.set(r,i)),await i}else if(e.nativeAccountId)if(this.canUsePlatformBroker(e,e.nativeAccountId)){const r=await this.acquireTokenNative({...e,correlationId:t},tn.acquireTokenByCode,e.nativeAccountId).catch(i=>{throw i instanceof No&&Lr(i)&&(this.nativeExtensionProvider=void 0),i});return n.end({accountType:Ro(r.account),success:!0}),r}else throw xe(ig);else throw xe(og)}catch(r){throw this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_BY_CODE_FAILURE,at.Silent,null,r),n.end({success:!1},r),r}}async acquireTokenByCodeAsync(e){var r;return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(ce.AcquireTokenByCodeAsync,e.correlationId),(r=this.acquireTokenByCodeAsyncMeasurement)==null||r.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(i=>{var s;return(s=this.acquireTokenByCodeAsyncMeasurement)==null||s.end({success:!0,fromCache:i.fromCache,isNativeBroker:i.fromNativeBroker}),i}).catch(i=>{var s;throw(s=this.acquireTokenByCodeAsyncMeasurement)==null||s.end({success:!1},i),i}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(ce.AcquireTokenFromCache,e.correlationId),t){case Jn.Default:case Jn.AccessToken:case Jn.AccessTokenAndRefreshToken:const n=this.createSilentCacheClient(e.correlationId);return Se(n.acquireToken.bind(n),ce.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw Ee(ar)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(ce.AcquireTokenByRefreshToken,e.correlationId),t){case Jn.Default:case Jn.AccessTokenAndRefreshToken:case Jn.RefreshToken:case Jn.RefreshTokenAndNetwork:const n=this.createSilentRefreshClient(e.correlationId);return Se(n.acquireToken.bind(n),ce.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw Ee(ar)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(ce.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return Se(t.acquireToken.bind(t),ce.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return jc(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return Vl(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(t){return Promise.reject(t)}}async clearCache(e){if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, returning early.");return}const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){return yy(this.logger,this.browserStorage,this.isBrowserEnvironment,e)}getAccount(e){return vy(e,this.logger,this.browserStorage)}getAccountByUsername(e){return wy(e,this.logger,this.browserStorage)}getAccountByHomeId(e){return ky(e,this.logger,this.browserStorage)}getAccountByLocalId(e){return Cy(e,this.logger,this.browserStorage)}setActiveAccount(e){Ey(e,this.browserStorage)}getActiveAccount(){return Iy(this.browserStorage)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const n=Vn.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(n,e.correlationId),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,n){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw xe(Di);return new Gr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,n||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)}canUsePlatformBroker(e,t){if(this.logger.trace("canUsePlatformBroker called"),!Ho.isPlatformBrokerAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUsePlatformBroker: isPlatformBrokerAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case Tn.NONE:case Tn.CONSENT:case Tn.LOGIN:this.logger.trace("canUsePlatformBroker: prompt is compatible with platform broker flow");break;default:return this.logger.trace(`canUsePlatformBroker: prompt = ${e.prompt} is not compatible with platform broker flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUsePlatformBroker: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Ky(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new Wy(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new Jy(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,tn.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new Mg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new Zy(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new ev(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,tn.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return kg(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){if(this.config.cache.cacheLocation!==Pn.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.subscribeCrossTab()}disableAccountStorageEvents(){if(this.config.cache.cacheLocation!==Pn.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.unsubscribeCrossTab()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e!=null&&e.correlationId?e.correlationId:this.isBrowserEnvironment?Eo():_e.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||Gc})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||Gc})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(ce.AcquireTokenSilent,t);n.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),ts(this.initialized,n),this.logger.verbose("acquireTokenSilent called",t);const r=e.account||this.getActiveAccount();if(!r)throw xe(Jh);n.add({accountType:Ro(r)});const i={clientId:this.config.auth.clientId,authority:e.authority||_e.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:r.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions},s=JSON.stringify(i),a=this.activeSilentTokenRequests.get(s);if(typeof a>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t);const l=Se(this.acquireTokenSilentAsync.bind(this),ce.AcquireTokenSilentAsync,this.logger,this.performanceClient,t)({...e,correlationId:t},r).then(c=>(this.activeSilentTokenRequests.delete(s),n.end({success:!0,fromCache:c.fromCache,isNativeBroker:c.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length}),c)).catch(c=>{throw this.activeSilentTokenRequests.delete(s),n.end({success:!1},c),c});return this.activeSilentTokenRequests.set(s,l),{...await l,state:e.state}}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),n.discard(),{...await a,state:e.state}}async acquireTokenSilentAsync(e,t){const n=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(ce.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_START,at.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",n);const r=await Se(Oy,ce.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),i=e.cacheLookupPolicy||Jn.Default;return this.acquireTokenSilentNoIframe(r,i).catch(async a=>{if(tv(a,i))if(this.activeIframeRequest)if(i!==Jn.Skip){const[c,u]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${u}`,r.correlationId);const d=this.performanceClient.startMeasurement(ce.AwaitConcurrentIframe,r.correlationId);d.add({awaitIframeCorrelationId:u});const f=await c;if(d.end({success:f}),f)return this.logger.verbose(`Parallel iframe request with correlationId: ${u} succeeded. Retrying cache and/or RT redemption`,r.correlationId),this.acquireTokenSilentNoIframe(r,i);throw this.logger.info(`Iframe request with correlationId: ${u} failed. Interaction is required.`),a}else return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",r.correlationId),Se(this.acquireTokenBySilentIframe.bind(this),ce.AcquireTokenBySilentIframe,this.logger,this.performanceClient,r.correlationId)(r);else{let c;return this.activeIframeRequest=[new Promise(u=>{c=u}),r.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",r.correlationId),Se(this.acquireTokenBySilentIframe.bind(this),ce.AcquireTokenBySilentIframe,this.logger,this.performanceClient,r.correlationId)(r).then(u=>(c(!0),u)).catch(u=>{throw c(!1),u}).finally(()=>{this.activeIframeRequest=void 0})}else throw a}).then(a=>(this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_SUCCESS,at.Silent,a),e.correlationId&&this.performanceClient.addFields({fromCache:a.fromCache,isNativeBroker:a.fromNativeBroker},e.correlationId),a)).catch(a=>{throw this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_FAILURE,at.Silent,null,a),a}).finally(()=>{document.removeEventListener("visibilitychange",n)})}async acquireTokenSilentNoIframe(e,t){return Ho.isPlatformBrokerAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.acquireTokenNative(e,tn.acquireTokenSilent_silentFlow).catch(async n=>{throw n instanceof No&&Lr(n)?(this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,Ee(ar)):n})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),Se(this.acquireTokenFromCache.bind(this),ce.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch(n=>{if(t===Jn.AccessToken)throw n;return this.eventHandler.emitEvent(ut.ACQUIRE_TOKEN_NETWORK_START,at.Silent,e),Se(this.acquireTokenByRefreshToken.bind(this),ce.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)}))}async preGeneratePkceCodes(e){return this.logger.verbose("Generating new PKCE codes"),this.pkceCode=await Se(Ag,ce.GeneratePkceCodes,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){this.logger.verbose("Attempting to pick up pre-generated PKCE codes");const t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,this.logger.verbose(`${t?"Found":"Did not find"} pre-generated PKCE codes`),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}}function tv(o,e){const t=!(o instanceof Co&&o.subError!==Ks),n=o.errorCode===xn.INVALID_GRANT_ERROR||o.errorCode===ar,r=t&&n||o.errorCode===bs||o.errorCode===Il,i=Hb.includes(e);return r&&i}/*! @azure/msal-browser v4.5.0 2025-02-26 */async function nv(o,e){const t=new Er(o);return await t.initialize(),Xs.createController(t,e)}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Wl{static async createPublicClientApplication(e){const t=await nv(e);return new Wl(e,t)}constructor(e,t){this.controller=t||new Xs(new Er(e))}async initialize(e){return this.controller.initialize(e)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}let bi="";async function ov(){var t;if(bi)return;const o=await apiFetch("/api/config");if(!o.ok)throw new Error("Failed to fetch OneDrive credentials");if(bi=(t=(await o.json()).onedrive)==null?void 0:t.client_id,!bi)throw new Error("OneDrive client ID not configured")}let lo=null;async function rv(){try{bi||await ov();const o={auth:{authority:"https://login.microsoftonline.com/consumers",clientId:bi}};return lo||(lo=new Wl(o),lo.initialize&&await lo.initialize()),lo}catch(o){throw new Error("MSAL initialization failed: "+(o instanceof Error?o.message:String(o)))}}async function qa(){const o={scopes:["OneDrive.ReadWrite"]};let e="";try{if(lo=await rv(),!lo)throw new Error("MSAL not initialized");e=(await lo.acquireTokenSilent(o)).accessToken}catch{if(!lo)throw new Error("MSAL not initialized");try{const n=await lo.loginPopup(o);lo.setActiveAccount(n.account),n.idToken&&(e=(await lo.acquireTokenSilent(o)).accessToken)}catch(n){throw new Error("Failed to login: "+(n instanceof Error?n.message:String(n)))}}if(!e)throw new Error("Failed to acquire access token");return e}const iv="https://onedrive.live.com/picker";var Tf;const eu={sdk:"8.0",entry:{oneDrive:{files:{}}},authentication:{},messaging:{origin:(Tf=window==null?void 0:window.location)==null?void 0:Tf.origin,channelId:Go()},typesAndSources:{mode:"files",pivots:{oneDrive:!0,recent:!0}}};async function sv(o){const e=await qa();if(!e)throw new Error("Unable to retrieve OneDrive access token.");const t=`${o["@sharePoint.endpoint"]}/drives/${o.parentReference.driveId}/items/${o.id}`,n=await apiFetch(t,{headers:{Authorization:`Bearer ${e}`}});if(!n.ok)throw new Error("Failed to fetch file information.");const i=(await n.json())["@content.downloadUrl"],s=await apiFetch(i);if(!s.ok)throw new Error("Failed to download file.");return await s.blob()}async function av(){if(typeof window>"u")throw new Error("Not in browser environment");return new Promise((o,e)=>{let t=null,n=null;const r=l=>{var u;if(l.source!==t)return;const c=l.data;if((c==null?void 0:c.type)==="initialize"&&(c==null?void 0:c.channelId)===eu.messaging.channelId){if(n=(u=l.ports)==null?void 0:u[0],!n)return;n.addEventListener("message",i),n.start(),n.postMessage({type:"activate"})}},i=async l=>{const c=l.data;switch(c.type){case"notification":break;case"command":{n==null||n.postMessage({type:"acknowledge",id:c.id});const u=c.data;switch(u.command){case"authenticate":{try{const d=await qa();if(d)n==null||n.postMessage({type:"result",id:c.id,data:{result:"token",token:d}});else throw new Error("Could not retrieve auth token")}catch{n==null||n.postMessage({result:"error",error:{code:"tokenError",message:"Failed to get token"},isExpected:!0})}break}case"close":{s(),o(null);break}case"pick":{n==null||n.postMessage({type:"result",id:c.id,data:{result:"success"}}),s(),o(u);break}default:{n==null||n.postMessage({result:"error",error:{code:"unsupportedCommand",message:u.command},isExpected:!0});break}}break}}};function s(){window.removeEventListener("message",r),n&&n.removeEventListener("message",i),t&&(t.close(),t=null)}(async()=>{try{const l=await qa();if(!l)return e(new Error("Failed to acquire access token"));if(t=window.open("","OneDrivePicker","width=800,height=600"),!t)return e(new Error("Failed to open OneDrive picker window"));const c=new URLSearchParams({filePicker:JSON.stringify(eu)}),u=`${iv}?${c.toString()}`,d=t.document.createElement("form");d.setAttribute("action",u),d.setAttribute("method","POST");const f=t.document.createElement("input");f.setAttribute("type","hidden"),f.setAttribute("name","access_token"),f.setAttribute("value",l),d.appendChild(f),t.document.body.appendChild(d),d.submit(),window.addEventListener("message",r)}catch(l){t&&t.close(),e(l)}})()})}async function lv(){const o=await av();if(!o||!o.items||o.items.length===0)return null;const e=o.items[0];return{blob:await sv(e),name:e.name}}function tu(o,e,t){const n=o.slice();return n[27]=e[t],n}function cv(o){let e;const t=o[15].default,n=Ft(t,o,o[23],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i&8388608)&&Kt(n,t,r,r[23],e?Wt(t,r[23],i,null):Gt(r[23]),null)},i(r){e||(T(n,r),e=!0)},o(r){N(n,r),e=!1},d(r){n&&n.d(r)}}}function uv(o){let e,t;return e=new qt({props:{content:o[8].t("More"),$$slots:{default:[cv]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&256&&(i.content=n[8].t("More")),r&8388608&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function nu(o){let e,t,n,r,i=Ct(Object.keys(o[6])),s=[];for(let l=0;l<i.length;l+=1)s[l]=ou(tu(o,i,l));const a=l=>N(s[l],1,1,()=>{s[l]=null});return{c(){e=M("div");for(let l=0;l<s.length;l+=1)s[l].c();t=$(),n=M("hr"),this.h()},l(l){e=O(l,"DIV",{class:!0});var c=A(e);for(let u=0;u<s.length;u+=1)s[u].l(c);c.forEach(p),t=ee(l),n=O(l,"HR",{class:!0}),this.h()},h(){g(e,"class","max-h-28 overflow-y-auto scrollbar-hidden"),g(n,"class","border-black/5 dark:border-white/5 my-1")},m(l,c){U(l,e,c);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);U(l,t,c),U(l,n,c),r=!0},p(l,c){if(c&65){i=Ct(Object.keys(l[6]));let u;for(u=0;u<i.length;u+=1){const d=tu(l,i,u);s[u]?(s[u].p(d,c),T(s[u],1)):(s[u]=ou(d),s[u].c(),T(s[u],1),s[u].m(e,null))}for(De(),u=i.length;u<s.length;u+=1)a(u);He()}},i(l){if(!r){for(let c=0;c<i.length;c+=1)T(s[c]);r=!0}},o(l){s=s.filter(Boolean);for(let c=0;c<s.length;c+=1)N(s[c]);r=!1},d(l){l&&(p(e),p(t),p(n)),Fn(s,l)}}}function dv(o){let e,t,n,r,i=o[6][o[27]].name+"",s,a;return t=new wp({}),{c(){e=M("div"),oe(t.$$.fragment),n=$(),r=M("div"),s=Ie(i),this.h()},l(l){e=O(l,"DIV",{class:!0});var c=A(e);ae(t.$$.fragment,c),c.forEach(p),n=ee(l),r=O(l,"DIV",{class:!0});var u=A(r);s=Te(u,i),u.forEach(p),this.h()},h(){g(e,"class","shrink-0"),g(r,"class","truncate")},m(l,c){U(l,e,c),re(t,e,null),U(l,n,c),U(l,r,c),E(r,s),a=!0},p(l,c){(!a||c&64)&&i!==(i=l[6][l[27]].name+"")&&Pe(s,i)},i(l){a||(T(t.$$.fragment,l),a=!0)},o(l){N(t.$$.fragment,l),a=!1},d(l){l&&(p(e),p(n),p(r)),ie(t)}}}function ou(o){var h;let e,t,n,r,i,s,a,l,c,u;n=new qt({props:{content:((h=o[6][o[27]])==null?void 0:h.description)??"",placement:"top-start",className:"flex flex-1 gap-2 items-center",$$slots:{default:[dv]},$$scope:{ctx:o}}});function d(..._){return o[16](o[27],..._)}s=new Hf({props:{state:o[6][o[27]].enabled}}),s.$on("change",d);function f(){return o[17](o[27])}return{c(){e=M("button"),t=M("div"),oe(n.$$.fragment),r=$(),i=M("div"),oe(s.$$.fragment),a=$(),this.h()},l(_){e=O(_,"BUTTON",{class:!0});var b=A(e);t=O(b,"DIV",{class:!0});var v=A(t);ae(n.$$.fragment,v),v.forEach(p),r=ee(b),i=O(b,"DIV",{class:!0});var m=A(i);ae(s.$$.fragment,m),m.forEach(p),a=ee(b),b.forEach(p),this.h()},h(){g(t,"class","flex-1 truncate"),g(i,"class","shrink-0"),g(e,"class","flex w-full justify-between gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl")},m(_,b){U(_,e,b),E(e,t),re(n,t,null),E(e,r),E(e,i),re(s,i,null),E(e,a),l=!0,c||(u=we(e,"click",f),c=!0)},p(_,b){var y;o=_;const v={};b&64&&(v.content=((y=o[6][o[27]])==null?void 0:y.description)??""),b&8388672&&(v.$$scope={dirty:b,ctx:o}),n.$set(v);const m={};b&64&&(m.state=o[6][o[27]].enabled),s.$set(m)},i(_){l||(T(n.$$.fragment,_),T(s.$$.fragment,_),l=!0)},o(_){N(n.$$.fragment,_),N(s.$$.fragment,_),l=!1},d(_){_&&p(e),ie(n),ie(s),c=!1,u()}}}function fv(o){let e,t,n,r=o[8].t("Upload Files")+"",i,s;return e=new Am({}),{c(){oe(e.$$.fragment),t=$(),n=M("div"),i=Ie(r),this.h()},l(a){ae(e.$$.fragment,a),t=ee(a),n=O(a,"DIV",{class:!0});var l=A(n);i=Te(l,r),l.forEach(p),this.h()},h(){g(n,"class","line-clamp-1")},m(a,l){re(e,a,l),U(a,t,l),U(a,n,l),E(n,i),s=!0},p(a,l){(!s||l&256)&&r!==(r=a[8].t("Upload Files")+"")&&Pe(i,r)},i(a){s||(T(e.$$.fragment,a),s=!0)},o(a){N(e.$$.fragment,a),s=!1},d(a){a&&(p(t),p(n)),ie(e,a)}}}function hv(o){let e,t;return e=new co({props:{class:"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl "+(o[7]?"":"opacity-50"),$$slots:{default:[fv]},$$scope:{ctx:o}}}),e.$on("click",o[18]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&128&&(i.class="flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl "+(n[7]?"":"opacity-50")),r&8388864&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function ru(o){let e,t;return e=new co({props:{class:"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl",$$slots:{default:[gv]},$$scope:{ctx:o}}}),e.$on("click",o[19]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&8388864&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function gv(o){let e,t,n,r,i,s,a,l,c,u=o[8].t("Google Drive")+"",d;return{c(){e=Me("svg"),t=Me("path"),n=Me("path"),r=Me("path"),i=Me("path"),s=Me("path"),a=Me("path"),l=$(),c=M("div"),d=Ie(u),this.h()},l(f){e=Oe(f,"svg",{xmlns:!0,viewBox:!0,class:!0});var h=A(e);t=Oe(h,"path",{d:!0,fill:!0}),A(t).forEach(p),n=Oe(h,"path",{d:!0,fill:!0}),A(n).forEach(p),r=Oe(h,"path",{d:!0,fill:!0}),A(r).forEach(p),i=Oe(h,"path",{d:!0,fill:!0}),A(i).forEach(p),s=Oe(h,"path",{d:!0,fill:!0}),A(s).forEach(p),a=Oe(h,"path",{d:!0,fill:!0}),A(a).forEach(p),h.forEach(p),l=ee(f),c=O(f,"DIV",{class:!0});var _=A(c);d=Te(_,u),_.forEach(p),this.h()},h(){g(t,"d","m6.6 66.85 3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z"),g(t,"fill","#0066da"),g(n,"d","m43.65 25-13.75-23.8c-1.35.8-2.5 1.9-3.3 3.3l-25.4 44a9.06 9.06 0 0 0 -1.2 4.5h27.5z"),g(n,"fill","#00ac47"),g(r,"d","m73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75 7.65-13.25c.8-1.4 1.2-2.95 1.2-4.5h-27.502l5.852 11.5z"),g(r,"fill","#ea4335"),g(i,"d","m43.65 25 13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2z"),g(i,"fill","#00832d"),g(s,"d","m59.8 53h-32.3l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h50.8c1.6 0 3.15-.45 4.5-1.2z"),g(s,"fill","#2684fc"),g(a,"d","m73.4 26.5-12.7-22c-.8-1.4-1.95-2.5-3.3-3.3l-13.75 23.8 16.15 28h27.45c0-1.55-.4-3.1-1.2-4.5z"),g(a,"fill","#ffba00"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 87.3 78"),g(e,"class","w-5 h-5"),g(c,"class","line-clamp-1")},m(f,h){U(f,e,h),E(e,t),E(e,n),E(e,r),E(e,i),E(e,s),E(e,a),U(f,l,h),U(f,c,h),E(c,d)},p(f,h){h&256&&u!==(u=f[8].t("Google Drive")+"")&&Pe(d,u)},d(f){f&&(p(e),p(l),p(c))}}}function iu(o){let e,t;return e=new co({props:{class:"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl",$$slots:{default:[mv]},$$scope:{ctx:o}}}),e.$on("click",o[20]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&8388864&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function mv(o){let e,t,n,r,i,s,a,l,c,u,d,f,h,_,b,v,m,y,w,I,S,k,C,R=o[8].t("OneDrive")+"",D;return{c(){e=Me("svg"),t=Me("mask"),n=Me("path"),r=Me("g"),i=Me("path"),s=Me("path"),a=Me("path"),l=Me("path"),c=Me("defs"),u=Me("linearGradient"),d=Me("stop"),f=Me("stop"),h=Me("linearGradient"),_=Me("stop"),b=Me("stop"),v=Me("linearGradient"),m=Me("stop"),y=Me("stop"),w=Me("linearGradient"),I=Me("stop"),S=Me("stop"),k=$(),C=M("div"),D=Ie(R),this.h()},l(H){e=Oe(H,"svg",{xmlns:!0,viewBox:!0,class:!0,fill:!0});var z=A(e);t=Oe(z,"mask",{id:!0,style:!0,maskUnits:!0,x:!0,y:!0,width:!0,height:!0});var W=A(t);n=Oe(W,"path",{d:!0,fill:!0}),A(n).forEach(p),W.forEach(p),r=Oe(z,"g",{mask:!0});var K=A(r);i=Oe(K,"path",{d:!0,fill:!0}),A(i).forEach(p),s=Oe(K,"path",{d:!0,fill:!0}),A(s).forEach(p),a=Oe(K,"path",{d:!0,fill:!0}),A(a).forEach(p),l=Oe(K,"path",{d:!0,fill:!0}),A(l).forEach(p),K.forEach(p),c=Oe(z,"defs",{});var P=A(c);u=Oe(P,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var V=A(u);d=Oe(V,"stop",{"stop-color":!0}),A(d).forEach(p),f=Oe(V,"stop",{offset:!0,"stop-color":!0}),A(f).forEach(p),V.forEach(p),h=Oe(P,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var L=A(h);_=Oe(L,"stop",{"stop-color":!0}),A(_).forEach(p),b=Oe(L,"stop",{offset:!0,"stop-color":!0}),A(b).forEach(p),L.forEach(p),v=Oe(P,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var q=A(v);m=Oe(q,"stop",{"stop-color":!0}),A(m).forEach(p),y=Oe(q,"stop",{offset:!0,"stop-color":!0}),A(y).forEach(p),q.forEach(p),w=Oe(P,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var Z=A(w);I=Oe(Z,"stop",{"stop-color":!0}),A(I).forEach(p),S=Oe(Z,"stop",{offset:!0,"stop-color":!0}),A(S).forEach(p),Z.forEach(p),P.forEach(p),z.forEach(p),k=ee(H),C=O(H,"DIV",{class:!0});var Q=A(C);D=Te(Q,R),Q.forEach(p),this.h()},h(){g(n,"d","M7.82979 26C3.50549 26 0 22.5675 0 18.3333C0 14.1921 3.35322 10.8179 7.54613 10.6716C9.27535 7.87166 12.4144 6 16 6C20.6308 6 24.5169 9.12183 25.5829 13.3335C29.1316 13.3603 32 16.1855 32 19.6667C32 23.0527 29 26 25.8723 25.9914L7.82979 26Z"),g(n,"fill","#C4C4C4"),g(t,"id","mask0_87_7796"),lt(t,"mask-type","alpha"),g(t,"maskUnits","userSpaceOnUse"),g(t,"x","0"),g(t,"y","6"),g(t,"width","32"),g(t,"height","20"),g(i,"d","M7.83017 26.0001C5.37824 26.0001 3.18957 24.8966 1.75391 23.1691L18.0429 16.3335L30.7089 23.4647C29.5926 24.9211 27.9066 26.0001 26.0004 25.9915C23.1254 26.0001 12.0629 26.0001 7.83017 26.0001Z"),g(i,"fill","url(#paint0_linear_87_7796)"),g(s,"d","M25.5785 13.3149L18.043 16.3334L30.709 23.4647C31.5199 22.4065 32.0004 21.0916 32.0004 19.6669C32.0004 16.1857 29.1321 13.3605 25.5833 13.3337C25.5817 13.3274 25.5801 13.3212 25.5785 13.3149Z"),g(s,"fill","url(#paint1_linear_87_7796)"),g(a,"d","M7.06445 10.7028L18.0423 16.3333L25.5779 13.3148C24.5051 9.11261 20.6237 6 15.9997 6C12.4141 6 9.27508 7.87166 7.54586 10.6716C7.3841 10.6773 7.22358 10.6877 7.06445 10.7028Z"),g(a,"fill","url(#paint2_linear_87_7796)"),g(l,"d","M1.7535 23.1687L18.0425 16.3331L7.06471 10.7026C3.09947 11.0792 0 14.3517 0 18.3331C0 20.1665 0.657197 21.8495 1.7535 23.1687Z"),g(l,"fill","url(#paint3_linear_87_7796)"),g(r,"mask","url(#mask0_87_7796)"),g(d,"stop-color","#2086B8"),g(f,"offset","1"),g(f,"stop-color","#46D3F6"),g(u,"id","paint0_linear_87_7796"),g(u,"x1","4.42591"),g(u,"y1","24.6668"),g(u,"x2","27.2309"),g(u,"y2","23.2764"),g(u,"gradientUnits","userSpaceOnUse"),g(_,"stop-color","#1694DB"),g(b,"offset","1"),g(b,"stop-color","#62C3FE"),g(h,"id","paint1_linear_87_7796"),g(h,"x1","23.8302"),g(h,"y1","19.6668"),g(h,"x2","30.2108"),g(h,"y2","15.2082"),g(h,"gradientUnits","userSpaceOnUse"),g(m,"stop-color","#0D3D78"),g(y,"offset","1"),g(y,"stop-color","#063B83"),g(v,"id","paint2_linear_87_7796"),g(v,"x1","8.51037"),g(v,"y1","7.33333"),g(v,"x2","23.3335"),g(v,"y2","15.9348"),g(v,"gradientUnits","userSpaceOnUse"),g(I,"stop-color","#16589B"),g(S,"offset","1"),g(S,"stop-color","#1464B7"),g(w,"id","paint3_linear_87_7796"),g(w,"x1","-0.340429"),g(w,"y1","19.9998"),g(w,"x2","14.5634"),g(w,"y2","14.4649"),g(w,"gradientUnits","userSpaceOnUse"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 32 32"),g(e,"class","w-5 h-5"),g(e,"fill","none"),g(C,"class","line-clamp-1")},m(H,z){U(H,e,z),E(e,t),E(t,n),E(e,r),E(r,i),E(r,s),E(r,a),E(r,l),E(e,c),E(c,u),E(u,d),E(u,f),E(c,h),E(h,_),E(h,b),E(c,v),E(v,m),E(v,y),E(c,w),E(w,I),E(w,S),U(H,k,z),U(H,C,z),E(C,D)},p(H,z){z&256&&R!==(R=H[8].t("OneDrive")+"")&&Pe(D,R)},d(H){H&&(p(e),p(k),p(C))}}}function pv(o){var d,f,h,_;let e=Object.keys(o[6]).length>0,t,n,r,i,s,a,l=e&&nu(o);n=new qt({props:{content:o[7]?"":o[8].t("You do not have permission to upload files"),className:"w-full",$$slots:{default:[hv]},$$scope:{ctx:o}}});let c=((f=(d=o[9])==null?void 0:d.features)==null?void 0:f.enable_google_drive_integration)&&ru(o),u=((_=(h=o[9])==null?void 0:h.features)==null?void 0:_.enable_onedrive_integration)&&iu(o);return{c(){l&&l.c(),t=$(),oe(n.$$.fragment),r=$(),c&&c.c(),i=$(),u&&u.c(),s=qe()},l(b){l&&l.l(b),t=ee(b),ae(n.$$.fragment,b),r=ee(b),c&&c.l(b),i=ee(b),u&&u.l(b),s=qe()},m(b,v){l&&l.m(b,v),U(b,t,v),re(n,b,v),U(b,r,v),c&&c.m(b,v),U(b,i,v),u&&u.m(b,v),U(b,s,v),a=!0},p(b,v){var y,w,I,S;v&64&&(e=Object.keys(b[6]).length>0),e?l?(l.p(b,v),v&64&&T(l,1)):(l=nu(b),l.c(),T(l,1),l.m(t.parentNode,t)):l&&(De(),N(l,1,1,()=>{l=null}),He());const m={};v&384&&(m.content=b[7]?"":b[8].t("You do not have permission to upload files")),v&8388994&&(m.$$scope={dirty:v,ctx:b}),n.$set(m),(w=(y=b[9])==null?void 0:y.features)!=null&&w.enable_google_drive_integration?c?(c.p(b,v),v&512&&T(c,1)):(c=ru(b),c.c(),T(c,1),c.m(i.parentNode,i)):c&&(De(),N(c,1,1,()=>{c=null}),He()),(S=(I=b[9])==null?void 0:I.features)!=null&&S.enable_onedrive_integration?u?(u.p(b,v),v&512&&T(u,1)):(u=iu(b),u.c(),T(u,1),u.m(s.parentNode,s)):u&&(De(),N(u,1,1,()=>{u=null}),He())},i(b){a||(T(l),T(n.$$.fragment,b),T(c),T(u),a=!0)},o(b){N(l),N(n.$$.fragment,b),N(c),N(u),a=!1},d(b){b&&(p(t),p(r),p(i),p(s)),l&&l.d(b),ie(n,b),c&&c.d(b),u&&u.d(b)}}}function _v(o){let e,t,n;return t=new Ds({props:{class:"w-full max-w-[220px] rounded-xl px-1 py-1  border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-sm",sideOffset:15,alignOffset:-8,side:"top",align:"start",transition:Oi,$$slots:{default:[pv]},$$scope:{ctx:o}}}),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(r){e=O(r,"DIV",{slot:!0});var i=A(e);ae(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"slot","content")},m(r,i){U(r,e,i),re(t,e,null),n=!0},p(r,i){const s={};i&8389583&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){N(t.$$.fragment,r),n=!1},d(r){r&&p(e),ie(t)}}}function bv(o){let e,t,n,r,i,s,a;function l(u){o[21](u)}let c={$$slots:{content:[_v],default:[uv]},$$scope:{ctx:o}};return o[5]!==void 0&&(c.show=o[5]),n=new el({props:c}),ze.push(()=>nt(n,"show",l)),n.$on("change",o[22]),{c(){e=M("input"),t=$(),oe(n.$$.fragment),this.h()},l(u){e=O(u,"INPUT",{id:!0,type:!0,accept:!0,capture:!0,style:!0}),t=ee(u),ae(n.$$.fragment,u),this.h()},h(){g(e,"id","camera-input"),g(e,"type","file"),g(e,"accept","image/*"),g(e,"capture","environment"),lt(e,"display","none")},m(u,d){U(u,e,d),U(u,t,d),re(n,u,d),i=!0,s||(a=we(e,"change",o[11]),s=!0)},p(u,[d]){const f={};d&8389583&&(f.$$scope={dirty:d,ctx:u}),!r&&d&32&&(r=!0,f.show=u[5],tt(()=>r=!1)),n.$set(f)},i(u){i||(T(n.$$.fragment,u),i=!0)},o(u){N(n.$$.fragment,u),i=!1},d(u){u&&(p(e),p(t)),ie(n,u),s=!1,a()}}}function yv(o,e,t){let n,r,i,s;fe(o,yr,K=>t(24,n=K)),fe(o,er,K=>t(14,r=K)),fe(o,ti,K=>t(9,s=K));let{$$slots:a={},$$scope:l}=e;const c=fn("i18n");fe(o,c,K=>t(8,i=K));let{screenCaptureHandler:u}=e,{uploadFilesHandler:d}=e,{inputFilesHandler:f}=e,{uploadGoogleDriveHandler:h}=e,{uploadOneDriveHandler:_}=e,{selectedToolIds:b=[]}=e,{onClose:v}=e,m={},y=!1,w=!0;const I=async()=>{n===null&&await yr.set(await xa(localStorage.token)),t(6,m=n.reduce((K,P,V,L)=>(K[P.id]={name:P.name,description:P.meta.description,enabled:b.includes(P.id)},K),{}))};function S(K){var V;const P=Array.from((V=K.target)==null?void 0:V.files);P&&P.length>0&&(console.log(P),f(P))}const k=async(K,P)=>{const V=P.detail;await it(),V?t(0,b=[...b,K]):t(0,b=b.filter(L=>L!==K))},C=K=>{t(6,m[K].enabled=!m[K].enabled,m)},R=()=>{w&&d()},D=()=>{h()},H=()=>{_()};function z(K){y=K,t(5,y)}const W=K=>{K.detail===!1&&v()};return o.$$set=K=>{"screenCaptureHandler"in K&&t(12,u=K.screenCaptureHandler),"uploadFilesHandler"in K&&t(1,d=K.uploadFilesHandler),"inputFilesHandler"in K&&t(13,f=K.inputFilesHandler),"uploadGoogleDriveHandler"in K&&t(2,h=K.uploadGoogleDriveHandler),"uploadOneDriveHandler"in K&&t(3,_=K.uploadOneDriveHandler),"selectedToolIds"in K&&t(0,b=K.selectedToolIds),"onClose"in K&&t(4,v=K.onClose),"$$scope"in K&&t(23,l=K.$$scope)},o.$$.update=()=>{var K,P;o.$$.dirty&32&&y&&I(),o.$$.dirty&16384&&t(7,w=r.role==="admin"||((P=(K=r==null?void 0:r.permissions)==null?void 0:K.chat)==null?void 0:P.file_upload))},[b,d,h,_,v,y,m,w,i,s,c,S,u,f,r,a,k,C,R,D,H,z,W,l]}class vv extends Ge{constructor(e){super(),We(this,e,yv,bv,Ye,{screenCaptureHandler:12,uploadFilesHandler:1,inputFilesHandler:13,uploadGoogleDriveHandler:2,uploadOneDriveHandler:3,selectedToolIds:0,onClose:4})}}function su(o,e,t){const n=o.slice();return n[0]=e[t],n[15]=t,n}function au(o){let e,t,n,r,i,s,a,l='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg>',c,u,d=o[3].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"",f,h=Ct(o[2]),_=[];for(let b=0;b<h.length;b+=1)_[b]=lu(su(o,h,b));return{c(){e=M("div"),t=M("div"),n=M("div"),r=M("div");for(let b=0;b<_.length;b+=1)_[b].c();i=$(),s=M("div"),a=M("div"),a.innerHTML=l,c=$(),u=M("div"),f=Ie(d),this.h()},l(b){e=O(b,"DIV",{id:!0,class:!0});var v=A(e);t=O(v,"DIV",{class:!0});var m=A(t);n=O(m,"DIV",{class:!0});var y=A(n);r=O(y,"DIV",{class:!0});var w=A(r);for(let k=0;k<_.length;k+=1)_[k].l(w);w.forEach(p),i=ee(y),s=O(y,"DIV",{class:!0});var I=A(s);a=O(I,"DIV",{"data-svelte-h":!0}),yt(a)!=="svelte-cdi12d"&&(a.innerHTML=l),c=ee(I),u=O(I,"DIV",{class:!0});var S=A(u);f=Te(S,d),S.forEach(p),I.forEach(p),y.forEach(p),m.forEach(p),v.forEach(p),this.h()},h(){g(r,"class","m-1 overflow-y-auto p-1 space-y-0.5 scrollbar-hidden"),g(u,"class","line-clamp-1"),g(s,"class","px-2 pt-0.5 pb-1 text-xs text-gray-600 dark:text-gray-100 bg-white dark:bg-gray-900 rounded-b-xl flex items-center space-x-1"),g(n,"class","max-h-60 flex flex-col w-full rounded-xl bg-white dark:bg-gray-900 dark:text-gray-100"),g(t,"class","flex w-full rounded-xl border border-gray-100 dark:border-gray-850"),g(e,"id","commands-container"),g(e,"class","px-2 mb-2 text-left w-full absolute bottom-0 left-0 right-0 z-10")},m(b,v){U(b,e,v),E(e,t),E(t,n),E(n,r);for(let m=0;m<_.length;m+=1)_[m]&&_[m].m(r,null);E(n,i),E(n,s),E(s,a),E(s,c),E(s,u),E(u,f)},p(b,v){if(v&38){h=Ct(b[2]);let m;for(m=0;m<h.length;m+=1){const y=su(b,h,m);_[m]?_[m].p(y,v):(_[m]=lu(y),_[m].c(),_[m].m(r,null))}for(;m<_.length;m+=1)_[m].d(1);_.length=h.length}v&8&&d!==(d=b[3].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"")&&Pe(f,d)},d(b){b&&p(e),Fn(_,b)}}}function lu(o){let e,t,n=o[0].command+"",r,i,s,a=o[0].title+"",l,c,u,d,f;function h(){return o[11](o[0])}function _(){return o[12](o[15])}return{c(){e=M("button"),t=M("div"),r=Ie(n),i=$(),s=M("div"),l=Ie(a),c=$(),this.h()},l(b){e=O(b,"BUTTON",{class:!0,type:!0});var v=A(e);t=O(v,"DIV",{class:!0});var m=A(t);r=Te(m,n),m.forEach(p),i=ee(v),s=O(v,"DIV",{class:!0});var y=A(s);l=Te(y,a),y.forEach(p),c=ee(v),v.forEach(p),this.h()},h(){g(t,"class","font-medium text-black dark:text-gray-100"),g(s,"class","text-xs text-gray-600 dark:text-gray-100"),g(e,"class",u="px-3 py-1.5 rounded-xl w-full text-left "+(o[15]===o[1]?"  bg-gray-50 dark:bg-gray-850 selected-command-option-button":"")),g(e,"type","button")},m(b,v){U(b,e,v),E(e,t),E(t,r),E(e,i),E(e,s),E(s,l),E(e,c),d||(f=[we(e,"click",h),we(e,"mousemove",_),we(e,"focus",kv)],d=!0)},p(b,v){o=b,v&4&&n!==(n=o[0].command+"")&&Pe(r,n),v&4&&a!==(a=o[0].title+"")&&Pe(l,a),v&2&&u!==(u="px-3 py-1.5 rounded-xl w-full text-left "+(o[15]===o[1]?"  bg-gray-50 dark:bg-gray-850 selected-command-option-button":""))&&g(e,"class",u)},d(b){b&&p(e),d=!1,cn(f)}}}function wv(o){let e,t=o[2].length>0&&au(o);return{c(){t&&t.c(),e=qe()},l(n){t&&t.l(n),e=qe()},m(n,r){t&&t.m(n,r),U(n,e,r)},p(n,[r]){n[2].length>0?t?t.p(n,r):(t=au(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Le,o:Le,d(n){n&&p(e),t&&t.d(n)}}}const kv=()=>{};function Cv(o,e,t){let n,r,i;fe(o,er,m=>t(13,n=m)),fe(o,Of,m=>t(10,i=m));const s=fn("i18n");fe(o,s,m=>t(3,r=m));let{files:a}=e,{prompt:l=""}=e,{command:c=""}=e,u=0,d=[];const f=()=>{t(1,u=Math.max(0,u-1))},h=()=>{t(1,u=Math.min(u+1,d.length-1))},_=async m=>{let y=m.content;if(m.content.includes("{{CLIPBOARD}}")){const S=await navigator.clipboard.readText().catch(R=>($e.error(r.t("Failed to read clipboard contents")),"{{CLIPBOARD}}")),k=await navigator.clipboard.read();let C=null;for(const R of k)for(const D of R.types)if(D.startsWith("image/")){const H=await R.getType(D);C=URL.createObjectURL(H)}C&&t(6,a=[...a,{type:"image",url:C}]),y=y.replaceAll("{{CLIPBOARD}}",S)}if(m.content.includes("{{USER_LOCATION}}")){let S;try{S=await Km()}catch{$e.error(r.t("Location access not allowed")),S="LOCATION_UNKNOWN"}y=y.replaceAll("{{USER_LOCATION}}",String(S))}if(m.content.includes("{{USER_NAME}}")){console.log(n);const S=n.name||"User";y=y.replaceAll("{{USER_NAME}}",S)}if(m.content.includes("{{USER_LANGUAGE}}")){const S=localStorage.getItem("locale")||"zh-CN";y=y.replaceAll("{{USER_LANGUAGE}}",S)}if(m.content.includes("{{CURRENT_DATE}}")){const S=Gm();y=y.replaceAll("{{CURRENT_DATE}}",S)}if(m.content.includes("{{CURRENT_TIME}}")){const S=Wm();y=y.replaceAll("{{CURRENT_TIME}}",S)}if(m.content.includes("{{CURRENT_DATETIME}}")){const S=qm();y=y.replaceAll("{{CURRENT_DATETIME}}",S)}if(m.content.includes("{{CURRENT_TIMEZONE}}")){const S=Ym();y=y.replaceAll("{{CURRENT_TIMEZONE}}",S)}if(m.content.includes("{{CURRENT_WEEKDAY}}")){const S=jm();y=y.replaceAll("{{CURRENT_WEEKDAY}}",S)}t(0,l=y);const w=document.getElementById("chat-input-container"),I=document.getElementById("chat-input");await it(),w&&(w.style.height="",w.style.height=Math.min(w.scrollHeight,200)+"px"),await it(),I&&(I.focus(),I.dispatchEvent(new Event("input")))},b=m=>{_(m)},v=m=>{t(1,u=m)};return o.$$set=m=>{"files"in m&&t(6,a=m.files),"prompt"in m&&t(0,l=m.prompt),"command"in m&&t(7,c=m.command)},o.$$.update=()=>{o.$$.dirty&1152&&t(2,d=i.filter(m=>m.command.toLowerCase().includes(c.toLowerCase())).sort((m,y)=>m.title.localeCompare(y.title))),o.$$.dirty&128&&c&&t(1,u=0)},[l,u,d,r,s,_,a,c,f,h,i,b,v]}class Ev extends Ge{constructor(e){super(),We(this,e,Cv,wv,Ye,{files:6,prompt:0,command:7,selectUp:8,selectDown:9})}get selectUp(){return this.$$.ctx[8]}get selectDown(){return this.$$.ctx[9]}}function cu(o,e,t){const n=o.slice();return n[19]=e[t],n[21]=t,n}function uu(o){let e,t,n,r,i,s,a,l=Ct(o[2]),c=[];for(let h=0;h<l.length;h+=1)c[h]=du(cu(o,l,h));function u(h,_){var b,v;if(_&1&&(s=null),_&1&&(a=null),s==null&&(s=!!h[0].split(" ").some(Pv)),s)return Mv;if(a==null&&(a=!!((v=(b=h[0].split(" "))==null?void 0:b.at(0))!=null&&v.substring(1).startsWith("http"))),a)return Rv}let d=u(o,-1),f=d&&d(o);return{c(){e=M("div"),t=M("div"),n=M("div"),r=M("div");for(let h=0;h<c.length;h+=1)c[h].c();i=$(),f&&f.c(),this.h()},l(h){e=O(h,"DIV",{id:!0,class:!0});var _=A(e);t=O(_,"DIV",{class:!0});var b=A(t);n=O(b,"DIV",{class:!0});var v=A(n);r=O(v,"DIV",{class:!0});var m=A(r);for(let y=0;y<c.length;y+=1)c[y].l(m);i=ee(m),f&&f.l(m),m.forEach(p),v.forEach(p),b.forEach(p),_.forEach(p),this.h()},h(){g(r,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5 scrollbar-hidden"),g(n,"class","max-h-60 flex flex-col w-full rounded-xl bg-white dark:bg-gray-900 dark:text-gray-100"),g(t,"class","flex w-full rounded-xl border border-gray-100 dark:border-gray-850"),g(e,"id","commands-container"),g(e,"class","px-2 mb-2 text-left w-full absolute bottom-0 left-0 right-0 z-10")},m(h,_){U(h,e,_),E(e,t),E(t,n),E(n,r);for(let b=0;b<c.length;b+=1)c[b]&&c[b].m(r,null);E(r,i),f&&f.m(r,null)},p(h,_){if(_&38){l=Ct(h[2]);let b;for(b=0;b<l.length;b+=1){const v=cu(h,l,b);c[b]?c[b].p(v,_):(c[b]=du(v),c[b].c(),c[b].m(r,i))}for(;b<c.length;b+=1)c[b].d(1);c.length=l.length}d===(d=u(h,_))&&f?f.p(h,_):(f&&f.d(1),f=d&&d(h),f&&(f.c(),f.m(r,null)))},d(h){h&&p(e),Fn(c,h),f&&f.d()}}}function Iv(o){let e,t="Collection";return{c(){e=M("div"),e.textContent=t,this.h()},l(n){e=O(n,"DIV",{class:!0,"data-svelte-h":!0}),yt(e)!=="svelte-1j93cxc"&&(e.textContent=t),this.h()},h(){g(e,"class","bg-green-500/20 text-green-700 dark:text-green-200 rounded-sm uppercase text-xs font-bold px-1 shrink-0")},m(n,r){U(n,e,r)},d(n){n&&p(e)}}}function Tv(o){let e,t="File";return{c(){e=M("div"),e.textContent=t,this.h()},l(n){e=O(n,"DIV",{class:!0,"data-svelte-h":!0}),yt(e)!=="svelte-dn3g9i"&&(e.textContent=t),this.h()},h(){g(e,"class","bg-gray-500/20 text-gray-700 dark:text-gray-200 rounded-sm uppercase text-xs font-bold px-1 shrink-0")},m(n,r){U(n,e,r)},d(n){n&&p(e)}}}function Sv(o){let e,t="Document";return{c(){e=M("div"),e.textContent=t,this.h()},l(n){e=O(n,"DIV",{class:!0,"data-svelte-h":!0}),yt(e)!=="svelte-2kpkct"&&(e.textContent=t),this.h()},h(){g(e,"class","bg-gray-500/20 text-gray-700 dark:text-gray-200 rounded-sm uppercase text-xs font-bold px-1 shrink-0")},m(n,r){U(n,e,r)},d(n){n&&p(e)}}}function Av(o){let e,t="Legacy";return{c(){e=M("div"),e.textContent=t,this.h()},l(n){e=O(n,"DIV",{class:!0,"data-svelte-h":!0}),yt(e)!=="svelte-8uyvzr"&&(e.textContent=t),this.h()},h(){g(e,"class","bg-gray-500/20 text-gray-700 dark:text-gray-200 rounded-sm uppercase text-xs font-bold px-1 shrink-0")},m(n,r){U(n,e,r)},d(n){n&&p(e)}}}function du(o){var I,S;let e,t,n,r,i,s=((I=o[19])==null?void 0:I.name)+"",a,l,c,u=((S=o[19])==null?void 0:S.description)+"",d,f,h,_;function b(k,C){var R,D,H;return k[19].legacy?Av:(D=(R=k[19])==null?void 0:R.meta)!=null&&D.document?Sv:((H=k[19])==null?void 0:H.type)==="file"?Tv:Iv}let v=b(o),m=v(o);function y(){return o[13](o[19])}function w(){return o[14](o[21])}return{c(){e=M("button"),t=M("div"),n=M("div"),m.c(),r=$(),i=M("div"),a=Ie(s),l=$(),c=M("div"),d=Ie(u),this.h()},l(k){e=O(k,"BUTTON",{class:!0,type:!0});var C=A(e);t=O(C,"DIV",{});var R=A(t);n=O(R,"DIV",{class:!0});var D=A(n);m.l(D),r=ee(D),i=O(D,"DIV",{class:!0});var H=A(i);a=Te(H,s),H.forEach(p),D.forEach(p),l=ee(R),c=O(R,"DIV",{class:!0});var z=A(c);d=Te(z,u),z.forEach(p),R.forEach(p),C.forEach(p),this.h()},h(){g(i,"class","line-clamp-1"),g(n,"class","font-medium text-black dark:text-gray-100 flex items-center gap-1"),g(c,"class","text-xs text-gray-600 dark:text-gray-100 line-clamp-1"),g(e,"class",f="px-3 py-1.5 rounded-xl w-full text-left flex justify-between items-center "+(o[21]===o[1]?" bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button":"")),g(e,"type","button")},m(k,C){U(k,e,C),E(e,t),E(t,n),m.m(n,null),E(n,r),E(n,i),E(i,a),E(t,l),E(t,c),E(c,d),h||(_=[we(e,"click",y),we(e,"mousemove",w)],h=!0)},p(k,C){var R,D;o=k,v!==(v=b(o))&&(m.d(1),m=v(o),m&&(m.c(),m.m(n,r))),C&4&&s!==(s=((R=o[19])==null?void 0:R.name)+"")&&Pe(a,s),C&4&&u!==(u=((D=o[19])==null?void 0:D.description)+"")&&Pe(d,u),C&2&&f!==(f="px-3 py-1.5 rounded-xl w-full text-left flex justify-between items-center "+(o[21]===o[1]?" bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button":""))&&g(e,"class",f)},d(k){k&&p(e),m.d(),h=!1,cn(_)}}}function Rv(o){var d,f;let e,t,n=((f=(d=o[0].split(" "))==null?void 0:d.at(0))==null?void 0:f.substring(1))+"",r,i,s,a=o[3].t("Web")+"",l,c,u;return{c(){e=M("button"),t=M("div"),r=Ie(n),i=$(),s=M("div"),l=Ie(a),this.h()},l(h){e=O(h,"BUTTON",{class:!0,type:!0});var _=A(e);t=O(_,"DIV",{class:!0});var b=A(t);r=Te(b,n),b.forEach(p),i=ee(_),s=O(_,"DIV",{class:!0});var v=A(s);l=Te(v,a),v.forEach(p),_.forEach(p),this.h()},h(){g(t,"class","font-medium text-black dark:text-gray-100 line-clamp-1"),g(s,"class","text-xs text-gray-600 line-clamp-1"),g(e,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button"),g(e,"type","button")},m(h,_){U(h,e,_),E(e,t),E(t,r),E(e,i),E(e,s),E(s,l),c||(u=we(e,"click",o[16]),c=!0)},p(h,_){var b,v;_&1&&n!==(n=((v=(b=h[0].split(" "))==null?void 0:b.at(0))==null?void 0:v.substring(1))+"")&&Pe(r,n),_&8&&a!==(a=h[3].t("Web")+"")&&Pe(l,a)},d(h){h&&p(e),c=!1,u()}}}function Mv(o){var d,f;let e,t,n=((f=(d=o[0].split(" "))==null?void 0:d.at(0))==null?void 0:f.substring(1))+"",r,i,s,a=o[3].t("Youtube")+"",l,c,u;return{c(){e=M("button"),t=M("div"),r=Ie(n),i=$(),s=M("div"),l=Ie(a),this.h()},l(h){e=O(h,"BUTTON",{class:!0,type:!0});var _=A(e);t=O(_,"DIV",{class:!0});var b=A(t);r=Te(b,n),b.forEach(p),i=ee(_),s=O(_,"DIV",{class:!0});var v=A(s);l=Te(v,a),v.forEach(p),_.forEach(p),this.h()},h(){g(t,"class","font-medium text-black dark:text-gray-100 line-clamp-1"),g(s,"class","text-xs text-gray-600 line-clamp-1"),g(e,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button"),g(e,"type","button")},m(h,_){U(h,e,_),E(e,t),E(t,r),E(e,i),E(e,s),E(s,l),c||(u=we(e,"click",o[15]),c=!0)},p(h,_){var b,v;_&1&&n!==(n=((v=(b=h[0].split(" "))==null?void 0:b.at(0))==null?void 0:v.substring(1))+"")&&Pe(r,n),_&8&&a!==(a=h[3].t("Youtube")+"")&&Pe(l,a)},d(h){h&&p(e),c=!1,u()}}}function Ov(o){var r,i;let e=o[2].length>0||((i=(r=o[0].split(" "))==null?void 0:r.at(0))==null?void 0:i.substring(1).startsWith("http")),t,n=e&&uu(o);return{c(){n&&n.c(),t=qe()},l(s){n&&n.l(s),t=qe()},m(s,a){n&&n.m(s,a),U(s,t,a)},p(s,[a]){var l,c;a&5&&(e=s[2].length>0||((c=(l=s[0].split(" "))==null?void 0:l.at(0))==null?void 0:c.substring(1).startsWith("http"))),e?n?n.p(s,a):(n=uu(s),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:Le,o:Le,d(s){s&&p(t),n&&n.d(s)}}}const Pv=o=>o.substring(1).startsWith("https://www.youtube.com")||o.substring(1).startsWith("https://youtu.be");function Nv(o,e,t){let n,r;fe(o,Pf,k=>t(17,n=k)),Fp.extend(Kp);const i=fn("i18n");fe(o,i,k=>t(3,r=k));let{prompt:s=""}=e,{command:a=""}=e;const l=An();let c=0,u=[],d=null,f=[];const h=()=>{t(1,c=Math.max(0,c-1))},_=()=>{t(1,c=Math.min(c+1,f.length-1))},b=async k=>{l("select",k),t(0,s=is(s,a));const C=document.getElementById("chat-input");await it(),C==null||C.focus(),await it()},v=async k=>{l("url",k),t(0,s=is(s,a));const C=document.getElementById("chat-input");await it(),C==null||C.focus(),await it()},m=async k=>{l("youtube",k),t(0,s=is(s,a));const C=document.getElementById("chat-input");await it(),C==null||C.focus(),await it()};Kn(()=>{let k=n.filter(H=>{var z;return(z=H==null?void 0:H.meta)==null?void 0:z.document}).map(H=>({...H,type:"file"})),C=k.length>0?[{name:"All Documents",legacy:!0,type:"collection",description:"Deprecated (legacy collection), please create a new knowledge base.",title:r.t("All Documents"),collection_names:k.map(H=>H.id)},...k.reduce((H,z)=>{var W;return[...new Set([...H,...(((W=z==null?void 0:z.meta)==null?void 0:W.tags)??[]).map(K=>K.name)])]},[]).map(H=>({name:H,legacy:!0,type:"collection",description:"Deprecated (legacy collection), please create a new knowledge base.",collection_names:k.filter(z=>{var W;return(((W=z==null?void 0:z.meta)==null?void 0:W.tags)??[]).map(K=>K.name).includes(H)}).map(z=>z.id)}))]:[],R=n.filter(H=>{var z;return!((z=H==null?void 0:H.meta)!=null&&z.document)}).map(H=>({...H,type:"collection"})),D=n.length>0?[...n.reduce((H,z)=>[...new Set([...H,...((z==null?void 0:z.files)??[]).map(W=>({...W,collection:{name:z.name,description:z.description}}))])],[]).map(H=>{var z,W,K;return{...H,name:(z=H==null?void 0:H.meta)==null?void 0:z.name,description:`${(W=H==null?void 0:H.collection)==null?void 0:W.name} - ${(K=H==null?void 0:H.collection)==null?void 0:K.description}`,type:"file"}})]:[];t(11,u=[...R,...D,...C,...k].map(H=>{var z,W;return{...H,...H!=null&&H.legacy||(z=H==null?void 0:H.meta)!=null&&z.legacy||(W=H==null?void 0:H.meta)!=null&&W.document?{legacy:!0}:{}}})),t(12,d=new tl(u,{keys:["name","description"]}))});const y=k=>{console.log(k),b(k)},w=k=>{t(1,c=k)},I=()=>{var C,R;const k=(R=(C=s.split(" "))==null?void 0:C.at(0))==null?void 0:R.substring(1);ic(k)?m(k):$e.error(r.t("Oops! Looks like the URL is invalid. Please double-check and try again."))},S=()=>{var C,R;const k=(R=(C=s.split(" "))==null?void 0:C.at(0))==null?void 0:R.substring(1);ic(k)?v(k):$e.error(r.t("Oops! Looks like the URL is invalid. Please double-check and try again."))};return o.$$set=k=>{"prompt"in k&&t(0,s=k.prompt),"command"in k&&t(8,a=k.command)},o.$$.update=()=>{o.$$.dirty&6400&&d&&t(2,f=a.slice(1)?d.search(a).map(k=>k.item):u),o.$$.dirty&256&&a&&t(1,c=0)},[s,c,f,r,i,b,v,m,a,h,_,u,d,y,w,I,S]}class Dv extends Ge{constructor(e){super(),We(this,e,Nv,Ov,Ye,{prompt:0,command:8,selectUp:9,selectDown:10})}get selectUp(){return this.$$.ctx[9]}get selectDown(){return this.$$.ctx[10]}}function fu(o,e,t){const n=o.slice();return n[12]=e[t],n[14]=t,n}function hu(o){let e,t,n,r,i=Ct(o[1]),s=[];for(let a=0;a<i.length;a+=1)s[a]=gu(fu(o,i,a));return{c(){e=M("div"),t=M("div"),n=M("div"),r=M("div");for(let a=0;a<s.length;a+=1)s[a].c();this.h()},l(a){e=O(a,"DIV",{id:!0,class:!0});var l=A(e);t=O(l,"DIV",{class:!0});var c=A(t);n=O(c,"DIV",{class:!0});var u=A(n);r=O(u,"DIV",{class:!0});var d=A(r);for(let f=0;f<s.length;f+=1)s[f].l(d);d.forEach(p),u.forEach(p),c.forEach(p),l.forEach(p),this.h()},h(){g(r,"class","m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden"),g(n,"class","max-h-60 flex flex-col w-full rounded-xl bg-white dark:bg-gray-900 dark:text-gray-100"),g(t,"class","flex w-full rounded-xl border border-gray-100 dark:border-gray-850"),g(e,"id","commands-container"),g(e,"class","px-2 mb-2 text-left w-full absolute bottom-0 left-0 right-0 z-10")},m(a,l){U(a,e,l),E(e,t),E(t,n),E(n,r);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(r,null)},p(a,l){if(l&7){i=Ct(a[1]);let c;for(c=0;c<i.length;c+=1){const u=fu(a,i,c);s[c]?s[c].p(u,l):(s[c]=gu(u),s[c].c(),s[c].m(r,null))}for(;c<s.length;c+=1)s[c].d(1);s.length=i.length}},d(a){a&&p(e),Fn(s,a)}}}function gu(o){let e,t,n,r,i,s,a=o[12].name+"",l,c,u,d,f;function h(){return o[7](o[12])}function _(){return o[8](o[14])}return{c(){e=M("button"),t=M("div"),n=M("img"),s=$(),l=Ie(a),c=$(),this.h()},l(b){e=O(b,"BUTTON",{class:!0,type:!0});var v=A(e);t=O(v,"DIV",{class:!0});var m=A(t);n=O(m,"IMG",{src:!0,alt:!0,class:!0}),s=ee(m),l=Te(m,a),m.forEach(p),c=ee(v),v.forEach(p),this.h()},h(){var b,v,m,y;xo(n.src,r=((m=(v=(b=o[12])==null?void 0:b.info)==null?void 0:v.meta)==null?void 0:m.profile_image_url)??"/static/favicon.png")||g(n,"src",r),g(n,"alt",i=((y=o[12])==null?void 0:y.name)??o[12].id),g(n,"class","rounded-full size-6 items-center mr-2"),g(t,"class","flex font-medium text-black dark:text-gray-100 line-clamp-1"),g(e,"class",u="px-3 py-1.5 rounded-xl w-full text-left "+(o[14]===o[0]?"bg-gray-50 dark:bg-gray-850 selected-command-option-button":"")),g(e,"type","button")},m(b,v){U(b,e,v),E(e,t),E(t,n),E(t,s),E(t,l),E(e,c),d||(f=[we(e,"click",h),we(e,"mousemove",_),we(e,"focus",Lv)],d=!0)},p(b,v){var m,y,w,I;o=b,v&2&&!xo(n.src,r=((w=(y=(m=o[12])==null?void 0:m.info)==null?void 0:y.meta)==null?void 0:w.profile_image_url)??"/static/favicon.png")&&g(n,"src",r),v&2&&i!==(i=((I=o[12])==null?void 0:I.name)??o[12].id)&&g(n,"alt",i),v&2&&a!==(a=o[12].name+"")&&Pe(l,a),v&1&&u!==(u="px-3 py-1.5 rounded-xl w-full text-left "+(o[14]===o[0]?"bg-gray-50 dark:bg-gray-850 selected-command-option-button":""))&&g(e,"class",u)},d(b){b&&p(e),d=!1,cn(f)}}}function Hv(o){let e,t=o[1].length>0&&hu(o);return{c(){t&&t.c(),e=qe()},l(n){t&&t.l(n),e=qe()},m(n,r){t&&t.m(n,r),U(n,e,r)},p(n,[r]){n[1].length>0?t?t.p(n,r):(t=hu(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Le,o:Le,d(n){n&&p(e),t&&t.d(n)}}}const Lv=()=>{};function Uv(o,e,t){let n;fe(o,Tr,_=>t(6,n=_)),fn("i18n");const r=An();let{command:i=""}=e,s=0,a=[],l=new tl(n.filter(_=>{var b,v;return!((v=(b=_==null?void 0:_.info)==null?void 0:b.meta)!=null&&v.hidden)}).map(_=>{var v,m,y,w,I;return{..._,modelName:_==null?void 0:_.name,tags:(y=(m=(v=_==null?void 0:_.info)==null?void 0:v.meta)==null?void 0:m.tags)==null?void 0:y.map(S=>S.name).join(" "),desc:(I=(w=_==null?void 0:_.info)==null?void 0:w.meta)==null?void 0:I.description}}),{keys:["value","tags","modelName"],threshold:.3});const c=()=>{t(0,s=Math.max(0,s-1))},u=()=>{t(0,s=Math.min(s+1,a.length-1))},d=async _=>{t(3,i=""),r("select",_)};Kn(async()=>{await it();const _=document.getElementById("chat-input");await it(),_==null||_.focus(),await it()});const f=_=>{d(_)},h=_=>{t(0,s=_)};return o.$$set=_=>{"command"in _&&t(3,i=_.command)},o.$$.update=()=>{o.$$.dirty&72&&t(1,a=i.slice(1)?l.search(i).map(_=>_.item):n.filter(_=>{var b,v;return!((v=(b=_==null?void 0:_.info)==null?void 0:b.meta)!=null&&v.hidden)})),o.$$.dirty&8&&i&&t(0,s=0)},[s,a,d,i,c,u,n,f,h]}class Bv extends Ge{constructor(e){super(),We(this,e,Uv,Hv,Ye,{command:3,selectUp:4,selectDown:5})}get selectUp(){return this.$$.ctx[4]}get selectDown(){return this.$$.ctx[5]}}function mu(o){let e,t,n,r;const i=[Vv,zv],s=[];function a(l,c){return l[4]?1:0}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=qe()},l(l){t.l(l),n=qe()},m(l,c){s[e].m(l,c),U(l,n,c),r=!0},p(l,c){let u=e;e=a(l),e===u?s[e].p(l,c):(De(),N(s[u],1,1,()=>{s[u]=null}),He(),t=s[e],t?t.p(l,c):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){N(t),r=!1},d(l){l&&p(n),s[e].d(l)}}}function zv(o){let e,t,n,r,i;return r=new Hs({}),{c(){e=M("div"),t=M("div"),n=M("div"),oe(r.$$.fragment),this.h()},l(s){e=O(s,"DIV",{id:!0,class:!0});var a=A(e);t=O(a,"DIV",{class:!0});var l=A(t);n=O(l,"DIV",{class:!0});var c=A(n);ae(r.$$.fragment,c),c.forEach(p),l.forEach(p),a.forEach(p),this.h()},h(){g(n,"class","max-h-60 flex flex-col w-full rounded-xl bg-white dark:bg-gray-900 dark:text-gray-100"),g(t,"class","flex w-full rounded-xl border border-gray-100 dark:border-gray-850"),g(e,"id","commands-container"),g(e,"class","px-2 mb-2 text-left w-full absolute bottom-0 left-0 right-0 z-10")},m(s,a){U(s,e,a),E(e,t),E(t,n),re(r,n,null),i=!0},p:Le,i(s){i||(T(r.$$.fragment,s),i=!0)},o(s){N(r.$$.fragment,s),i=!1},d(s){s&&p(e),ie(r)}}}function Vv(o){let e,t,n,r,i,s,a;const l=[Gv,Kv,Fv],c=[];function u(d,f){var h,_,b;return f&4&&(e=null),f&4&&(t=null),f&4&&(n=null),e==null&&(e=((h=d[2])==null?void 0:h.charAt(0))==="/"),e?0:(t==null&&(t=!!(((_=d[2])==null?void 0:_.charAt(0))==="#"&&d[2].startsWith("#")&&!d[2].includes("# ")||d[2].slice(0,2)==="\\#"&&d[2].startsWith("#")&&!d[2].includes("# "))),t?1:(n==null&&(n=((b=d[2])==null?void 0:b.charAt(0))==="@"),n?2:-1))}return~(r=u(o,-1))&&(i=c[r]=l[r](o)),{c(){i&&i.c(),s=qe()},l(d){i&&i.l(d),s=qe()},m(d,f){~r&&c[r].m(d,f),U(d,s,f),a=!0},p(d,f){let h=r;r=u(d,f),r===h?~r&&c[r].p(d,f):(i&&(De(),N(c[h],1,1,()=>{c[h]=null}),He()),~r?(i=c[r],i?i.p(d,f):(i=c[r]=l[r](d),i.c()),T(i,1),i.m(s.parentNode,s)):i=null)},i(d){a||(T(i),a=!0)},o(d){N(i),a=!1},d(d){d&&p(s),~r&&c[r].d(d)}}}function Fv(o){let e,t,n={command:o[2]};return e=new Bv({props:n}),o[17](e),e.$on("select",o[18]),{c(){oe(e.$$.fragment)},l(r){ae(e.$$.fragment,r)},m(r,i){re(e,r,i),t=!0},p(r,i){const s={};i&4&&(s.command=r[2]),e.$set(s)},i(r){t||(T(e.$$.fragment,r),t=!0)},o(r){N(e.$$.fragment,r),t=!1},d(r){o[17](null),ie(e,r)}}}function Kv(o){let e,t,n;function r(s){o[13](s)}let i={command:o[2].includes("\\#")?o[2].slice(2):o[2]};return o[0]!==void 0&&(i.prompt=o[0]),e=new Dv({props:i}),o[12](e),ze.push(()=>nt(e,"prompt",r)),e.$on("youtube",o[14]),e.$on("url",o[15]),e.$on("select",o[16]),{c(){oe(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){re(e,s,a),n=!0},p(s,a){const l={};a&4&&(l.command=s[2].includes("\\#")?s[2].slice(2):s[2]),!t&&a&1&&(t=!0,l.prompt=s[0],tt(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){N(e.$$.fragment,s),n=!1},d(s){o[12](null),ie(e,s)}}}function Gv(o){let e,t,n,r;function i(l){o[10](l)}function s(l){o[11](l)}let a={command:o[2]};return o[0]!==void 0&&(a.prompt=o[0]),o[1]!==void 0&&(a.files=o[1]),e=new Ev({props:a}),o[9](e),ze.push(()=>nt(e,"prompt",i)),ze.push(()=>nt(e,"files",s)),{c(){oe(e.$$.fragment)},l(l){ae(e.$$.fragment,l)},m(l,c){re(e,l,c),r=!0},p(l,c){const u={};c&4&&(u.command=l[2]),!t&&c&1&&(t=!0,u.prompt=l[0],tt(()=>t=!1)),!n&&c&2&&(n=!0,u.files=l[1],tt(()=>n=!1)),e.$set(u)},i(l){r||(T(e.$$.fragment,l),r=!0)},o(l){N(e.$$.fragment,l),r=!1},d(l){o[9](null),ie(e,l)}}}function Wv(o){let e,t,n=o[3]&&mu(o);return{c(){n&&n.c(),e=qe()},l(r){n&&n.l(r),e=qe()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,[i]){r[3]?n?(n.p(r,i),i&8&&T(n,1)):(n=mu(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(De(),N(n,1,1,()=>{n=null}),He())},i(r){t||(T(n),t=!0)},o(r){N(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function qv(o,e,t){const n=An();let{prompt:r=""}=e,{files:i=[]}=e,s=!1,a=null;const l=()=>{a==null||a.selectUp()},c=()=>{a==null||a.selectDown()};let u="",d=!1;const f=async()=>{t(4,s=!0),await Promise.all([(async()=>{Of.set(await zp(localStorage.token))})(),(async()=>{Pf.set(await Vp(localStorage.token))})()]),t(4,s=!1)};function h(C){ze[C?"unshift":"push"](()=>{a=C,t(5,a)})}function _(C){r=C,t(0,r)}function b(C){i=C,t(1,i)}function v(C){ze[C?"unshift":"push"](()=>{a=C,t(5,a)})}function m(C){r=C,t(0,r)}const y=C=>{console.log(C),n("upload",{type:"youtube",data:C.detail})},w=C=>{console.log(C),n("upload",{type:"web",data:C.detail})},I=C=>{console.log(C),!i.find(R=>R.id===C.detail.id)&&(t(1,i=[...i,{...C.detail,status:"processed"}]),n("select"))};function S(C){ze[C?"unshift":"push"](()=>{a=C,t(5,a)})}const k=C=>{t(0,r=is(r,u)),n("select",{type:"model",data:C.detail})};return o.$$set=C=>{"prompt"in C&&t(0,r=C.prompt),"files"in C&&t(1,i=C.files)},o.$$.update=()=>{var C,R;o.$$.dirty&1&&t(2,u=((R=(C=r==null?void 0:r.split(`
`).pop())==null?void 0:C.split(" "))==null?void 0:R.pop())??""),o.$$.dirty&4&&t(3,d=["/","#","@"].includes(u==null?void 0:u.charAt(0))||u.slice(0,2)==="\\#"),o.$$.dirty&8&&d&&f()},[r,i,u,d,s,a,n,l,c,h,_,b,v,m,y,w,I,S,k]}class Yv extends Ge{constructor(e){super(),We(this,e,qv,Wv,Ye,{prompt:0,files:1,selectUp:7,selectDown:8})}get selectUp(){return this.$$.ctx[7]}get selectDown(){return this.$$.ctx[8]}}function jv(o){let e,t;return{c(){e=Me("svg"),t=Me("path"),this.h()},l(n){e=Oe(n,"svg",{"aria-hidden":!0,xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=A(e);t=Oe(r,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),A(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"fill-rule","evenodd"),g(t,"d","M12 5a7 7 0 0 0-7 7v1.17c.313-.11.65-.17 1-.17h2a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a3 3 0 0 1-3-3v-6a9 9 0 0 1 18 0v6a3 3 0 0 1-3 3h-2a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2c.35 0 .687.06 1 .17V12a7 7 0 0 0-7-7Z"),g(t,"clip-rule","evenodd"),g(e,"aria-hidden","true"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","currentColor"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){U(n,e,r),E(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Le,o:Le,d(n){n&&p(e)}}}function Qv(o,e,t){let{className:n="w-4 h-4"}=e,{strokeWidth:r="0"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class Xv extends Ge{constructor(e){super(),We(this,e,Qv,jv,Ye,{className:0,strokeWidth:1})}}function Jv(o){let e,t;return{c(){e=Me("svg"),t=Me("path"),this.h()},l(n){e=Oe(n,"svg",{class:!0,"stroke-width":!0,"aria-hidden":!0,xmlns:!0,fill:!0,viewBox:!0});var r=A(e);t=Oe(r,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),A(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"stroke","currentColor"),g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"stroke-width","2"),g(t,"d","m3 16 5-7 6 6.5m6.5 2.5L16 13l-4.286 6M14 10h.01M4 19h16a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1Z"),g(e,"class",o[0]),g(e,"stroke-width",o[1]),g(e,"aria-hidden","true"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24")},m(n,r){U(n,e,r),E(e,t)},p(n,[r]){r&1&&g(e,"class",n[0]),r&2&&g(e,"stroke-width",n[1])},i:Le,o:Le,d(n){n&&p(e)}}}function Zv(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="1.5"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class xv extends Ge{constructor(e){super(),We(this,e,Zv,Jv,Ye,{className:0,strokeWidth:1})}}function pu(o,e,t){const n=o.slice();return n[91]=e[t],n[93]=t,n}function _u(o,e,t){const n=o.slice();return n[94]=e[t],n[96]=t,n}function bu(o){var q,Z;let e,t,n,r,i,s,a,l,c,u,d,f,h,_,b,v,m,y,w,I,S,k,C,R,D=o[6]===!1&&((q=o[12])==null?void 0:q.currentId)&&yu(o),H=(o[0]!==void 0||o[3].length>0||o[5]||(((Z=o[25])==null?void 0:Z.webSearch)??!1)==="always"||o[4]||o[7])&&vu(o);function z(Q){o[44](Q)}function W(Q){o[45](Q)}let K={};o[1]!==void 0&&(K.prompt=o[1]),o[2]!==void 0&&(K.files=o[2]),l=new Yv({props:K}),o[43](l),ze.push(()=>nt(l,"prompt",z)),ze.push(()=>nt(l,"files",W)),l.$on("upload",o[46]),l.$on("select",o[47]);const P=[tw,ew],V=[];function L(Q,Y){return Q[17]?0:1}return y=L(o),w=V[y]=P[y](o),{c(){e=M("div"),t=M("div"),n=M("div"),r=M("div"),D&&D.c(),i=$(),s=M("div"),H&&H.c(),a=$(),oe(l.$$.fragment),f=$(),h=M("div"),_=M("div"),b=M("div"),v=M("input"),m=$(),w.c(),this.h()},l(Q){e=O(Q,"DIV",{class:!0});var Y=A(e);t=O(Y,"DIV",{class:!0});var te=A(t);n=O(te,"DIV",{class:!0});var F=A(n);r=O(F,"DIV",{class:!0});var j=A(r);D&&D.l(j),j.forEach(p),i=ee(F),s=O(F,"DIV",{class:!0});var x=A(s);H&&H.l(x),a=ee(x),ae(l.$$.fragment,x),x.forEach(p),F.forEach(p),te.forEach(p),f=ee(Y),h=O(Y,"DIV",{class:!0});var J=A(h);_=O(J,"DIV",{class:!0});var ve=A(_);b=O(ve,"DIV",{class:!0});var le=A(b);v=O(le,"INPUT",{type:!0}),m=ee(le),w.l(le),le.forEach(p),ve.forEach(p),J.forEach(p),Y.forEach(p),this.h()},h(){var Q,Y;g(r,"class","relative"),g(s,"class","w-full relative"),g(n,"class",d="flex flex-col px-3 "+(((Q=o[25])==null?void 0:Q.widescreenMode)??null?"max-w-full":"max-w-6xl")+" w-full"),g(t,"class","mx-auto inset-x-0 bg-transparent flex justify-center"),g(v,"type","file"),v.hidden=!0,g(b,"class",""),g(_,"class",I=(((Y=o[25])==null?void 0:Y.widescreenMode)??null?"max-w-full":"max-w-6xl")+" px-2.5 mx-auto inset-x-0"),g(h,"class",S=o[8]?"bg-transparent":"bg-white dark:bg-gray-900"),g(e,"class","w-full font-primary")},m(Q,Y){U(Q,e,Y),E(e,t),E(t,n),E(n,r),D&&D.m(r,null),E(n,i),E(n,s),H&&H.m(s,null),E(s,a),re(l,s,null),E(e,f),E(e,h),E(h,_),E(_,b),E(b,v),o[48](v),E(b,m),V[y].m(b,null),k=!0,C||(R=[we(v,"change",o[49]),we(v,"change",o[50])],C=!0)},p(Q,Y){var j,x,J,ve;Q[6]===!1&&((j=Q[12])!=null&&j.currentId)?D?D.p(Q,Y):(D=yu(Q),D.c(),D.m(r,null)):D&&(D.d(1),D=null),Q[0]!==void 0||Q[3].length>0||Q[5]||(((x=Q[25])==null?void 0:x.webSearch)??!1)==="always"||Q[4]||Q[7]?H?(H.p(Q,Y),Y[0]&33554617&&T(H,1)):(H=vu(Q),H.c(),T(H,1),H.m(s,a)):H&&(De(),N(H,1,1,()=>{H=null}),He());const te={};!c&&Y[0]&2&&(c=!0,te.prompt=Q[1],tt(()=>c=!1)),!u&&Y[0]&4&&(u=!0,te.files=Q[2],tt(()=>u=!1)),l.$set(te),(!k||Y[0]&33554432&&d!==(d="flex flex-col px-3 "+(((J=Q[25])==null?void 0:J.widescreenMode)??null?"max-w-full":"max-w-6xl")+" w-full"))&&g(n,"class",d);let F=y;y=L(Q),y===F?V[y].p(Q,Y):(De(),N(V[F],1,1,()=>{V[F]=null}),He(),w=V[y],w?w.p(Q,Y):(w=V[y]=P[y](Q),w.c()),T(w,1),w.m(b,null)),(!k||Y[0]&33554432&&I!==(I=(((ve=Q[25])==null?void 0:ve.widescreenMode)??null?"max-w-full":"max-w-6xl")+" px-2.5 mx-auto inset-x-0"))&&g(_,"class",I),(!k||Y[0]&256&&S!==(S=Q[8]?"bg-transparent":"bg-white dark:bg-gray-900"))&&g(h,"class",S)},i(Q){k||(T(H),T(l.$$.fragment,Q),T(w),k=!0)},o(Q){N(H),N(l.$$.fragment,Q),N(w),k=!1},d(Q){Q&&p(e),D&&D.d(),H&&H.d(),o[43](null),ie(l),o[48](null),V[y].d(),C=!1,cn(R)}}}function yu(o){let e,t,n='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd"></path></svg>',r,i;return{c(){e=M("div"),t=M("button"),t.innerHTML=n,this.h()},l(s){e=O(s,"DIV",{class:!0});var a=A(e);t=O(a,"BUTTON",{class:!0,"data-svelte-h":!0}),yt(t)!=="svelte-h8r9o0"&&(t.innerHTML=n),a.forEach(p),this.h()},h(){g(t,"class","bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto"),g(e,"class","absolute -top-12 left-0 right-0 flex justify-center z-30 pointer-events-none")},m(s,a){U(s,e,a),E(e,t),r||(i=we(t,"click",o[39]),r=!0)},p:Le,d(s){s&&p(e),r=!1,i()}}}function vu(o){var f,h,_;let e,t,n,r,i,s,a=o[3].length>0&&wu(o),l=(o[5]||(((h=(f=o[27])==null?void 0:f.features)==null?void 0:h.enable_web_search)&&(((_=o[25])==null?void 0:_.webSearch)??!1))==="always")&&Eu(o),c=o[4]&&Iu(o),u=o[7]&&Tu(o),d=o[0]!==void 0&&Su(o);return{c(){e=M("div"),a&&a.c(),t=$(),l&&l.c(),n=$(),c&&c.c(),r=$(),u&&u.c(),i=$(),d&&d.c(),this.h()},l(b){e=O(b,"DIV",{class:!0});var v=A(e);a&&a.l(v),t=ee(v),l&&l.l(v),n=ee(v),c&&c.l(v),r=ee(v),u&&u.l(v),i=ee(v),d&&d.l(v),v.forEach(p),this.h()},h(){g(e,"class","px-3 pb-0.5 pt-1.5 text-left w-full flex flex-col absolute bottom-0 left-0 right-0 bg-linear-to-t from-white dark:from-gray-900 z-10")},m(b,v){U(b,e,v),a&&a.m(e,null),E(e,t),l&&l.m(e,null),E(e,n),c&&c.m(e,null),E(e,r),u&&u.m(e,null),E(e,i),d&&d.m(e,null),s=!0},p(b,v){var m,y,w;b[3].length>0?a?(a.p(b,v),v[0]&8&&T(a,1)):(a=wu(b),a.c(),T(a,1),a.m(e,t)):a&&(De(),N(a,1,1,()=>{a=null}),He()),b[5]||(((y=(m=b[27])==null?void 0:m.features)==null?void 0:y.enable_web_search)&&(((w=b[25])==null?void 0:w.webSearch)??!1))==="always"?l?l.p(b,v):(l=Eu(b),l.c(),l.m(e,n)):l&&(l.d(1),l=null),b[4]?c?c.p(b,v):(c=Iu(b),c.c(),c.m(e,r)):c&&(c.d(1),c=null),b[7]?u?u.p(b,v):(u=Tu(b),u.c(),u.m(e,i)):u&&(u.d(1),u=null),b[0]!==void 0?d?(d.p(b,v),v[0]&1&&T(d,1)):(d=Su(b),d.c(),T(d,1),d.m(e,null)):d&&(De(),N(d,1,1,()=>{d=null}),He())},i(b){s||(T(a),T(d),s=!0)},o(b){N(a),N(d),s=!1},d(b){b&&p(e),a&&a.d(),l&&l.d(),c&&c.d(),u&&u.d(),d&&d.d()}}}function wu(o){let e,t,n,r='<span class="relative flex size-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"></span> <span class="relative inline-flex rounded-full size-2 bg-yellow-500"></span></span>',i,s,a=[],l=new Map,c,u=Ct(o[3].map(o[40]));const d=f=>f[96];for(let f=0;f<u.length;f+=1){let h=_u(o,u,f),_=d(h);l.set(_,a[f]=Cu(_,h))}return{c(){e=M("div"),t=M("div"),n=M("div"),n.innerHTML=r,i=$(),s=M("div");for(let f=0;f<a.length;f+=1)a[f].c();this.h()},l(f){e=O(f,"DIV",{class:!0});var h=A(e);t=O(h,"DIV",{class:!0});var _=A(t);n=O(_,"DIV",{class:!0,"data-svelte-h":!0}),yt(n)!=="svelte-1exsj7u"&&(n.innerHTML=r),i=ee(_),s=O(_,"DIV",{class:!0});var b=A(s);for(let v=0;v<a.length;v+=1)a[v].l(b);b.forEach(p),_.forEach(p),h.forEach(p),this.h()},h(){g(n,"class","pl-1"),g(s,"class","text-ellipsis line-clamp-1 flex"),g(t,"class","flex items-center gap-2.5 text-sm dark:text-gray-500"),g(e,"class","flex items-center justify-between w-full")},m(f,h){U(f,e,h),E(e,t),E(t,n),E(t,i),E(t,s);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(s,null);c=!0},p(f,h){h[0]&536870920&&(u=Ct(f[3].map(f[40])),De(),a=Ps(a,h,d,1,f,u,l,s,Ns,Cu,null,_u),He())},i(f){if(!c){for(let h=0;h<u.length;h+=1)T(a[h]);c=!0}},o(f){for(let h=0;h<a.length;h+=1)N(a[h]);c=!1},d(f){f&&p(e);for(let h=0;h<a.length;h+=1)a[h].d()}}}function $v(o){let e=o[94].name+"",t;return{c(){t=Ie(e)},l(n){t=Te(n,e)},m(n,r){U(n,t,r)},p(n,r){r[0]&536870920&&e!==(e=n[94].name+"")&&Pe(t,e)},d(n){n&&p(t)}}}function ku(o){let e,t=", ";return{c(){e=M("span"),e.textContent=t},l(n){e=O(n,"SPAN",{"data-svelte-h":!0}),yt(e)!=="svelte-1okzske"&&(e.textContent=t)},m(n,r){U(n,e,r)},d(n){n&&p(e)}}}function Cu(o,e){var l,c;let t,n,r,i,s;n=new qt({props:{content:((c=(l=e[94])==null?void 0:l.meta)==null?void 0:c.description)??"",className:" "+(e[96]!==0?"pl-0.5":"")+" shrink-0",placement:"top",$$slots:{default:[$v]},$$scope:{ctx:e}}});let a=e[96]!==e[3].length-1&&ku();return{key:o,first:null,c(){t=qe(),oe(n.$$.fragment),r=$(),a&&a.c(),i=qe(),this.h()},l(u){t=qe(),ae(n.$$.fragment,u),r=ee(u),a&&a.l(u),i=qe(),this.h()},h(){this.first=t},m(u,d){U(u,t,d),re(n,u,d),U(u,r,d),a&&a.m(u,d),U(u,i,d),s=!0},p(u,d){var h,_;e=u;const f={};d[0]&536870920&&(f.content=((_=(h=e[94])==null?void 0:h.meta)==null?void 0:_.description)??""),d[0]&536870920&&(f.className=" "+(e[96]!==0?"pl-0.5":"")+" shrink-0"),d[0]&536870920|d[3]&16&&(f.$$scope={dirty:d,ctx:e}),n.$set(f),e[96]!==e[3].length-1?a||(a=ku(),a.c(),a.m(i.parentNode,i)):a&&(a.d(1),a=null)},i(u){s||(T(n.$$.fragment,u),s=!0)},o(u){N(n.$$.fragment,u),s=!1},d(u){u&&(p(t),p(r),p(i)),ie(n,u),a&&a.d(u)}}}function Eu(o){let e,t,n,r='<span class="relative flex size-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span> <span class="relative inline-flex rounded-full size-2 bg-blue-500"></span></span>',i,s,a=o[26].t("Search the internet")+"",l;return{c(){e=M("div"),t=M("div"),n=M("div"),n.innerHTML=r,i=$(),s=M("div"),l=Ie(a),this.h()},l(c){e=O(c,"DIV",{class:!0});var u=A(e);t=O(u,"DIV",{class:!0});var d=A(t);n=O(d,"DIV",{class:!0,"data-svelte-h":!0}),yt(n)!=="svelte-19sghfm"&&(n.innerHTML=r),i=ee(d),s=O(d,"DIV",{class:!0});var f=A(s);l=Te(f,a),f.forEach(p),d.forEach(p),u.forEach(p),this.h()},h(){g(n,"class","pl-1"),g(s,"class","translate-y-[0.5px]"),g(t,"class","flex items-center gap-2.5 text-sm dark:text-gray-500"),g(e,"class","flex items-center justify-between w-full")},m(c,u){U(c,e,u),E(e,t),E(t,n),E(t,i),E(t,s),E(s,l)},p(c,u){u[0]&67108864&&a!==(a=c[26].t("Search the internet")+"")&&Pe(l,a)},d(c){c&&p(e)}}}function Iu(o){let e,t,n,r='<span class="relative flex size-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-teal-400 opacity-75"></span> <span class="relative inline-flex rounded-full size-2 bg-teal-500"></span></span>',i,s,a=o[26].t("Generate an image")+"",l;return{c(){e=M("div"),t=M("div"),n=M("div"),n.innerHTML=r,i=$(),s=M("div"),l=Ie(a),this.h()},l(c){e=O(c,"DIV",{class:!0});var u=A(e);t=O(u,"DIV",{class:!0});var d=A(t);n=O(d,"DIV",{class:!0,"data-svelte-h":!0}),yt(n)!=="svelte-kf1e3u"&&(n.innerHTML=r),i=ee(d),s=O(d,"DIV",{class:!0});var f=A(s);l=Te(f,a),f.forEach(p),d.forEach(p),u.forEach(p),this.h()},h(){g(n,"class","pl-1"),g(s,"class","translate-y-[0.5px]"),g(t,"class","flex items-center gap-2.5 text-sm dark:text-gray-500"),g(e,"class","flex items-center justify-between w-full")},m(c,u){U(c,e,u),E(e,t),E(t,n),E(t,i),E(t,s),E(s,l)},p(c,u){u[0]&67108864&&a!==(a=c[26].t("Generate an image")+"")&&Pe(l,a)},d(c){c&&p(e)}}}function Tu(o){let e,t,n,r='<span class="relative flex size-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span> <span class="relative inline-flex rounded-full size-2 bg-green-500"></span></span>',i,s,a=o[26].t("Execute code for analysis")+"",l;return{c(){e=M("div"),t=M("div"),n=M("div"),n.innerHTML=r,i=$(),s=M("div"),l=Ie(a),this.h()},l(c){e=O(c,"DIV",{class:!0});var u=A(e);t=O(u,"DIV",{class:!0});var d=A(t);n=O(d,"DIV",{class:!0,"data-svelte-h":!0}),yt(n)!=="svelte-12j611w"&&(n.innerHTML=r),i=ee(d),s=O(d,"DIV",{class:!0});var f=A(s);l=Te(f,a),f.forEach(p),d.forEach(p),u.forEach(p),this.h()},h(){g(n,"class","pl-1"),g(s,"class","translate-y-[0.5px]"),g(t,"class","flex items-center gap-2.5 text-sm dark:text-gray-500"),g(e,"class","flex items-center justify-between w-full")},m(c,u){U(c,e,u),E(e,t),E(t,n),E(t,i),E(t,s),E(s,l)},p(c,u){u[0]&67108864&&a!==(a=c[26].t("Execute code for analysis")+"")&&Pe(l,a)},d(c){c&&p(e)}}}function Su(o){let e,t,n,r,i,s,a,l,c=o[0].name+"",u,d,f,h,_,b,v,m;return _=new Ls({}),{c(){e=M("div"),t=M("div"),n=M("img"),i=$(),s=M("div"),a=Ie("Talking to "),l=M("span"),u=Ie(c),d=$(),f=M("div"),h=M("button"),oe(_.$$.fragment),this.h()},l(y){e=O(y,"DIV",{class:!0});var w=A(e);t=O(w,"DIV",{class:!0});var I=A(t);n=O(I,"IMG",{crossorigin:!0,alt:!0,class:!0,src:!0}),i=ee(I),s=O(I,"DIV",{class:!0});var S=A(s);a=Te(S,"Talking to "),l=O(S,"SPAN",{class:!0});var k=A(l);u=Te(k,c),k.forEach(p),S.forEach(p),I.forEach(p),d=ee(w),f=O(w,"DIV",{});var C=A(f);h=O(C,"BUTTON",{class:!0});var R=A(h);ae(_.$$.fragment,R),R.forEach(p),C.forEach(p),w.forEach(p),this.h()},h(){var y,w,I;g(n,"crossorigin","anonymous"),g(n,"alt","model profile"),g(n,"class","size-3.5 max-w-[28px] object-cover rounded-full"),xo(n.src,r=((I=(w=(y=o[14].find(o[41]))==null?void 0:y.info)==null?void 0:w.meta)==null?void 0:I.profile_image_url)??(o[26].language==="dg-DG"?"/doge.png":`${vi}/static/favicon.png`))||g(n,"src",r),g(l,"class","font-medium"),g(s,"class","translate-y-[0.5px]"),g(t,"class","pl-[1px] flex items-center gap-2 text-sm dark:text-gray-500"),g(h,"class","flex items-center dark:text-gray-500"),g(e,"class","flex items-center justify-between w-full")},m(y,w){U(y,e,w),E(e,t),E(t,n),E(t,i),E(t,s),E(s,a),E(s,l),E(l,u),E(e,d),E(e,f),E(f,h),re(_,h,null),b=!0,v||(m=we(h,"click",o[42]),v=!0)},p(y,w){var I,S,k;(!b||w[0]&67125249&&!xo(n.src,r=((k=(S=(I=y[14].find(y[41]))==null?void 0:I.info)==null?void 0:S.meta)==null?void 0:k.profile_image_url)??(y[26].language==="dg-DG"?"/doge.png":`${vi}/static/favicon.png`)))&&g(n,"src",r),(!b||w[0]&1)&&c!==(c=y[0].name+"")&&Pe(u,c)},i(y){b||(T(_.$$.fragment,y),b=!0)},o(y){N(_.$$.fragment,y),b=!1},d(y){y&&p(e),ie(_),v=!1,m()}}}function ew(o){var Z,Q;let e,t,n,r,i,s,a,l,c,u,d,f,h,_,b,v,m,y,w,I,S,k,C=o[2].length>0&&Au(o);const R=[sw,iw],D=[];function H(Y,te){var F;return((F=Y[25])==null?void 0:F.richTextInput)??!0?0:1}i=H(o),s=D[i]=R[i](o);function z(Y){o[77](Y)}let W={screenCaptureHandler:o[35],inputFilesHandler:o[37],uploadFilesHandler:o[73],uploadGoogleDriveHandler:o[74],uploadOneDriveHandler:o[75],onClose:o[76],$$slots:{default:[aw]},$$scope:{ctx:o}};o[3]!==void 0&&(W.selectedToolIds=o[3]),u=new vv({props:W}),ze.push(()=>nt(u,"selectedToolIds",z));let K=o[28]&&Ou(o),P=(!((Z=o[12])!=null&&Z.currentId)||((Q=o[12].messages[o[12].currentId])==null?void 0:Q.done)==!0)&&Du(o);const V=[fw,dw],L=[];function q(Y,te){var F;return!Y[12].currentId||((F=Y[12].messages[Y[12].currentId])==null?void 0:F.done)==!0?0:-1}return~(m=q(o))&&(y=L[m]=V[m](o)),{c(){e=M("form"),t=M("div"),C&&C.c(),n=$(),r=M("div"),s.c(),a=$(),l=M("div"),c=M("div"),oe(u.$$.fragment),f=$(),h=M("div"),K&&K.c(),_=$(),b=M("div"),P&&P.c(),v=$(),y&&y.c(),this.h()},l(Y){e=O(Y,"FORM",{class:!0});var te=A(e);t=O(te,"DIV",{class:!0,dir:!0});var F=A(t);C&&C.l(F),n=ee(F),r=O(F,"DIV",{class:!0});var j=A(r);s.l(j),j.forEach(p),a=ee(F),l=O(F,"DIV",{class:!0});var x=A(l);c=O(x,"DIV",{class:!0});var J=A(c);ae(u.$$.fragment,J),f=ee(J),h=O(J,"DIV",{class:!0});var ve=A(h);K&&K.l(ve),ve.forEach(p),J.forEach(p),_=ee(x),b=O(x,"DIV",{class:!0});var le=A(b);P&&P.l(le),v=ee(le),y&&y.l(le),le.forEach(p),x.forEach(p),F.forEach(p),te.forEach(p),this.h()},h(){var Y;g(r,"class","px-2.5"),g(h,"class","flex gap-0.5 items-center overflow-x-auto scrollbar-none flex-1"),g(c,"class","ml-1 self-end gap-0.5 flex items-center flex-1 max-w-[80%]"),g(b,"class","self-end flex space-x-1 mr-1 shrink-0"),g(l,"class","flex justify-between mt-1.5 mb-2.5 mx-0.5 max-w-full"),g(t,"class","flex-1 flex flex-col relative w-full rounded-3xl px-1 bg-gray-600/5 dark:bg-gray-400/5 dark:text-gray-100"),g(t,"dir",w=((Y=o[25])==null?void 0:Y.chatDirection)??"LTR"),g(e,"class","w-full flex gap-1.5")},m(Y,te){U(Y,e,te),E(e,t),C&&C.m(t,null),E(t,n),E(t,r),D[i].m(r,null),E(t,a),E(t,l),E(l,c),re(u,c,null),E(c,f),E(c,h),K&&K.m(h,null),E(l,_),E(l,b),P&&P.m(b,null),E(b,v),~m&&L[m].m(b,null),I=!0,S||(k=we(e,"submit",Os(o[84])),S=!0)},p(Y,te){var J,ve,le;Y[2].length>0?C?(C.p(Y,te),te[0]&4&&T(C,1)):(C=Au(Y),C.c(),T(C,1),C.m(t,n)):C&&(De(),N(C,1,1,()=>{C=null}),He());let F=i;i=H(Y),i===F?D[i].p(Y,te):(De(),N(D[F],1,1,()=>{D[F]=null}),He(),s=D[i],s?s.p(Y,te):(s=D[i]=R[i](Y),s.c()),T(s,1),s.m(r,null));const j={};te[0]&1048576&&(j.uploadFilesHandler=Y[73]),te[0]&67108864&&(j.uploadGoogleDriveHandler=Y[74]),te[3]&16&&(j.$$scope={dirty:te,ctx:Y}),!d&&te[0]&8&&(d=!0,j.selectedToolIds=Y[3],tt(()=>d=!1)),u.$set(j),Y[28]?K?(K.p(Y,te),te[0]&268435456&&T(K,1)):(K=Ou(Y),K.c(),T(K,1),K.m(h,null)):K&&(De(),N(K,1,1,()=>{K=null}),He()),!((J=Y[12])!=null&&J.currentId)||((ve=Y[12].messages[Y[12].currentId])==null?void 0:ve.done)==!0?P?(P.p(Y,te),te[0]&4096&&T(P,1)):(P=Du(Y),P.c(),T(P,1),P.m(b,v)):P&&(De(),N(P,1,1,()=>{P=null}),He());let x=m;m=q(Y),m===x?~m&&L[m].p(Y,te):(y&&(De(),N(L[x],1,1,()=>{L[x]=null}),He()),~m?(y=L[m],y?y.p(Y,te):(y=L[m]=V[m](Y),y.c()),T(y,1),y.m(b,null)):y=null),(!I||te[0]&33554432&&w!==(w=((le=Y[25])==null?void 0:le.chatDirection)??"LTR"))&&g(t,"dir",w)},i(Y){I||(T(C),T(s),T(u.$$.fragment,Y),T(K),T(P),T(y),I=!0)},o(Y){N(C),N(s),N(u.$$.fragment,Y),N(K),N(P),N(y),I=!1},d(Y){Y&&p(e),C&&C.d(),D[i].d(),ie(u),K&&K.d(),P&&P.d(),~m&&L[m].d(),S=!1,k()}}}function tw(o){let e,t,n;function r(s){o[51](s)}let i={};return o[17]!==void 0&&(i.recording=o[17]),e=new Up({props:i}),ze.push(()=>nt(e,"recording",r)),e.$on("cancel",o[52]),e.$on("confirm",o[53]),{c(){oe(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){re(e,s,a),n=!0},p(s,a){const l={};!t&&a[0]&131072&&(t=!0,l.recording=s[17],tt(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){N(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function Au(o){let e,t,n=Ct(o[2]),r=[];for(let s=0;s<n.length;s+=1)r[s]=Mu(pu(o,n,s));const i=s=>N(r[s],1,1,()=>{r[s]=null});return{c(){e=M("div");for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=O(s,"DIV",{class:!0});var a=A(e);for(let l=0;l<r.length;l+=1)r[l].l(a);a.forEach(p),this.h()},h(){g(e,"class","mx-2 mt-2.5 -mb-1 flex items-center flex-wrap gap-2")},m(s,a){U(s,e,a);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(e,null);t=!0},p(s,a){if(a[0]&83888133){n=Ct(s[2]);let l;for(l=0;l<n.length;l+=1){const c=pu(s,n,l);r[l]?(r[l].p(c,a),T(r[l],1)):(r[l]=Mu(c),r[l].c(),T(r[l],1),r[l].m(e,null))}for(De(),l=n.length;l<r.length;l+=1)i(l);He()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)T(r[a]);t=!0}},o(s){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)N(r[a]);t=!1},d(s){s&&p(e),Fn(r,s)}}}function nw(o){var i;let e,t;function n(){return o[56](o[91],o[93])}function r(){return o[57](o[91])}return e=new Lf({props:{item:o[91],name:o[91].name,type:o[91].type,size:(i=o[91])==null?void 0:i.size,loading:o[91].status==="uploading",dismissible:!0,edit:!0}}),e.$on("dismiss",n),e.$on("click",r),{c(){oe(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){re(e,s,a),t=!0},p(s,a){var c;o=s;const l={};a[0]&4&&(l.item=o[91]),a[0]&4&&(l.name=o[91].name),a[0]&4&&(l.type=o[91].type),a[0]&4&&(l.size=(c=o[91])==null?void 0:c.size),a[0]&4&&(l.loading=o[91].status==="uploading"),e.$set(l)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){ie(e,s)}}}function ow(o){let e,t,n,r,i,s,a,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-4"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg>',c,u,d,f;n=new Gp({props:{src:o[91].url,alt:"input",imageClassName:" size-14 rounded-xl object-cover"}});let h=(o[0]?o[24].length===0:o[11].length!==o[24].length)&&Ru(o);function _(){return o[55](o[93])}return{c(){e=M("div"),t=M("div"),oe(n.$$.fragment),r=$(),h&&h.c(),i=$(),s=M("div"),a=M("button"),a.innerHTML=l,c=$(),this.h()},l(b){e=O(b,"DIV",{class:!0});var v=A(e);t=O(v,"DIV",{class:!0});var m=A(t);ae(n.$$.fragment,m),r=ee(m),h&&h.l(m),m.forEach(p),i=ee(v),s=O(v,"DIV",{class:!0});var y=A(s);a=O(y,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),yt(a)!=="svelte-4ewxlv"&&(a.innerHTML=l),y.forEach(p),c=ee(v),v.forEach(p),this.h()},h(){g(t,"class","relative flex items-center"),g(a,"class","bg-white text-black border border-white rounded-full group-hover:visible invisible transition"),g(a,"type","button"),g(s,"class","absolute -top-1 -right-1"),g(e,"class","relative group")},m(b,v){U(b,e,v),E(e,t),re(n,t,null),E(t,r),h&&h.m(t,null),E(e,i),E(e,s),E(s,a),E(e,c),u=!0,d||(f=we(a,"click",_),d=!0)},p(b,v){o=b;const m={};v[0]&4&&(m.src=o[91].url),n.$set(m),(o[0]?o[24].length===0:o[11].length!==o[24].length)?h?(h.p(o,v),v[0]&16779265&&T(h,1)):(h=Ru(o),h.c(),T(h,1),h.m(t,null)):h&&(De(),N(h,1,1,()=>{h=null}),He())},i(b){u||(T(n.$$.fragment,b),T(h),u=!0)},o(b){N(n.$$.fragment,b),N(h),u=!1},d(b){b&&p(e),ie(n),h&&h.d(),d=!1,f()}}}function Ru(o){let e,t;return e=new qt({props:{className:" absolute top-1 left-1",content:o[26].t("{{ models }}",{models:[...o[0]?[o[0]]:o[11]].filter(o[54]).join(", ")}),$$slots:{default:[rw]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&83888129&&(i.content=n[26].t("{{ models }}",{models:[...n[0]?[n[0]]:n[11]].filter(n[54]).join(", ")})),r[3]&16&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function rw(o){let e,t;return{c(){e=Me("svg"),t=Me("path"),this.h()},l(n){e=Oe(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var r=A(e);t=Oe(r,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),A(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"fill-rule","evenodd"),g(t,"d","M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"),g(t,"clip-rule","evenodd"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 24 24"),g(e,"fill","currentColor"),g(e,"class","size-4 fill-yellow-300")},m(n,r){U(n,e,r),E(e,t)},p:Le,d(n){n&&p(e)}}}function Mu(o){let e,t,n,r;const i=[ow,nw],s=[];function a(l,c){return l[91].type==="image"?0:1}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=qe()},l(l){t.l(l),n=qe()},m(l,c){s[e].m(l,c),U(l,n,c),r=!0},p(l,c){let u=e;e=a(l),e===u?s[e].p(l,c):(De(),N(s[u],1,1,()=>{s[u]=null}),He(),t=s[e],t?t.p(l,c):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){N(t),r=!1},d(l){l&&p(n),s[e].d(l)}}}function iw(o){let e,t,n,r;return{c(){e=M("textarea"),this.h()},l(i){e=O(i,"TEXTAREA",{id:!0,class:!0,placeholder:!0,rows:!0}),A(e).forEach(p),this.h()},h(){g(e,"id","chat-input"),g(e,"class","scrollbar-hidden bg-transparent dark:text-gray-100 outline-hidden w-full pt-3 px-1 resize-none"),g(e,"placeholder",t=o[13]?o[13]:o[26].t("Send a Message")),g(e,"rows","1")},m(i,s){U(i,e,s),o[65](e),uo(e,o[1]),n||(r=[we(e,"input",o[66]),we(e,"compositionstart",o[67]),we(e,"compositionend",o[68]),we(e,"keydown",o[69]),we(e,"input",o[70]),we(e,"focus",o[71]),we(e,"paste",o[72])],n=!0)},p(i,s){s[0]&67117056&&t!==(t=i[13]?i[13]:i[26].t("Send a Message"))&&g(e,"placeholder",t),s[0]&2&&uo(e,i[1])},i:Le,o:Le,d(i){i&&p(e),o[65](null),n=!1,cn(r)}}}function sw(o){var a,l,c;let e,t,n,r;function i(u){o[62](u)}let s={id:"chat-input",messageInput:!0,shiftEnter:!(((a=o[25])==null?void 0:a.ctrlEnterToSend)??!1)&&(!o[30]||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)),placeholder:o[13]?o[13]:o[26].t("Send a Message"),largeTextAsFile:((l=o[25])==null?void 0:l.largeTextAsFile)??!1,autocomplete:(c=o[27])==null?void 0:c.features.enable_autocomplete_generation,generateAutoCompletion:o[58],oncompositionstart:o[59],oncompositionend:o[60]};return o[1]!==void 0&&(s.value=o[1]),t=new Bp({props:s}),o[61](t),ze.push(()=>nt(t,"value",i)),t.$on("keydown",o[63]),t.$on("paste",o[64]),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(u){e=O(u,"DIV",{class:!0});var d=A(e);ae(t.$$.fragment,d),d.forEach(p),this.h()},h(){g(e,"class","scrollbar-hidden text-left bg-transparent dark:text-gray-100 outline-hidden w-full pt-3 px-1 resize-none h-fit max-h-80 overflow-auto")},m(u,d){U(u,e,d),re(t,e,null),r=!0},p(u,d){var h,_,b;const f={};d[0]&1107296256&&(f.shiftEnter=!(((h=u[25])==null?void 0:h.ctrlEnterToSend)??!1)&&(!u[30]||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))),d[0]&67117056&&(f.placeholder=u[13]?u[13]:u[26].t("Send a Message")),d[0]&33554432&&(f.largeTextAsFile=((_=u[25])==null?void 0:_.largeTextAsFile)??!1),d[0]&134217728&&(f.autocomplete=(b=u[27])==null?void 0:b.features.enable_autocomplete_generation),d[0]&67145728&&(f.generateAutoCompletion=u[58]),d[0]&262144&&(f.oncompositionstart=u[59]),d[0]&262144&&(f.oncompositionend=u[60]),!n&&d[0]&2&&(n=!0,f.value=u[1],tt(()=>n=!1)),t.$set(f)},i(u){r||(T(t.$$.fragment,u),r=!0)},o(u){N(t.$$.fragment,u),r=!1},d(u){u&&p(e),o[61](null),ie(t)}}}function aw(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"></path></svg>';return{c(){e=M("button"),e.innerHTML=t,this.h()},l(n){e=O(n,"BUTTON",{class:!0,type:!0,"aria-label":!0,"data-svelte-h":!0}),yt(e)!=="svelte-ys0us"&&(e.innerHTML=t),this.h()},h(){g(e,"class","bg-transparent hover:bg-gray-100 text-gray-800 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5 outline-hidden focus:outline-hidden"),g(e,"type","button"),g(e,"aria-label","More")},m(n,r){U(n,e,r)},p:Le,d(n){n&&p(e)}}}function Ou(o){var l,c,u,d,f,h,_,b,v,m;let e,t,n,r,i=((c=(l=o[27])==null?void 0:l.features)==null?void 0:c.enable_web_search)&&(o[28].role==="admin"||((f=(d=(u=o[28])==null?void 0:u.permissions)==null?void 0:d.features)==null?void 0:f.web_search))&&Pu(o),s=((_=(h=o[27])==null?void 0:h.features)==null?void 0:_.enable_image_generation)&&(o[28].role==="admin"||((m=(v=(b=o[28])==null?void 0:b.permissions)==null?void 0:v.features)==null?void 0:m.image_generation))&&Nu(o),a=us;return{c(){i&&i.c(),e=$(),s&&s.c(),t=$(),n=qe()},l(y){i&&i.l(y),e=ee(y),s&&s.l(y),t=ee(y),n=qe()},m(y,w){i&&i.m(y,w),U(y,e,w),s&&s.m(y,w),U(y,t,w),U(y,n,w),r=!0},p(y,w){var I,S,k,C,R,D,H,z,W,K;(S=(I=y[27])==null?void 0:I.features)!=null&&S.enable_web_search&&(y[28].role==="admin"||(R=(C=(k=y[28])==null?void 0:k.permissions)==null?void 0:C.features)!=null&&R.web_search)?i?(i.p(y,w),w[0]&402653184&&T(i,1)):(i=Pu(y),i.c(),T(i,1),i.m(e.parentNode,e)):i&&(De(),N(i,1,1,()=>{i=null}),He()),(H=(D=y[27])==null?void 0:D.features)!=null&&H.enable_image_generation&&(y[28].role==="admin"||(K=(W=(z=y[28])==null?void 0:z.permissions)==null?void 0:W.features)!=null&&K.image_generation)?s?(s.p(y,w),w[0]&402653184&&T(s,1)):(s=Nu(y),s.c(),T(s,1),s.m(t.parentNode,t)):s&&(De(),N(s,1,1,()=>{s=null}),He())},i(y){r||(T(i),T(s),T(a),r=!0)},o(y){N(i),N(s),N(a),r=!1},d(y){y&&(p(e),p(t),p(n)),i&&i.d(y),s&&s.d(y)}}}function Pu(o){let e,t;return e=new qt({props:{content:o[26].t("Search the internet"),placement:"top",$$slots:{default:[lw]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&67108864&&(i.content=n[26].t("Search the internet")),r[0]&100663328|r[3]&16&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function lw(o){let e,t,n,r,i=o[26].t("Web Search")+"",s,a,l,c,u;return t=new jp({props:{className:"size-5",strokeWidth:"1.75"}}),{c(){e=M("button"),oe(t.$$.fragment),n=$(),r=M("span"),s=Ie(i),this.h()},l(d){e=O(d,"BUTTON",{type:!0,class:!0});var f=A(e);ae(t.$$.fragment,f),n=ee(f),r=O(f,"SPAN",{class:!0});var h=A(r);s=Te(h,i),h.forEach(p),f.forEach(p),this.h()},h(){var d;g(r,"class","hidden @sm:block whitespace-nowrap overflow-hidden text-ellipsis translate-y-[0.5px] mr-0.5"),g(e,"type","button"),g(e,"class",a="px-1.5 @sm:px-2.5 py-1.5 flex gap-1.5 items-center text-sm rounded-full font-medium transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden "+(o[5]||(((d=o[25])==null?void 0:d.webSearch)??!1)==="always"?"bg-blue-100 dark:bg-blue-500/20 text-blue-500 dark:text-blue-400":"bg-transparent text-gray-600 dark:text-gray-300 border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800"))},m(d,f){U(d,e,f),re(t,e,null),E(e,n),E(e,r),E(r,s),l=!0,c||(u=we(e,"click",Os(o[78])),c=!0)},p(d,f){var h;(!l||f[0]&67108864)&&i!==(i=d[26].t("Web Search")+"")&&Pe(s,i),(!l||f[0]&33554464&&a!==(a="px-1.5 @sm:px-2.5 py-1.5 flex gap-1.5 items-center text-sm rounded-full font-medium transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden "+(d[5]||(((h=d[25])==null?void 0:h.webSearch)??!1)==="always"?"bg-blue-100 dark:bg-blue-500/20 text-blue-500 dark:text-blue-400":"bg-transparent text-gray-600 dark:text-gray-300 border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800")))&&g(e,"class",a)},i(d){l||(T(t.$$.fragment,d),l=!0)},o(d){N(t.$$.fragment,d),l=!1},d(d){d&&p(e),ie(t),c=!1,u()}}}function Nu(o){let e,t;return e=new qt({props:{content:o[26].t("Generate an image"),placement:"top",$$slots:{default:[cw]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&67108864&&(i.content=n[26].t("Generate an image")),r[0]&67108880|r[3]&16&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function cw(o){let e,t,n,r,i=o[26].t("Image")+"",s,a,l,c,u;return t=new xv({props:{className:"size-5",strokeWidth:"1.75"}}),{c(){e=M("button"),oe(t.$$.fragment),n=$(),r=M("span"),s=Ie(i),this.h()},l(d){e=O(d,"BUTTON",{type:!0,class:!0});var f=A(e);ae(t.$$.fragment,f),n=ee(f),r=O(f,"SPAN",{class:!0});var h=A(r);s=Te(h,i),h.forEach(p),f.forEach(p),this.h()},h(){g(r,"class","hidden @sm:block whitespace-nowrap overflow-hidden text-ellipsis translate-y-[0.5px] mr-0.5"),g(e,"type","button"),g(e,"class",a="px-1.5 @sm:px-2.5 py-1.5 flex gap-1.5 items-center text-sm rounded-full font-medium transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden "+(o[4]?"bg-gray-100 dark:bg-gray-500/20 text-gray-600 dark:text-gray-400":"bg-transparent text-gray-600 dark:text-gray-300 border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 "))},m(d,f){U(d,e,f),re(t,e,null),E(e,n),E(e,r),E(r,s),l=!0,c||(u=we(e,"click",Os(o[79])),c=!0)},p(d,f){(!l||f[0]&67108864)&&i!==(i=d[26].t("Image")+"")&&Pe(s,i),(!l||f[0]&16&&a!==(a="px-1.5 @sm:px-2.5 py-1.5 flex gap-1.5 items-center text-sm rounded-full font-medium transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden "+(d[4]?"bg-gray-100 dark:bg-gray-500/20 text-gray-600 dark:text-gray-400":"bg-transparent text-gray-600 dark:text-gray-300 border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 ")))&&g(e,"class",a)},i(d){l||(T(t.$$.fragment,d),l=!0)},o(d){N(t.$$.fragment,d),l=!1},d(d){d&&p(e),ie(t),c=!1,u()}}}function Du(o){let e,t;return e=new qt({props:{content:o[26].t("Record voice"),$$slots:{default:[uw]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&67108864&&(i.content=n[26].t("Record voice")),r[0]&67239936|r[3]&16&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function uw(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 translate-y-[0.5px]"><path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"></path><path d="M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"></path></svg>',n,r;return{c(){e=M("button"),e.innerHTML=t,this.h()},l(i){e=O(i,"BUTTON",{id:!0,class:!0,type:!0,"aria-label":!0,"data-svelte-h":!0}),yt(e)!=="svelte-4nqm9k"&&(e.innerHTML=t),this.h()},h(){g(e,"id","voice-input-button"),g(e,"class","text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 transition rounded-full p-1.5 mr-0.5 self-center"),g(e,"type","button"),g(e,"aria-label","Voice Input")},m(i,s){U(i,e,s),n||(r=we(e,"click",o[81]),n=!0)},p:Le,d(i){i&&p(e),n=!1,r()}}}function dw(o){let e,t,n;return t=new qt({props:{content:o[26].t("Stop"),$$slots:{default:[hw]},$$scope:{ctx:o}}}),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);ae(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"class","flex items-center")},m(r,i){U(r,e,i),re(t,e,null),n=!0},p(r,i){const s={};i[0]&67108864&&(s.content=r[26].t("Stop")),i[0]&1024|i[3]&16&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){N(t.$$.fragment,r),n=!1},d(r){r&&p(e),ie(t)}}}function fw(o){let e,t,n,r;const i=[mw,gw],s=[];function a(l,c){return 1}return e=a(),t=s[e]=i[e](o),{c(){t.c(),n=qe()},l(l){t.l(l),n=qe()},m(l,c){s[e].m(l,c),U(l,n,c),r=!0},p(l,c){let u=e;e=a(),e===u?s[e].p(l,c):(De(),N(s[u],1,1,()=>{s[u]=null}),He(),t=s[e],t?t.p(l,c):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){N(t),r=!1},d(l){l&&p(n),s[e].d(l)}}}function hw(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z" clip-rule="evenodd"></path></svg>',n,r;return{c(){e=M("button"),e.innerHTML=t,this.h()},l(i){e=O(i,"BUTTON",{class:!0,"data-svelte-h":!0}),yt(e)!=="svelte-nqxd5x"&&(e.innerHTML=t),this.h()},h(){g(e,"class","bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5")},m(i,s){U(i,e,s),n||(r=we(e,"click",o[83]),n=!0)},p:Le,d(i){i&&p(e),n=!1,r()}}}function gw(o){let e,t,n;return t=new qt({props:{content:o[26].t("Send message"),$$slots:{default:[pw]},$$scope:{ctx:o}}}),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);ae(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"class","flex items-center")},m(r,i){U(r,e,i),re(t,e,null),n=!0},p(r,i){const s={};i[0]&67108864&&(s.content=r[26].t("Send message")),i[0]&33554470|i[3]&16&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){N(t.$$.fragment,r),n=!1},d(r){r&&p(e),ie(t)}}}function mw(o){let e,t,n;return t=new qt({props:{content:o[26].t("Call"),$$slots:{default:[_w]},$$scope:{ctx:o}}}),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);ae(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"class","flex items-center")},m(r,i){U(r,e,i),re(t,e,null),n=!0},p(r,i){const s={};i[0]&67108864&&(s.content=r[26].t("Call")),i[0]&234883104|i[1]&1|i[3]&16&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){N(t.$$.fragment,r),n=!1},d(r){r&&p(e),ie(t)}}}function pw(o){let e,t,n,r,i;return{c(){e=M("button"),t=Me("svg"),n=Me("path"),this.h()},l(s){e=O(s,"BUTTON",{id:!0,class:!0,type:!0});var a=A(e);t=Oe(a,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var l=A(t);n=Oe(l,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),A(n).forEach(p),l.forEach(p),a.forEach(p),this.h()},h(){var s;g(n,"fill-rule","evenodd"),g(n,"d","M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z"),g(n,"clip-rule","evenodd"),g(t,"xmlns","http://www.w3.org/2000/svg"),g(t,"viewBox","0 0 16 16"),g(t,"fill","currentColor"),g(t,"class","size-5"),g(e,"id","send-message-button"),g(e,"class",r=(o[1]===""&&o[2].length===0?"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled":o[5]||(((s=o[25])==null?void 0:s.webSearch)??!1)==="always"?"bg-blue-500 text-white hover:bg-blue-400 ":"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ")+" transition rounded-full p-1.5 self-center"),g(e,"type","submit"),e.disabled=i=o[1]===""&&o[2].length===0},m(s,a){U(s,e,a),E(e,t),E(t,n)},p(s,a){var l;a[0]&33554470&&r!==(r=(s[1]===""&&s[2].length===0?"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled":s[5]||(((l=s[25])==null?void 0:l.webSearch)??!1)==="always"?"bg-blue-500 text-white hover:bg-blue-400 ":"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ")+" transition rounded-full p-1.5 self-center")&&g(e,"class",r),a[0]&6&&i!==(i=s[1]===""&&s[2].length===0)&&(e.disabled=i)},d(s){s&&p(e)}}}function _w(o){let e,t,n,r,i,s;return t=new Xv({props:{className:"size-5"}}),{c(){e=M("button"),oe(t.$$.fragment),this.h()},l(a){e=O(a,"BUTTON",{class:!0,type:!0,"aria-label":!0});var l=A(e);ae(t.$$.fragment,l),l.forEach(p),this.h()},h(){var a;g(e,"class",n=(o[5]||(((a=o[25])==null?void 0:a.webSearch)??!1)==="always"?"bg-blue-500 text-white hover:bg-blue-400 ":"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100")+" transition rounded-full p-1.5 self-center"),g(e,"type","button"),g(e,"aria-label","Call")},m(a,l){U(a,e,l),re(t,e,null),r=!0,i||(s=we(e,"click",o[82]),i=!0)},p(a,l){var c;(!r||l[0]&33554464&&n!==(n=(a[5]||(((c=a[25])==null?void 0:c.webSearch)??!1)==="always"?"bg-blue-500 text-white hover:bg-blue-400 ":"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100")+" transition rounded-full p-1.5 self-center"))&&g(e,"class",n)},i(a){r||(T(t.$$.fragment,a),r=!0)},o(a){N(t.$$.fragment,a),r=!1},d(a){a&&p(e),ie(t),i=!1,s()}}}function bw(o){let e,t,n,r;e=new Rm({props:{show:o[23]}});let i=o[16]&&bu(o);return{c(){oe(e.$$.fragment),t=$(),i&&i.c(),n=qe()},l(s){ae(e.$$.fragment,s),t=ee(s),i&&i.l(s),n=qe()},m(s,a){re(e,s,a),U(s,t,a),i&&i.m(s,a),U(s,n,a),r=!0},p(s,a){const l={};a[0]&8388608&&(l.show=s[23]),e.$set(l),s[16]?i?(i.p(s,a),a[0]&65536&&T(i,1)):(i=bu(s),i.c(),T(i,1),i.m(n.parentNode,n)):i&&(De(),N(i,1,1,()=>{i=null}),He())},i(s){r||(T(e.$$.fragment,s),T(i),r=!0)},o(s){N(e.$$.fragment,s),N(i),r=!1},d(s){s&&(p(t),p(n)),ie(e,s),i&&i.d(s)}}}function yw(o,e,t){let n,r,i,s,a,l,c,u;fe(o,qo,G=>t(25,n=G)),fe(o,ti,G=>t(27,i=G)),fe(o,er,G=>t(28,s=G)),fe(o,Tr,G=>t(14,a=G)),fe(o,yr,G=>t(29,l=G)),fe(o,Mi,G=>t(30,c=G)),fe(o,wa,G=>t(31,u=G));const d=An(),f=fn("i18n");fe(o,f,G=>t(26,r=G));let{transparentBackground:h=!1}=e,{onChange:_=()=>{}}=e,{createMessagePair:b}=e,{stopResponse:v}=e,{autoScroll:m=!1}=e,{atSelectedModel:y=void 0}=e,{selectedModels:w}=e,I=[],{history:S}=e,{prompt:k=""}=e,{files:C=[]}=e,{selectedToolIds:R=[]}=e,{imageGenerationEnabled:D=!1}=e,{webSearchEnabled:H=!1}=e,{codeInterpreterEnabled:z=!1}=e,W=!1,K=!1,P=!1,V,L,q,Z,Q=!1,{placeholder:Y=""}=e,te=[];const F=()=>{const G=document.getElementById("messages-container");G.scrollTo({top:G.scrollHeight,behavior:"smooth"})},j=async()=>{try{const G=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"never"},audio:!1}),Ne=document.createElement("video");Ne.srcObject=G,await Ne.play();const Je=document.createElement("canvas");Je.width=Ne.videoWidth,Je.height=Ne.videoHeight,Je.getContext("2d").drawImage(Ne,0,0,Je.width,Je.height),G.getTracks().forEach(ct=>ct.stop()),window.focus();const Ve=Je.toDataURL("image/png");t(2,C=[...C,{type:"image",url:Ve}]),Ne.srcObject=null}catch(G){console.error("Error capturing screen:",G)}},x=async G=>{try{Cp("...");const Ne=await Rp(localStorage.token,G);if(Ne){Ep("...");const Je=Ne._id;await it();let ht=Date.now(),Ve=!1;for(;!Ve&&Date.now()-ht<5*60*1e3;){const ct=await Sm().catch(Lt=>($e.error(`${Lt}`),null));if(ct){const Lt=ct.find(Ln=>Ln._id===Je);if((Lt==null?void 0:Lt.status)==="SUCCESS"&&(Lt==null?void 0:Lt.calculatedStatus)==="SUCCESS"){Ve=!0;break}}await new Promise(Lt=>setTimeout(Lt,1e3))}if(!Ve){$e.error(",");return}return Je}}finally{Ip()}},J=async(G,Ne=!1)=>{var ct,Lt,Ln,Wn;if((s==null?void 0:s.role)!=="admin"&&!(((Lt=(ct=s==null?void 0:s.permissions)==null?void 0:ct.chat)==null?void 0:Lt.file_upload)??!0))return $e.error(r.t("You do not have permission to upload files.")),null;const Je=Go(),ht={type:"file",file:"",id:null,url:"",name:G.name,collection_name:"",status:"uploading",size:G.size,error:"",itemId:Je,...Ne?{context:"full"}:{}};if(ht.size==0)return $e.error(r.t("You cannot upload an empty file.")),null;if(t(2,C=[...C,ht]),["audio/mpeg","audio/wav","audio/ogg","audio/x-m4a"].includes(G.type)){const sn=await kp(localStorage.token,G).catch(Xt=>($e.error(`${Xt}`),null));sn&&(console.log(sn),t(1,k=`${k}${sn.text} `),await it(),(Ln=document.getElementById("chat-input"))==null||Ln.focus(),((n==null?void 0:n.speechAutoSend)??!0)&&d("submit",k));return}let Ve=null;try{if(G.size>100*1024*1024){$e.error("100M");return}const sn=async()=>{var Xt;t(1,k=`'${G.name}',Agent`),await it(),(Xt=document.getElementById("chat-input"))==null||Xt.focus(),((n==null?void 0:n.speechAutoSend)??!0)&&await d("submit",k)};((Wn=ye(so))==null?void 0:Wn.length)===0?await Promise.race([new Promise((Xt,qn)=>{let Un=()=>{};Un=so.subscribe(async ho=>{ho&&ho.length>0&&(Un(),Ve=await x(G),Xt(ho))}),setTimeout(()=>{Un(),qn(new Error(","))},1e5),sn()})]).catch(Xt=>{throw $e.error(Xt.message),Xt}):(Ve=await x(G),await sn())}catch(sn){$e.error(`${sn}`),t(2,C=C.filter(Xt=>(Xt==null?void 0:Xt.itemId)!==Je))}finally{Ve&&setTimeout(()=>{Tm(Ve)},2e4)}},ve=async G=>{console.log("Input files handler called with:",G),G.forEach(Ne=>{var Je,ht,Ve,ct;if(console.log("Processing file:",{name:Ne.name,type:Ne.type,size:Ne.size,extension:Ne.name.split(".").at(-1)}),(((Je=i==null?void 0:i.file)==null?void 0:Je.max_size)??null)!==null&&Ne.size>(((ht=i==null?void 0:i.file)==null?void 0:ht.max_size)??0)*1024*1024){console.log("File exceeds max size limit:",{fileSize:Ne.size,maxSize:(((Ve=i==null?void 0:i.file)==null?void 0:Ve.max_size)??0)*1024*1024}),$e.error(r.t("File size should not exceed {{maxSize}} MB.",{maxSize:(ct=i==null?void 0:i.file)==null?void 0:ct.max_size}));return}if(["image/gif","image/webp","image/jpeg","image/png","image/avif"].includes(Ne.type)){if(te.length===0){$e.error(r.t("Selected model(s) do not support image inputs"));return}let Lt=new FileReader;Lt.onload=async Ln=>{var sn,Xt;let Wn=Ln.target.result;if((n==null?void 0:n.imageCompression)??!1){const qn=((sn=n==null?void 0:n.imageCompressionSize)==null?void 0:sn.width)??null,Un=((Xt=n==null?void 0:n.imageCompressionSize)==null?void 0:Xt.height)??null;(qn||Un)&&(Wn=await Qm(Wn,qn,Un))}t(2,C=[...C,{type:"image",url:`${Wn}`}])},Lt.readAsDataURL(Ne)}else J(Ne)})},le=G=>{G.key==="Escape"&&(console.log("Escape"),t(23,Q=!1))},me=G=>{var Ne,Je;G.preventDefault(),(Je=(Ne=G.dataTransfer)==null?void 0:Ne.types)!=null&&Je.includes("Files")?t(23,Q=!0):t(23,Q=!1)},X=()=>{t(23,Q=!1)},ue=async G=>{var Ne,Je;if(G.preventDefault(),console.log(G),(Ne=G.dataTransfer)!=null&&Ne.files){const ht=Array.from((Je=G.dataTransfer)==null?void 0:Je.files);ht&&ht.length>0&&(console.log(ht),ve(ht))}t(23,Q=!1)};Kn(async()=>{t(16,W=!0),window.setTimeout(()=>{const Ne=document.getElementById("chat-input");Ne==null||Ne.focus()},0),window.addEventListener("keydown",le),await it();const G=document.getElementById("chat-container");G==null||G.addEventListener("dragover",me),G==null||G.addEventListener("drop",ue),G==null||G.addEventListener("dragleave",X)}),ur(()=>{console.log("destroy"),window.removeEventListener("keydown",le);const G=document.getElementById("chat-container");G&&(G==null||G.removeEventListener("dragover",me),G==null||G.removeEventListener("drop",ue),G==null||G.removeEventListener("dragleave",X))});const be=()=>{t(6,m=!0),F()},Re=G=>l?l.find(Ne=>Ne.id===G):{id:G,name:G},Fe=G=>G.id===y.id,he=()=>{t(0,y=void 0)};function et(G){ze[G?"unshift":"push"](()=>{q=G,t(21,q)})}function ot(G){k=G,t(1,k)}function Et(G){C=G,t(2,C)}const Dt=G=>{d("upload",G.detail)},Yt=G=>{const Ne=G.detail;(Ne==null?void 0:Ne.type)==="model"&&t(0,y=Ne.data);const Je=document.getElementById("chat-input");Je==null||Je.focus()};function Pt(G){ze[G?"unshift":"push"](()=>{L=G,t(20,L)})}function Zt(){Z=this.files,t(22,Z)}const jt=async()=>{if(Z&&Z.length>0){const G=Array.from(Z);ve(G)}else $e.error(r.t("File not found."));t(20,L.value="",L),t(2,C=[])};function Ht(G){K=G,t(17,K)}const Qt=async()=>{var G;t(17,K=!1),await it(),(G=document.getElementById("chat-input"))==null||G.focus()},se=async G=>{var ht;const{text:Ne,filename:Je}=G.detail;t(1,k=`${k}${Ne} `),t(17,K=!1),await it(),(ht=document.getElementById("chat-input"))==null||ht.focus(),((n==null?void 0:n.speechAutoSend)??!0)&&d("submit",k)},Qe=G=>!te.includes(G),rt=G=>{C.splice(G,1),t(2,C)},pt=async(G,Ne)=>{G.type!=="collection"&&!(G!=null&&G.collection)&&G.id&&await Ap(localStorage.token,G.id),C.splice(Ne,1),t(2,C)},Ue=G=>{console.log(G)},en=async G=>{(I.length===0||!I.at(0))&&$e.error(r.t("Please select a model first."));const Ne=await fp(localStorage.token,I.at(0),G,S!=null&&S.currentId?ao(S,S.currentId):null).catch(Je=>(console.log(Je),null));return console.log(Ne),Ne},At=()=>t(18,P=!0),pe=()=>t(18,P=!1);function Xe(G){ze[G?"unshift":"push"](()=>{V=G,t(19,V)})}function Be(G){k=G,t(1,k)}const Ze=async G=>{var ht;G=G.detail.event;const Ne=G.ctrlKey||G.metaKey,Je=document.getElementById("commands-container");if(G.key==="Escape"&&v(),Ne&&G.key==="Enter"&&G.shiftKey&&(G.preventDefault(),b(k)),k===""&&Ne&&G.key.toLowerCase()==="r"){G.preventDefault(),console.log("regenerate");const Ve=[...document.getElementsByClassName("regenerate-response-button")].at(-1);Ve==null||Ve.click()}if(k===""&&G.key=="ArrowUp"){G.preventDefault();const Ve=[...document.getElementsByClassName("user-message")].at(-1);if(Ve){Ve.scrollIntoView({block:"center"});const ct=[...document.getElementsByClassName("edit-user-message-button")].at(-1);ct==null||ct.click()}}if(Je){if(Je&&G.key==="ArrowUp"&&(G.preventDefault(),q.selectUp(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),Je&&G.key==="ArrowDown"&&(G.preventDefault(),q.selectDown(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),Je&&G.key==="Tab"){G.preventDefault();const Ve=[...document.getElementsByClassName("selected-command-option-button")].at(-1);Ve==null||Ve.click()}if(Je&&G.key==="Enter"){G.preventDefault();const Ve=[...document.getElementsByClassName("selected-command-option-button")].at(-1);Ve?Ve==null||Ve.click():(ht=document.getElementById("send-message-button"))==null||ht.click()}}else if(!c||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)){if(P)return;((n==null?void 0:n.ctrlEnterToSend)??!1?(G.key==="Enter"||G.keyCode===13)&&Ne:(G.key==="Enter"||G.keyCode===13)&&!G.shiftKey)&&(G.preventDefault(),(k!==""||C.length>0)&&d("submit",k))}G.key==="Escape"&&(console.log("Escape"),t(0,y=void 0),t(3,R=[]),t(5,H=!1),t(4,D=!1))},Tt=async G=>{G=G.detail.event,console.log(G);const Ne=G.clipboardData||window.clipboardData;if(Ne&&Ne.items){for(const Je of Ne.items)if(Je.type.indexOf("image")!==-1){const ht=Je.getAsFile(),Ve=new FileReader;Ve.onload=function(ct){t(2,C=[...C,{type:"image",url:`${ct.target.result}`}])},Ve.readAsDataURL(ht)}else if(Je.type==="text/plain"&&((n==null?void 0:n.largeTextAsFile)??!1)){const ht=Ne.getData("text/plain");if(ht.length>oc){G.preventDefault();const Ve=new Blob([ht],{type:"text/plain"}),ct=new File([Ve],`Pasted_Text_${Date.now()}.txt`,{type:"text/plain"});await J(ct,!0)}}}};function St(G){ze[G?"unshift":"push"](()=>{V=G,t(19,V)})}function Nt(){k=this.value,t(1,k)}const _t=()=>t(18,P=!0),yn=()=>t(18,P=!1),hn=async G=>{var ht;const Ne=G.ctrlKey||G.metaKey;console.log("keydown",G);const Je=document.getElementById("commands-container");if(G.key==="Escape"&&v(),Ne&&G.key==="Enter"&&G.shiftKey&&(G.preventDefault(),b(k)),k===""&&Ne&&G.key.toLowerCase()==="r"){G.preventDefault(),console.log("regenerate");const Ve=[...document.getElementsByClassName("regenerate-response-button")].at(-1);Ve==null||Ve.click()}if(k===""&&G.key=="ArrowUp"){G.preventDefault();const Ve=[...document.getElementsByClassName("user-message")].at(-1),ct=[...document.getElementsByClassName("edit-user-message-button")].at(-1);console.log(Ve),Ve.scrollIntoView({block:"center"}),ct==null||ct.click()}if(Je){if(Je&&G.key==="ArrowUp"&&(G.preventDefault(),q.selectUp(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),Je&&G.key==="ArrowDown"&&(G.preventDefault(),q.selectDown(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),Je&&G.key==="Enter"){G.preventDefault();const Ve=[...document.getElementsByClassName("selected-command-option-button")].at(-1);G.shiftKey?t(1,k=`${k}
`):Ve?Ve==null||Ve.click():(ht=document.getElementById("send-message-button"))==null||ht.click()}if(Je&&G.key==="Tab"){G.preventDefault();const Ve=[...document.getElementsByClassName("selected-command-option-button")].at(-1);Ve==null||Ve.click()}}else if(!c||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)){if(P)return;console.log("keypress",G);const Ve=G.ctrlKey||G.metaKey,ct=(n==null?void 0:n.ctrlEnterToSend)??!1?(G.key==="Enter"||G.keyCode===13)&&Ve:(G.key==="Enter"||G.keyCode===13)&&!G.shiftKey;console.log("Enter pressed:",ct),ct&&G.preventDefault(),(k!==""||C.length>0)&&ct&&d("submit",k)}if(G.key==="Tab"){const Ve=Xm(k);if(Ve.length>0){const ct=Ve.at(0),Lt=k;t(1,k=k.substring(0,(ct==null?void 0:ct.endIndex)+1)),await it(),G.target.scrollTop=G.target.scrollHeight,t(1,k=Lt),await it(),G.preventDefault(),G.target.setSelectionRange(ct==null?void 0:ct.startIndex,ct.endIndex+1)}G.target.style.height="",G.target.style.height=Math.min(G.target.scrollHeight,320)+"px"}G.key==="Escape"&&(console.log("Escape"),t(0,y=void 0),t(3,R=[]),t(5,H=!1),t(4,D=!1))},gn=async G=>{G.target.style.height="",G.target.style.height=Math.min(G.target.scrollHeight,320)+"px"},xt=async G=>{G.target.style.height="",G.target.style.height=Math.min(G.target.scrollHeight,320)+"px"},on=async G=>{const Ne=G.clipboardData||window.clipboardData;if(Ne&&Ne.items){for(const Je of Ne.items)if(Je.type.indexOf("image")!==-1){const ht=Je.getAsFile(),Ve=new FileReader;Ve.onload=function(ct){t(2,C=[...C,{type:"image",url:`${ct.target.result}`}])},Ve.readAsDataURL(ht)}else if(Je.type==="text/plain"&&((n==null?void 0:n.largeTextAsFile)??!1)){const ht=Ne.getData("text/plain");if(ht.length>oc){G.preventDefault();const Ve=new Blob([ht],{type:"text/plain"}),ct=new File([Ve],`Pasted_Text_${Date.now()}.txt`,{type:"text/plain"});await J(ct,!0)}}}},kn=()=>{L.click()},Rn=async()=>{try{const G=await S1();if(G){const Ne=new File([G.blob],G.name,{type:G.blob.type});await J(Ne)}else console.log("No file was selected from Google Drive")}catch(G){console.error("Google Drive Error:",G),$e.error(r.t("Error accessing Google Drive: {{error}}",{error:G.message}))}},rn=async()=>{try{const G=await lv();if(G){const Ne=new File([G.blob],G.name,{type:G.blob.type||"application/octet-stream"});await J(Ne)}else console.log("No file was selected from OneDrive")}catch(G){console.error("OneDrive Error:",G)}},Bt=async()=>{await it();const G=document.getElementById("chat-input");G==null||G.focus()};function to(G){R=G,t(3,R)}const Gn=()=>t(5,H=!H),no=()=>t(4,D=!D),fo=()=>t(7,z=!z),Io=async()=>{try{let G=await navigator.mediaDevices.getUserMedia({audio:!0}).catch(function(Ne){return $e.error(r.t("Permission denied when accessing microphone: {{error}}",{error:Ne})),null});G&&(t(17,K=!0),G.getTracks().forEach(Je=>Je.stop())),G=null}catch{$e.error(r.t("Permission denied when accessing microphone"))}},Vo=async()=>{var G,Ne,Je,ht,Ve;if(w.length>1){$e.error(r.t("Select only one model to call"));return}if(i.audio.stt.engine==="web"){$e.error(r.t("Call feature is not supported when using Web STT engine"));return}try{let ct=await navigator.mediaDevices.getUserMedia({audio:!0});ct&&ct.getTracks().forEach(Ln=>Ln.stop()),ct=null,((Ne=(G=n.audio)==null?void 0:G.tts)==null?void 0:Ne.engine)==="browser-kokoro"&&(u||(await wa.set(new Qp({dtype:((Ve=(ht=(Je=n.audio)==null?void 0:Je.tts)==null?void 0:ht.engineConfig)==null?void 0:Ve.dtype)??"fp32"})),await u.init())),Zn.set(!0),dn.set(!0)}catch{$e.error(r.t("Permission denied when accessing media devices"))}},oo=()=>{v()},ro=()=>{d("submit",k)};return o.$$set=G=>{"transparentBackground"in G&&t(8,h=G.transparentBackground),"onChange"in G&&t(38,_=G.onChange),"createMessagePair"in G&&t(9,b=G.createMessagePair),"stopResponse"in G&&t(10,v=G.stopResponse),"autoScroll"in G&&t(6,m=G.autoScroll),"atSelectedModel"in G&&t(0,y=G.atSelectedModel),"selectedModels"in G&&t(11,w=G.selectedModels),"history"in G&&t(12,S=G.history),"prompt"in G&&t(1,k=G.prompt),"files"in G&&t(2,C=G.files),"selectedToolIds"in G&&t(3,R=G.selectedToolIds),"imageGenerationEnabled"in G&&t(4,D=G.imageGenerationEnabled),"webSearchEnabled"in G&&t(5,H=G.webSearchEnabled),"codeInterpreterEnabled"in G&&t(7,z=G.codeInterpreterEnabled),"placeholder"in G&&t(13,Y=G.placeholder)},o.$$.update=()=>{o.$$.dirty[0]&2049&&t(15,I=y!==void 0?[y.id]:w),o.$$.dirty[0]&62|o.$$.dirty[1]&128&&_({prompt:k,files:C,selectedToolIds:R,imageGenerationEnabled:D,webSearchEnabled:H}),o.$$.dirty[0]&18433&&t(24,te=[...y?[y]:w].filter(G=>{var Ne,Je,ht,Ve;return((Ve=(ht=(Je=(Ne=a.find(ct=>ct.id===G))==null?void 0:Ne.info)==null?void 0:Je.meta)==null?void 0:ht.capabilities)==null?void 0:Ve.vision)??!0}))},[y,k,C,R,D,H,m,z,h,b,v,w,S,Y,a,I,W,K,P,V,L,q,Z,Q,te,n,r,i,s,l,c,u,d,f,F,j,J,ve,_,be,Re,Fe,he,et,ot,Et,Dt,Yt,Pt,Zt,jt,Ht,Qt,se,Qe,rt,pt,Ue,en,At,pe,Xe,Be,Ze,Tt,St,Nt,_t,yn,hn,gn,xt,on,kn,Rn,rn,Bt,to,Gn,no,fo,Io,Vo,oo,ro]}class Ng extends Ge{constructor(e){super(),We(this,e,yw,bw,Ye,{transparentBackground:8,onChange:38,createMessagePair:9,stopResponse:10,autoScroll:6,atSelectedModel:0,selectedModels:11,history:12,prompt:1,files:2,selectedToolIds:3,imageGenerationEnabled:4,webSearchEnabled:5,codeInterpreterEnabled:7,placeholder:13},null,[-1,-1,-1,-1])}}function Hu(o,e,t){const n=o.slice();return n[36]=e[t],n}function Lu(o,e,t){const n=o.slice();return n[39]=e[t],n[41]=t,n}function Uu(o,e,t){const n=o.slice();return n[42]=e[t],n}function Bu(o,e,t){const n=o.slice();return n[42]=e[t],n}function vw(o){let e;return{c(){e=Ie(o[2])},l(t){e=Te(t,o[2])},m(t,n){U(t,e,n)},p(t,n){n[0]&4&&Pe(e,t[2])},d(t){t&&p(e)}}}function ww(o){let e=o[10].label+"",t;return{c(){t=Ie(e)},l(n){t=Te(n,e)},m(n,r){U(n,t,r)},p(n,r){r[0]&1024&&e!==(e=n[10].label+"")&&Pe(t,e)},d(n){n&&p(t)}}}function kw(o){let e,t,n,r,i;function s(c,u){return c[10]?ww:vw}let a=s(o),l=a(o);return n=new xp({props:{className:" self-center ml-2 size-3",strokeWidth:"2.5"}}),{c(){e=M("div"),l.c(),t=$(),oe(n.$$.fragment),this.h()},l(c){e=O(c,"DIV",{class:!0});var u=A(e);l.l(u),t=ee(u),ae(n.$$.fragment,u),u.forEach(p),this.h()},h(){g(e,"class",r="flex w-full text-left px-0.5 outline-hidden bg-transparent truncate "+o[5]+" justify-between font-medium placeholder-gray-400 focus:outline-hidden")},m(c,u){U(c,e,u),l.m(e,null),E(e,t),re(n,e,null),i=!0},p(c,u){a===(a=s(c))&&l?l.p(c,u):(l.d(1),l=a(c),l&&(l.c(),l.m(e,t))),(!i||u[0]&32&&r!==(r="flex w-full text-left px-0.5 outline-hidden bg-transparent truncate "+c[5]+" justify-between font-medium placeholder-gray-400 focus:outline-hidden"))&&g(e,"class",r)},i(c){i||(T(n.$$.fragment,c),i=!0)},o(c){N(n.$$.fragment,c),i=!1},d(c){c&&p(e),l.d(),ie(n)}}}function zu(o){let e,t,n="";return{c(){e=M("div"),t=M("div"),t.innerHTML=n,this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);t=O(i,"DIV",{class:!0,"data-svelte-h":!0}),yt(t)!=="svelte-194p8kq"&&(t.innerHTML=n),i.forEach(p),this.h()},h(){g(t,"class","flex gap-1 scrollbar-none overflow-x-auto w-fit text-center text-sm font-medium rounded-full bg-transparent px-1.5 pb-0.5"),g(e,"class","flex w-full sticky")},m(r,i){U(r,e,i),E(e,t),o[24](t)},p:Le,d(r){r&&p(e),o[24](null)}}}function Vu(o){let e,t,n=o[15].t("No results found")+"",r;return{c(){e=M("div"),t=M("div"),r=Ie(n),this.h()},l(i){e=O(i,"DIV",{});var s=A(e);t=O(s,"DIV",{class:!0});var a=A(t);r=Te(a,n),a.forEach(p),s.forEach(p),this.h()},h(){g(t,"class","block px-3 py-2 text-sm text-gray-700 dark:text-gray-100")},m(i,s){U(i,e,s),E(e,t),E(t,r)},p(i,s){s[0]&32768&&n!==(n=i[15].t("No results found")+"")&&Pe(r,n)},d(i){i&&p(e)}}}function Fu(o){var r,i;let e,t=Ct((i=(r=o[39].model)==null?void 0:r.info)==null?void 0:i.meta.tags),n=[];for(let s=0;s<t.length;s+=1)n[s]=Ku(Bu(o,t,s));return{c(){e=M("div");for(let s=0;s<n.length;s+=1)n[s].c();this.h()},l(s){e=O(s,"DIV",{class:!0});var a=A(e);for(let l=0;l<n.length;l+=1)n[l].l(a);a.forEach(p),this.h()},h(){g(e,"class","flex gap-0.5 self-start h-full mb-1.5 -translate-x-1")},m(s,a){U(s,e,a);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(e,null)},p(s,a){var l,c;if(a[0]&8192){t=Ct((c=(l=s[39].model)==null?void 0:l.info)==null?void 0:c.meta.tags);let u;for(u=0;u<t.length;u+=1){const d=Bu(s,t,u);n[u]?n[u].p(d,a):(n[u]=Ku(d),n[u].c(),n[u].m(e,null))}for(;u<n.length;u+=1)n[u].d(1);n.length=t.length}},d(s){s&&p(e),Fn(n,s)}}}function Ku(o){let e,t=o[42].name+"",n,r;return{c(){e=M("div"),n=Ie(t),r=$(),this.h()},l(i){e=O(i,"DIV",{class:!0});var s=A(e);n=Te(s,t),r=ee(s),s.forEach(p),this.h()},h(){g(e,"class","text-xs font-bold px-1 rounded-sm uppercase line-clamp-1 bg-gray-500/20 text-gray-700 dark:text-gray-200")},m(i,s){U(i,e,s),E(e,n),E(e,r)},p(i,s){s[0]&8192&&t!==(t=i[42].name+"")&&Pe(n,t)},d(i){i&&p(e)}}}function Cw(o){let e,t,n,r=o[39].label+"",i;return{c(){e=M("img"),n=$(),i=Ie(r),this.h()},l(s){e=O(s,"IMG",{src:!0,alt:!0,class:!0}),n=ee(s),i=Te(s,r),this.h()},h(){var s,a,l;xo(e.src,t=((l=(a=(s=o[39].model)==null?void 0:s.info)==null?void 0:a.meta)==null?void 0:l.profile_image_url)??"/static/favicon.png")||g(e,"src",t),g(e,"alt","Model"),g(e,"class","rounded-full size-5 flex items-center mr-2")},m(s,a){U(s,e,a),U(s,n,a),U(s,i,a)},p(s,a){var l,c,u;a[0]&8192&&!xo(e.src,t=((u=(c=(l=s[39].model)==null?void 0:l.info)==null?void 0:c.meta)==null?void 0:u.profile_image_url)??"/static/favicon.png")&&g(e,"src",t),a[0]&8192&&r!==(r=s[39].label+"")&&Pe(i,r)},d(s){s&&(p(e),p(n),p(i))}}}function Gu(o){var r,i,s,a,l,c;let e,t,n;return t=new qt({props:{content:`${(i=(r=o[39].model.ollama)==null?void 0:r.details)!=null&&i.quantization_level?((a=(s=o[39].model.ollama)==null?void 0:s.details)==null?void 0:a.quantization_level)+" ":""}${(l=o[39].model.ollama)!=null&&l.size?`(${(((c=o[39].model.ollama)==null?void 0:c.size)/1024**3).toFixed(1)}GB)`:""}`,className:"self-end",$$slots:{default:[Ew]},$$scope:{ctx:o}}}),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(u){e=O(u,"DIV",{class:!0});var d=A(e);ae(t.$$.fragment,d),d.forEach(p),this.h()},h(){g(e,"class","flex ml-1 items-center translate-y-[0.5px]")},m(u,d){U(u,e,d),re(t,e,null),n=!0},p(u,d){var h,_,b,v,m,y;const f={};d[0]&8192&&(f.content=`${(_=(h=u[39].model.ollama)==null?void 0:h.details)!=null&&_.quantization_level?((v=(b=u[39].model.ollama)==null?void 0:b.details)==null?void 0:v.quantization_level)+" ":""}${(m=u[39].model.ollama)!=null&&m.size?`(${(((y=u[39].model.ollama)==null?void 0:y.size)/1024**3).toFixed(1)}GB)`:""}`),d[0]&8192|d[1]&1&&(f.$$scope={dirty:d,ctx:u}),t.$set(f)},i(u){n||(T(t.$$.fragment,u),n=!0)},o(u){N(t.$$.fragment,u),n=!1},d(u){u&&p(e),ie(t)}}}function Ew(o){var r,i;let e,t=(((i=(r=o[39].model.ollama)==null?void 0:r.details)==null?void 0:i.parameter_size)??"")+"",n;return{c(){e=M("span"),n=Ie(t),this.h()},l(s){e=O(s,"SPAN",{class:!0});var a=A(e);n=Te(a,t),a.forEach(p),this.h()},h(){g(e,"class","text-xs font-medium text-gray-600 dark:text-gray-400 line-clamp-1")},m(s,a){U(s,e,a),E(e,n)},p(s,a){var l,c;a[0]&8192&&t!==(t=(((c=(l=s[39].model.ollama)==null?void 0:l.details)==null?void 0:c.parameter_size)??"")+"")&&Pe(n,t)},d(s){s&&p(e)}}}function Iw(o){let e,t;return e=new qt({props:{content:"External",$$slots:{default:[Sw]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function Tw(o){let e,t;return e=new qt({props:{content:"Direct",$$slots:{default:[Aw]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function Sw(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-3"><path fill-rule="evenodd" d="M8.914 6.025a.75.75 0 0 1 1.06 0 3.5 3.5 0 0 1 0 4.95l-2 2a3.5 3.5 0 0 1-5.396-4.402.75.75 0 0 1 1.251.827 2 2 0 0 0 3.085 2.514l2-2a2 2 0 0 0 0-2.828.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"></path><path fill-rule="evenodd" d="M7.086 9.975a.75.75 0 0 1-1.06 0 3.5 3.5 0 0 1 0-4.95l2-2a3.5 3.5 0 0 1 5.396 4.402.75.75 0 0 1-1.251-.827 2 2 0 0 0-3.085-2.514l-2 2a2 2 0 0 0 0 2.828.75.75 0 0 1 0 1.06Z" clip-rule="evenodd"></path></svg>';return{c(){e=M("div"),e.innerHTML=t,this.h()},l(n){e=O(n,"DIV",{class:!0,"data-svelte-h":!0}),yt(e)!=="svelte-n3uai6"&&(e.innerHTML=t),this.h()},h(){g(e,"class","translate-y-[1px]")},m(n,r){U(n,e,r)},p:Le,d(n){n&&p(e)}}}function Aw(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-3"><path fill-rule="evenodd" d="M2 2.75A.75.75 0 0 1 2.75 2C8.963 2 14 7.037 14 13.25a.75.75 0 0 1-1.5 0c0-5.385-4.365-9.75-9.75-9.75A.75.75 0 0 1 2 2.75Zm0 4.5a.75.75 0 0 1 .75-.75 6.75 6.75 0 0 1 6.75 6.75.75.75 0 0 1-1.5 0C8 10.35 5.65 8 2.75 8A.75.75 0 0 1 2 7.25ZM3.5 11a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z" clip-rule="evenodd"></path></svg>';return{c(){e=M("div"),e.innerHTML=t,this.h()},l(n){e=O(n,"DIV",{class:!0,"data-svelte-h":!0}),yt(e)!=="svelte-1dup7go"&&(e.innerHTML=t),this.h()},h(){g(e,"class","translate-y-[1px]")},m(n,r){U(n,e,r)},p:Le,d(n){n&&p(e)}}}function Wu(o){var n,r,i;let e,t;return e=new qt({props:{content:`${jr.parse(Yr((i=(r=(n=o[39].model)==null?void 0:n.info)==null?void 0:r.meta)==null?void 0:i.description).replaceAll(`
`,"<br>"))}`,$$slots:{default:[Rw]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){re(e,s,a),t=!0},p(s,a){var c,u,d;const l={};a[0]&8192&&(l.content=`${jr.parse(Yr((d=(u=(c=s[39].model)==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.description).replaceAll(`
`,"<br>"))}`),a[1]&1&&(l.$$scope={dirty:a,ctx:s}),e.$set(l)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){ie(e,s)}}}function Rw(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg>';return{c(){e=M("div"),e.innerHTML=t,this.h()},l(n){e=O(n,"DIV",{class:!0,"data-svelte-h":!0}),yt(e)!=="svelte-1mqbvzr"&&(e.innerHTML=t),this.h()},h(){g(e,"class","translate-y-[1px]")},m(n,r){U(n,e,r)},p:Le,d(n){n&&p(e)}}}function qu(o){var s,a;let e,t,n=Ct((a=(s=o[39].model)==null?void 0:s.info)==null?void 0:a.meta.tags),r=[];for(let l=0;l<n.length;l+=1)r[l]=Yu(Uu(o,n,l));const i=l=>N(r[l],1,1,()=>{r[l]=null});return{c(){e=M("div");for(let l=0;l<r.length;l+=1)r[l].c();this.h()},l(l){e=O(l,"DIV",{class:!0});var c=A(e);for(let u=0;u<r.length;u+=1)r[u].l(c);c.forEach(p),this.h()},h(){g(e,"class","flex gap-0.5 self-center items-center h-full translate-y-[0.5px] overflow-x-auto scrollbar-none")},m(l,c){U(l,e,c);for(let u=0;u<r.length;u+=1)r[u]&&r[u].m(e,null);t=!0},p(l,c){var u,d;if(c[0]&8192){n=Ct((d=(u=l[39].model)==null?void 0:u.info)==null?void 0:d.meta.tags);let f;for(f=0;f<n.length;f+=1){const h=Uu(l,n,f);r[f]?(r[f].p(h,c),T(r[f],1)):(r[f]=Yu(h),r[f].c(),T(r[f],1),r[f].m(e,null))}for(De(),f=n.length;f<r.length;f+=1)i(f);He()}},i(l){if(!t){for(let c=0;c<n.length;c+=1)T(r[c]);t=!0}},o(l){r=r.filter(Boolean);for(let c=0;c<r.length;c+=1)N(r[c]);t=!1},d(l){l&&p(e),Fn(r,l)}}}function Mw(o){let e,t=o[42].name+"",n,r;return{c(){e=M("div"),n=Ie(t),r=$(),this.h()},l(i){e=O(i,"DIV",{class:!0});var s=A(e);n=Te(s,t),s.forEach(p),r=ee(i),this.h()},h(){g(e,"class","text-xs font-bold px-1 rounded-sm uppercase bg-gray-500/20 text-gray-700 dark:text-gray-200")},m(i,s){U(i,e,s),E(e,n),U(i,r,s)},p(i,s){s[0]&8192&&t!==(t=i[42].name+"")&&Pe(n,t)},d(i){i&&(p(e),p(r))}}}function Yu(o){let e,t;return e=new qt({props:{content:o[42].name,className:"flex-shrink-0",$$slots:{default:[Mw]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&8192&&(i.content=n[42].name),r[0]&8192|r[1]&1&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function ju(o){let e,t,n;return t=new $p({}),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);ae(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"class","ml-auto pl-2 pr-2 md:pr-0")},m(r,i){U(r,e,i),re(t,e,null),n=!0},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){N(t.$$.fragment,r),n=!1},d(r){r&&p(e),ie(t)}}}function Qu(o){var P,V,L,q,Z,Q,Y,te,F,j,x,J,ve,le,me;let e,t,n,r,i,s,a,l,c,u,d,f,h,_,b,v,m,y,w,I,S=o[16]&&(((q=(L=(V=(P=o[39])==null?void 0:P.model)==null?void 0:V.info)==null?void 0:L.meta)==null?void 0:q.tags)??[]).length>0&&Fu(o);l=new qt({props:{content:((Z=o[17])==null?void 0:Z.role)==="admin"?((Q=o[39])==null?void 0:Q.value)??"":"",placement:"top-start",$$slots:{default:[Cw]},$$scope:{ctx:o}}});let k=o[39].model.owned_by==="ollama"&&(((te=(Y=o[39].model.ollama)==null?void 0:Y.details)==null?void 0:te.parameter_size)??"")!==""&&Gu(o);const C=[Tw,Iw],R=[];function D(X,ue){var be;return(be=X[39].model)!=null&&be.direct?0:X[39].model.owned_by==="openai"?1:-1}~(d=D(o))&&(f=R[d]=C[d](o));let H=((x=(j=(F=o[39].model)==null?void 0:F.info)==null?void 0:j.meta)==null?void 0:x.description)&&Wu(o),z=!o[16]&&(((me=(le=(ve=(J=o[39])==null?void 0:J.model)==null?void 0:ve.info)==null?void 0:le.meta)==null?void 0:me.tags)??[]).length>0&&qu(o),W=o[0]===o[39].value&&ju();function K(){return o[25](o[39],o[41])}return{c(){e=M("button"),t=M("div"),S&&S.c(),n=$(),r=M("div"),i=M("div"),s=M("div"),a=M("div"),oe(l.$$.fragment),c=$(),k&&k.c(),u=$(),f&&f.c(),h=$(),H&&H.c(),_=$(),z&&z.c(),b=$(),W&&W.c(),this.h()},l(X){e=O(X,"BUTTON",{"aria-label":!0,class:!0,"data-arrow-selected":!0});var ue=A(e);t=O(ue,"DIV",{class:!0});var be=A(t);S&&S.l(be),n=ee(be),r=O(be,"DIV",{class:!0});var Re=A(r);i=O(Re,"DIV",{class:!0});var Fe=A(i);s=O(Fe,"DIV",{class:!0});var he=A(s);a=O(he,"DIV",{class:!0});var et=A(a);ae(l.$$.fragment,et),et.forEach(p),he.forEach(p),c=ee(Fe),k&&k.l(Fe),Fe.forEach(p),u=ee(Re),f&&f.l(Re),h=ee(Re),H&&H.l(Re),_=ee(Re),z&&z.l(Re),Re.forEach(p),be.forEach(p),b=ee(ue),W&&W.l(ue),ue.forEach(p),this.h()},h(){g(a,"class","flex items-center min-w-fit"),g(s,"class","line-clamp-1"),g(i,"class","flex items-center min-w-fit"),g(r,"class","flex items-center gap-2"),g(t,"class","flex flex-col"),g(e,"aria-label","model-item"),g(e,"class",v="flex w-full text-left font-medium line-clamp-1 select-none items-center rounded-button py-2 pl-3 pr-1.5 text-sm text-gray-700 dark:text-gray-100 outline-hidden transition-all duration-75 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg cursor-pointer data-highlighted:bg-muted "+(o[41]===o[12]?"bg-gray-100 dark:bg-gray-800 group-hover:bg-transparent":"")),g(e,"data-arrow-selected",m=o[41]===o[12])},m(X,ue){U(X,e,ue),E(e,t),S&&S.m(t,null),E(t,n),E(t,r),E(r,i),E(i,s),E(s,a),re(l,a,null),E(i,c),k&&k.m(i,null),E(r,u),~d&&R[d].m(r,null),E(r,h),H&&H.m(r,null),E(r,_),z&&z.m(r,null),E(e,b),W&&W.m(e,null),y=!0,w||(I=we(e,"click",K),w=!0)},p(X,ue){var Fe,he,et,ot,Et,Dt,Yt,Pt,Zt,jt,Ht,Qt,se,Qe,rt;o=X,o[16]&&(((ot=(et=(he=(Fe=o[39])==null?void 0:Fe.model)==null?void 0:he.info)==null?void 0:et.meta)==null?void 0:ot.tags)??[]).length>0?S?S.p(o,ue):(S=Fu(o),S.c(),S.m(t,n)):S&&(S.d(1),S=null);const be={};ue[0]&139264&&(be.content=((Et=o[17])==null?void 0:Et.role)==="admin"?((Dt=o[39])==null?void 0:Dt.value)??"":""),ue[0]&8192|ue[1]&1&&(be.$$scope={dirty:ue,ctx:o}),l.$set(be),o[39].model.owned_by==="ollama"&&(((Pt=(Yt=o[39].model.ollama)==null?void 0:Yt.details)==null?void 0:Pt.parameter_size)??"")!==""?k?(k.p(o,ue),ue[0]&8192&&T(k,1)):(k=Gu(o),k.c(),T(k,1),k.m(i,null)):k&&(De(),N(k,1,1,()=>{k=null}),He());let Re=d;d=D(o),d!==Re&&(f&&(De(),N(R[Re],1,1,()=>{R[Re]=null}),He()),~d?(f=R[d],f||(f=R[d]=C[d](o),f.c()),T(f,1),f.m(r,h)):f=null),(Ht=(jt=(Zt=o[39].model)==null?void 0:Zt.info)==null?void 0:jt.meta)!=null&&Ht.description?H?(H.p(o,ue),ue[0]&8192&&T(H,1)):(H=Wu(o),H.c(),T(H,1),H.m(r,_)):H&&(De(),N(H,1,1,()=>{H=null}),He()),!o[16]&&(((rt=(Qe=(se=(Qt=o[39])==null?void 0:Qt.model)==null?void 0:se.info)==null?void 0:Qe.meta)==null?void 0:rt.tags)??[]).length>0?z?(z.p(o,ue),ue[0]&73728&&T(z,1)):(z=qu(o),z.c(),T(z,1),z.m(r,null)):z&&(De(),N(z,1,1,()=>{z=null}),He()),o[0]===o[39].value?W?ue[0]&8193&&T(W,1):(W=ju(),W.c(),T(W,1),W.m(e,null)):W&&(De(),N(W,1,1,()=>{W=null}),He()),(!y||ue[0]&4096&&v!==(v="flex w-full text-left font-medium line-clamp-1 select-none items-center rounded-button py-2 pl-3 pr-1.5 text-sm text-gray-700 dark:text-gray-100 outline-hidden transition-all duration-75 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg cursor-pointer data-highlighted:bg-muted "+(o[41]===o[12]?"bg-gray-100 dark:bg-gray-800 group-hover:bg-transparent":"")))&&g(e,"class",v),(!y||ue[0]&4096&&m!==(m=o[41]===o[12]))&&g(e,"data-arrow-selected",m)},i(X){y||(T(l.$$.fragment,X),T(k),T(f),T(H),T(z),T(W),y=!0)},o(X){N(l.$$.fragment,X),N(k),N(f),N(H),N(z),N(W),y=!1},d(X){X&&p(e),S&&S.d(),ie(l),k&&k.d(),~d&&R[d].d(),H&&H.d(),z&&z.d(),W&&W.d(),w=!1,I()}}}function Xu(o){let e,t;return e=new qt({props:{content:o[15].t('Pull "{{searchValue}}" from Ollama.com',{searchValue:o[6]}),placement:"top-start",$$slots:{default:[Ow]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&32832&&(i.content=n[15].t('Pull "{{searchValue}}" from Ollama.com',{searchValue:n[6]})),r[0]&32832|r[1]&1&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function Ow(o){let e,t,n=o[15].t('Pull "{{searchValue}}" from Ollama.com',{searchValue:o[6]})+"",r,i,s;return{c(){e=M("button"),t=M("div"),r=Ie(n),this.h()},l(a){e=O(a,"BUTTON",{class:!0});var l=A(e);t=O(l,"DIV",{class:!0});var c=A(t);r=Te(c,n),c.forEach(p),l.forEach(p),this.h()},h(){g(t,"class","truncate"),g(e,"class","flex w-full font-medium line-clamp-1 select-none items-center rounded-button py-2 pl-3 pr-1.5 text-sm text-gray-700 dark:text-gray-100 outline-hidden transition-all duration-75 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg cursor-pointer data-highlighted:bg-muted")},m(a,l){U(a,e,l),E(e,t),E(t,r),i||(s=we(e,"click",o[26]),i=!0)},p(a,l){l[0]&32832&&n!==(n=a[15].t('Pull "{{searchValue}}" from Ollama.com',{searchValue:a[6]})+"")&&Pe(r,n)},d(a){a&&p(e),i=!1,s()}}}function Ju(o){let e,t=o[14][o[36]].digest+"",n;return{c(){e=M("div"),n=Ie(t),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);n=Te(i,t),i.forEach(p),this.h()},h(){g(e,"class","-mt-1 h-fit text-[0.7rem] dark:text-gray-500 line-clamp-1")},m(r,i){U(r,e,i),E(e,n)},p(r,i){i[0]&16384&&t!==(t=r[14][r[36]].digest+"")&&Pe(n,t)},d(r){r&&p(e)}}}function Pw(o){let e,t='<svg class="w-4 h-4 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"></path></svg>',n,r;function i(){return o[27](o[36])}return{c(){e=M("button"),e.innerHTML=t,this.h()},l(s){e=O(s,"BUTTON",{class:!0,"data-svelte-h":!0}),yt(e)!=="svelte-19bzgft"&&(e.innerHTML=t),this.h()},h(){g(e,"class","text-gray-800 dark:text-gray-100")},m(s,a){U(s,e,a),n||(r=we(e,"click",i),n=!0)},p(s,a){o=s},d(s){s&&p(e),n=!1,r()}}}function Zu(o){let e,t,n,r=`<svg class="size-4" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><style>.spinner_ajPY {
											transform-origin: center;
											animation: spinner_AtaB 0.75s infinite linear;
										}
										@keyframes spinner_AtaB {
											100% {
												transform: rotate(360deg);
											}
										}
									</style><path d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"></path><path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" class="spinner_ajPY"></path></svg>`,i,s,a,l,c,u=o[36]+"",d,f,h,_,b="pullProgress"in o[14][o[36]]?`(${o[14][o[36]].pullProgress}%)`:"",v,m,y,w,I,S,k,C="digest"in o[14][o[36]]&&o[14][o[36]].digest&&Ju(o);return I=new qt({props:{content:o[15].t("Cancel"),$$slots:{default:[Pw]},$$scope:{ctx:o}}}),{c(){e=M("div"),t=M("div"),n=M("div"),n.innerHTML=r,i=$(),s=M("div"),a=M("div"),l=M("div"),c=Ie('Downloading "'),d=Ie(u),f=Ie('"'),h=$(),_=M("div"),v=Ie(b),m=$(),C&&C.c(),y=$(),w=M("div"),oe(I.$$.fragment),S=$(),this.h()},l(R){e=O(R,"DIV",{class:!0});var D=A(e);t=O(D,"DIV",{class:!0});var H=A(t);n=O(H,"DIV",{class:!0,"data-svelte-h":!0}),yt(n)!=="svelte-102rp4j"&&(n.innerHTML=r),i=ee(H),s=O(H,"DIV",{class:!0});var z=A(s);a=O(z,"DIV",{class:!0});var W=A(a);l=O(W,"DIV",{class:!0});var K=A(l);c=Te(K,'Downloading "'),d=Te(K,u),f=Te(K,'"'),K.forEach(p),h=ee(W),_=O(W,"DIV",{class:!0});var P=A(_);v=Te(P,b),P.forEach(p),W.forEach(p),m=ee(z),C&&C.l(z),z.forEach(p),H.forEach(p),y=ee(D),w=O(D,"DIV",{class:!0});var V=A(w);ae(I.$$.fragment,V),V.forEach(p),S=ee(D),D.forEach(p),this.h()},h(){g(n,"class","-ml-2 mr-2.5 translate-y-0.5"),g(l,"class","line-clamp-1"),g(_,"class","shrink-0"),g(a,"class","flex gap-1"),g(s,"class","flex flex-col self-start"),g(t,"class","flex"),g(w,"class","mr-2 ml-1 translate-y-0.5"),g(e,"class","flex w-full justify-between font-medium select-none rounded-button py-2 pl-3 pr-1.5 text-sm text-gray-700 dark:text-gray-100 outline-hidden transition-all duration-75 rounded-lg cursor-pointer data-highlighted:bg-muted")},m(R,D){U(R,e,D),E(e,t),E(t,n),E(t,i),E(t,s),E(s,a),E(a,l),E(l,c),E(l,d),E(l,f),E(a,h),E(a,_),E(_,v),E(s,m),C&&C.m(s,null),E(e,y),E(e,w),re(I,w,null),E(e,S),k=!0},p(R,D){(!k||D[0]&16384)&&u!==(u=R[36]+"")&&Pe(d,u),(!k||D[0]&16384)&&b!==(b="pullProgress"in R[14][R[36]]?`(${R[14][R[36]].pullProgress}%)`:"")&&Pe(v,b),"digest"in R[14][R[36]]&&R[14][R[36]].digest?C?C.p(R,D):(C=Ju(R),C.c(),C.m(s,null)):C&&(C.d(1),C=null);const H={};D[0]&32768&&(H.content=R[15].t("Cancel")),D[0]&16384|D[1]&1&&(H.$$scope={dirty:D,ctx:R}),I.$set(H)},i(R){k||(T(I.$$.fragment,R),k=!0)},o(R){N(I.$$.fragment,R),k=!1},d(R){R&&p(e),C&&C.d(),ie(I)}}}function xu(o){let e,t,n,r,i,s,a,l=o[15].t("Temporary Chat")+"",c,u,d,f,h,_,b;return s=new o_({props:{className:"size-4",strokeWidth:"2.5"}}),f=new Hf({props:{state:o[18]}}),{c(){e=M("hr"),t=$(),n=M("div"),r=M("button"),i=M("div"),oe(s.$$.fragment),a=$(),c=Ie(l),u=$(),d=M("div"),oe(f.$$.fragment),this.h()},l(v){e=O(v,"HR",{class:!0}),t=ee(v),n=O(v,"DIV",{class:!0});var m=A(n);r=O(m,"BUTTON",{class:!0});var y=A(r);i=O(y,"DIV",{class:!0});var w=A(i);ae(s.$$.fragment,w),a=ee(w),c=Te(w,l),w.forEach(p),u=ee(y),d=O(y,"DIV",{});var I=A(d);ae(f.$$.fragment,I),I.forEach(p),y.forEach(p),m.forEach(p),this.h()},h(){g(e,"class","border-gray-100 dark:border-gray-800"),g(i,"class","flex gap-2.5 items-center"),g(r,"class","flex justify-between w-full font-medium line-clamp-1 select-none items-center rounded-button py-2 px-3 text-sm text-gray-700 dark:text-gray-100 outline-hidden transition-all duration-75 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg cursor-pointer data-highlighted:bg-muted"),g(n,"class","flex items-center mx-2 my-2")},m(v,m){U(v,e,m),U(v,t,m),U(v,n,m),E(n,r),E(r,i),re(s,i,null),E(i,a),E(i,c),E(r,u),E(r,d),re(f,d,null),h=!0,_||(b=we(r,"click",o[28]),_=!0)},p(v,m){(!h||m[0]&32768)&&l!==(l=v[15].t("Temporary Chat")+"")&&Pe(c,l);const y={};m[0]&262144&&(y.state=v[18]),f.$set(y)},i(v){h||(T(s.$$.fragment,v),T(f.$$.fragment,v),h=!0)},o(v){N(s.$$.fragment,v),N(f.$$.fragment,v),h=!1},d(v){v&&(p(e),p(t),p(n)),ie(s),ie(f),_=!1,b()}}}function Nw(o){let e,t,n,r=!(o[6].trim()in o[14])&&o[6]&&o[11]&&o[17].role==="admin",i,s,a,l,c,u,d,f=o[9]&&zu(o),h=Ct(o[13]),_=[];for(let k=0;k<h.length;k+=1)_[k]=Qu(Lu(o,h,k));const b=k=>N(_[k],1,1,()=>{_[k]=null});let v=null;h.length||(v=Vu(o));let m=r&&Xu(o),y=Ct(Object.keys(o[14])),w=[];for(let k=0;k<y.length;k+=1)w[k]=Zu(Hu(o,y,k));const I=k=>N(w[k],1,1,()=>{w[k]=null});let S=o[3]&&xu(o);return{c(){e=M("div"),f&&f.c(),t=$();for(let k=0;k<_.length;k+=1)_[k].c();v&&v.c(),n=$(),m&&m.c(),i=$();for(let k=0;k<w.length;k+=1)w[k].c();s=$(),S&&S.c(),a=$(),l=M("div"),c=$(),u=M("div"),this.h()},l(k){e=O(k,"DIV",{class:!0});var C=A(e);f&&f.l(C),t=ee(C);for(let R=0;R<_.length;R+=1)_[R].l(C);v&&v.l(C),n=ee(C),m&&m.l(C),i=ee(C);for(let R=0;R<w.length;R+=1)w[R].l(C);C.forEach(p),s=ee(k),S&&S.l(k),a=ee(k),l=O(k,"DIV",{class:!0}),A(l).forEach(p),c=ee(k),u=O(k,"DIV",{class:!0}),A(u).forEach(p),this.h()},h(){g(e,"class","px-3 mb-2 max-h-64 overflow-y-auto scrollbar-hidden group relative"),g(l,"class","hidden w-[42rem]"),g(u,"class","hidden w-[32rem]")},m(k,C){U(k,e,C),f&&f.m(e,null),E(e,t);for(let R=0;R<_.length;R+=1)_[R]&&_[R].m(e,null);v&&v.m(e,null),E(e,n),m&&m.m(e,null),E(e,i);for(let R=0;R<w.length;R+=1)w[R]&&w[R].m(e,null);U(k,s,C),S&&S.m(k,C),U(k,a,C),U(k,l,C),U(k,c,C),U(k,u,C),d=!0},p(k,C){if(k[9]?f?f.p(k,C):(f=zu(k),f.c(),f.m(e,t)):f&&(f.d(1),f=null),C[0]&241921){h=Ct(k[13]);let R;for(R=0;R<h.length;R+=1){const D=Lu(k,h,R);_[R]?(_[R].p(D,C),T(_[R],1)):(_[R]=Qu(D),_[R].c(),T(_[R],1),_[R].m(e,n))}for(De(),R=h.length;R<_.length;R+=1)b(R);He(),!h.length&&v?v.p(k,C):h.length?v&&(v.d(1),v=null):(v=Vu(k),v.c(),v.m(e,n))}if(C[0]&149568&&(r=!(k[6].trim()in k[14])&&k[6]&&k[11]&&k[17].role==="admin"),r?m?(m.p(k,C),C[0]&149568&&T(m,1)):(m=Xu(k),m.c(),T(m,1),m.m(e,i)):m&&(De(),N(m,1,1,()=>{m=null}),He()),C[0]&2146304){y=Ct(Object.keys(k[14]));let R;for(R=0;R<y.length;R+=1){const D=Hu(k,y,R);w[R]?(w[R].p(D,C),T(w[R],1)):(w[R]=Zu(D),w[R].c(),T(w[R],1),w[R].m(e,null))}for(De(),R=y.length;R<w.length;R+=1)I(R);He()}k[3]?S?(S.p(k,C),C[0]&8&&T(S,1)):(S=xu(k),S.c(),T(S,1),S.m(a.parentNode,a)):S&&(De(),N(S,1,1,()=>{S=null}),He())},i(k){if(!d){for(let C=0;C<h.length;C+=1)T(_[C]);T(m);for(let C=0;C<y.length;C+=1)T(w[C]);T(S),d=!0}},o(k){_=_.filter(Boolean);for(let C=0;C<_.length;C+=1)N(_[C]);N(m),w=w.filter(Boolean);for(let C=0;C<w.length;C+=1)N(w[C]);N(S),d=!1},d(k){k&&(p(e),p(s),p(a),p(l),p(c),p(u)),f&&f.d(),Fn(_,k),v&&v.d(),m&&m.d(),Fn(w,k),S&&S.d(k)}}}function Dw(o){let e;const t=o[23].default,n=Ft(t,o,o[31],null),r=n||Nw(o);return{c(){r&&r.c()},l(i){r&&r.l(i)},m(i,s){r&&r.m(i,s),e=!0},p(i,s){n?n.p&&(!e||s[1]&1)&&Kt(n,t,i,i[31],e?Wt(t,i[31],s,null):Gt(i[31]),null):r&&r.p&&(!e||s[0]&523209)&&r.p(i,e?s:[-1,-1])},i(i){e||(T(r,i),e=!0)},o(i){N(r,i),e=!1},d(i){r&&r.d(i)}}}function Hw(o){let e,t,n,r;return e=new Lp({props:{class:"relative w-full font-primary","aria-label":o[2],id:"model-selector-"+o[1]+"-button",$$slots:{default:[kw]},$$scope:{ctx:o}}}),n=new Ds({props:{class:" z-40 "+(o[16]?"w-full":`${o[4]}`)+" max-w-[calc(100vw-1rem)] justify-start rounded-xl  bg-white dark:bg-gray-850 dark:text-white shadow-lg  outline-hidden",transition:Oi,side:o[16]?"bottom":"bottom-start",sideOffset:3,$$slots:{default:[Dw]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment),t=$(),oe(n.$$.fragment)},l(i){ae(e.$$.fragment,i),t=ee(i),ae(n.$$.fragment,i)},m(i,s){re(e,i,s),U(i,t,s),re(n,i,s),r=!0},p(i,s){const a={};s[0]&4&&(a["aria-label"]=i[2]),s[0]&2&&(a.id="model-selector-"+i[1]+"-button"),s[0]&1060|s[1]&1&&(a.$$scope={dirty:s,ctx:i}),e.$set(a);const l={};s[0]&65552&&(l.class=" z-40 "+(i[16]?"w-full":`${i[4]}`)+" max-w-[calc(100vw-1rem)] justify-start rounded-xl  bg-white dark:bg-gray-850 dark:text-white shadow-lg  outline-hidden"),s[0]&65536&&(l.side=i[16]?"bottom":"bottom-start"),s[0]&523209|s[1]&1&&(l.$$scope={dirty:s,ctx:i}),n.$set(l)},i(i){r||(T(e.$$.fragment,i),T(n.$$.fragment,i),r=!0)},o(i){N(e.$$.fragment,i),N(n.$$.fragment,i),r=!1},d(i){i&&p(t),ie(e,i),ie(n,i)}}}function Lw(o){let e,t,n;function r(s){o[30](s)}let i={onOpenChange:o[29],closeFocus:!1,$$slots:{default:[Hw]},$$scope:{ctx:o}};return o[8]!==void 0&&(i.open=o[8]),e=new Hp({props:i}),ze.push(()=>nt(e,"open",r)),{c(){oe(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){re(e,s,a),n=!0},p(s,a){const l={};a[0]&4160&&(l.onOpenChange=s[29]),a[0]&524287|a[1]&1&&(l.$$scope={dirty:a,ctx:s}),!t&&a[0]&256&&(t=!0,l.open=s[8],tt(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){N(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function Uw(o,e,t){let n,r,i,s,a,l,c,u;fe(o,Mr,F=>t(14,r=F)),fe(o,qo,F=>t(32,s=F)),fe(o,ti,F=>t(33,a=F)),fe(o,Mi,F=>t(16,l=F)),fe(o,er,F=>t(17,c=F)),fe(o,qr,F=>t(18,u=F));let{$$slots:d={},$$scope:f}=e;const h=fn("i18n");fe(o,h,F=>t(15,i=F)),An();let{id:_=""}=e,{value:b=ye(oa)}=e,{placeholder:v=""}=e,{showTemporaryChatControl:m=!1}=e,{items:y=[]}=e,{className:w="w-[32rem]"}=e,{triggerClassName:I="text-lg"}=e,S,k=!1,C=[],R="",D="",H=null,z=0;const W=new tl(y.map(F=>{var x,J,ve,le,me,X,ue,be;return{...F,modelName:(x=F.model)==null?void 0:x.name,tags:(me=(le=(ve=(J=F.model)==null?void 0:J.info)==null?void 0:ve.meta)==null?void 0:le.tags)==null?void 0:me.map(Re=>Re.name).join(" "),desc:(be=(ue=(X=F.model)==null?void 0:X.info)==null?void 0:ue.meta)==null?void 0:be.description}}),{keys:["value","tags","modelName"],threshold:.4}),K=async()=>{var J;const F=D.trim().replace(/^ollama\s+(run|pull)\s+/,"");if(console.log(r),r[F]){$e.error(i.t("Model '{{modelTag}}' is already in queue for downloading.",{modelTag:F}));return}if(Object.keys(r).length===3){$e.error(i.t("Maximum of 3 models can be downloaded simultaneously. Please try again later."));return}const[j,x]=await t_(localStorage.token,F,"0").catch(ve=>($e.error(`${ve}`),null));if(j){const ve=j.body.pipeThrough(new TextDecoderStream).pipeThrough(Jm(`
`)).getReader();for(Mr.set({...r,[F]:{...r[F],abortController:x,reader:ve,done:!1}});;)try{const{value:le,done:me}=await ve.read();if(me)break;let X=le.split(`
`);for(const ue of X)if(ue!==""){let be=JSON.parse(ue);if(console.log(be),be.error)throw be.error;if(be.detail)throw be.detail;if(be.status)if(be.digest){let Re=0;be.completed?Re=Math.round(be.completed/be.total*1e3)/10:Re=100,Mr.set({...r,[F]:{...r[F],pullProgress:Re,digest:be.digest}})}else $e.success(be.status),Mr.set({...r,[F]:{...r[F],done:be.status==="success"}})}}catch(le){console.log(le),typeof le!="string"&&(le=le.message),$e.error(`${le}`);break}r[F].done?($e.success(i.t("Model '{{modelName}}' has been successfully downloaded.",{modelName:F})),Tr.set(await hp(localStorage.token,((J=a==null?void 0:a.features)==null?void 0:J.enable_direct_connections)&&((s==null?void 0:s.directConnections)??null)))):$e.error(i.t("Download canceled")),delete r[F],Mr.set({...r})}};Kn(async()=>{t(11,H=await e_(localStorage.token).catch(F=>!1)),y&&(t(0,b=ye(oa)),t(9,C=y.flatMap(F=>{var j,x,J;return((J=(x=(j=F.model)==null?void 0:j.info)==null?void 0:x.meta)==null?void 0:J.tags)??[]}).map(F=>F.name)),t(9,C=Array.from(new Set(C)).sort((F,j)=>F.localeCompare(j))))});const P=async F=>{const{reader:j,abortController:x}=r[F];x&&x.abort(),j&&(await j.cancel(),delete r[F],Mr.set({...r}),await n_(localStorage.token,F),$e.success(`${F} download has been canceled`))};function V(F){ze[F?"unshift":"push"](()=>{S=F,t(7,S)})}const L=(F,j)=>{t(0,b=F.value),t(12,z=j),oa.set(F.value),localStorage.setItem(Nm,F.value),t(8,k=!1)},q=()=>{K()},Z=F=>{P(F)},Q=async()=>{qr.set(!u),await rs("/");const F=document.getElementById("new-chat-button");setTimeout(()=>{F==null||F.click()},0),u?history.replaceState(null,"","?temporary-chat=true"):history.replaceState(null,"",location.pathname),t(8,k=!1)},Y=async()=>{t(6,D=""),t(12,z=0),window.setTimeout(()=>{var F;return(F=document.getElementById("model-search-input"))==null?void 0:F.focus()},0)};function te(F){k=F,t(8,k)}return o.$$set=F=>{"id"in F&&t(1,_=F.id),"value"in F&&t(0,b=F.value),"placeholder"in F&&t(2,v=F.placeholder),"showTemporaryChatControl"in F&&t(3,m=F.showTemporaryChatControl),"items"in F&&t(22,y=F.items),"className"in F&&t(4,w=F.className),"triggerClassName"in F&&t(5,I=F.triggerClassName),"$$scope"in F&&t(31,f=F.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&4194305&&t(10,R=y.find(F=>F.value===b)??""),o.$$.dirty[0]&4194368&&t(13,n=D?W.search(D).map(F=>F.item).filter(F=>!0):y.filter(F=>!0))},[b,_,v,m,w,I,D,S,k,C,R,H,z,n,r,i,l,c,u,h,K,P,y,d,V,L,q,Z,Q,Y,te,f]}class Bw extends Ge{constructor(e){super(),We(this,e,Uw,Lw,Ye,{id:1,value:0,placeholder:2,showTemporaryChatControl:3,items:22,className:4,triggerClassName:5},null,[-1,-1])}}function zw(o){let e,t,n,r,i,s,a;function l(u){o[3](u)}let c={id:"1",placeholder:o[0]||"",items:Dm.map(Vw)};return o[0]!==void 0&&(c.value=o[0]),i=new Bw({props:c}),ze.push(()=>nt(i,"value",l)),{c(){e=M("div"),t=M("div"),n=M("div"),r=M("div"),oe(i.$$.fragment),this.h()},l(u){e=O(u,"DIV",{class:!0});var d=A(e);t=O(d,"DIV",{class:!0});var f=A(t);n=O(f,"DIV",{class:!0});var h=A(n);r=O(h,"DIV",{class:!0});var _=A(r);ae(i.$$.fragment,_),_.forEach(p),h.forEach(p),f.forEach(p),d.forEach(p),this.h()},h(){g(r,"class","mr-1 max-w-full"),g(n,"class","overflow-hidden w-full"),g(t,"class","flex w-full max-w-fit"),g(e,"class","flex flex-col w-full items-start")},m(u,d){U(u,e,d),E(e,t),E(t,n),E(n,r),re(i,r,null),a=!0},p(u,[d]){const f={};d&1&&(f.placeholder=u[0]||""),!s&&d&1&&(s=!0,f.value=u[0],tt(()=>s=!1)),i.$set(f)},i(u){a||(T(i.$$.fragment,u),a=!0)},o(u){N(i.$$.fragment,u),a=!1},d(u){u&&p(e),ie(i)}}}const Vw=o=>({value:o.id,label:o.name,model:o});function Fw(o,e,t){fe(o,qo,a=>t(4,a)),fn("i18n");let{disabled:n=!1}=e,{showSetDefault:r=!0}=e,i="";function s(a){i=a,t(0,i)}return o.$$set=a=>{"disabled"in a&&t(1,n=a.disabled),"showSetDefault"in a&&t(2,r=a.showSetDefault)},[i,n,r,s]}class Kw extends Ge{constructor(e){super(),We(this,e,Fw,zw,Ye,{disabled:1,showSetDefault:2})}}function Gw(o){let e,t;return{c(){e=Me("svg"),t=Me("path"),this.h()},l(n){e=Oe(n,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=A(e);t=Oe(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){U(n,e,r),E(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Le,o:Le,d(n){n&&p(e)}}}function Ww(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="2"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}let qw=class extends Ge{constructor(e){super(),We(this,e,Ww,Gw,Ye,{className:0,strokeWidth:1})}};function Yw(o){let e,t;return{c(){e=Me("svg"),t=Me("path"),this.h()},l(n){e=Oe(n,"svg",{xmlns:!0,viewBox:!0,stroke:!0,fill:!0,class:!0,"stroke-width":!0});var r=A(e);t=Oe(r,"path",{d:!0}),A(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"d","M18.75 12.75h1.5a.75.75 0 0 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM12 6a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 6ZM12 18a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 18ZM3.75 6.75h1.5a.75.75 0 1 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM5.25 18.75h-1.5a.75.75 0 0 1 0-1.5h1.5a.75.75 0 0 1 0 1.5ZM3 12a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 3 12ZM9 3.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5ZM12.75 12a2.25 2.25 0 1 1 4.5 0 2.25 2.25 0 0 1-4.5 0ZM9 15.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 24 24"),g(e,"stroke","currentColor"),g(e,"fill","currentColor"),g(e,"class",o[0]),g(e,"stroke-width",o[1])},m(n,r){U(n,e,r),E(e,t)},p(n,[r]){r&1&&g(e,"class",n[0]),r&2&&g(e,"stroke-width",n[1])},i:Le,o:Le,d(n){n&&p(e)}}}function jw(o,e,t){let{className:n="w-4 h-4"}=e,{strokeWidth:r="1.5"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class ql extends Ge{constructor(e){super(),We(this,e,jw,Yw,Ye,{className:0,strokeWidth:1})}}function Qw(o){let e,t;return{c(){e=Me("svg"),t=Me("path"),this.h()},l(n){e=Oe(n,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=A(e);t=Oe(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){U(n,e,r),E(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Le,o:Le,d(n){n&&p(e)}}}function Xw(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="2"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class Jw extends Ge{constructor(e){super(),We(this,e,Xw,Qw,Ye,{className:0,strokeWidth:1})}}function Zw(o){let e;const t=o[13].default,n=Ft(t,o,o[23],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i&8388608)&&Kt(n,t,r,r[23],e?Wt(t,r[23],i,null):Gt(r[23]),null)},i(r){e||(T(n,r),e=!0)},o(r){N(n,r),e=!1},d(r){n&&n.d(r)}}}function $u(o){let e,t;return e=new co({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-controls-button",$$slots:{default:[xw]},$$scope:{ctx:o}}}),e.$on("click",o[14]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&8388640&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function xw(o){let e,t,n,r=o[5].t("Controls")+"",i,s;return e=new ql({props:{className:" size-4",strokeWidth:"0.5"}}),{c(){oe(e.$$.fragment),t=$(),n=M("div"),i=Ie(r),this.h()},l(a){ae(e.$$.fragment,a),t=ee(a),n=O(a,"DIV",{class:!0});var l=A(n);i=Te(l,r),l.forEach(p),this.h()},h(){g(n,"class","flex items-center")},m(a,l){re(e,a,l),U(a,t,l),U(a,n,l),E(n,i),s=!0},p(a,l){(!s||l&32)&&r!==(r=a[5].t("Controls")+"")&&Pe(i,r)},i(a){s||(T(e.$$.fragment,a),s=!0)},o(a){N(e.$$.fragment,a),s=!1},d(a){a&&(p(t),p(n)),ie(e,a)}}}function ed(o){let e,t;return e=new co({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-share-button",$$slots:{default:[$w]},$$scope:{ctx:o}}}),e.$on("click",o[15]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&8388640&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function $w(o){let e,t,n,r,i=o[5].t("Share")+"",s;return{c(){e=Me("svg"),t=Me("path"),n=$(),r=M("div"),s=Ie(i),this.h()},l(a){e=Oe(a,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var l=A(e);t=Oe(l,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),A(t).forEach(p),l.forEach(p),n=ee(a),r=O(a,"DIV",{class:!0});var c=A(r);s=Te(c,i),c.forEach(p),this.h()},h(){g(t,"fill-rule","evenodd"),g(t,"d","M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z"),g(t,"clip-rule","evenodd"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 24 24"),g(e,"fill","currentColor"),g(e,"class","size-4"),g(r,"class","flex items-center")},m(a,l){U(a,e,l),E(e,t),U(a,n,l),U(a,r,l),E(r,s)},p(a,l){l&32&&i!==(i=a[5].t("Share")+"")&&Pe(s,i)},d(a){a&&(p(e),p(n),p(r))}}}function ek(o){let e,t,n,r=o[5].t("Overview")+"",i,s;return e=new qw({props:{className:" size-4",strokeWidth:"1.5"}}),{c(){oe(e.$$.fragment),t=$(),n=M("div"),i=Ie(r),this.h()},l(a){ae(e.$$.fragment,a),t=ee(a),n=O(a,"DIV",{class:!0});var l=A(n);i=Te(l,r),l.forEach(p),this.h()},h(){g(n,"class","flex items-center")},m(a,l){re(e,a,l),U(a,t,l),U(a,n,l),E(n,i),s=!0},p(a,l){(!s||l&32)&&r!==(r=a[5].t("Overview")+"")&&Pe(i,r)},i(a){s||(T(e.$$.fragment,a),s=!0)},o(a){N(e.$$.fragment,a),s=!1},d(a){a&&(p(t),p(n)),ie(e,a)}}}function tk(o){let e,t,n,r=o[5].t("Artifacts")+"",i,s;return e=new Jw({props:{className:" size-4",strokeWidth:"1.5"}}),{c(){oe(e.$$.fragment),t=$(),n=M("div"),i=Ie(r),this.h()},l(a){ae(e.$$.fragment,a),t=ee(a),n=O(a,"DIV",{class:!0});var l=A(n);i=Te(l,r),l.forEach(p),this.h()},h(){g(n,"class","flex items-center")},m(a,l){re(e,a,l),U(a,t,l),U(a,n,l),E(n,i),s=!0},p(a,l){(!s||l&32)&&r!==(r=a[5].t("Artifacts")+"")&&Pe(i,r)},i(a){s||(T(e.$$.fragment,a),s=!0)},o(a){N(e.$$.fragment,a),s=!1},d(a){a&&(p(t),p(n)),ie(e,a)}}}function nk(o){let e,t,n,r,i=o[5].t("Download")+"",s;return{c(){e=Me("svg"),t=Me("path"),n=$(),r=M("div"),s=Ie(i),this.h()},l(a){e=Oe(a,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var l=A(e);t=Oe(l,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(t).forEach(p),l.forEach(p),n=ee(a),r=O(a,"DIV",{class:!0});var c=A(r);s=Te(c,i),c.forEach(p),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width","1.5"),g(e,"stroke","currentColor"),g(e,"class","size-4"),g(r,"class","flex items-center")},m(a,l){U(a,e,l),E(e,t),U(a,n,l),U(a,r,l),E(r,s)},p(a,l){l&32&&i!==(i=a[5].t("Download")+"")&&Pe(s,i)},d(a){a&&(p(e),p(n),p(r))}}}function ok(o){let e,t=o[5].t("Export chat (.json)")+"",n;return{c(){e=M("div"),n=Ie(t),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);n=Te(i,t),i.forEach(p),this.h()},h(){g(e,"class","flex items-center line-clamp-1")},m(r,i){U(r,e,i),E(e,n)},p(r,i){i&32&&t!==(t=r[5].t("Export chat (.json)")+"")&&Pe(n,t)},d(r){r&&p(e)}}}function rk(o){let e,t=o[5].t("Plain text (.txt)")+"",n;return{c(){e=M("div"),n=Ie(t),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);n=Te(i,t),i.forEach(p),this.h()},h(){g(e,"class","flex items-center line-clamp-1")},m(r,i){U(r,e,i),E(e,n)},p(r,i){i&32&&t!==(t=r[5].t("Plain text (.txt)")+"")&&Pe(n,t)},d(r){r&&p(e)}}}function ik(o){let e,t=o[5].t("PDF document (.pdf)")+"",n;return{c(){e=M("div"),n=Ie(t),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);n=Te(i,t),i.forEach(p),this.h()},h(){g(e,"class","flex items-center line-clamp-1")},m(r,i){U(r,e,i),E(e,n)},p(r,i){i&32&&t!==(t=r[5].t("PDF document (.pdf)")+"")&&Pe(n,t)},d(r){r&&p(e)}}}function sk(o){let e,t,n,r,i,s;return e=new co({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[ok]},$$scope:{ctx:o}}}),e.$on("click",o[18]),n=new co({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[rk]},$$scope:{ctx:o}}}),n.$on("click",o[19]),i=new co({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[ik]},$$scope:{ctx:o}}}),i.$on("click",o[20]),{c(){oe(e.$$.fragment),t=$(),oe(n.$$.fragment),r=$(),oe(i.$$.fragment)},l(a){ae(e.$$.fragment,a),t=ee(a),ae(n.$$.fragment,a),r=ee(a),ae(i.$$.fragment,a)},m(a,l){re(e,a,l),U(a,t,l),re(n,a,l),U(a,r,l),re(i,a,l),s=!0},p(a,l){const c={};l&8388640&&(c.$$scope={dirty:l,ctx:a}),e.$set(c);const u={};l&8388640&&(u.$$scope={dirty:l,ctx:a}),n.$set(u);const d={};l&8388640&&(d.$$scope={dirty:l,ctx:a}),i.$set(d)},i(a){s||(T(e.$$.fragment,a),T(n.$$.fragment,a),T(i.$$.fragment,a),s=!0)},o(a){N(e.$$.fragment,a),N(n.$$.fragment,a),N(i.$$.fragment,a),s=!1},d(a){a&&(p(t),p(r)),ie(e,a),ie(n,a),ie(i,a)}}}function ak(o){let e,t,n,r;return e=new l1({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[nk]},$$scope:{ctx:o}}}),n=new t1({props:{class:"w-full rounded-xl px-1 py-1.5 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",transition:Oi,sideOffset:8,$$slots:{default:[sk]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment),t=$(),oe(n.$$.fragment)},l(i){ae(e.$$.fragment,i),t=ee(i),ae(n.$$.fragment,i)},m(i,s){re(e,i,s),U(i,t,s),re(n,i,s),r=!0},p(i,s){const a={};s&8388640&&(a.$$scope={dirty:s,ctx:i}),e.$set(a);const l={};s&8388640&&(l.$$scope={dirty:s,ctx:i}),n.$set(l)},i(i){r||(T(e.$$.fragment,i),T(n.$$.fragment,i),r=!0)},o(i){N(e.$$.fragment,i),N(n.$$.fragment,i),r=!1},d(i){i&&p(t),ie(e,i),ie(n,i)}}}function lk(o){let e,t,n,r=o[5].t("Copy")+"",i,s;return e=new Wp({props:{className:" size-4",strokeWidth:"1.5"}}),{c(){oe(e.$$.fragment),t=$(),n=M("div"),i=Ie(r),this.h()},l(a){ae(e.$$.fragment,a),t=ee(a),n=O(a,"DIV",{class:!0});var l=A(n);i=Te(l,r),l.forEach(p),this.h()},h(){g(n,"class","flex items-center")},m(a,l){re(e,a,l),U(a,t,l),U(a,n,l),E(n,i),s=!0},p(a,l){(!s||l&32)&&r!==(r=a[5].t("Copy")+"")&&Pe(i,r)},i(a){s||(T(e.$$.fragment,a),s=!0)},o(a){N(e.$$.fragment,a),s=!1},d(a){a&&(p(t),p(n)),ie(e,a)}}}function td(o){let e,t,n,r,i;return r=new d1({props:{chatId:o[1].id}}),{c(){e=M("hr"),t=$(),n=M("div"),oe(r.$$.fragment),this.h()},l(s){e=O(s,"HR",{class:!0}),t=ee(s),n=O(s,"DIV",{class:!0});var a=A(n);ae(r.$$.fragment,a),a.forEach(p),this.h()},h(){g(e,"class","border-gray-100 dark:border-gray-850 my-0.5"),g(n,"class","flex p-1")},m(s,a){U(s,e,a),U(s,t,a),U(s,n,a),re(r,n,null),i=!0},p(s,a){const l={};a&2&&(l.chatId=s[1].id),r.$set(l)},i(s){i||(T(r.$$.fragment,s),i=!0)},o(s){N(r.$$.fragment,s),i=!1},d(s){s&&(p(e),p(t),p(n)),ie(r)}}}function ck(o){let e,t,n,r,i,s,a,l,c,u,d,f,h=o[4]&&$u(o),_=!o[3]&&ed(o);n=new co({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-overview-button",$$slots:{default:[ek]},$$scope:{ctx:o}}}),n.$on("click",o[16]),i=new co({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-overview-button",$$slots:{default:[tk]},$$scope:{ctx:o}}}),i.$on("click",o[17]),a=new V_({props:{$$slots:{default:[ak]},$$scope:{ctx:o}}}),c=new co({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-copy-button",$$slots:{default:[lk]},$$scope:{ctx:o}}}),c.$on("click",o[21]);let b=!o[3]&&td(o);return{c(){h&&h.c(),e=$(),_&&_.c(),t=$(),oe(n.$$.fragment),r=$(),oe(i.$$.fragment),s=$(),oe(a.$$.fragment),l=$(),oe(c.$$.fragment),u=$(),b&&b.c(),d=qe()},l(v){h&&h.l(v),e=ee(v),_&&_.l(v),t=ee(v),ae(n.$$.fragment,v),r=ee(v),ae(i.$$.fragment,v),s=ee(v),ae(a.$$.fragment,v),l=ee(v),ae(c.$$.fragment,v),u=ee(v),b&&b.l(v),d=qe()},m(v,m){h&&h.m(v,m),U(v,e,m),_&&_.m(v,m),U(v,t,m),re(n,v,m),U(v,r,m),re(i,v,m),U(v,s,m),re(a,v,m),U(v,l,m),re(c,v,m),U(v,u,m),b&&b.m(v,m),U(v,d,m),f=!0},p(v,m){v[4]?h?(h.p(v,m),m&16&&T(h,1)):(h=$u(v),h.c(),T(h,1),h.m(e.parentNode,e)):h&&(De(),N(h,1,1,()=>{h=null}),He()),v[3]?_&&(De(),N(_,1,1,()=>{_=null}),He()):_?(_.p(v,m),m&8&&T(_,1)):(_=ed(v),_.c(),T(_,1),_.m(t.parentNode,t));const y={};m&8388640&&(y.$$scope={dirty:m,ctx:v}),n.$set(y);const w={};m&8388640&&(w.$$scope={dirty:m,ctx:v}),i.$set(w);const I={};m&8388640&&(I.$$scope={dirty:m,ctx:v}),a.$set(I);const S={};m&8388640&&(S.$$scope={dirty:m,ctx:v}),c.$set(S),v[3]?b&&(De(),N(b,1,1,()=>{b=null}),He()):b?(b.p(v,m),m&8&&T(b,1)):(b=td(v),b.c(),T(b,1),b.m(d.parentNode,d))},i(v){f||(T(h),T(_),T(n.$$.fragment,v),T(i.$$.fragment,v),T(a.$$.fragment,v),T(c.$$.fragment,v),T(b),f=!0)},o(v){N(h),N(_),N(n.$$.fragment,v),N(i.$$.fragment,v),N(a.$$.fragment,v),N(c.$$.fragment,v),N(b),f=!1},d(v){v&&(p(e),p(t),p(r),p(s),p(l),p(u),p(d)),h&&h.d(v),_&&_.d(v),ie(n,v),ie(i,v),ie(a,v),ie(c,v),b&&b.d(v)}}}function uk(o){let e,t,n;return t=new Ds({props:{class:"w-full max-w-[200px] rounded-xl px-1 py-1.5  z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",sideOffset:8,side:"bottom",align:"end",transition:Oi,$$slots:{default:[ck]},$$scope:{ctx:o}}}),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(r){e=O(r,"DIV",{slot:!0});var i=A(e);ae(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"slot","content")},m(r,i){U(r,e,i),re(t,e,null),n=!0},p(r,i){const s={};i&8388667&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){N(t.$$.fragment,r),n=!1},d(r){r&&p(e),ie(t)}}}function dk(o){let e,t;return e=new el({props:{$$slots:{content:[uk],default:[Zw]},$$scope:{ctx:o}}}),e.$on("change",o[22]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,[r]){const i={};r&8388667&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function fk(o,e,t){let n,r,i;fe(o,qr,W=>t(3,n=W)),fe(o,Mi,W=>t(4,r=W));let{$$slots:s={},$$scope:a}=e;const{saveAs:l}=r_,c=fn("i18n");fe(o,c,W=>t(5,i=W));let{shareEnabled:u=!1}=e,{shareHandler:d}=e,{downloadHandler:f}=e,{chat:h}=e,{onClose:_=()=>{}}=e;const b=async()=>{const W=h.chat.history;return ao(W,W.currentId).reduce((V,L,q,Z)=>`${V}### ${L.role.toUpperCase()}
${L.content}

`,"").trim()},v=async()=>{const W=await b();let K=new Blob([W],{type:"text/plain"});l(K,`chat-${h.chat.title}.txt`)},m=async()=>{const W=h.chat.history,K=ao(W,W.currentId),P=await i_(localStorage.token,h.chat.title,K),V=window.URL.createObjectURL(P),L=document.createElement("a");L.href=V,L.download=`chat-${h.chat.title}.pdf`,document.body.appendChild(L),L.click(),document.body.removeChild(L),window.URL.revokeObjectURL(V)},y=async()=>{if(h.id){let W=null;h.id==="local"||n?W=h:W=await Ea(localStorage.token,h.id);let K=new Blob([JSON.stringify([W])],{type:"application/json"});l(K,`chat-export-${Date.now()}.json`)}},w=async()=>{await dn.set(!0),await jo.set(!1),await Lo.set(!1)},I=()=>{d()},S=async()=>{await dn.set(!0),await jo.set(!0),await Lo.set(!1)},k=async()=>{await dn.set(!0),await Lo.set(!0),await jo.set(!1)},C=()=>{y()},R=()=>{v()},D=()=>{m()},H=async()=>{await Za(await b()).catch(K=>{console.error(K)})&&$e.success(i.t("Copied to clipboard"))},z=W=>{W.detail===!1&&_()};return o.$$set=W=>{"shareEnabled"in W&&t(11,u=W.shareEnabled),"shareHandler"in W&&t(0,d=W.shareHandler),"downloadHandler"in W&&t(12,f=W.downloadHandler),"chat"in W&&t(1,h=W.chat),"onClose"in W&&t(2,_=W.onClose),"$$scope"in W&&t(23,a=W.$$scope)},[d,h,_,n,r,i,c,b,v,m,y,u,f,s,w,I,S,k,C,R,D,H,z,a]}class hk extends Ge{constructor(e){super(),We(this,e,fk,dk,Ye,{shareEnabled:11,shareHandler:0,downloadHandler:12,chat:1,onClose:2})}}function gk(o){let e,t;return e=new qt({props:{content:o[13].t("Controls"),$$slots:{default:[pk]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&8192&&(i.content=n[13].t("Controls")),r&268451840&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function mk(o){let e,t;return e=new hk({props:{chat:o[4],shareEnabled:o[3],shareHandler:o[21],downloadHandler:o[22],$$slots:{default:[_k]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&16&&(i.chat=n[4]),r&8&&(i.shareEnabled=n[3]),r&64&&(i.shareHandler=n[21]),r&128&&(i.downloadHandler=n[22]),r&268435456&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function pk(o){let e,t,n,r,i,s;return n=new ql({props:{className:" size-5",strokeWidth:"0.5"}}),{c(){e=M("button"),t=M("div"),oe(n.$$.fragment),this.h()},l(a){e=O(a,"BUTTON",{class:!0,"aria-label":!0});var l=A(e);t=O(l,"DIV",{class:!0});var c=A(t);ae(n.$$.fragment,c),c.forEach(p),l.forEach(p),this.h()},h(){g(t,"class","m-auto self-center"),g(e,"class","flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(e,"aria-label","Controls")},m(a,l){U(a,e,l),E(e,t),re(n,t,null),r=!0,i||(s=we(e,"click",o[23]),i=!0)},p:Le,i(a){r||(T(n.$$.fragment,a),r=!0)},o(a){N(n.$$.fragment,a),r=!1},d(a){a&&p(e),ie(n),i=!1,s()}}}function _k(o){let e,t='<div class="m-auto self-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"></path></svg></div>';return{c(){e=M("button"),e.innerHTML=t,this.h()},l(n){e=O(n,"BUTTON",{class:!0,id:!0,"data-svelte-h":!0}),yt(e)!=="svelte-xd5mtd"&&(e.innerHTML=t),this.h()},h(){g(e,"class","flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(e,"id","chat-context-menu-button")},m(n,r){U(n,e,r)},p:Le,d(n){n&&p(e)}}}function nd(o){let e,t;return e=new qt({props:{content:o[13].t("Controls"),$$slots:{default:[bk]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&8192&&(i.content=n[13].t("Controls")),r&268451840&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function bk(o){let e,t,n,r,i,s;return n=new ql({props:{className:" size-5",strokeWidth:"0.5"}}),{c(){e=M("button"),t=M("div"),oe(n.$$.fragment),this.h()},l(a){e=O(a,"BUTTON",{class:!0,"aria-label":!0});var l=A(e);t=O(l,"DIV",{class:!0});var c=A(t);ae(n.$$.fragment,c),c.forEach(p),l.forEach(p),this.h()},h(){g(t,"class","m-auto self-center"),g(e,"class","flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(e,"aria-label","Controls")},m(a,l){U(a,e,l),E(e,t),re(n,t,null),r=!0,i||(s=we(e,"click",o[24]),i=!0)},p:Le,i(a){r||(T(n.$$.fragment,a),r=!0)},o(a){N(n.$$.fragment,a),r=!1},d(a){a&&p(e),ie(n),i=!1,s()}}}function yk(o){let e,t,n,r,i,s,a;return n=new up({props:{className:" size-5",strokeWidth:"2"}}),{c(){e=M("button"),t=M("div"),oe(n.$$.fragment),this.h()},l(l){e=O(l,"BUTTON",{id:!0,class:!0,"aria-label":!0});var c=A(e);t=O(c,"DIV",{class:!0});var u=A(t);ae(n.$$.fragment,u),u.forEach(p),c.forEach(p),this.h()},h(){g(t,"class","m-auto self-center"),g(e,"id","new-chat-button"),g(e,"class",r="flex "+(o[9]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(e,"aria-label","New Chat")},m(l,c){U(l,e,c),E(e,t),re(n,t,null),i=!0,s||(a=we(e,"click",o[25]),s=!0)},p(l,c){(!i||c&512&&r!==(r="flex "+(l[9]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-850 transition"))&&g(e,"class",r)},i(l){i||(T(n.$$.fragment,l),i=!0)},o(l){N(n.$$.fragment,l),i=!1},d(l){l&&p(e),ie(n),s=!1,a()}}}function vk(o){var J,ve,le;let e,t,n,r,i,s,a,l,c,u,d,f,h,_,b,v,m,y,w,I,S,k,C,R,D,H,z,W,K,P;function V(me){o[17](me)}let L={chatId:o[8]};o[6]!==void 0&&(L.show=o[6]),e=new cp({props:L}),ze.push(()=>nt(e,"show",V)),f=new a_({});let q=us;function Z(me){o[20](me)}let Q={showSetDefault:!0};o[1]!==void 0&&(Q.selectedAgents=o[1]),m=new Kw({props:Q}),ze.push(()=>nt(m,"selectedAgents",Z));const Y=[mk,gk],te=[];function F(me,X){var ue,be,Re;return me[11]&&(me[12].role==="admin"||(Re=(be=(ue=me[12])==null?void 0:ue.permissions)==null?void 0:be.chat)!=null&&Re.controls)?1:-1}~(k=F(o))&&(C=te[k]=Y[k](o));let j=!o[11]&&(o[12].role==="admin"||((le=(ve=(J=o[12])==null?void 0:J.permissions)==null?void 0:ve.chat)==null?void 0:le.controls))&&nd(o);H=new qt({props:{content:o[13].t("New Chat"),$$slots:{default:[yk]},$$scope:{ctx:o}}});let x=us;return{c(){oe(e.$$.fragment),n=$(),r=M("nav"),i=M("div"),s=$(),a=M("div"),l=M("div"),c=M("div"),u=M("button"),d=M("div"),oe(f.$$.fragment),_=$(),b=$(),v=M("div"),oe(m.$$.fragment),I=$(),S=M("div"),C&&C.c(),R=$(),j&&j.c(),D=$(),oe(H.$$.fragment),z=$(),this.h()},l(me){ae(e.$$.fragment,me),n=ee(me),r=O(me,"NAV",{class:!0});var X=A(r);i=O(X,"DIV",{class:!0}),A(i).forEach(p),s=ee(X),a=O(X,"DIV",{class:!0});var ue=A(a);l=O(ue,"DIV",{class:!0});var be=A(l);c=O(be,"DIV",{class:!0});var Re=A(c);u=O(Re,"BUTTON",{id:!0,class:!0,"aria-label":!0});var Fe=A(u);d=O(Fe,"DIV",{class:!0});var he=A(d);ae(f.$$.fragment,he),he.forEach(p),Fe.forEach(p),Re.forEach(p),_=ee(be),b=ee(be),v=O(be,"DIV",{class:!0});var et=A(v);ae(m.$$.fragment,et),et.forEach(p),I=ee(be),S=O(be,"DIV",{class:!0});var ot=A(S);C&&C.l(ot),R=ee(ot),j&&j.l(ot),D=ee(ot),ae(H.$$.fragment,ot),z=ee(ot),ot.forEach(p),be.forEach(p),ue.forEach(p),X.forEach(p),this.h()},h(){g(i,"class","bg-linear-to-b via-50% from-white via-white to-transparent dark:from-gray-900 dark:via-gray-900 dark:to-transparent pointer-events-none absolute inset-0 -bottom-7 z-[-1]"),g(d,"class","m-auto self-center"),g(u,"id","sidebar-toggle-button"),g(u,"class","cursor-pointer px-2 py-2 flex rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(u,"aria-label","Toggle Sidebar"),g(c,"class",h=(o[9]?"md:hidden":"")+" mr-1 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),g(v,"class",w="flex-1 overflow-hidden max-w-full py-0.5 "+(o[9]?"ml-1":"")),g(S,"class","self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),g(l,"class","flex items-center w-full max-w-full"),g(a,"class","flex max-w-full w-full mx-auto px-1 pt-0.5 bg-transparent"),g(r,"class","sticky top-0 z-30 w-full px-1.5 py-1.5 -mb-8 flex items-center drag-region")},m(me,X){re(e,me,X),U(me,n,X),U(me,r,X),E(r,i),E(r,s),E(r,a),E(a,l),E(l,c),E(c,u),E(u,d),re(f,d,null),E(l,_),E(l,b),E(l,v),re(m,v,null),E(l,I),E(l,S),~k&&te[k].m(S,null),E(S,R),j&&j.m(S,null),E(S,D),re(H,S,null),E(S,z),W=!0,K||(P=we(u,"click",o[18]),K=!0)},p(me,[X]){var he,et,ot;const ue={};X&256&&(ue.chatId=me[8]),!t&&X&64&&(t=!0,ue.show=me[6],tt(()=>t=!1)),e.$set(ue),(!W||X&512&&h!==(h=(me[9]?"md:hidden":"")+" mr-1 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"))&&g(c,"class",h);const be={};!y&&X&2&&(y=!0,be.selectedAgents=me[1],tt(()=>y=!1)),m.$set(be),(!W||X&512&&w!==(w="flex-1 overflow-hidden max-w-full py-0.5 "+(me[9]?"ml-1":"")))&&g(v,"class",w);let Re=k;k=F(me),k===Re?~k&&te[k].p(me,X):(C&&(De(),N(te[Re],1,1,()=>{te[Re]=null}),He()),~k?(C=te[k],C?C.p(me,X):(C=te[k]=Y[k](me),C.c()),T(C,1),C.m(S,R)):C=null),!me[11]&&(me[12].role==="admin"||(ot=(et=(he=me[12])==null?void 0:he.permissions)==null?void 0:et.chat)!=null&&ot.controls)?j?(j.p(me,X),X&6144&&T(j,1)):(j=nd(me),j.c(),T(j,1),j.m(S,D)):j&&(De(),N(j,1,1,()=>{j=null}),He());const Fe={};X&8192&&(Fe.content=me[13].t("New Chat")),X&268435972&&(Fe.$$scope={dirty:X,ctx:me}),H.$set(Fe)},i(me){W||(T(e.$$.fragment,me),T(f.$$.fragment,me),T(q),T(m.$$.fragment,me),T(C),T(j),T(H.$$.fragment,me),T(x),W=!0)},o(me){N(e.$$.fragment,me),N(f.$$.fragment,me),N(q),N(m.$$.fragment,me),N(C),N(j),N(H.$$.fragment,me),N(x),W=!1},d(me){me&&(p(n),p(r)),ie(e,me),ie(f),ie(m),~k&&te[k].d(),j&&j.d(),ie(H),K=!1,P()}}}function wk(o,e,t){let n,r,i,s,a,l,c,u;fe(o,Nf,V=>t(27,n=V)),fe(o,so,V=>t(8,r=V)),fe(o,ka,V=>t(9,i=V)),fe(o,qr,V=>t(10,s=V)),fe(o,Mi,V=>t(11,a=V)),fe(o,er,V=>t(12,l=V)),fe(o,dn,V=>t(14,u=V));const d=fn("i18n");fe(o,d,V=>t(13,c=V));let{initNewChat:f}=e,{title:h=n}=e,{shareEnabled:_=!1}=e,{chat:b}=e,{selectedModels:v}=e,{selectedAgents:m}=e,{showModelSelector:y=!0}=e,w=!1,I=!1;function S(V){w=V,t(6,w)}const k=()=>{ka.set(!i)};function C(V){v=V,t(0,v)}function R(V){m=V,t(1,m)}const D=()=>{t(6,w=!w)},H=()=>{t(7,I=!I)},z=async()=>{await dn.set(!u)},W=async()=>{await dn.set(!u)},K=()=>{f()},P=V=>{V.detail==="archived-chat"&&Hm.set(!0)};return o.$$set=V=>{"initNewChat"in V&&t(2,f=V.initNewChat),"title"in V&&t(16,h=V.title),"shareEnabled"in V&&t(3,_=V.shareEnabled),"chat"in V&&t(4,b=V.chat),"selectedModels"in V&&t(0,v=V.selectedModels),"selectedAgents"in V&&t(1,m=V.selectedAgents),"showModelSelector"in V&&t(5,y=V.showModelSelector)},[v,m,f,_,b,y,w,I,r,i,s,a,l,c,u,d,h,S,k,C,R,D,H,z,W,K,P]}class kk extends Ge{constructor(e){super(),We(this,e,wk,vk,Ye,{initNewChat:2,title:16,shareEnabled:3,chat:4,selectedModels:0,selectedAgents:1,showModelSelector:5})}}function nn(o){if(typeof o=="string"||typeof o=="number")return""+o;let e="";if(Array.isArray(o))for(let t=0,n;t<o.length;t++)(n=nn(o[t]))!==""&&(e+=(e&&" ")+n);else for(let t in o)o[t]&&(e+=(e&&" ")+t);return e}const Li={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:o=>`Node type "${o}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:o=>`The old edge with id=${o} does not exist.`,error009:o=>`Marker type "${o}" doesn't exist.`,error008:(o,{id:e,sourceHandle:t,targetHandle:n})=>`Couldn't create edge for ${o} handle id: "${o==="source"?t:n}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:o=>`Edge type "${o}" not found. Using fallback type "default".`,error012:o=>`Node with id "${o}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(o="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${o}/dist/style.css' or base.css to make sure everything is working properly.`},Es=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]];var Ir;(function(o){o.Strict="strict",o.Loose="loose"})(Ir||(Ir={}));var Bo;(function(o){o.Free="free",o.Vertical="vertical",o.Horizontal="horizontal"})(Bo||(Bo={}));var Is;(function(o){o.Partial="partial",o.Full="full"})(Is||(Is={}));const Ya={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var Wr;(function(o){o.Bezier="default",o.Straight="straight",o.Step="step",o.SmoothStep="smoothstep",o.SimpleBezier="simplebezier"})(Wr||(Wr={}));var Ts;(function(o){o.Arrow="arrow",o.ArrowClosed="arrowclosed"})(Ts||(Ts={}));var mt;(function(o){o.Left="left",o.Top="top",o.Right="right",o.Bottom="bottom"})(mt||(mt={}));const od={[mt.Left]:mt.Right,[mt.Right]:mt.Left,[mt.Top]:mt.Bottom,[mt.Bottom]:mt.Top};function Ck(o,e){if(!o&&!e)return!0;if(!o||!e||o.size!==e.size)return!1;if(!o.size&&!e.size)return!0;for(const t of o.keys())if(!e.has(t))return!1;return!0}function rd(o,e,t){if(!t)return;const n=[];o.forEach((r,i)=>{e!=null&&e.has(i)||n.push(r)}),n.length&&t(n)}function id(o){return o===null?null:o?"valid":"invalid"}const Ek=o=>"id"in o&&"source"in o&&"target"in o,Ik=o=>"id"in o&&"position"in o&&!("source"in o)&&!("target"in o),Yl=o=>"id"in o&&"internals"in o&&!("source"in o)&&!("target"in o),Js=(o,e=[0,0])=>{const{width:t,height:n}=ri(o),r=o.origin??e,i=t*r[0],s=n*r[1];return{x:o.position.x-i,y:o.position.y-s}},Tk=(o,e={nodeOrigin:[0,0],nodeLookup:void 0})=>{if(o.length===0)return{x:0,y:0,width:0,height:0};const t=o.reduce((n,r)=>{const i=typeof r=="string";let s=!e.nodeLookup&&!i?r:void 0;e.nodeLookup&&(s=i?e.nodeLookup.get(r):Yl(r)?r:e.nodeLookup.get(r.id));const a=s?Ss(s,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return xs(n,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return $s(t)},Zs=(o,e={})=>{if(o.size===0)return{x:0,y:0,width:0,height:0};let t={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return o.forEach(n=>{if(e.filter===void 0||e.filter(n)){const r=Ss(n);t=xs(t,r)}}),$s(t)},Dg=(o,e,[t,n,r]=[0,0,1],i=!1,s=!1)=>{const a={...Ui(e,[t,n,r]),width:e.width/r,height:e.height/r},l=[];for(const c of o.values()){const{measured:u,selectable:d=!0,hidden:f=!1}=c;if(s&&!d||f)continue;const h=u.width??c.width??c.initialWidth??null,_=u.height??c.height??c.initialHeight??null,b=Si(a,$r(c)),v=(h??0)*(_??0),m=i&&b>0;(!c.internals.handleBounds||m||b>=v||c.dragging)&&l.push(c)}return l},ja=(o,e)=>{const t=new Set;return o.forEach(n=>{t.add(n.id)}),e.filter(n=>t.has(n.source)||t.has(n.target))};function sd(o,e){const t=new Map,n=e!=null&&e.nodes?new Set(e.nodes.map(r=>r.id)):null;return o.forEach(r=>{r.measured.width&&r.measured.height&&((e==null?void 0:e.includeHiddenNodes)||!r.hidden)&&(!n||n.has(r.id))&&t.set(r.id,r)}),t}async function ad({nodes:o,width:e,height:t,panZoom:n,minZoom:r,maxZoom:i},s){if(o.size===0)return Promise.resolve(!1);const a=Zs(o),l=Ql(a,e,t,(s==null?void 0:s.minZoom)??r,(s==null?void 0:s.maxZoom)??i,(s==null?void 0:s.padding)??.1);return await n.setViewport(l,{duration:s==null?void 0:s.duration}),Promise.resolve(!0)}function Sk({nodeId:o,nextPosition:e,nodeLookup:t,nodeOrigin:n=[0,0],nodeExtent:r,onError:i}){const s=t.get(o),a=s.parentId?t.get(s.parentId):void 0,{x:l,y:c}=a?a.internals.positionAbsolute:{x:0,y:0},u=s.origin??n;let d=r;if(s.extent==="parent"&&!s.expandParent)if(!a)i==null||i("005",Li.error005());else{const h=a.measured.width,_=a.measured.height;h&&_&&(d=[[l,c],[l+h,c+_]])}else a&&Ai(s.extent)&&(d=[[s.extent[0][0]+l,s.extent[0][1]+c],[s.extent[1][0]+l,s.extent[1][1]+c]]);const f=Ai(d)?xr(e,d,s.measured):e;return{position:{x:f.x-l+s.measured.width*u[0],y:f.y-c+s.measured.height*u[1]},positionAbsolute:f}}async function Hg({nodesToRemove:o=[],edgesToRemove:e=[],nodes:t,edges:n,onBeforeDelete:r}){const i=new Set(o.map(f=>f.id)),s=[];for(const f of t){if(f.deletable===!1)continue;const h=i.has(f.id),_=!h&&f.parentId&&s.find(b=>b.id===f.parentId);(h||_)&&s.push(f)}const a=new Set(e.map(f=>f.id)),l=n.filter(f=>f.deletable!==!1),u=ja(s,l);for(const f of l)a.has(f.id)&&!u.find(_=>_.id===f.id)&&u.push(f);if(!r)return{edges:u,nodes:s};const d=await r({nodes:s,edges:u});return typeof d=="boolean"?d?{edges:u,nodes:s}:{edges:[],nodes:[]}:d}const Zr=(o,e=0,t=1)=>Math.min(Math.max(o,e),t),xr=(o={x:0,y:0},e,t)=>({x:Zr(o.x,e[0][0],e[1][0]-((t==null?void 0:t.width)??0)),y:Zr(o.y,e[0][1],e[1][1]-((t==null?void 0:t.height)??0))});function Lg(o,e,t){const{width:n,height:r}=ri(t),{x:i,y:s}=t.internals.positionAbsolute;return xr(o,[[i,s],[i+n,s+r]],e)}const ld=(o,e,t)=>o<e?Zr(Math.abs(o-e),1,e)/e:o>t?-Zr(Math.abs(o-t),1,e)/e:0,Ug=(o,e,t=15,n=40)=>{const r=ld(o.x,n,e.width-n)*t,i=ld(o.y,n,e.height-n)*t;return[r,i]},xs=(o,e)=>({x:Math.min(o.x,e.x),y:Math.min(o.y,e.y),x2:Math.max(o.x2,e.x2),y2:Math.max(o.y2,e.y2)}),Qa=({x:o,y:e,width:t,height:n})=>({x:o,y:e,x2:o+t,y2:e+n}),$s=({x:o,y:e,x2:t,y2:n})=>({x:o,y:e,width:t-o,height:n-e}),$r=(o,e=[0,0])=>{var r,i;const{x:t,y:n}=Yl(o)?o.internals.positionAbsolute:Js(o,e);return{x:t,y:n,width:((r=o.measured)==null?void 0:r.width)??o.width??o.initialWidth??0,height:((i=o.measured)==null?void 0:i.height)??o.height??o.initialHeight??0}},Ss=(o,e=[0,0])=>{var r,i;const{x:t,y:n}=Yl(o)?o.internals.positionAbsolute:Js(o,e);return{x:t,y:n,x2:t+(((r=o.measured)==null?void 0:r.width)??o.width??o.initialWidth??0),y2:n+(((i=o.measured)==null?void 0:i.height)??o.height??o.initialHeight??0)}},Ak=(o,e)=>$s(xs(Qa(o),Qa(e))),Si=(o,e)=>{const t=Math.max(0,Math.min(o.x+o.width,e.x+e.width)-Math.max(o.x,e.x)),n=Math.max(0,Math.min(o.y+o.height,e.y+e.height)-Math.max(o.y,e.y));return Math.ceil(t*n)},cd=o=>wo(o.width)&&wo(o.height)&&wo(o.x)&&wo(o.y),wo=o=>!isNaN(o)&&isFinite(o),Rk=(o,e)=>{},jl=(o,e=[1,1])=>({x:e[0]*Math.round(o.x/e[0]),y:e[1]*Math.round(o.y/e[1])}),Ui=({x:o,y:e},[t,n,r],i=!1,s=[1,1])=>{const a={x:(o-t)/r,y:(e-n)/r};return i?jl(a,s):a},Bg=({x:o,y:e},[t,n,r])=>({x:o*r+t,y:e*r+n}),Ql=(o,e,t,n,r,i)=>{const s=e/(o.width*(1+i)),a=t/(o.height*(1+i)),l=Math.min(s,a),c=Zr(l,n,r),u=o.x+o.width/2,d=o.y+o.height/2,f=e/2-u*c,h=t/2-d*c;return{x:f,y:h,zoom:c}},As=()=>{var o;return typeof navigator<"u"&&((o=navigator==null?void 0:navigator.userAgent)==null?void 0:o.indexOf("Mac"))>=0};function Ai(o){return o!==void 0&&o!=="parent"}function ri(o){var e,t;return{width:((e=o.measured)==null?void 0:e.width)??o.width??o.initialWidth??0,height:((t=o.measured)==null?void 0:t.height)??o.height??o.initialHeight??0}}function ud(o){var e,t;return(((e=o.measured)==null?void 0:e.width)??o.width??o.initialWidth)!==void 0&&(((t=o.measured)==null?void 0:t.height)??o.height??o.initialHeight)!==void 0}function Mk(o,e={width:0,height:0},t,n,r){let i=t;const s={...o};for(;i;){const a=n.get(i);if(i=a==null?void 0:a.parentId,a){const l=a.origin||r;s.x+=a.internals.positionAbsolute.x-(e.width??0)*l[0],s.y+=a.internals.positionAbsolute.y-(e.height??0)*l[1]}}return s}function ma(o,{snapGrid:e=[0,0],snapToGrid:t=!1,transform:n}){const{x:r,y:i}=Jo(o),s=Ui({x:r,y:i},n),{x:a,y:l}=t?jl(s,e):s;return{xSnapped:a,ySnapped:l,...s}}const zg=o=>({width:o.offsetWidth,height:o.offsetHeight}),Ok=o=>{var e;return((e=o.getRootNode)==null?void 0:e.call(o))||(window==null?void 0:window.document)},Pk=["INPUT","SELECT","TEXTAREA"];function Nk(o){var n,r;const e=((r=(n=o.composedPath)==null?void 0:n.call(o))==null?void 0:r[0])||o.target;return Pk.includes(e==null?void 0:e.nodeName)||(e==null?void 0:e.hasAttribute("contenteditable"))||!!(e!=null&&e.closest(".nokey"))}const Vg=o=>"clientX"in o,Jo=(o,e)=>{var i,s;const t=Vg(o),n=t?o.clientX:(i=o.touches)==null?void 0:i[0].clientX,r=t?o.clientY:(s=o.touches)==null?void 0:s[0].clientY;return{x:n-((e==null?void 0:e.left)??0),y:r-((e==null?void 0:e.top)??0)}},dd=(o,e,t,n,r)=>{const i=e.querySelectorAll(`.${o}`);return!i||!i.length?null:Array.from(i).map(s=>{const a=s.getBoundingClientRect();return{id:s.getAttribute("data-handleid"),type:o,nodeId:r,position:s.getAttribute("data-handlepos"),x:(a.left-t.left)/n,y:(a.top-t.top)/n,...zg(s)}})};function Dk({sourceX:o,sourceY:e,targetX:t,targetY:n,sourceControlX:r,sourceControlY:i,targetControlX:s,targetControlY:a}){const l=o*.125+r*.375+s*.375+t*.125,c=e*.125+i*.375+a*.375+n*.125,u=Math.abs(l-o),d=Math.abs(c-e);return[l,c,u,d]}function ns(o,e){return o>=0?.5*o:e*25*Math.sqrt(-o)}function fd({pos:o,x1:e,y1:t,x2:n,y2:r,c:i}){switch(o){case mt.Left:return[e-ns(e-n,i),t];case mt.Right:return[e+ns(n-e,i),t];case mt.Top:return[e,t-ns(t-r,i)];case mt.Bottom:return[e,t+ns(r-t,i)]}}function Fg({sourceX:o,sourceY:e,sourcePosition:t=mt.Bottom,targetX:n,targetY:r,targetPosition:i=mt.Top,curvature:s=.25}){const[a,l]=fd({pos:t,x1:o,y1:e,x2:n,y2:r,c:s}),[c,u]=fd({pos:i,x1:n,y1:r,x2:o,y2:e,c:s}),[d,f,h,_]=Dk({sourceX:o,sourceY:e,targetX:n,targetY:r,sourceControlX:a,sourceControlY:l,targetControlX:c,targetControlY:u});return[`M${o},${e} C${a},${l} ${c},${u} ${n},${r}`,d,f,h,_]}function Kg({sourceX:o,sourceY:e,targetX:t,targetY:n}){const r=Math.abs(t-o)/2,i=t<o?t+r:t-r,s=Math.abs(n-e)/2,a=n<e?n+s:n-s;return[i,a,r,s]}function Hk({sourceNode:o,targetNode:e,selected:t=!1,zIndex:n=0,elevateOnSelect:r=!1}){if(!r)return n;const i=t||e.selected||o.selected,s=Math.max(o.internals.z||0,e.internals.z||0,1e3);return n+(i?s:0)}function Lk({sourceNode:o,targetNode:e,width:t,height:n,transform:r}){const i=xs(Ss(o),Ss(e));i.x===i.x2&&(i.x2+=1),i.y===i.y2&&(i.y2+=1);const s={x:-r[0]/r[2],y:-r[1]/r[2],width:t/r[2],height:n/r[2]};return Si(s,$s(i))>0}const Uk=({source:o,sourceHandle:e,target:t,targetHandle:n})=>`xy-edge__${o}${e||""}-${t}${n||""}`,Bk=(o,e)=>e.some(t=>t.source===o.source&&t.target===o.target&&(t.sourceHandle===o.sourceHandle||!t.sourceHandle&&!o.sourceHandle)&&(t.targetHandle===o.targetHandle||!t.targetHandle&&!o.targetHandle)),zk=(o,e)=>{if(!o.source||!o.target)return e;let t;return Ek(o)?t={...o}:t={...o,id:Uk(o)},Bk(t,e)?e:(t.sourceHandle===null&&delete t.sourceHandle,t.targetHandle===null&&delete t.targetHandle,e.concat(t))};function Gg({sourceX:o,sourceY:e,targetX:t,targetY:n}){const[r,i,s,a]=Kg({sourceX:o,sourceY:e,targetX:t,targetY:n});return[`M ${o},${e}L ${t},${n}`,r,i,s,a]}const hd={[mt.Left]:{x:-1,y:0},[mt.Right]:{x:1,y:0},[mt.Top]:{x:0,y:-1},[mt.Bottom]:{x:0,y:1}},Vk=({source:o,sourcePosition:e=mt.Bottom,target:t})=>e===mt.Left||e===mt.Right?o.x<t.x?{x:1,y:0}:{x:-1,y:0}:o.y<t.y?{x:0,y:1}:{x:0,y:-1},gd=(o,e)=>Math.sqrt(Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2));function Fk({source:o,sourcePosition:e=mt.Bottom,target:t,targetPosition:n=mt.Top,center:r,offset:i}){const s=hd[e],a=hd[n],l={x:o.x+s.x*i,y:o.y+s.y*i},c={x:t.x+a.x*i,y:t.y+a.y*i},u=Vk({source:l,sourcePosition:e,target:c}),d=u.x!==0?"x":"y",f=u[d];let h=[],_,b;const v={x:0,y:0},m={x:0,y:0},[y,w,I,S]=Kg({sourceX:o.x,sourceY:o.y,targetX:t.x,targetY:t.y});if(s[d]*a[d]===-1){_=r.x??y,b=r.y??w;const C=[{x:_,y:l.y},{x:_,y:c.y}],R=[{x:l.x,y:b},{x:c.x,y:b}];s[d]===f?h=d==="x"?C:R:h=d==="x"?R:C}else{const C=[{x:l.x,y:c.y}],R=[{x:c.x,y:l.y}];if(d==="x"?h=s.x===f?R:C:h=s.y===f?C:R,e===n){const K=Math.abs(o[d]-t[d]);if(K<=i){const P=Math.min(i-1,i-K);s[d]===f?v[d]=(l[d]>o[d]?-1:1)*P:m[d]=(c[d]>t[d]?-1:1)*P}}if(e!==n){const K=d==="x"?"y":"x",P=s[d]===a[K],V=l[K]>c[K],L=l[K]<c[K];(s[d]===1&&(!P&&V||P&&L)||s[d]!==1&&(!P&&L||P&&V))&&(h=d==="x"?C:R)}const D={x:l.x+v.x,y:l.y+v.y},H={x:c.x+m.x,y:c.y+m.y},z=Math.max(Math.abs(D.x-h[0].x),Math.abs(H.x-h[0].x)),W=Math.max(Math.abs(D.y-h[0].y),Math.abs(H.y-h[0].y));z>=W?(_=(D.x+H.x)/2,b=h[0].y):(_=h[0].x,b=(D.y+H.y)/2)}return[[o,{x:l.x+v.x,y:l.y+v.y},...h,{x:c.x+m.x,y:c.y+m.y},t],_,b,I,S]}function Kk(o,e,t,n){const r=Math.min(gd(o,e)/2,gd(e,t)/2,n),{x:i,y:s}=e;if(o.x===i&&i===t.x||o.y===s&&s===t.y)return`L${i} ${s}`;if(o.y===s){const c=o.x<t.x?-1:1,u=o.y<t.y?1:-1;return`L ${i+r*c},${s}Q ${i},${s} ${i},${s+r*u}`}const a=o.x<t.x?1:-1,l=o.y<t.y?-1:1;return`L ${i},${s+r*l}Q ${i},${s} ${i+r*a},${s}`}function Rs({sourceX:o,sourceY:e,sourcePosition:t=mt.Bottom,targetX:n,targetY:r,targetPosition:i=mt.Top,borderRadius:s=5,centerX:a,centerY:l,offset:c=20}){const[u,d,f,h,_]=Fk({source:{x:o,y:e},sourcePosition:t,target:{x:n,y:r},targetPosition:i,center:{x:a,y:l},offset:c});return[u.reduce((v,m,y)=>{let w="";return y>0&&y<u.length-1?w=Kk(u[y-1],m,u[y+1],s):w=`${y===0?"M":"L"}${m.x} ${m.y}`,v+=w,v},""),d,f,h,_]}function md(o){var e;return o&&!!(o.internals.handleBounds||(e=o.handles)!=null&&e.length)&&!!(o.measured.width||o.width||o.initialWidth)}function Gk(o){var d;const{sourceNode:e,targetNode:t}=o;if(!md(e)||!md(t))return null;const n=e.internals.handleBounds||pd(e.handles),r=t.internals.handleBounds||pd(t.handles),i=_d((n==null?void 0:n.source)??[],o.sourceHandle),s=_d(o.connectionMode===Ir.Strict?(r==null?void 0:r.target)??[]:((r==null?void 0:r.target)??[]).concat((r==null?void 0:r.source)??[]),o.targetHandle);if(!i||!s)return(d=o.onError)==null||d.call(o,"008",Li.error008(i?"target":"source",{id:o.id,sourceHandle:o.sourceHandle,targetHandle:o.targetHandle})),null;const a=(i==null?void 0:i.position)||mt.Bottom,l=(s==null?void 0:s.position)||mt.Top,c=Ri(e,i,a),u=Ri(t,s,l);return{sourceX:c.x,sourceY:c.y,targetX:u.x,targetY:u.y,sourcePosition:a,targetPosition:l}}function pd(o){if(!o)return null;const e=[],t=[];for(const n of o)n.width=n.width??1,n.height=n.height??1,n.type==="source"?e.push(n):n.type==="target"&&t.push(n);return{source:e,target:t}}function Ri(o,e,t=mt.Left,n=!1){const r=((e==null?void 0:e.x)??0)+o.internals.positionAbsolute.x,i=((e==null?void 0:e.y)??0)+o.internals.positionAbsolute.y,{width:s,height:a}=e??ri(o);if(n)return{x:r+s/2,y:i+a/2};switch((e==null?void 0:e.position)??t){case mt.Top:return{x:r+s/2,y:i};case mt.Right:return{x:r+s,y:i+a/2};case mt.Bottom:return{x:r+s/2,y:i+a};case mt.Left:return{x:r,y:i+a/2}}}function _d(o,e){return o&&(e?o.find(t=>t.id===e):o[0])||null}function Xa(o,e){return o?typeof o=="string"?o:`${e?`${e}__`:""}${Object.keys(o).sort().map(n=>`${n}=${o[n]}`).join("&")}`:""}function Wk(o,{id:e,defaultColor:t,defaultMarkerStart:n,defaultMarkerEnd:r}){const i=new Set;return o.reduce((s,a)=>([a.markerStart||n,a.markerEnd||r].forEach(l=>{if(l&&typeof l=="object"){const c=Xa(l,e);i.has(c)||(s.push({id:c,color:l.color||t,...l}),i.add(c))}}),s),[]).sort((s,a)=>s.id.localeCompare(a.id))}const Wg={nodeOrigin:[0,0],nodeExtent:Es,elevateNodesOnSelect:!0,defaults:{}},qk={...Wg,checkEquality:!0};function qg(o,e){const t={...o};for(const n in e)e[n]!==void 0&&(t[n]=e[n]);return t}function Yg(o,e,t,n){var a,l;const r=qg(qk,n),i=new Map(e),s=r!=null&&r.elevateNodesOnSelect?1e3:0;e.clear(),t.clear();for(const c of o){let u=i.get(c.id);if(r.checkEquality&&c===(u==null?void 0:u.internals.userNode))e.set(c.id,u);else{const d=Js(c,r.nodeOrigin),f=Ai(c.extent)?c.extent:r.nodeExtent,h=xr(d,f,ri(c));u={...r.defaults,...c,measured:{width:(a=c.measured)==null?void 0:a.width,height:(l=c.measured)==null?void 0:l.height},internals:{positionAbsolute:h,handleBounds:c.measured?u==null?void 0:u.internals.handleBounds:void 0,z:Qg(c,s),userNode:c}},e.set(c.id,u)}c.parentId&&jg(u,e,t,n)}}function Yk(o,e){if(!o.parentId)return;const t=e.get(o.parentId);t?t.set(o.id,o):e.set(o.parentId,new Map([[o.id,o]]))}function jg(o,e,t,n){const{elevateNodesOnSelect:r,nodeOrigin:i,nodeExtent:s}=qg(Wg,n),a=o.parentId,l=e.get(a);if(!l){console.warn(`Parent node ${a} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}Yk(o,t);const c=r?1e3:0,{x:u,y:d,z:f}=jk(o,l,i,s,c),{positionAbsolute:h}=o.internals,_=u!==h.x||d!==h.y;(_||f!==o.internals.z)&&(o.internals={...o.internals,positionAbsolute:_?{x:u,y:d}:h,z:f})}function Qg(o,e){return(wo(o.zIndex)?o.zIndex:0)+(o.selected?e:0)}function jk(o,e,t,n,r){const{x:i,y:s}=e.internals.positionAbsolute,a=ri(o),l=Js(o,t),c=Ai(o.extent)?xr(l,o.extent,a):l;let u=xr({x:i+c.x,y:s+c.y},n,a);o.extent==="parent"&&(u=Lg(u,a,e));const d=Qg(o,r),f=e.internals.z??0;return{x:u.x,y:u.y,z:f>d?f:d}}function Qk(o,e,t,n=[0,0]){var s;const r=[],i=new Map;for(const a of o){const l=e.get(a.parentId);if(!l)continue;const c=((s=i.get(a.parentId))==null?void 0:s.expandedRect)??$r(l),u=Ak(c,a.rect);i.set(a.parentId,{expandedRect:u,parent:l})}return i.size>0&&i.forEach(({expandedRect:a,parent:l},c)=>{var w;const u=l.internals.positionAbsolute,d=ri(l),f=l.origin??n,h=a.x<u.x?Math.round(Math.abs(u.x-a.x)):0,_=a.y<u.y?Math.round(Math.abs(u.y-a.y)):0,b=Math.max(d.width,Math.round(a.width)),v=Math.max(d.height,Math.round(a.height)),m=(b-d.width)*f[0],y=(v-d.height)*f[1];(h>0||_>0||m||y)&&(r.push({id:c,type:"position",position:{x:l.position.x-h+m,y:l.position.y-_+y}}),(w=t.get(c))==null||w.forEach(I=>{o.some(S=>S.id===I.id)||r.push({id:I.id,type:"position",position:{x:I.position.x+h,y:I.position.y+_}})})),(d.width<a.width||d.height<a.height||h||_)&&r.push({id:c,type:"dimensions",setAttributes:!0,dimensions:{width:b+(h?f[0]*h-m:0),height:v+(_?f[1]*_-y:0)}})}),r}function Xk(o,e,t,n,r,i){const s=n==null?void 0:n.querySelector(".xyflow__viewport");let a=!1;if(!s)return{changes:[],updatedInternals:a};const l=[],c=window.getComputedStyle(s),{m22:u}=new window.DOMMatrixReadOnly(c.transform),d=[];for(const f of o.values()){const h=e.get(f.id);if(h)if(h.hidden)h.internals={...h.internals,handleBounds:void 0},a=!0;else{const _=zg(f.nodeElement),b=h.measured.width!==_.width||h.measured.height!==_.height;if(!!(_.width&&_.height&&(b||!h.internals.handleBounds||f.force))){const m=f.nodeElement.getBoundingClientRect(),y=Ai(h.extent)?h.extent:i;let{positionAbsolute:w}=h.internals;h.parentId&&h.extent==="parent"?w=Lg(w,_,e.get(h.parentId)):y&&(w=xr(w,y,_)),h.measured=_,h.internals={...h.internals,positionAbsolute:w,handleBounds:{source:dd("source",f.nodeElement,m,u,h.id),target:dd("target",f.nodeElement,m,u,h.id)}},h.parentId&&jg(h,e,t,{nodeOrigin:r}),a=!0,b&&(l.push({id:h.id,type:"dimensions",dimensions:_}),h.expandParent&&h.parentId&&d.push({id:h.id,parentId:h.parentId,rect:$r(h,r)}))}}}if(d.length>0){const f=Qk(d,e,t,r);l.push(...f)}return{changes:l,updatedInternals:a}}async function Jk({delta:o,panZoom:e,transform:t,translateExtent:n,width:r,height:i}){if(!e||!o.x&&!o.y)return Promise.resolve(!1);const s=await e.setViewportConstrained({x:t[0]+o.x,y:t[1]+o.y,zoom:t[2]},[[0,0],[r,i]],n),a=!!s&&(s.x!==t[0]||s.y!==t[1]||s.k!==t[2]);return Promise.resolve(a)}function Xg(o,e,t){o.clear(),e.clear();for(const n of t){const{source:r,target:i,sourceHandle:s=null,targetHandle:a=null}=n,l=`${r}-source-${s}`,c=`${i}-target-${a}`,u=o.get(l)||new Map,d=o.get(c)||new Map,f={edgeId:n.id,source:r,target:i,sourceHandle:s,targetHandle:a};e.set(n.id,n),o.set(l,u.set(`${i}-${a}`,f)),o.set(c,d.set(`${r}-${s}`,f))}}function Jg(o,e){if(!o.parentId)return!1;const t=e.get(o.parentId);return t?t.selected?!0:Jg(t,e):!1}function bd(o,e,t){let n=o;do{if(n!=null&&n.matches(e))return!0;if(n===t)return!1;n=n.parentElement}while(n);return!1}function Zk(o,e,t,n){const r=new Map;for(const[i,s]of o)if((s.selected||s.id===n)&&(!s.parentId||!Jg(s,o))&&(s.draggable||e&&typeof s.draggable>"u")){const a=o.get(i);a&&r.set(i,{id:i,position:a.position||{x:0,y:0},distance:{x:t.x-a.internals.positionAbsolute.x,y:t.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return r}function pa({nodeId:o,dragItems:e,nodeLookup:t,dragging:n=!0}){var s,a;const r=[];for(const[l,c]of e){const u=(s=t.get(l))==null?void 0:s.internals.userNode;u&&r.push({...u,position:c.position,dragging:n})}if(!o)return[r[0],r];const i=t.get(o).internals.userNode;return[{...i,position:((a=e.get(o))==null?void 0:a.position)||i.position,dragging:n},r]}function xk({onNodeMouseDown:o,getStoreItems:e,onDragStart:t,onDrag:n,onDragStop:r}){let i={x:null,y:null},s=0,a=new Map,l=!1,c={x:0,y:0},u=null,d=!1,f=null,h=!1;function _({noDragClassName:v,handleSelector:m,domNode:y,isSelectable:w,nodeId:I,nodeClickDistance:S=0}){f=vo(y);function k({x:H,y:z},W){const{nodeLookup:K,nodeExtent:P,snapGrid:V,snapToGrid:L,nodeOrigin:q,onNodeDrag:Z,onSelectionDrag:Q,onError:Y,updateNodePositions:te}=e();i={x:H,y:z};let F=!1,j={x:0,y:0,x2:0,y2:0};if(a.size>1&&P){const x=Zs(a);j=Qa(x)}for(const[x,J]of a){let ve={x:H-J.distance.x,y:z-J.distance.y};L&&(ve=jl(ve,V));let le=[[P[0][0],P[0][1]],[P[1][0],P[1][1]]];if(a.size>1&&P&&!J.extent){const{positionAbsolute:ue}=J.internals,be=ue.x-j.x+P[0][0],Re=ue.x+J.measured.width-j.x2+P[1][0],Fe=ue.y-j.y+P[0][1],he=ue.y+J.measured.height-j.y2+P[1][1];le=[[be,Fe],[Re,he]]}const{position:me,positionAbsolute:X}=Sk({nodeId:x,nextPosition:ve,nodeLookup:K,nodeExtent:le,nodeOrigin:q,onError:Y});F=F||J.position.x!==me.x||J.position.y!==me.y,J.position=me,J.internals.positionAbsolute=X}if(F&&(te(a,!0),W&&(n||Z||!I&&Q))){const[x,J]=pa({nodeId:I,dragItems:a,nodeLookup:K});n==null||n(W,a,x,J),Z==null||Z(W,x,J),I||Q==null||Q(W,J)}}async function C(){if(!u)return;const{transform:H,panBy:z,autoPanSpeed:W}=e(),[K,P]=Ug(c,u,W);(K!==0||P!==0)&&(i.x=(i.x??0)-K/H[2],i.y=(i.y??0)-P/H[2],await z({x:K,y:P})&&k(i,null)),s=requestAnimationFrame(C)}function R(H){var F;const{nodeLookup:z,multiSelectionActive:W,nodesDraggable:K,transform:P,snapGrid:V,snapToGrid:L,selectNodesOnDrag:q,onNodeDragStart:Z,onSelectionDragStart:Q,unselectNodesAndEdges:Y}=e();d=!0,(!q||!w)&&!W&&I&&((F=z.get(I))!=null&&F.selected||Y()),w&&q&&I&&(o==null||o(I));const te=ma(H.sourceEvent,{transform:P,snapGrid:V,snapToGrid:L});if(i=te,a=Zk(z,K,te,I),a.size>0&&(t||Z||!I&&Q)){const[j,x]=pa({nodeId:I,dragItems:a,nodeLookup:z});t==null||t(H.sourceEvent,a,j,x),Z==null||Z(H.sourceEvent,j,x),I||Q==null||Q(H.sourceEvent,x)}}const D=I_().clickDistance(S).on("start",H=>{const{domNode:z,nodeDragThreshold:W,transform:K,snapGrid:P,snapToGrid:V}=e();h=!1,W===0&&R(H),i=ma(H.sourceEvent,{transform:K,snapGrid:P,snapToGrid:V}),u=(z==null?void 0:z.getBoundingClientRect())||null,c=Jo(H.sourceEvent,u)}).on("drag",H=>{const{autoPanOnNodeDrag:z,transform:W,snapGrid:K,snapToGrid:P,nodeDragThreshold:V}=e(),L=ma(H.sourceEvent,{transform:W,snapGrid:K,snapToGrid:P});if(H.sourceEvent.type==="touchmove"&&H.sourceEvent.touches.length>1&&(h=!0),!h){if(!l&&z&&d&&(l=!0,C()),!d){const q=L.xSnapped-(i.x??0),Z=L.ySnapped-(i.y??0);Math.sqrt(q*q+Z*Z)>V&&R(H)}(i.x!==L.xSnapped||i.y!==L.ySnapped)&&a&&d&&(c=Jo(H.sourceEvent,u),k(L,H.sourceEvent))}}).on("end",H=>{if(!(!d||h)&&(l=!1,d=!1,cancelAnimationFrame(s),a.size>0)){const{nodeLookup:z,updateNodePositions:W,onNodeDragStop:K,onSelectionDragStop:P}=e();if(W(a,!1),r||K||!I&&P){const[V,L]=pa({nodeId:I,dragItems:a,nodeLookup:z,dragging:!1});r==null||r(H.sourceEvent,a,V,L),K==null||K(H.sourceEvent,V,L),I||P==null||P(H.sourceEvent,L)}}}).filter(H=>{const z=H.target;return!H.button&&(!v||!bd(z,`.${v}`,y))&&(!m||bd(z,m,y))});f.call(D)}function b(){f==null||f.on(".drag",null)}return{update:_,destroy:b}}function $k(o,e,t){const n=[],r={x:o.x-t,y:o.y-t,width:t*2,height:t*2};for(const i of e.values())Si(r,$r(i))>0&&n.push(i);return n}const eC=250;function tC(o,e,t,n){var a,l;let r=[],i=1/0;const s=$k(o,t,e+eC);for(const c of s){const u=[...((a=c.internals.handleBounds)==null?void 0:a.source)??[],...((l=c.internals.handleBounds)==null?void 0:l.target)??[]];for(const d of u){if(n.nodeId===d.nodeId&&n.type===d.type&&n.id===d.id)continue;const{x:f,y:h}=Ri(c,d,d.position,!0),_=Math.sqrt(Math.pow(f-o.x,2)+Math.pow(h-o.y,2));_>e||(_<i?(r=[{...d,x:f,y:h}],i=_):_===i&&r.push({...d,x:f,y:h}))}}if(!r.length)return null;if(r.length>1){const c=n.type==="source"?"target":"source";return r.find(u=>u.type===c)??r[0]}return r[0]}function Zg(o,e,t,n,r,i=!1){var c,u,d;const s=n.get(o);if(!s)return null;const a=r==="strict"?(c=s.internals.handleBounds)==null?void 0:c[e]:[...((u=s.internals.handleBounds)==null?void 0:u.source)??[],...((d=s.internals.handleBounds)==null?void 0:d.target)??[]],l=(t?a==null?void 0:a.find(f=>f.id===t):a==null?void 0:a[0])??null;return l&&i?{...l,...Ri(s,l,l.position,!0)}:l}function xg(o,e){return o||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function nC(o,e){let t=null;return e?t=!0:o&&!e&&(t=!1),t}const $g=()=>!0;function oC(o,{connectionMode:e,connectionRadius:t,handleId:n,nodeId:r,edgeUpdaterType:i,isTarget:s,domNode:a,nodeLookup:l,lib:c,autoPanOnConnect:u,flowId:d,panBy:f,cancelConnection:h,onConnectStart:_,onConnect:b,onConnectEnd:v,isValidConnection:m=$g,onReconnectEnd:y,updateConnection:w,getTransform:I,getFromHandle:S,autoPanSpeed:k}){const C=Ok(o.target);let R=0,D;const{x:H,y:z}=Jo(o),W=C==null?void 0:C.elementFromPoint(H,z),K=xg(i,W),P=a==null?void 0:a.getBoundingClientRect();if(!P||!K)return;const V=Zg(r,K,n,l,e);if(!V)return;let L=Jo(o,P),q=!1,Z=null,Q=!1,Y=null;function te(){if(!u||!P)return;const[X,ue]=Ug(L,P,k);f({x:X,y:ue}),R=requestAnimationFrame(te)}const F={...V,nodeId:r,type:K,position:V.position},j=l.get(r),J={inProgress:!0,isValid:null,from:Ri(j,F,mt.Left,!0),fromHandle:F,fromPosition:F.position,fromNode:j,to:L,toHandle:null,toPosition:od[F.position],toNode:null};w(J);let ve=J;_==null||_(o,{nodeId:r,handleId:n,handleType:K});function le(X){if(!S()||!F){me(X);return}const ue=I();L=Jo(X,P),D=tC(Ui(L,ue,!1,[1,1]),t,l,F),q||(te(),q=!0);const be=em(X,{handle:D,connectionMode:e,fromNodeId:r,fromHandleId:n,fromType:s?"target":"source",isValidConnection:m,doc:C,lib:c,flowId:d,nodeLookup:l});Y=be.handleDomNode,Z=be.connection,Q=nC(!!D,be.isValid);const Re={...ve,isValid:Q,to:D&&Q?Bg({x:D.x,y:D.y},ue):L,toHandle:be.toHandle,toPosition:Q&&be.toHandle?be.toHandle.position:od[F.position],toNode:be.toHandle?l.get(be.toHandle.nodeId):null};Q&&D&&ve.toHandle&&Re.toHandle&&ve.toHandle.type===Re.toHandle.type&&ve.toHandle.nodeId===Re.toHandle.nodeId&&ve.toHandle.id===Re.toHandle.id&&ve.to.x===Re.to.x&&ve.to.y===Re.to.y||(w(Re),ve=Re)}function me(X){(D||Y)&&Z&&Q&&(b==null||b(Z));const{inProgress:ue,...be}=ve,Re={...be,toPosition:ve.toHandle?ve.toPosition:null};v==null||v(X,Re),i&&(y==null||y(X,Re)),h(),cancelAnimationFrame(R),q=!1,Q=!1,Z=null,Y=null,C.removeEventListener("mousemove",le),C.removeEventListener("mouseup",me),C.removeEventListener("touchmove",le),C.removeEventListener("touchend",me)}C.addEventListener("mousemove",le),C.addEventListener("mouseup",me),C.addEventListener("touchmove",le),C.addEventListener("touchend",me)}function em(o,{handle:e,connectionMode:t,fromNodeId:n,fromHandleId:r,fromType:i,doc:s,lib:a,flowId:l,isValidConnection:c=$g,nodeLookup:u}){const d=i==="target",f=e?s.querySelector(`.${a}-flow__handle[data-id="${l}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:h,y:_}=Jo(o),b=s.elementFromPoint(h,_),v=b!=null&&b.classList.contains(`${a}-flow__handle`)?b:f,m={handleDomNode:v,isValid:!1,connection:null,toHandle:null};if(v){const y=xg(void 0,v),w=v.getAttribute("data-nodeid"),I=v.getAttribute("data-handleid"),S=v.classList.contains("connectable"),k=v.classList.contains("connectableend");if(!w||!y)return m;const C={source:d?w:n,sourceHandle:d?I:r,target:d?n:w,targetHandle:d?r:I};m.connection=C;const D=S&&k&&(t===Ir.Strict?d&&y==="source"||!d&&y==="target":w!==n||I!==r);m.isValid=D&&c(C),m.toHandle=Zg(w,y,I,u,t,!1)}return m}const rC={onPointerDown:oC,isValid:em},iC=(o,e)=>o.x!==e.x||o.y!==e.y||o.zoom!==e.k,ea=o=>({x:o.x,y:o.y,zoom:o.k}),_a=({x:o,y:e,zoom:t})=>nl.translate(o,e).scale(t),Vr=(o,e)=>o.target.closest(`.${e}`),tm=(o,e)=>e===2&&Array.isArray(o)&&o.includes(2),ba=(o,e=0,t=()=>{})=>{const n=typeof e=="number"&&e>0;return n||t(),n?o.transition().duration(e).on("end",t):o},nm=o=>{const e=o.ctrlKey&&As()?10:1;return-o.deltaY*(o.deltaMode===1?.05:o.deltaMode?1:.002)*e};function sC({zoomPanValues:o,noWheelClassName:e,d3Selection:t,d3Zoom:n,panOnScrollMode:r,panOnScrollSpeed:i,zoomOnPinch:s,onPanZoomStart:a,onPanZoom:l,onPanZoomEnd:c}){return u=>{if(Vr(u,e))return!1;u.preventDefault(),u.stopImmediatePropagation();const d=t.property("__zoom").k||1;if(u.ctrlKey&&s){const v=Oo(u),m=nm(u),y=d*Math.pow(2,m);n.scaleTo(t,y,v,u);return}const f=u.deltaMode===1?20:1;let h=r===Bo.Vertical?0:u.deltaX*f,_=r===Bo.Horizontal?0:u.deltaY*f;!As()&&u.shiftKey&&r!==Bo.Vertical&&(h=u.deltaY*f,_=0),n.translateBy(t,-(h/d)*i,-(_/d)*i,{internal:!0});const b=ea(t.property("__zoom"));clearTimeout(o.panScrollTimeout),o.isPanScrolling||(o.isPanScrolling=!0,a==null||a(u,b)),o.isPanScrolling&&(l==null||l(u,b),o.panScrollTimeout=setTimeout(()=>{c==null||c(u,b),o.isPanScrolling=!1},150))}}function aC({noWheelClassName:o,preventScrolling:e,d3ZoomHandler:t}){return function(n,r){if(!e&&n.type==="wheel"&&!n.ctrlKey||Vr(n,o))return null;n.preventDefault(),t.call(this,n,r)}}function lC({zoomPanValues:o,onDraggingChange:e,onPanZoomStart:t}){return n=>{var i,s,a;if((i=n.sourceEvent)!=null&&i.internal)return;const r=ea(n.transform);o.mouseButton=((s=n.sourceEvent)==null?void 0:s.button)||0,o.isZoomingOrPanning=!0,o.prevViewport=r,((a=n.sourceEvent)==null?void 0:a.type)==="mousedown"&&e(!0),t&&(t==null||t(n.sourceEvent,r))}}function cC({zoomPanValues:o,panOnDrag:e,onPaneContextMenu:t,onTransformChange:n,onPanZoom:r}){return i=>{var s,a;o.usedRightMouseButton=!!(t&&tm(e,o.mouseButton??0)),(s=i.sourceEvent)!=null&&s.sync||n([i.transform.x,i.transform.y,i.transform.k]),r&&!((a=i.sourceEvent)!=null&&a.internal)&&(r==null||r(i.sourceEvent,ea(i.transform)))}}function uC({zoomPanValues:o,panOnDrag:e,panOnScroll:t,onDraggingChange:n,onPanZoomEnd:r,onPaneContextMenu:i}){return s=>{var a;if(!((a=s.sourceEvent)!=null&&a.internal)&&(o.isZoomingOrPanning=!1,i&&tm(e,o.mouseButton??0)&&!o.usedRightMouseButton&&s.sourceEvent&&i(s.sourceEvent),o.usedRightMouseButton=!1,n(!1),r&&iC(o.prevViewport,s.transform))){const l=ea(s.transform);o.prevViewport=l,clearTimeout(o.timerId),o.timerId=setTimeout(()=>{r==null||r(s.sourceEvent,l)},t?150:0)}}}function dC({zoomActivationKeyPressed:o,zoomOnScroll:e,zoomOnPinch:t,panOnDrag:n,panOnScroll:r,zoomOnDoubleClick:i,userSelectionActive:s,noWheelClassName:a,noPanClassName:l,lib:c}){return u=>{var _;const d=o||e,f=t&&u.ctrlKey;if(u.button===1&&u.type==="mousedown"&&(Vr(u,`${c}-flow__node`)||Vr(u,`${c}-flow__edge`)))return!0;if(!n&&!d&&!r&&!i&&!t||s||Vr(u,a)&&u.type==="wheel"||Vr(u,l)&&(u.type!=="wheel"||r&&u.type==="wheel"&&!o)||!t&&u.ctrlKey&&u.type==="wheel")return!1;if(!t&&u.type==="touchstart"&&((_=u.touches)==null?void 0:_.length)>1)return u.preventDefault(),!1;if(!d&&!r&&!f&&u.type==="wheel"||!n&&(u.type==="mousedown"||u.type==="touchstart")||Array.isArray(n)&&!n.includes(u.button)&&u.type==="mousedown")return!1;const h=Array.isArray(n)&&n.includes(u.button)||!u.button||u.button<=1;return(!u.ctrlKey||u.type==="wheel")&&h}}function fC({domNode:o,minZoom:e,maxZoom:t,paneClickDistance:n,translateExtent:r,viewport:i,onPanZoom:s,onPanZoomStart:a,onPanZoomEnd:l,onDraggingChange:c}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=o.getBoundingClientRect(),f=L_().clickDistance(!wo(n)||n<0?0:n).scaleExtent([e,t]).translateExtent(r),h=vo(o).call(f);w({x:i.x,y:i.y,zoom:Zr(i.zoom,e,t)},[[0,0],[d.width,d.height]],r);const _=h.on("wheel.zoom"),b=h.on("dblclick.zoom");f.wheelDelta(nm);function v(W,K){return h?new Promise(P=>{f==null||f.transform(ba(h,K==null?void 0:K.duration,()=>P(!0)),W)}):Promise.resolve(!1)}function m({noWheelClassName:W,noPanClassName:K,onPaneContextMenu:P,userSelectionActive:V,panOnScroll:L,panOnDrag:q,panOnScrollMode:Z,panOnScrollSpeed:Q,preventScrolling:Y,zoomOnPinch:te,zoomOnScroll:F,zoomOnDoubleClick:j,zoomActivationKeyPressed:x,lib:J,onTransformChange:ve}){V&&!u.isZoomingOrPanning&&y();const me=L&&!x&&!V?sC({zoomPanValues:u,noWheelClassName:W,d3Selection:h,d3Zoom:f,panOnScrollMode:Z,panOnScrollSpeed:Q,zoomOnPinch:te,onPanZoomStart:a,onPanZoom:s,onPanZoomEnd:l}):aC({noWheelClassName:W,preventScrolling:Y,d3ZoomHandler:_});if(h.on("wheel.zoom",me,{passive:!1}),!V){const ue=lC({zoomPanValues:u,onDraggingChange:c,onPanZoomStart:a});f.on("start",ue);const be=cC({zoomPanValues:u,panOnDrag:q,onPaneContextMenu:!!P,onPanZoom:s,onTransformChange:ve});f.on("zoom",be);const Re=uC({zoomPanValues:u,panOnDrag:q,panOnScroll:L,onPaneContextMenu:P,onPanZoomEnd:l,onDraggingChange:c});f.on("end",Re)}const X=dC({zoomActivationKeyPressed:x,panOnDrag:q,zoomOnScroll:F,panOnScroll:L,zoomOnDoubleClick:j,zoomOnPinch:te,userSelectionActive:V,noPanClassName:K,noWheelClassName:W,lib:J});f.filter(X),j?h.on("dblclick.zoom",b):h.on("dblclick.zoom",null)}function y(){f.on("zoom",null)}async function w(W,K,P){const V=_a(W),L=f==null?void 0:f.constrain()(V,K,P);return L&&await v(L),new Promise(q=>q(L))}async function I(W,K){const P=_a(W);return await v(P,K),new Promise(V=>V(P))}function S(W){if(h){const K=_a(W),P=h.property("__zoom");(P.k!==W.zoom||P.x!==W.x||P.y!==W.y)&&(f==null||f.transform(h,K,null,{sync:!0}))}}function k(){const W=h?qp(h.node()):{x:0,y:0,k:1};return{x:W.x,y:W.y,zoom:W.k}}function C(W,K){return h?new Promise(P=>{f==null||f.scaleTo(ba(h,K==null?void 0:K.duration,()=>P(!0)),W)}):Promise.resolve(!1)}function R(W,K){return h?new Promise(P=>{f==null||f.scaleBy(ba(h,K==null?void 0:K.duration,()=>P(!0)),W)}):Promise.resolve(!1)}function D(W){f==null||f.scaleExtent(W)}function H(W){f==null||f.translateExtent(W)}function z(W){const K=!wo(W)||W<0?0:W;f==null||f.clickDistance(K)}return{update:m,destroy:y,setViewport:I,setViewportConstrained:w,getViewport:k,scaleTo:C,scaleBy:R,setScaleExtent:D,setTranslateExtent:H,syncViewport:S,setClickDistance:z}}var yd;(function(o){o.Line="line",o.Handle="handle"})(yd||(yd={}));function hC(o){let e,t,n,r,i,s;const a=o[45].default,l=Ft(a,o,o[44],null);return{c(){e=M("div"),l&&l.c(),this.h()},l(c){e=O(c,"DIV",{"data-handleid":!0,"data-nodeid":!0,"data-handlepos":!0,"data-id":!0,class:!0,style:!0,role:!0,tabindex:!0});var u=A(e);l&&l.l(u),u.forEach(p),this.h()},h(){g(e,"data-handleid",o[6]),g(e,"data-nodeid",o[14]),g(e,"data-handlepos",o[2]),g(e,"data-id",t=o[13]+"-"+o[14]+"-"+(o[0]||null)+"-"+o[1]),g(e,"class",n=nn(["svelte-flow__handle",`svelte-flow__handle-${o[2]}`,"nodrag","nopan",o[2],o[4]])),g(e,"style",o[3]),g(e,"role","button"),g(e,"tabindex","-1"),gt(e,"valid",o[7]),gt(e,"connectingto",o[5]),gt(e,"connectingfrom",o[9]),gt(e,"source",!o[11]),gt(e,"target",o[11]),gt(e,"connectablestart",o[12]),gt(e,"connectableend",o[12]),gt(e,"connectable",o[12]),gt(e,"connectionindicator",o[12]&&(!o[10]||o[8]))},m(c,u){U(c,e,u),l&&l.m(e,null),r=!0,i||(s=[we(e,"mousedown",o[32]),we(e,"touchstart",o[32])],i=!0)},p(c,u){l&&l.p&&(!r||u[1]&8192)&&Kt(l,a,c,c[44],r?Wt(a,c[44],u,null):Gt(c[44]),null),(!r||u[0]&64)&&g(e,"data-handleid",c[6]),(!r||u[0]&4)&&g(e,"data-handlepos",c[2]),(!r||u[0]&8195&&t!==(t=c[13]+"-"+c[14]+"-"+(c[0]||null)+"-"+c[1]))&&g(e,"data-id",t),(!r||u[0]&20&&n!==(n=nn(["svelte-flow__handle",`svelte-flow__handle-${c[2]}`,"nodrag","nopan",c[2],c[4]])))&&g(e,"class",n),(!r||u[0]&8)&&g(e,"style",c[3]),(!r||u[0]&148)&&gt(e,"valid",c[7]),(!r||u[0]&52)&&gt(e,"connectingto",c[5]),(!r||u[0]&532)&&gt(e,"connectingfrom",c[9]),(!r||u[0]&2068)&&gt(e,"source",!c[11]),(!r||u[0]&2068)&&gt(e,"target",c[11]),(!r||u[0]&4116)&&gt(e,"connectablestart",c[12]),(!r||u[0]&4116)&&gt(e,"connectableend",c[12]),(!r||u[0]&4116)&&gt(e,"connectable",c[12]),(!r||u[0]&5396)&&gt(e,"connectionindicator",c[12]&&(!c[10]||c[8]))},i(c){r||(T(l,c),r=!0)},o(c){N(l,c),r=!1},d(c){c&&p(e),l&&l.d(c),i=!1,cn(s)}}}function gC(o,e,t){let n,r,i,s,a,l,c,u,d,f,h,_,b,v,m,y,w,I,S,k,C,R,D,H,z,{$$slots:W={},$$scope:K}=e,{id:P=void 0}=e,{type:V="source"}=e,{position:L=mt.Top}=e,{style:q=void 0}=e,{isValidConnection:Z=void 0}=e,{onconnect:Q=void 0}=e,{ondisconnect:Y=void 0}=e,{isConnectable:te=void 0}=e,{class:F=void 0}=e;const j=fn("svelteflow__node_id"),x=fn("svelteflow__node_connectable");fe(o,x,Ue=>t(43,z=Ue));const J=pn(),{connectionMode:ve,domNode:le,nodeLookup:me,connectionRadius:X,viewport:ue,isValidConnection:be,lib:Re,addEdge:Fe,onedgecreate:he,panBy:et,cancelConnection:ot,updateConnection:Et,autoPanOnConnect:Dt,edges:Yt,connectionLookup:Pt,onconnect:Zt,onconnectstart:jt,onconnectend:Ht,flowId:Qt,connection:se}=J;fe(o,ve,Ue=>t(40,f=Ue)),fe(o,le,Ue=>t(55,D=Ue)),fe(o,me,Ue=>t(54,R=Ue)),fe(o,X,Ue=>t(56,H=Ue)),fe(o,ue,Ue=>t(46,b=Ue)),fe(o,be,Ue=>t(51,I=Ue)),fe(o,Re,Ue=>t(53,C=Ue)),fe(o,he,Ue=>t(50,w=Ue)),fe(o,Dt,Ue=>t(52,k=Ue)),fe(o,Yt,Ue=>t(42,_=Ue)),fe(o,Pt,Ue=>t(41,h=Ue)),fe(o,Zt,Ue=>t(49,y=Ue)),fe(o,jt,Ue=>t(48,m=Ue)),fe(o,Ht,Ue=>t(47,v=Ue)),fe(o,Qt,Ue=>t(13,S=Ue)),fe(o,se,Ue=>t(39,d=Ue));function Qe(Ue){const en=Vg(Ue);(en&&Ue.button===0||!en)&&rC.onPointerDown(Ue,{handleId:i,nodeId:j,isTarget:n,connectionRadius:H,domNode:D,nodeLookup:R,connectionMode:f,lib:C,autoPanOnConnect:k,flowId:S,isValidConnection:Z??I,updateConnection:Et,cancelConnection:ot,panBy:et,onConnect:At=>{const pe=w?w(At):At;pe&&(Fe(pe),y==null||y(At))},onConnectStart:(At,pe)=>{m==null||m(At,{nodeId:pe.nodeId,handleId:pe.handleId,handleType:pe.handleType})},onConnectEnd:(At,pe)=>{v==null||v(At,pe)},getTransform:()=>[b.x,b.y,b.zoom],getFromHandle:()=>d.fromHandle})}let rt=null,pt;return o.$$set=Ue=>{"id"in Ue&&t(0,P=Ue.id),"type"in Ue&&t(1,V=Ue.type),"position"in Ue&&t(2,L=Ue.position),"style"in Ue&&t(3,q=Ue.style),"isValidConnection"in Ue&&t(33,Z=Ue.isValidConnection),"onconnect"in Ue&&t(34,Q=Ue.onconnect),"ondisconnect"in Ue&&t(35,Y=Ue.ondisconnect),"isConnectable"in Ue&&t(36,te=Ue.isConnectable),"class"in Ue&&t(4,F=Ue.class),"$$scope"in Ue&&t(44,K=Ue.$$scope)},o.$$.update=()=>{var Ue,en,At,pe,Xe,Be,Ze,Tt,St;if(o.$$.dirty[0]&2&&t(11,n=V==="target"),o.$$.dirty[1]&4128&&t(12,r=te!==void 0?te:z),o.$$.dirty[0]&1&&t(6,i=P||null),o.$$.dirty[0]&3|o.$$.dirty[1]&3096&&(Q||Y)&&t(38,pt=h.get(`${j}-${V}-${P||null}`)),o.$$.dirty[1]&216){if(rt&&!Ck(pt,rt)){const Nt=pt??new Map;rd(rt,Nt,Y),rd(Nt,rt,Q)}t(37,rt=pt??new Map)}o.$$.dirty[1]&256&&t(10,s=!!d.fromHandle),o.$$.dirty[0]&66|o.$$.dirty[1]&256&&t(9,a=((Ue=d.fromHandle)==null?void 0:Ue.nodeId)===j&&((en=d.fromHandle)==null?void 0:en.type)===V&&((At=d.fromHandle)==null?void 0:At.id)===i),o.$$.dirty[0]&66|o.$$.dirty[1]&256&&t(5,l=((pe=d.toHandle)==null?void 0:pe.nodeId)===j&&((Xe=d.toHandle)==null?void 0:Xe.type)===V&&((Be=d.toHandle)==null?void 0:Be.id)===i),o.$$.dirty[0]&66|o.$$.dirty[1]&768&&t(8,c=f===Ir.Strict?((Ze=d.fromHandle)==null?void 0:Ze.type)!==V:j!==((Tt=d.fromHandle)==null?void 0:Tt.nodeId)||i!==((St=d.fromHandle)==null?void 0:St.id)),o.$$.dirty[0]&32|o.$$.dirty[1]&256&&t(7,u=l&&d.isValid)},[P,V,L,q,F,l,i,u,c,a,s,n,r,S,j,x,ve,le,me,X,ue,be,Re,he,Dt,Yt,Pt,Zt,jt,Ht,Qt,se,Qe,Z,Q,Y,te,rt,pt,d,f,h,_,z,K,W]}class ei extends Ge{constructor(e){super(),We(this,e,gC,hC,Ye,{id:0,type:1,position:2,style:3,isValidConnection:33,onconnect:34,ondisconnect:35,isConnectable:36,class:4},null,[-1,-1])}}function mC(o){var l;let e,t,n=((l=o[0])==null?void 0:l.label)+"",r,i,s,a;return e=new ei({props:{type:"target",position:o[1]??mt.Top}}),s=new ei({props:{type:"source",position:o[2]??mt.Bottom}}),{c(){oe(e.$$.fragment),t=$(),r=Ie(n),i=$(),oe(s.$$.fragment)},l(c){ae(e.$$.fragment,c),t=ee(c),r=Te(c,n),i=ee(c),ae(s.$$.fragment,c)},m(c,u){re(e,c,u),U(c,t,u),U(c,r,u),U(c,i,u),re(s,c,u),a=!0},p(c,[u]){var h;const d={};u&2&&(d.position=c[1]??mt.Top),e.$set(d),(!a||u&1)&&n!==(n=((h=c[0])==null?void 0:h.label)+"")&&Pe(r,n);const f={};u&4&&(f.position=c[2]??mt.Bottom),s.$set(f)},i(c){a||(T(e.$$.fragment,c),T(s.$$.fragment,c),a=!0)},o(c){N(e.$$.fragment,c),N(s.$$.fragment,c),a=!1},d(c){c&&(p(t),p(r),p(i)),ie(e,c),ie(s,c)}}}function pC(o,e,t){const n=["data","targetPosition","sourcePosition"];$t(e,n);let{data:r={label:"Node"}}=e,{targetPosition:i=void 0}=e,{sourcePosition:s=void 0}=e;return o.$$set=a=>{e=wt(wt({},e),eo(a)),t(3,$t(e,n)),"data"in a&&t(0,r=a.data),"targetPosition"in a&&t(1,i=a.targetPosition),"sourcePosition"in a&&t(2,s=a.sourcePosition)},[r,i,s]}class om extends Ge{constructor(e){super(),We(this,e,pC,mC,Ye,{data:0,targetPosition:1,sourcePosition:2})}}function _C(o){var s;let e=((s=o[0])==null?void 0:s.label)+"",t,n,r,i;return r=new ei({props:{type:"source",position:o[1]??mt.Bottom}}),{c(){t=Ie(e),n=$(),oe(r.$$.fragment)},l(a){t=Te(a,e),n=ee(a),ae(r.$$.fragment,a)},m(a,l){U(a,t,l),U(a,n,l),re(r,a,l),i=!0},p(a,[l]){var u;(!i||l&1)&&e!==(e=((u=a[0])==null?void 0:u.label)+"")&&Pe(t,e);const c={};l&2&&(c.position=a[1]??mt.Bottom),r.$set(c)},i(a){i||(T(r.$$.fragment,a),i=!0)},o(a){N(r.$$.fragment,a),i=!1},d(a){a&&(p(t),p(n)),ie(r,a)}}}function bC(o,e,t){const n=["data","sourcePosition"];$t(e,n);let{data:r={label:"Node"}}=e,{sourcePosition:i=void 0}=e;return o.$$set=s=>{e=wt(wt({},e),eo(s)),t(2,$t(e,n)),"data"in s&&t(0,r=s.data),"sourcePosition"in s&&t(1,i=s.sourcePosition)},[r,i]}class yC extends Ge{constructor(e){super(),We(this,e,bC,_C,Ye,{data:0,sourcePosition:1})}}function vC(o){var s;let e=((s=o[0])==null?void 0:s.label)+"",t,n,r,i;return r=new ei({props:{type:"target",position:o[1]??mt.Top}}),{c(){t=Ie(e),n=$(),oe(r.$$.fragment)},l(a){t=Te(a,e),n=ee(a),ae(r.$$.fragment,a)},m(a,l){U(a,t,l),U(a,n,l),re(r,a,l),i=!0},p(a,[l]){var u;(!i||l&1)&&e!==(e=((u=a[0])==null?void 0:u.label)+"")&&Pe(t,e);const c={};l&2&&(c.position=a[1]??mt.Top),r.$set(c)},i(a){i||(T(r.$$.fragment,a),i=!0)},o(a){N(r.$$.fragment,a),i=!1},d(a){a&&(p(t),p(n)),ie(r,a)}}}function wC(o,e,t){const n=["data","targetPosition"];$t(e,n);let{data:r={label:"Node"}}=e,{targetPosition:i=void 0}=e;return o.$$set=s=>{e=wt(wt({},e),eo(s)),t(2,$t(e,n)),"data"in s&&t(0,r=s.data),"targetPosition"in s&&t(1,i=s.targetPosition)},[r,i]}class kC extends Ge{constructor(e){super(),We(this,e,wC,vC,Ye,{data:0,targetPosition:1})}}function CC(o,e,t){const n=[];return $t(e,n),o.$$set=r=>{e=wt(wt({},e),eo(r)),t(0,$t(e,n))},[]}class EC extends Ge{constructor(e){super(),We(this,e,CC,null,Ye,{})}}function vd(o,e,t){if(!e)return;const n=t?e.querySelector(t):e;n&&n.appendChild(o)}function IC(o,{target:e,domNode:t}){return vd(o,t,e),{async update({target:n,domNode:r}){vd(o,r,n)},destroy(){o.parentNode&&o.parentNode.removeChild(o)}}}function TC(o){let e,t,n,r,i;const s=o[3].default,a=Ft(s,o,o[2],null);return{c(){e=M("div"),a&&a.c()},l(l){e=O(l,"DIV",{});var c=A(e);a&&a.l(c),c.forEach(p)},m(l,c){U(l,e,c),a&&a.m(e,null),n=!0,r||(i=wn(t=IC.call(null,e,{target:".svelte-flow__edgelabel-renderer",domNode:o[0]})),r=!0)},p(l,[c]){a&&a.p&&(!n||c&4)&&Kt(a,s,l,l[2],n?Wt(s,l[2],c,null):Gt(l[2]),null),t&&In(t.update)&&c&1&&t.update.call(null,{target:".svelte-flow__edgelabel-renderer",domNode:l[0]})},i(l){n||(T(a,l),n=!0)},o(l){N(a,l),n=!1},d(l){l&&p(e),a&&a.d(l),r=!1,i()}}}function SC(o,e,t){let n,{$$slots:r={},$$scope:i}=e;const{domNode:s}=pn();return fe(o,s,a=>t(0,n=a)),o.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[n,s,i,r]}class AC extends Ge{constructor(e){super(),We(this,e,SC,TC,Ye,{})}}function rm(){const{edgeLookup:o,selectionRect:e,selectionRectMode:t,multiselectionKeyPressed:n,addSelectedEdges:r,unselectNodesAndEdges:i,elementsSelectable:s}=pn();return a=>{const l=ye(o).get(a);if(!l){console.warn("012",Li.error012(a));return}(l.selectable||ye(s)&&typeof l.selectable>"u")&&(e.set(null),t.set(null),l.selected?l.selected&&ye(n)&&i({nodes:[],edges:[l]}):r([a]))}}function RC(o){let e,t,n=`translate(-50%, -50%) translate(${o[1]}px,${o[2]}px)`,r,i,s;const a=o[5].default,l=Ft(a,o,o[7],null);return{c(){e=M("div"),l&&l.c(),this.h()},l(c){e=O(c,"DIV",{class:!0,style:!0,role:!0,tabindex:!0});var u=A(e);l&&l.l(u),u.forEach(p),this.h()},h(){g(e,"class","svelte-flow__edge-label"),g(e,"style",t="pointer-events: all;"+o[0]),g(e,"role","button"),g(e,"tabindex","-1"),lt(e,"transform",n)},m(c,u){U(c,e,u),l&&l.m(e,null),r=!0,i||(s=[we(e,"keyup",OC),we(e,"click",o[6])],i=!0)},p(c,u){l&&l.p&&(!r||u&128)&&Kt(l,a,c,c[7],r?Wt(a,c[7],u,null):Gt(c[7]),null),(!r||u&1&&t!==(t="pointer-events: all;"+c[0]))&&g(e,"style",t);const d=u&1;(u&7&&n!==(n=`translate(-50%, -50%) translate(${c[1]}px,${c[2]}px)`)||d)&&lt(e,"transform",n)},i(c){r||(T(l,c),r=!0)},o(c){N(l,c),r=!1},d(c){c&&p(e),l&&l.d(c),i=!1,cn(s)}}}function MC(o){let e,t;return e=new AC({props:{$$slots:{default:[RC]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,[r]){const i={};r&135&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}const OC=()=>{};function PC(o,e,t){let{$$slots:n={},$$scope:r}=e,{style:i=void 0}=e,{x:s=void 0}=e,{y:a=void 0}=e;const l=rm(),c=fn("svelteflow__edge_id"),u=()=>{c&&l(c)};return o.$$set=d=>{"style"in d&&t(0,i=d.style),"x"in d&&t(1,s=d.x),"y"in d&&t(2,a=d.y),"$$scope"in d&&t(7,r=d.$$scope)},[i,s,a,l,c,n,u,r]}class NC extends Ge{constructor(e){super(),We(this,e,PC,MC,Ye,{style:0,x:1,y:2})}}function DC(o){let e;return{c(){e=Me("path"),this.h()},l(t){e=Oe(t,"path",{d:!0,"stroke-opacity":!0,"stroke-width":!0,fill:!0,class:!0}),A(e).forEach(p),this.h()},h(){g(e,"d",o[1]),g(e,"stroke-opacity",0),g(e,"stroke-width",o[10]),g(e,"fill","none"),g(e,"class","svelte-flow__edge-interaction")},m(t,n){U(t,e,n)},p(t,n){n&2&&g(e,"d",t[1])},d(t){t&&p(e)}}}function wd(o){let e,t;return e=new NC({props:{x:o[3],y:o[4],style:o[5],$$slots:{default:[HC]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&8&&(i.x=n[3]),r&16&&(i.y=n[4]),r&32&&(i.style=n[5]),r&4100&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function HC(o){let e;return{c(){e=Ie(o[2])},l(t){e=Te(t,o[2])},m(t,n){U(t,e,n)},p(t,n){n&4&&Pe(e,t[2])},d(t){t&&p(e)}}}function LC(o){let e,t,n,r,i,s,a=o[10]&&DC(o),l=o[2]&&wd(o);return{c(){e=Me("path"),n=$(),a&&a.c(),r=$(),l&&l.c(),i=qe(),this.h()},l(c){e=Oe(c,"path",{id:!0,d:!0,class:!0,"marker-start":!0,"marker-end":!0,fill:!0,style:!0}),A(e).forEach(p),n=ee(c),a&&a.l(c),r=ee(c),l&&l.l(c),i=qe(),this.h()},h(){g(e,"id",o[0]),g(e,"d",o[1]),g(e,"class",t=nn(["svelte-flow__edge-path",o[9]])),g(e,"marker-start",o[6]),g(e,"marker-end",o[7]),g(e,"fill","none"),g(e,"style",o[8])},m(c,u){U(c,e,u),U(c,n,u),a&&a.m(c,u),U(c,r,u),l&&l.m(c,u),U(c,i,u),s=!0},p(c,[u]){(!s||u&1)&&g(e,"id",c[0]),(!s||u&2)&&g(e,"d",c[1]),(!s||u&512&&t!==(t=nn(["svelte-flow__edge-path",c[9]])))&&g(e,"class",t),(!s||u&64)&&g(e,"marker-start",c[6]),(!s||u&128)&&g(e,"marker-end",c[7]),(!s||u&256)&&g(e,"style",c[8]),c[10]&&a.p(c,u),c[2]?l?(l.p(c,u),u&4&&T(l,1)):(l=wd(c),l.c(),T(l,1),l.m(i.parentNode,i)):l&&(De(),N(l,1,1,()=>{l=null}),He())},i(c){s||(T(l),s=!0)},o(c){N(l),s=!1},d(c){c&&(p(e),p(n),p(r),p(i)),a&&a.d(c),l&&l.d(c)}}}function UC(o,e,t){let{id:n=void 0}=e,{path:r}=e,{label:i=void 0}=e,{labelX:s=void 0}=e,{labelY:a=void 0}=e,{labelStyle:l=void 0}=e,{markerStart:c=void 0}=e,{markerEnd:u=void 0}=e,{style:d=void 0}=e,{interactionWidth:f=20}=e,{class:h=void 0}=e,_=f===void 0?20:f;return o.$$set=b=>{"id"in b&&t(0,n=b.id),"path"in b&&t(1,r=b.path),"label"in b&&t(2,i=b.label),"labelX"in b&&t(3,s=b.labelX),"labelY"in b&&t(4,a=b.labelY),"labelStyle"in b&&t(5,l=b.labelStyle),"markerStart"in b&&t(6,c=b.markerStart),"markerEnd"in b&&t(7,u=b.markerEnd),"style"in b&&t(8,d=b.style),"interactionWidth"in b&&t(11,f=b.interactionWidth),"class"in b&&t(9,h=b.class)},[n,r,i,s,a,l,c,u,d,h,_,f]}class ta extends Ge{constructor(e){super(),We(this,e,UC,LC,Ye,{id:0,path:1,label:2,labelX:3,labelY:4,labelStyle:5,markerStart:6,markerEnd:7,style:8,interactionWidth:11,class:9})}}function BC(o){let e,t;return e=new ta({props:{path:o[8],labelX:o[7],labelY:o[6],label:o[0],labelStyle:o[1],markerStart:o[3],markerEnd:o[4],interactionWidth:o[5],style:o[2]}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,[r]){const i={};r&256&&(i.path=n[8]),r&128&&(i.labelX=n[7]),r&64&&(i.labelY=n[6]),r&1&&(i.label=n[0]),r&2&&(i.labelStyle=n[1]),r&8&&(i.markerStart=n[3]),r&16&&(i.markerEnd=n[4]),r&32&&(i.interactionWidth=n[5]),r&4&&(i.style=n[2]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function zC(o,e,t){let n,r,i;const s=["label","labelStyle","style","markerStart","markerEnd","interactionWidth","sourceX","sourceY","sourcePosition","targetX","targetY","targetPosition"];$t(e,s);let{label:a=void 0}=e,{labelStyle:l=void 0}=e,{style:c=void 0}=e,{markerStart:u=void 0}=e,{markerEnd:d=void 0}=e,{interactionWidth:f=void 0}=e,{sourceX:h}=e,{sourceY:_}=e,{sourcePosition:b}=e,{targetX:v}=e,{targetY:m}=e,{targetPosition:y}=e;return o.$$set=w=>{e=wt(wt({},e),eo(w)),t(15,$t(e,s)),"label"in w&&t(0,a=w.label),"labelStyle"in w&&t(1,l=w.labelStyle),"style"in w&&t(2,c=w.style),"markerStart"in w&&t(3,u=w.markerStart),"markerEnd"in w&&t(4,d=w.markerEnd),"interactionWidth"in w&&t(5,f=w.interactionWidth),"sourceX"in w&&t(9,h=w.sourceX),"sourceY"in w&&t(10,_=w.sourceY),"sourcePosition"in w&&t(11,b=w.sourcePosition),"targetX"in w&&t(12,v=w.targetX),"targetY"in w&&t(13,m=w.targetY),"targetPosition"in w&&t(14,y=w.targetPosition)},o.$$.update=()=>{o.$$.dirty&32256&&t(8,[n,r,i]=Fg({sourceX:h,sourceY:_,targetX:v,targetY:m,sourcePosition:b,targetPosition:y}),n,(t(7,r),t(9,h),t(10,_),t(12,v),t(13,m),t(11,b),t(14,y)),(t(6,i),t(9,h),t(10,_),t(12,v),t(13,m),t(11,b),t(14,y)))},[a,l,c,u,d,f,i,r,n,h,_,b,v,m,y]}class im extends Ge{constructor(e){super(),We(this,e,zC,BC,Ye,{label:0,labelStyle:1,style:2,markerStart:3,markerEnd:4,interactionWidth:5,sourceX:9,sourceY:10,sourcePosition:11,targetX:12,targetY:13,targetPosition:14})}}function VC(o){let e,t;return e=new ta({props:{path:o[8],labelX:o[7],labelY:o[6],label:o[0],labelStyle:o[1],markerStart:o[3],markerEnd:o[4],interactionWidth:o[5],style:o[2]}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,[r]){const i={};r&256&&(i.path=n[8]),r&128&&(i.labelX=n[7]),r&64&&(i.labelY=n[6]),r&1&&(i.label=n[0]),r&2&&(i.labelStyle=n[1]),r&8&&(i.markerStart=n[3]),r&16&&(i.markerEnd=n[4]),r&32&&(i.interactionWidth=n[5]),r&4&&(i.style=n[2]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function FC(o,e,t){let n,r,i;const s=["label","labelStyle","style","markerStart","markerEnd","interactionWidth","sourceX","sourceY","sourcePosition","targetX","targetY","targetPosition"];$t(e,s);let{label:a=void 0}=e,{labelStyle:l=void 0}=e,{style:c=void 0}=e,{markerStart:u=void 0}=e,{markerEnd:d=void 0}=e,{interactionWidth:f=void 0}=e,{sourceX:h}=e,{sourceY:_}=e,{sourcePosition:b}=e,{targetX:v}=e,{targetY:m}=e,{targetPosition:y}=e;return o.$$set=w=>{e=wt(wt({},e),eo(w)),t(15,$t(e,s)),"label"in w&&t(0,a=w.label),"labelStyle"in w&&t(1,l=w.labelStyle),"style"in w&&t(2,c=w.style),"markerStart"in w&&t(3,u=w.markerStart),"markerEnd"in w&&t(4,d=w.markerEnd),"interactionWidth"in w&&t(5,f=w.interactionWidth),"sourceX"in w&&t(9,h=w.sourceX),"sourceY"in w&&t(10,_=w.sourceY),"sourcePosition"in w&&t(11,b=w.sourcePosition),"targetX"in w&&t(12,v=w.targetX),"targetY"in w&&t(13,m=w.targetY),"targetPosition"in w&&t(14,y=w.targetPosition)},o.$$.update=()=>{o.$$.dirty&32256&&t(8,[n,r,i]=Rs({sourceX:h,sourceY:_,targetX:v,targetY:m,sourcePosition:b,targetPosition:y}),n,(t(7,r),t(9,h),t(10,_),t(12,v),t(13,m),t(11,b),t(14,y)),(t(6,i),t(9,h),t(10,_),t(12,v),t(13,m),t(11,b),t(14,y)))},[a,l,c,u,d,f,i,r,n,h,_,b,v,m,y]}class KC extends Ge{constructor(e){super(),We(this,e,FC,VC,Ye,{label:0,labelStyle:1,style:2,markerStart:3,markerEnd:4,interactionWidth:5,sourceX:9,sourceY:10,sourcePosition:11,targetX:12,targetY:13,targetPosition:14})}}function GC(o){let e,t;return e=new ta({props:{path:o[8],labelX:o[7],labelY:o[6],label:o[0],labelStyle:o[1],markerStart:o[3],markerEnd:o[4],interactionWidth:o[5],style:o[2]}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,[r]){const i={};r&256&&(i.path=n[8]),r&128&&(i.labelX=n[7]),r&64&&(i.labelY=n[6]),r&1&&(i.label=n[0]),r&2&&(i.labelStyle=n[1]),r&8&&(i.markerStart=n[3]),r&16&&(i.markerEnd=n[4]),r&32&&(i.interactionWidth=n[5]),r&4&&(i.style=n[2]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function WC(o,e,t){let n,r,i;const s=["label","labelStyle","style","markerStart","markerEnd","interactionWidth","sourceX","sourceY","targetX","targetY"];$t(e,s);let{label:a=void 0}=e,{labelStyle:l=void 0}=e,{style:c=void 0}=e,{markerStart:u=void 0}=e,{markerEnd:d=void 0}=e,{interactionWidth:f=void 0}=e,{sourceX:h}=e,{sourceY:_}=e,{targetX:b}=e,{targetY:v}=e;return o.$$set=m=>{e=wt(wt({},e),eo(m)),t(13,$t(e,s)),"label"in m&&t(0,a=m.label),"labelStyle"in m&&t(1,l=m.labelStyle),"style"in m&&t(2,c=m.style),"markerStart"in m&&t(3,u=m.markerStart),"markerEnd"in m&&t(4,d=m.markerEnd),"interactionWidth"in m&&t(5,f=m.interactionWidth),"sourceX"in m&&t(9,h=m.sourceX),"sourceY"in m&&t(10,_=m.sourceY),"targetX"in m&&t(11,b=m.targetX),"targetY"in m&&t(12,v=m.targetY)},o.$$.update=()=>{o.$$.dirty&7680&&t(8,[n,r,i]=Gg({sourceX:h,sourceY:_,targetX:b,targetY:v}),n,(t(7,r),t(9,h),t(10,_),t(11,b),t(12,v)),(t(6,i),t(9,h),t(10,_),t(11,b),t(12,v)))},[a,l,c,u,d,f,i,r,n,h,_,b,v]}class qC extends Ge{constructor(e){super(),We(this,e,WC,GC,Ye,{label:0,labelStyle:1,style:2,markerStart:3,markerEnd:4,interactionWidth:5,sourceX:9,sourceY:10,targetX:11,targetY:12})}}function YC(o){let e,t;return e=new ta({props:{path:o[8],labelX:o[7],labelY:o[6],label:o[0],labelStyle:o[1],markerStart:o[3],markerEnd:o[4],interactionWidth:o[5],style:o[2]}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,[r]){const i={};r&256&&(i.path=n[8]),r&128&&(i.labelX=n[7]),r&64&&(i.labelY=n[6]),r&1&&(i.label=n[0]),r&2&&(i.labelStyle=n[1]),r&8&&(i.markerStart=n[3]),r&16&&(i.markerEnd=n[4]),r&32&&(i.interactionWidth=n[5]),r&4&&(i.style=n[2]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function jC(o,e,t){let n,r,i;const s=["label","labelStyle","style","markerStart","markerEnd","interactionWidth","sourceX","sourceY","sourcePosition","targetX","targetY","targetPosition"];$t(e,s);let{label:a=void 0}=e,{labelStyle:l=void 0}=e,{style:c=void 0}=e,{markerStart:u=void 0}=e,{markerEnd:d=void 0}=e,{interactionWidth:f=void 0}=e,{sourceX:h}=e,{sourceY:_}=e,{sourcePosition:b}=e,{targetX:v}=e,{targetY:m}=e,{targetPosition:y}=e;return o.$$set=w=>{e=wt(wt({},e),eo(w)),t(15,$t(e,s)),"label"in w&&t(0,a=w.label),"labelStyle"in w&&t(1,l=w.labelStyle),"style"in w&&t(2,c=w.style),"markerStart"in w&&t(3,u=w.markerStart),"markerEnd"in w&&t(4,d=w.markerEnd),"interactionWidth"in w&&t(5,f=w.interactionWidth),"sourceX"in w&&t(9,h=w.sourceX),"sourceY"in w&&t(10,_=w.sourceY),"sourcePosition"in w&&t(11,b=w.sourcePosition),"targetX"in w&&t(12,v=w.targetX),"targetY"in w&&t(13,m=w.targetY),"targetPosition"in w&&t(14,y=w.targetPosition)},o.$$.update=()=>{o.$$.dirty&32256&&t(8,[n,r,i]=Rs({sourceX:h,sourceY:_,targetX:v,targetY:m,sourcePosition:b,targetPosition:y,borderRadius:0}),n,(t(7,r),t(9,h),t(10,_),t(12,v),t(13,m),t(11,b),t(14,y)),(t(6,i),t(9,h),t(10,_),t(12,v),t(13,m),t(11,b),t(14,y)))},[a,l,c,u,d,f,i,r,n,h,_,b,v,m,y]}class QC extends Ge{constructor(e){super(),We(this,e,jC,YC,Ye,{label:0,labelStyle:1,style:2,markerStart:3,markerEnd:4,interactionWidth:5,sourceX:9,sourceY:10,sourcePosition:11,targetX:12,targetY:13,targetPosition:14})}}function XC(o,e){const t=o.set,n=e.set,r=ye(o),i=ye(e);let a=r.length===0&&i.length>0?i:r;o.set(a);const l=c=>{const u=t(c);return a=u,n(a),u};o.set=e.set=l,o.update=e.update=c=>l(c(a))}function JC(o,e){const t=o.set,n=e.set;let r=ye(e);o.set(r);const i=s=>{t(s),n(s),r=s};o.set=e.set=i,o.update=e.update=s=>i(s(r))}const ZC=(o,e,t)=>{if(!t)return;const n=ye(o),r=e.set,i=t.set;let s=t?ye(t):{x:0,y:0,zoom:1};e.set(s),e.set=a=>(r(a),i(a),s=a,a),t.set=a=>(n==null||n.syncViewport(a),r(a),i(a),s=a,a),e.update=a=>{e.set(a(s))},t.update=a=>{t.set(a(s))}},xC=(o,e,t,n=[0,0],r=Es)=>{const{subscribe:i,set:s,update:a}=st([]);let l=o,c={},u=!0;const d=b=>(Yg(b,e,t,{elevateNodesOnSelect:u,nodeOrigin:n,nodeExtent:r,defaults:c,checkEquality:!1}),l=b,s(l),l),f=b=>d(b(l)),h=b=>{c=b},_=b=>{u=b.elevateNodesOnSelect??u};return d(l),{subscribe:i,set:d,update:f,setDefaultOptions:h,setOptions:_}},$C=(o,e,t,n)=>{const{subscribe:r,set:i,update:s}=st([]);let a=o,l={};const c=f=>{const h=l?f.map(_=>({...l,..._})):f;Xg(e,t,h),a=h,i(a)},u=f=>c(f(a)),d=f=>{l=f};return c(a),{subscribe:r,set:c,update:u,setDefaultOptions:d}},sm={input:yC,output:kC,default:om,group:EC},am={straight:qC,smoothstep:KC,default:im,step:QC},e2=({nodes:o=[],edges:e=[],width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:s})=>{const a=new Map,l=new Map,c=new Map,u=new Map,d=i??[0,0],f=s??Es;Yg(o,a,l,{nodeExtent:f,nodeOrigin:d,elevateNodesOnSelect:!1,checkEquality:!1}),Xg(c,u,e);let h={x:0,y:0,zoom:1};if(r&&t&&n){const _=Zs(a,{filter:b=>!!((b.width||b.initialWidth)&&(b.height||b.initialHeight))});h=Ql(_,t,n,.5,2,.1)}return{flowId:st(null),nodes:xC(o,a,l,d,f),nodeLookup:bo(a),parentLookup:bo(l),edgeLookup:bo(u),visibleNodes:bo([]),edges:$C(e,c,u),visibleEdges:bo([]),connectionLookup:bo(c),height:st(500),width:st(500),minZoom:st(.5),maxZoom:st(2),nodeOrigin:st(d),nodeDragThreshold:st(1),nodeExtent:st(f),translateExtent:st(Es),autoPanOnNodeDrag:st(!0),autoPanOnConnect:st(!0),fitViewOnInit:st(!1),fitViewOnInitDone:st(!1),fitViewOptions:st(void 0),panZoom:st(null),snapGrid:st(null),dragging:st(!1),selectionRect:st(null),selectionKeyPressed:st(!1),multiselectionKeyPressed:st(!1),deleteKeyPressed:st(!1),panActivationKeyPressed:st(!1),zoomActivationKeyPressed:st(!1),selectionRectMode:st(null),selectionMode:st(Is.Partial),nodeTypes:st(sm),edgeTypes:st(am),viewport:st(h),connectionMode:st(Ir.Strict),domNode:st(null),connection:bo(Ya),connectionLineType:st(Wr.Bezier),connectionRadius:st(20),isValidConnection:st(()=>!0),nodesDraggable:st(!0),nodesConnectable:st(!0),elementsSelectable:st(!0),selectNodesOnDrag:st(!0),markers:bo([]),defaultMarkerColor:st("#b1b1b7"),lib:bo("svelte"),onlyRenderVisibleElements:st(!1),onerror:st(Rk),ondelete:st(void 0),onedgecreate:st(void 0),onconnect:st(void 0),onconnectstart:st(void 0),onconnectend:st(void 0),onbeforedelete:st(void 0),nodesInitialized:st(!1),edgesInitialized:st(!1),viewportInitialized:st(!1),initialized:bo(!1)}};function t2(o){const e=br([o.edges,o.nodes,o.nodeLookup,o.onlyRenderVisibleElements,o.viewport,o.width,o.height],([t,,n,r,i,s,a])=>r&&s&&a?t.filter(c=>{const u=n.get(c.source),d=n.get(c.target);return u&&d&&Lk({sourceNode:u,targetNode:d,width:s,height:a,transform:[i.x,i.y,i.zoom]})}):t);return br([e,o.nodes,o.nodeLookup,o.connectionMode,o.onerror],([t,,n,r,i])=>t.reduce((a,l)=>{const c=n.get(l.source),u=n.get(l.target);if(!c||!u)return a;const d=Gk({id:l.id,sourceNode:c,targetNode:u,sourceHandle:l.sourceHandle||null,targetHandle:l.targetHandle||null,connectionMode:r,onError:i});return d&&a.push({...l,zIndex:Hk({selected:l.selected,zIndex:l.zIndex,sourceNode:c,targetNode:u,elevateOnSelect:!1}),...d}),a},[]))}function n2(o){return br([o.nodeLookup,o.onlyRenderVisibleElements,o.width,o.height,o.viewport,o.nodes],([e,t,n,r,i])=>{const s=[i.x,i.y,i.zoom];return t?Dg(e,{x:0,y:0,width:n,height:r},s,!0):Array.from(e.values())})}const na=Symbol();function lm({nodes:o,edges:e,width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:s}){const a=e2({nodes:o,edges:e,width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:s});function l(L){a.nodeTypes.set({...sm,...L})}function c(L){a.edgeTypes.set({...am,...L})}function u(L){const q=ye(a.edges);a.edges.set(zk(L,q))}const d=(L,q=!1)=>{var Q;const Z=ye(a.nodeLookup);for(const[Y,te]of L){const F=(Q=Z.get(Y))==null?void 0:Q.internals.userNode;F&&(F.position=te.position,F.dragging=q)}a.nodes.update(Y=>Y)};function f(L){var Y,te,F;const q=ye(a.nodeLookup),{changes:Z,updatedInternals:Q}=Xk(L,q,ye(a.parentLookup),ye(a.domNode),ye(a.nodeOrigin));if(Q){if(!ye(a.fitViewOnInitDone)&&ye(a.fitViewOnInit)){const j=ye(a.fitViewOptions),x=_({...j,nodes:j==null?void 0:j.nodes});a.fitViewOnInitDone.set(x)}for(const j of Z){const x=(Y=q.get(j.id))==null?void 0:Y.internals.userNode;if(x)switch(j.type){case"dimensions":{const J={...x.measured,...j.dimensions};j.setAttributes&&(x.width=((te=j.dimensions)==null?void 0:te.width)??x.width,x.height=((F=j.dimensions)==null?void 0:F.height)??x.height),x.measured=J;break}case"position":x.position=j.position??x.position;break}}a.nodes.update(j=>j),ye(a.nodesInitialized)||a.nodesInitialized.set(!0)}}function h(L){const q=ye(a.panZoom);if(!q)return Promise.resolve(!1);const Z=sd(ye(a.nodeLookup),L);return ad({nodes:Z,width:ye(a.width),height:ye(a.height),minZoom:ye(a.minZoom),maxZoom:ye(a.maxZoom),panZoom:q},L)}function _(L){const q=ye(a.panZoom);if(!q)return!1;const Z=sd(ye(a.nodeLookup),L);return ad({nodes:Z,width:ye(a.width),height:ye(a.height),minZoom:ye(a.minZoom),maxZoom:ye(a.maxZoom),panZoom:q},L),Z.size>0}function b(L,q){const Z=ye(a.panZoom);return Z?Z.scaleBy(L,q):Promise.resolve(!1)}function v(L){return b(1.2,L)}function m(L){return b(1/1.2,L)}function y(L){const q=ye(a.panZoom);q&&(q.setScaleExtent([L,ye(a.maxZoom)]),a.minZoom.set(L))}function w(L){const q=ye(a.panZoom);q&&(q.setScaleExtent([ye(a.minZoom),L]),a.maxZoom.set(L))}function I(L){const q=ye(a.panZoom);q&&(q.setTranslateExtent(L),a.translateExtent.set(L))}function S(L){let q=!1;return L.forEach(Z=>{Z.selected&&(Z.selected=!1,q=!0)}),q}function k(L){var q;(q=ye(a.panZoom))==null||q.setClickDistance(L)}function C(L){S((L==null?void 0:L.nodes)||ye(a.nodes))&&a.nodes.set(ye(a.nodes)),S((L==null?void 0:L.edges)||ye(a.edges))&&a.edges.set(ye(a.edges))}a.deleteKeyPressed.subscribe(async L=>{var q;if(L){const Z=ye(a.nodes),Q=ye(a.edges),Y=Z.filter(x=>x.selected),te=Q.filter(x=>x.selected),{nodes:F,edges:j}=await Hg({nodesToRemove:Y,edgesToRemove:te,nodes:Z,edges:Q,onBeforeDelete:ye(a.onbeforedelete)});(F.length||j.length)&&(a.nodes.update(x=>x.filter(J=>!F.some(ve=>ve.id===J.id))),a.edges.update(x=>x.filter(J=>!j.some(ve=>ve.id===J.id))),(q=ye(a.ondelete))==null||q({nodes:F,edges:j}))}});function R(L){const q=ye(a.multiselectionKeyPressed);a.nodes.update(Z=>Z.map(Q=>{const Y=L.includes(Q.id),te=q&&Q.selected||Y;return Q.selected=te,Q})),q||a.edges.update(Z=>Z.map(Q=>(Q.selected=!1,Q)))}function D(L){const q=ye(a.multiselectionKeyPressed);a.edges.update(Z=>Z.map(Q=>{const Y=L.includes(Q.id),te=q&&Q.selected||Y;return Q.selected=te,Q})),q||a.nodes.update(Z=>Z.map(Q=>(Q.selected=!1,Q)))}function H(L){var Z;const q=(Z=ye(a.nodes))==null?void 0:Z.find(Q=>Q.id===L);if(!q){console.warn("012",Li.error012(L));return}a.selectionRect.set(null),a.selectionRectMode.set(null),q.selected?q.selected&&ye(a.multiselectionKeyPressed)&&C({nodes:[q],edges:[]}):R([L])}function z(L){const q=ye(a.viewport);return Jk({delta:L,panZoom:ye(a.panZoom),transform:[q.x,q.y,q.zoom],translateExtent:ye(a.translateExtent),width:ye(a.width),height:ye(a.height)})}const W=st(Ya),K=L=>{W.set({...L})};function P(){W.set(Ya)}function V(){a.fitViewOnInitDone.set(!1),a.selectionRect.set(null),a.selectionRectMode.set(null),a.snapGrid.set(null),a.isValidConnection.set(()=>!0),C(),P()}return{...a,visibleEdges:t2(a),visibleNodes:n2(a),connection:br([W,a.viewport],([L,q])=>L.inProgress?{...L,to:Ui(L.to,[q.x,q.y,q.zoom])}:{...L}),markers:br([a.edges,a.defaultMarkerColor,a.flowId],([L,q,Z])=>Wk(L,{defaultColor:q,id:Z})),initialized:(()=>{let L=!1;const q=ye(a.nodes).length,Z=ye(a.edges).length;return br([a.nodesInitialized,a.edgesInitialized,a.viewportInitialized],([Q,Y,te])=>L||(q===0?L=te:Z===0?L=te&&Q:L=te&&Q&&Y,L))})(),syncNodeStores:L=>XC(a.nodes,L),syncEdgeStores:L=>JC(a.edges,L),syncViewport:L=>ZC(a.panZoom,a.viewport,L),setNodeTypes:l,setEdgeTypes:c,addEdge:u,updateNodePositions:d,updateNodeInternals:f,zoomIn:v,zoomOut:m,fitView:L=>h(L),setMinZoom:y,setMaxZoom:w,setTranslateExtent:I,setPaneClickDistance:k,unselectNodesAndEdges:C,addSelectedNodes:R,addSelectedEdges:D,handleNodeSelection:H,panBy:z,updateConnection:K,cancelConnection:P,reset:V}}function pn(){const o=fn(na);if(!o)throw new Error("In order to use useStore you need to wrap your component in a <SvelteFlowProvider />");return o.getStore()}function o2({nodes:o,edges:e,width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:s}){const a=lm({nodes:o,edges:e,width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:s});return yi(na,{getStore:()=>a}),a}function r2(o,e){const{panZoom:t,minZoom:n,maxZoom:r,initialViewport:i,viewport:s,dragging:a,translateExtent:l,paneClickDistance:c}=e,u=fC({domNode:o,minZoom:n,maxZoom:r,translateExtent:l,viewport:i,paneClickDistance:c,onDraggingChange:a.set}),d=u.getViewport();return s.set(d),t.set(u),u.update(e),{update(f){u.update(f)}}}function i2(o){let e,t,n,r,i;const s=o[35].default,a=Ft(s,o,o[34],null);return{c(){e=M("div"),a&&a.c(),this.h()},l(l){e=O(l,"DIV",{class:!0});var c=A(e);a&&a.l(c),c.forEach(p),this.h()},h(){g(e,"class","svelte-flow__zoom svelte-4xkw84")},m(l,c){U(l,e,c),a&&a.m(e,null),n=!0,r||(i=wn(t=r2.call(null,e,{viewport:o[18],minZoom:o[12],maxZoom:o[13],initialViewport:o[11],dragging:o[23],panZoom:o[19],onPanZoomStart:o[0],onPanZoom:o[1],onPanZoomEnd:o[2],zoomOnScroll:o[5],zoomOnDoubleClick:o[6],zoomOnPinch:o[7],panOnScroll:o[9],panOnDrag:o[10],panOnScrollSpeed:.5,panOnScrollMode:o[3]||Bo.Free,zoomActivationKeyPressed:o[14],preventScrolling:typeof o[4]=="boolean"?o[4]:!0,noPanClassName:"nopan",noWheelClassName:"nowheel",userSelectionActive:!!o[15],translateExtent:o[16],lib:o[17],paneClickDistance:o[8],onTransformChange:o[29]})),r=!0)},p(l,c){a&&a.p&&(!n||c[1]&8)&&Kt(a,s,l,l[34],n?Wt(s,l[34],c,null):Gt(l[34]),null),t&&In(t.update)&&c[0]&262143&&t.update.call(null,{viewport:l[18],minZoom:l[12],maxZoom:l[13],initialViewport:l[11],dragging:l[23],panZoom:l[19],onPanZoomStart:l[0],onPanZoom:l[1],onPanZoomEnd:l[2],zoomOnScroll:l[5],zoomOnDoubleClick:l[6],zoomOnPinch:l[7],panOnScroll:l[9],panOnDrag:l[10],panOnScrollSpeed:.5,panOnScrollMode:l[3]||Bo.Free,zoomActivationKeyPressed:l[14],preventScrolling:typeof l[4]=="boolean"?l[4]:!0,noPanClassName:"nopan",noWheelClassName:"nowheel",userSelectionActive:!!l[15],translateExtent:l[16],lib:l[17],paneClickDistance:l[8],onTransformChange:l[29]})},i(l){n||(T(a,l),n=!0)},o(l){N(a,l),n=!1},d(l){l&&p(e),a&&a.d(l),r=!1,i()}}}function s2(o,e,t){let n,r,i,s,a,l,c,u,d,f,h,{$$slots:_={},$$scope:b}=e,{initialViewport:v=void 0}=e,{onMoveStart:m=void 0}=e,{onMove:y=void 0}=e,{onMoveEnd:w=void 0}=e,{panOnScrollMode:I}=e,{preventScrolling:S}=e,{zoomOnScroll:k}=e,{zoomOnDoubleClick:C}=e,{zoomOnPinch:R}=e,{panOnDrag:D}=e,{panOnScroll:H}=e,{paneClickDistance:z}=e;const{viewport:W,panZoom:K,selectionRect:P,minZoom:V,maxZoom:L,dragging:q,translateExtent:Z,lib:Q,panActivationKeyPressed:Y,zoomActivationKeyPressed:te,viewportInitialized:F}=pn();fe(o,P,x=>t(15,d=x)),fe(o,V,x=>t(12,l=x)),fe(o,L,x=>t(13,c=x)),fe(o,Z,x=>t(16,f=x)),fe(o,Q,x=>t(17,h=x)),fe(o,Y,x=>t(33,a=x)),fe(o,te,x=>t(14,u=x)),fe(o,F,x=>t(36,s=x));const j=x=>W.set({x:x[0],y:x[1],zoom:x[2]});return Kn(()=>{ls(F,s=!0,s)}),o.$$set=x=>{"initialViewport"in x&&t(30,v=x.initialViewport),"onMoveStart"in x&&t(0,m=x.onMoveStart),"onMove"in x&&t(1,y=x.onMove),"onMoveEnd"in x&&t(2,w=x.onMoveEnd),"panOnScrollMode"in x&&t(3,I=x.panOnScrollMode),"preventScrolling"in x&&t(4,S=x.preventScrolling),"zoomOnScroll"in x&&t(5,k=x.zoomOnScroll),"zoomOnDoubleClick"in x&&t(6,C=x.zoomOnDoubleClick),"zoomOnPinch"in x&&t(7,R=x.zoomOnPinch),"panOnDrag"in x&&t(31,D=x.panOnDrag),"panOnScroll"in x&&t(32,H=x.panOnScroll),"paneClickDistance"in x&&t(8,z=x.paneClickDistance),"$$scope"in x&&t(34,b=x.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&1073741824&&t(11,n=v||{x:0,y:0,zoom:1}),o.$$.dirty[1]&5&&t(10,r=a||D),o.$$.dirty[1]&6&&t(9,i=a||H)},[m,y,w,I,S,k,C,R,z,i,r,n,l,c,u,d,f,h,W,K,P,V,L,q,Z,Q,Y,te,F,j,v,D,H,a,b,_]}class a2 extends Ge{constructor(e){super(),We(this,e,s2,i2,Ye,{initialViewport:30,onMoveStart:0,onMove:1,onMoveEnd:2,panOnScrollMode:3,preventScrolling:4,zoomOnScroll:5,zoomOnDoubleClick:6,zoomOnPinch:7,panOnDrag:31,panOnScroll:32,paneClickDistance:8},null,[-1,-1])}}function l2(o){let e,t,n,r;const i=o[28].default,s=Ft(i,o,o[27],null);return{c(){e=M("div"),s&&s.c(),this.h()},l(a){e=O(a,"DIV",{class:!0});var l=A(e);s&&s.l(l),l.forEach(p),this.h()},h(){g(e,"class","svelte-flow__pane svelte-1esy7hx"),gt(e,"draggable",o[0]===!0||Array.isArray(o[0])&&o[0].includes(0)),gt(e,"dragging",o[4]),gt(e,"selection",o[1])},m(a,l){U(a,e,l),s&&s.m(e,null),o[29](e),t=!0,n||(r=[we(e,"click",function(){In(o[3]?void 0:os(o[15],o[2]))&&(o[3]?void 0:os(o[15],o[2])).apply(this,arguments)}),we(e,"pointerdown",function(){In(o[3]?o[16]:void 0)&&(o[3]?o[16]:void 0).apply(this,arguments)}),we(e,"pointermove",function(){In(o[3]?o[17]:void 0)&&(o[3]?o[17]:void 0).apply(this,arguments)}),we(e,"pointerup",function(){In(o[3]?o[18]:void 0)&&(o[3]?o[18]:void 0).apply(this,arguments)}),we(e,"contextmenu",function(){In(os(o[19],o[2]))&&os(o[19],o[2]).apply(this,arguments)})],n=!0)},p(a,l){o=a,s&&s.p&&(!t||l[0]&134217728)&&Kt(s,i,o,o[27],t?Wt(i,o[27],l,null):Gt(o[27]),null),(!t||l[0]&1)&&gt(e,"draggable",o[0]===!0||Array.isArray(o[0])&&o[0].includes(0)),(!t||l[0]&16)&&gt(e,"dragging",o[4]),(!t||l[0]&2)&&gt(e,"selection",o[1])},i(a){t||(T(s,a),t=!0)},o(a){N(s,a),t=!1},d(a){a&&p(e),s&&s.d(a),o[29](null),n=!1,cn(r)}}}function os(o,e){return t=>{t.target===e&&(o==null||o(t))}}function kd(o){return e=>{const t=o.includes(e.id);return e.selected!==t&&(e.selected=t),e}}function c2(o,e,t){let n,r,i,s,a,l,c,u,d,f,h,_,b,{$$slots:v={},$$scope:m}=e,{panOnDrag:y=void 0}=e,{selectionOnDrag:w=void 0}=e;const I=An(),{nodes:S,nodeLookup:k,edges:C,viewport:R,dragging:D,elementsSelectable:H,selectionRect:z,selectionRectMode:W,selectionKeyPressed:K,selectionMode:P,panActivationKeyPressed:V,unselectNodesAndEdges:L}=pn();fe(o,k,le=>t(36,d=le)),fe(o,C,le=>t(33,l=le)),fe(o,R,le=>t(35,u=le)),fe(o,D,le=>t(4,b=le)),fe(o,H,le=>t(25,h=le)),fe(o,z,le=>t(24,f=le)),fe(o,W,le=>t(23,a=le)),fe(o,K,le=>t(22,s=le)),fe(o,P,le=>t(34,c=le)),fe(o,V,le=>t(26,_=le));let q,Z=null,Q=[],Y=!1;function te(le){if(Y){Y=!1;return}I("paneclick",{event:le}),L(),W.set(null)}function F(le){var ue,be;if(Z=q.getBoundingClientRect(),!H||!r||le.button!==0||le.target!==q||!Z)return;(be=(ue=le.target)==null?void 0:ue.setPointerCapture)==null||be.call(ue,le.pointerId);const{x:me,y:X}=Jo(le,Z);L(),z.set({width:0,height:0,startX:me,startY:X,x:me,y:X})}function j(le){if(!r||!Z||!f)return;Y=!0;const me=Jo(le,Z),X=f.startX??0,ue=f.startY??0,be={...f,x:me.x<X?me.x:X,y:me.y<ue?me.y:ue,width:Math.abs(me.x-X),height:Math.abs(me.y-ue)},Re=Q.map(ot=>ot.id),Fe=ja(Q,l).map(ot=>ot.id);Q=Dg(d,be,[u.x,u.y,u.zoom],c===Is.Partial,!0);const he=ja(Q,l).map(ot=>ot.id),et=Q.map(ot=>ot.id);(Re.length!==et.length||et.some(ot=>!Re.includes(ot)))&&S.update(ot=>ot.map(kd(et))),(Fe.length!==he.length||he.some(ot=>!Fe.includes(ot)))&&C.update(ot=>ot.map(kd(he))),W.set("user"),z.set(be)}function x(le){var me,X;le.button===0&&((X=(me=le.target)==null?void 0:me.releasePointerCapture)==null||X.call(me,le.pointerId),!r&&a==="user"&&le.target===q&&(te==null||te(le)),z.set(null),Q.length>0&&ls(W,a="nodes",a),s&&(Y=!1))}const J=le=>{if(Array.isArray(n)&&(n!=null&&n.includes(2))){le.preventDefault();return}I("panecontextmenu",{event:le})};function ve(le){ze[le?"unshift":"push"](()=>{q=le,t(2,q)})}return o.$$set=le=>{"panOnDrag"in le&&t(0,y=le.panOnDrag),"selectionOnDrag"in le&&t(20,w=le.selectionOnDrag),"$$scope"in le&&t(27,m=le.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&67108865&&t(21,n=_||y),o.$$.dirty[0]&24117248&&t(1,r=s||f||w&&n!==!0),o.$$.dirty[0]&41943042&&t(3,i=h&&(r||a==="user"))},[y,r,q,i,b,k,C,R,D,H,z,W,K,P,V,te,F,j,x,J,w,n,s,a,f,h,_,m,v,ve]}class u2 extends Ge{constructor(e){super(),We(this,e,c2,l2,Ye,{panOnDrag:0,selectionOnDrag:20},null,[-1,-1])}}function d2(o){let e,t;const n=o[3].default,r=Ft(n,o,o[2],null);return{c(){e=M("div"),r&&r.c(),this.h()},l(i){e=O(i,"DIV",{class:!0,style:!0});var s=A(e);r&&r.l(s),s.forEach(p),this.h()},h(){g(e,"class","svelte-flow__viewport xyflow__viewport svelte-1floaup"),lt(e,"transform","translate("+o[0].x+"px, "+o[0].y+"px) scale("+o[0].zoom+")")},m(i,s){U(i,e,s),r&&r.m(e,null),t=!0},p(i,[s]){r&&r.p&&(!t||s&4)&&Kt(r,n,i,i[2],t?Wt(n,i[2],s,null):Gt(i[2]),null),(!t||s&1)&&lt(e,"transform","translate("+i[0].x+"px, "+i[0].y+"px) scale("+i[0].zoom+")")},i(i){t||(T(r,i),t=!0)},o(i){N(r,i),t=!1},d(i){i&&p(e),r&&r.d(i)}}}function f2(o,e,t){let n,{$$slots:r={},$$scope:i}=e;const{viewport:s}=pn();return fe(o,s,a=>t(0,n=a)),o.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[n,s,i,r]}class h2 extends Ge{constructor(e){super(),We(this,e,f2,d2,Ye,{})}}function cm(o,e){const{store:t,onDrag:n,onDragStart:r,onDragStop:i,onNodeMouseDown:s}=e,a=xk({onDrag:n,onDragStart:r,onDragStop:i,onNodeMouseDown:s,getStoreItems:()=>{const c=ye(t.snapGrid),u=ye(t.viewport);return{nodes:ye(t.nodes),nodeLookup:ye(t.nodeLookup),edges:ye(t.edges),nodeExtent:ye(t.nodeExtent),snapGrid:c||[0,0],snapToGrid:!!c,nodeOrigin:ye(t.nodeOrigin),multiSelectionActive:ye(t.multiselectionKeyPressed),domNode:ye(t.domNode),transform:[u.x,u.y,u.zoom],autoPanOnNodeDrag:ye(t.autoPanOnNodeDrag),nodesDraggable:ye(t.nodesDraggable),selectNodesOnDrag:ye(t.selectNodesOnDrag),nodeDragThreshold:ye(t.nodeDragThreshold),unselectNodesAndEdges:t.unselectNodesAndEdges,updateNodePositions:t.updateNodePositions,panBy:t.panBy}}});function l(c,u){if(u.disabled){a.destroy();return}a.update({domNode:c,noDragClassName:u.noDragClass,handleSelector:u.handleSelector,nodeId:u.nodeId,isSelectable:u.isSelectable,nodeClickDistance:u.nodeClickDistance})}return l(o,e),{update(c){l(o,c)},destroy(){a.destroy()}}}function g2({width:o,height:e,initialWidth:t,initialHeight:n,measuredWidth:r,measuredHeight:i}){if(r===void 0&&i===void 0){const s=o??t,a=e??n;return{width:s?`width:${s}px;`:"",height:a?`height:${a}px;`:""}}return{width:o?`width:${o}px;`:"",height:e?`height:${e}px;`:""}}function Cd(o){let e,t,n,r,i,s=`translate(${o[12]}px, ${o[13]}px)`,a,l,c;var u=o[27];function d(f,h){return{props:{data:f[2],id:f[1],selected:f[3],selectable:f[5],deletable:f[7],sourcePosition:f[14],targetPosition:f[15],zIndex:f[16],dragging:f[9],draggable:f[4],dragHandle:f[19],parentId:f[21],type:f[25],isConnectable:f[28],positionAbsoluteX:f[12],positionAbsoluteY:f[13],width:f[17],height:f[18]}}}return u&&(t=cs(u,d(o))),{c(){e=M("div"),t&&oe(t.$$.fragment),this.h()},l(f){e=O(f,"DIV",{"data-id":!0,class:!0,style:!0});var h=A(e);t&&ae(t.$$.fragment,h),h.forEach(p),this.h()},h(){g(e,"data-id",o[1]),g(e,"class",n=nn(["svelte-flow__node",`svelte-flow__node-${o[25]}`,o[23]])),g(e,"style",r=(o[10]??"")+";"+o[26].width+o[26].height),gt(e,"dragging",o[9]),gt(e,"selected",o[3]),gt(e,"draggable",o[4]),gt(e,"connectable",o[6]),gt(e,"selectable",o[5]),gt(e,"nopan",o[4]),gt(e,"parent",o[11]),lt(e,"z-index",o[16]),lt(e,"transform",s),lt(e,"visibility",o[20]?"visible":"hidden")},m(f,h){U(f,e,h),t&&re(t,e,null),o[50](e),a=!0,l||(c=[wn(i=cm.call(null,e,{nodeId:o[1],isSelectable:o[5],disabled:!1,handleSelector:o[19],noDragClass:"nodrag",nodeClickDistance:o[22],onNodeMouseDown:o[31],onDrag:o[47],onDragStart:o[48],onDragStop:o[49],store:o[29]})),we(e,"click",o[34]),we(e,"mouseenter",o[51]),we(e,"mouseleave",o[52]),we(e,"mousemove",o[53]),we(e,"contextmenu",o[54])],l=!0)},p(f,h){if(h[0]&134217728&&u!==(u=f[27])){if(t){De();const b=t;N(b.$$.fragment,1,0,()=>{ie(b,1)}),He()}u?(t=cs(u,d(f)),oe(t.$$.fragment),T(t.$$.fragment,1),re(t,e,null)):t=null}else if(u){const b={};h[0]&4&&(b.data=f[2]),h[0]&2&&(b.id=f[1]),h[0]&8&&(b.selected=f[3]),h[0]&32&&(b.selectable=f[5]),h[0]&128&&(b.deletable=f[7]),h[0]&16384&&(b.sourcePosition=f[14]),h[0]&32768&&(b.targetPosition=f[15]),h[0]&65536&&(b.zIndex=f[16]),h[0]&512&&(b.dragging=f[9]),h[0]&16&&(b.draggable=f[4]),h[0]&524288&&(b.dragHandle=f[19]),h[0]&2097152&&(b.parentId=f[21]),h[0]&33554432&&(b.type=f[25]),h[0]&268435456&&(b.isConnectable=f[28]),h[0]&4096&&(b.positionAbsoluteX=f[12]),h[0]&8192&&(b.positionAbsoluteY=f[13]),h[0]&131072&&(b.width=f[17]),h[0]&262144&&(b.height=f[18]),t.$set(b)}(!a||h[0]&2)&&g(e,"data-id",f[1]),(!a||h[0]&41943040&&n!==(n=nn(["svelte-flow__node",`svelte-flow__node-${f[25]}`,f[23]])))&&g(e,"class",n),(!a||h[0]&67109888&&r!==(r=(f[10]??"")+";"+f[26].width+f[26].height))&&g(e,"style",r),i&&In(i.update)&&h[0]&4718626&&i.update.call(null,{nodeId:f[1],isSelectable:f[5],disabled:!1,handleSelector:f[19],noDragClass:"nodrag",nodeClickDistance:f[22],onNodeMouseDown:f[31],onDrag:f[47],onDragStart:f[48],onDragStop:f[49],store:f[29]}),(!a||h[0]&41943552)&&gt(e,"dragging",f[9]),(!a||h[0]&41943048)&&gt(e,"selected",f[3]),(!a||h[0]&41943056)&&gt(e,"draggable",f[4]),(!a||h[0]&41943104)&&gt(e,"connectable",f[6]),(!a||h[0]&41943072)&&gt(e,"selectable",f[5]),(!a||h[0]&41943056)&&gt(e,"nopan",f[4]),(!a||h[0]&41945088)&&gt(e,"parent",f[11]);const _=h[0]&67109888;(h[0]&67175424||_)&&lt(e,"z-index",f[16]),(h[0]&67122176&&s!==(s=`translate(${f[12]}px, ${f[13]}px)`)||_)&&lt(e,"transform",s),(h[0]&68158464||_)&&lt(e,"visibility",f[20]?"visible":"hidden")},i(f){a||(t&&T(t.$$.fragment,f),a=!0)},o(f){t&&N(t.$$.fragment,f),a=!1},d(f){f&&p(e),t&&ie(t),o[50](null),l=!1,cn(c)}}}function m2(o){let e,t,n=!o[8]&&Cd(o);return{c(){n&&n.c(),e=qe()},l(r){n&&n.l(r),e=qe()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,i){r[8]?n&&(De(),N(n,1,1,()=>{n=null}),He()):n?(n.p(r,i),i[0]&256&&T(n,1)):(n=Cd(r),n.c(),T(n,1),n.m(e.parentNode,e))},i(r){t||(T(n),t=!0)},o(r){N(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function p2(o,e,t){let n,r,i,s,a,l,{node:c}=e,{id:u}=e,{data:d={}}=e,{selected:f=!1}=e,{draggable:h=void 0}=e,{selectable:_=void 0}=e,{connectable:b=!0}=e,{deletable:v=!0}=e,{hidden:m=!1}=e,{dragging:y=!1}=e,{resizeObserver:w=null}=e,{style:I=void 0}=e,{type:S="default"}=e,{isParent:k=!1}=e,{positionX:C}=e,{positionY:R}=e,{sourcePosition:D=void 0}=e,{targetPosition:H=void 0}=e,{zIndex:z}=e,{measuredWidth:W=void 0}=e,{measuredHeight:K=void 0}=e,{initialWidth:P=void 0}=e,{initialHeight:V=void 0}=e,{width:L=void 0}=e,{height:q=void 0}=e,{dragHandle:Z=void 0}=e,{initialized:Q=!1}=e,{parentId:Y=void 0}=e,{nodeClickDistance:te=void 0}=e,{class:F=""}=e;const j=pn(),{nodeTypes:x,nodeDragThreshold:J,selectNodesOnDrag:ve,handleNodeSelection:le,updateNodeInternals:me}=j;fe(o,x,se=>t(46,a=se));let X,ue=null;const be=An(),Re=st(b);fe(o,Re,se=>t(28,l=se));let Fe,he,et;yi("svelteflow__node_id",u),yi("svelteflow__node_connectable",Re),ur(()=>{ue&&(w==null||w.unobserve(ue))});function ot(se){_&&(!ye(ve)||!h||ye(J)>0)&&le(u),be("nodeclick",{node:c.internals.userNode,event:se})}const Et=(se,Qe,rt,pt)=>{be("nodedrag",{event:se,targetNode:rt,nodes:pt})},Dt=(se,Qe,rt,pt)=>{be("nodedragstart",{event:se,targetNode:rt,nodes:pt})},Yt=(se,Qe,rt,pt)=>{be("nodedragstop",{event:se,targetNode:rt,nodes:pt})};function Pt(se){ze[se?"unshift":"push"](()=>{X=se,t(24,X)})}const Zt=se=>be("nodemouseenter",{node:c,event:se}),jt=se=>be("nodemouseleave",{node:c,event:se}),Ht=se=>be("nodemousemove",{node:c,event:se}),Qt=se=>be("nodecontextmenu",{node:c,event:se});return o.$$set=se=>{"node"in se&&t(0,c=se.node),"id"in se&&t(1,u=se.id),"data"in se&&t(2,d=se.data),"selected"in se&&t(3,f=se.selected),"draggable"in se&&t(4,h=se.draggable),"selectable"in se&&t(5,_=se.selectable),"connectable"in se&&t(6,b=se.connectable),"deletable"in se&&t(7,v=se.deletable),"hidden"in se&&t(8,m=se.hidden),"dragging"in se&&t(9,y=se.dragging),"resizeObserver"in se&&t(35,w=se.resizeObserver),"style"in se&&t(10,I=se.style),"type"in se&&t(36,S=se.type),"isParent"in se&&t(11,k=se.isParent),"positionX"in se&&t(12,C=se.positionX),"positionY"in se&&t(13,R=se.positionY),"sourcePosition"in se&&t(14,D=se.sourcePosition),"targetPosition"in se&&t(15,H=se.targetPosition),"zIndex"in se&&t(16,z=se.zIndex),"measuredWidth"in se&&t(37,W=se.measuredWidth),"measuredHeight"in se&&t(38,K=se.measuredHeight),"initialWidth"in se&&t(39,P=se.initialWidth),"initialHeight"in se&&t(40,V=se.initialHeight),"width"in se&&t(17,L=se.width),"height"in se&&t(18,q=se.height),"dragHandle"in se&&t(19,Z=se.dragHandle),"initialized"in se&&t(20,Q=se.initialized),"parentId"in se&&t(21,Y=se.parentId),"nodeClickDistance"in se&&t(22,te=se.nodeClickDistance),"class"in se&&t(23,F=se.class)},o.$$.update=()=>{o.$$.dirty[1]&32&&t(25,n=S||"default"),o.$$.dirty[0]&33554432|o.$$.dirty[1]&32768&&t(45,r=!!a[n]),o.$$.dirty[0]&33554432|o.$$.dirty[1]&32768&&t(27,i=a[n]||om),o.$$.dirty[1]&16416&&(r||console.warn("003",Li.error003(S))),o.$$.dirty[0]&393216|o.$$.dirty[1]&960&&t(26,s=g2({width:L,height:q,initialWidth:P,initialHeight:V,measuredWidth:W,measuredHeight:K})),o.$$.dirty[0]&64&&Re.set(!!b),o.$$.dirty[0]&50380802|o.$$.dirty[1]&14336&&((Fe&&n!==Fe||he&&D!==he||et&&H!==et)&&requestAnimationFrame(()=>me(new Map([[u,{id:u,nodeElement:X,force:!0}]]))),t(42,Fe=n),t(43,he=D),t(44,et=H)),o.$$.dirty[0]&17825792|o.$$.dirty[1]&1040&&w&&(X!==ue||!Q)&&(ue&&w.unobserve(ue),X&&w.observe(X),t(41,ue=X))},[c,u,d,f,h,_,b,v,m,y,I,k,C,R,D,H,z,L,q,Z,Q,Y,te,F,X,n,s,i,l,j,x,le,be,Re,ot,w,S,W,K,P,V,ue,Fe,he,et,r,a,Et,Dt,Yt,Pt,Zt,jt,Ht,Qt]}class _2 extends Ge{constructor(e){super(),We(this,e,p2,m2,Sf,{node:0,id:1,data:2,selected:3,draggable:4,selectable:5,connectable:6,deletable:7,hidden:8,dragging:9,resizeObserver:35,style:10,type:36,isParent:11,positionX:12,positionY:13,sourcePosition:14,targetPosition:15,zIndex:16,measuredWidth:37,measuredHeight:38,initialWidth:39,initialHeight:40,width:17,height:18,dragHandle:19,initialized:20,parentId:21,nodeClickDistance:22,class:23},null,[-1,-1])}}const{Map:b2}=Rf;function Ed(o,e,t){const n=o.slice();return n[21]=e[t],n}function Id(o,e){let t,n,r;return n=new _2({props:{node:e[21],id:e[21].id,data:e[21].data,selected:!!e[21].selected,hidden:!!e[21].hidden,draggable:!!(e[21].draggable||e[2]&&typeof e[21].draggable>"u"),selectable:!!(e[21].selectable||e[3]&&typeof e[21].selectable>"u"),connectable:!!(e[21].connectable||e[4]&&typeof e[21].connectable>"u"),deletable:e[21].deletable??!0,positionX:e[21].internals.positionAbsolute.x,positionY:e[21].internals.positionAbsolute.y,isParent:e[5].has(e[21].id),style:e[21].style,class:e[21].class,type:e[21].type??"default",sourcePosition:e[21].sourcePosition,targetPosition:e[21].targetPosition,dragging:e[21].dragging,zIndex:e[21].internals.z??0,dragHandle:e[21].dragHandle,initialized:ud(e[21]),width:e[21].width,height:e[21].height,initialWidth:e[21].initialWidth,initialHeight:e[21].initialHeight,measuredWidth:e[21].measured.width,measuredHeight:e[21].measured.height,parentId:e[21].parentId,resizeObserver:e[11],nodeClickDistance:e[0]}}),n.$on("nodeclick",e[12]),n.$on("nodemouseenter",e[13]),n.$on("nodemousemove",e[14]),n.$on("nodemouseleave",e[15]),n.$on("nodedrag",e[16]),n.$on("nodedragstart",e[17]),n.$on("nodedragstop",e[18]),n.$on("nodecontextmenu",e[19]),{key:o,first:null,c(){t=qe(),oe(n.$$.fragment),this.h()},l(i){t=qe(),ae(n.$$.fragment,i),this.h()},h(){this.first=t},m(i,s){U(i,t,s),re(n,i,s),r=!0},p(i,s){e=i;const a={};s&2&&(a.node=e[21]),s&2&&(a.id=e[21].id),s&2&&(a.data=e[21].data),s&2&&(a.selected=!!e[21].selected),s&2&&(a.hidden=!!e[21].hidden),s&6&&(a.draggable=!!(e[21].draggable||e[2]&&typeof e[21].draggable>"u")),s&10&&(a.selectable=!!(e[21].selectable||e[3]&&typeof e[21].selectable>"u")),s&18&&(a.connectable=!!(e[21].connectable||e[4]&&typeof e[21].connectable>"u")),s&2&&(a.deletable=e[21].deletable??!0),s&2&&(a.positionX=e[21].internals.positionAbsolute.x),s&2&&(a.positionY=e[21].internals.positionAbsolute.y),s&34&&(a.isParent=e[5].has(e[21].id)),s&2&&(a.style=e[21].style),s&2&&(a.class=e[21].class),s&2&&(a.type=e[21].type??"default"),s&2&&(a.sourcePosition=e[21].sourcePosition),s&2&&(a.targetPosition=e[21].targetPosition),s&2&&(a.dragging=e[21].dragging),s&2&&(a.zIndex=e[21].internals.z??0),s&2&&(a.dragHandle=e[21].dragHandle),s&2&&(a.initialized=ud(e[21])),s&2&&(a.width=e[21].width),s&2&&(a.height=e[21].height),s&2&&(a.initialWidth=e[21].initialWidth),s&2&&(a.initialHeight=e[21].initialHeight),s&2&&(a.measuredWidth=e[21].measured.width),s&2&&(a.measuredHeight=e[21].measured.height),s&2&&(a.parentId=e[21].parentId),s&1&&(a.nodeClickDistance=e[0]),n.$set(a)},i(i){r||(T(n.$$.fragment,i),r=!0)},o(i){N(n.$$.fragment,i),r=!1},d(i){i&&p(t),ie(n,i)}}}function y2(o){let e,t=[],n=new b2,r,i=Ct(o[1]);const s=a=>a[21].id;for(let a=0;a<i.length;a+=1){let l=Ed(o,i,a),c=s(l);n.set(c,t[a]=Id(c,l))}return{c(){e=M("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=O(a,"DIV",{class:!0});var l=A(e);for(let c=0;c<t.length;c+=1)t[c].l(l);l.forEach(p),this.h()},h(){g(e,"class","svelte-flow__nodes svelte-tf4uy4")},m(a,l){U(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);r=!0},p(a,[l]){l&2111&&(i=Ct(a[1]),De(),t=Ps(t,l,s,1,a,i,n,e,Ns,Id,null,Ed),He())},i(a){if(!r){for(let l=0;l<i.length;l+=1)T(t[l]);r=!0}},o(a){for(let l=0;l<t.length;l+=1)N(t[l]);r=!1},d(a){a&&p(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function v2(o,e,t){let n,r,i,s,a,{nodeClickDistance:l=0}=e;const{visibleNodes:c,nodesDraggable:u,nodesConnectable:d,elementsSelectable:f,updateNodeInternals:h,parentLookup:_}=pn();fe(o,c,R=>t(1,n=R)),fe(o,u,R=>t(2,r=R)),fe(o,d,R=>t(4,s=R)),fe(o,f,R=>t(3,i=R)),fe(o,_,R=>t(5,a=R));const b=typeof ResizeObserver>"u"?null:new ResizeObserver(R=>{const D=new Map;R.forEach(H=>{const z=H.target.getAttribute("data-id");D.set(z,{id:z,nodeElement:H.target,force:!0})}),h(D)});ur(()=>{b==null||b.disconnect()});function v(R){Mt.call(this,o,R)}function m(R){Mt.call(this,o,R)}function y(R){Mt.call(this,o,R)}function w(R){Mt.call(this,o,R)}function I(R){Mt.call(this,o,R)}function S(R){Mt.call(this,o,R)}function k(R){Mt.call(this,o,R)}function C(R){Mt.call(this,o,R)}return o.$$set=R=>{"nodeClickDistance"in R&&t(0,l=R.nodeClickDistance)},[l,n,r,i,s,a,c,u,d,f,_,b,v,m,y,w,I,S,k,C]}class w2 extends Ge{constructor(e){super(),We(this,e,v2,y2,Ye,{nodeClickDistance:0})}}function Td(o){let e,t,n,r,i,s,a,l;var c=o[27];function u(d,f){return{props:{id:d[0],source:d[1],target:d[2],sourceX:d[14],sourceY:d[15],targetX:d[16],targetY:d[17],sourcePosition:d[18],targetPosition:d[19],animated:d[6],selected:d[7],label:d[10],labelStyle:d[11],data:d[3],style:d[4],interactionWidth:d[21],selectable:d[24],deletable:d[8]??!0,type:d[23],sourceHandleId:d[12],targetHandleId:d[13],markerStart:d[26],markerEnd:d[25]}}}return c&&(n=cs(c,u(o))),{c(){e=Me("svg"),t=Me("g"),n&&oe(n.$$.fragment),this.h()},l(d){e=Oe(d,"svg",{});var f=A(e);t=Oe(f,"g",{class:!0,"data-id":!0,"aria-label":!0,role:!0});var h=A(t);n&&ae(n.$$.fragment,h),h.forEach(p),f.forEach(p),this.h()},h(){g(t,"class",r=nn(["svelte-flow__edge",o[22]])),g(t,"data-id",o[0]),g(t,"aria-label",i=o[20]===null?void 0:o[20]?o[20]:`Edge from ${o[1]} to ${o[2]}`),g(t,"role","img"),gt(t,"animated",o[6]),gt(t,"selected",o[7]),gt(t,"selectable",o[24]),lt(e,"z-index",o[5])},m(d,f){U(d,e,f),E(e,t),n&&re(n,t,null),s=!0,a||(l=[we(t,"click",o[32]),we(t,"contextmenu",o[41]),we(t,"mouseenter",o[42]),we(t,"mouseleave",o[43])],a=!0)},p(d,f){if(f[0]&134217728&&c!==(c=d[27])){if(n){De();const h=n;N(h.$$.fragment,1,0,()=>{ie(h,1)}),He()}c?(n=cs(c,u(d)),oe(n.$$.fragment),T(n.$$.fragment,1),re(n,t,null)):n=null}else if(c){const h={};f[0]&1&&(h.id=d[0]),f[0]&2&&(h.source=d[1]),f[0]&4&&(h.target=d[2]),f[0]&16384&&(h.sourceX=d[14]),f[0]&32768&&(h.sourceY=d[15]),f[0]&65536&&(h.targetX=d[16]),f[0]&131072&&(h.targetY=d[17]),f[0]&262144&&(h.sourcePosition=d[18]),f[0]&524288&&(h.targetPosition=d[19]),f[0]&64&&(h.animated=d[6]),f[0]&128&&(h.selected=d[7]),f[0]&1024&&(h.label=d[10]),f[0]&2048&&(h.labelStyle=d[11]),f[0]&8&&(h.data=d[3]),f[0]&16&&(h.style=d[4]),f[0]&2097152&&(h.interactionWidth=d[21]),f[0]&16777216&&(h.selectable=d[24]),f[0]&256&&(h.deletable=d[8]??!0),f[0]&8388608&&(h.type=d[23]),f[0]&4096&&(h.sourceHandleId=d[12]),f[0]&8192&&(h.targetHandleId=d[13]),f[0]&67108864&&(h.markerStart=d[26]),f[0]&33554432&&(h.markerEnd=d[25]),n.$set(h)}(!s||f[0]&4194304&&r!==(r=nn(["svelte-flow__edge",d[22]])))&&g(t,"class",r),(!s||f[0]&1)&&g(t,"data-id",d[0]),(!s||f[0]&1048582&&i!==(i=d[20]===null?void 0:d[20]?d[20]:`Edge from ${d[1]} to ${d[2]}`))&&g(t,"aria-label",i),(!s||f[0]&4194368)&&gt(t,"animated",d[6]),(!s||f[0]&4194432)&&gt(t,"selected",d[7]),(!s||f[0]&20971520)&&gt(t,"selectable",d[24]),f[0]&32&&lt(e,"z-index",d[5])},i(d){s||(n&&T(n.$$.fragment,d),s=!0)},o(d){n&&N(n.$$.fragment,d),s=!1},d(d){d&&p(e),n&&ie(n),a=!1,cn(l)}}}function k2(o){let e,t,n=!o[9]&&Td(o);return{c(){n&&n.c(),e=qe()},l(r){n&&n.l(r),e=qe()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,i){r[9]?n&&(De(),N(n,1,1,()=>{n=null}),He()):n?(n.p(r,i),i[0]&512&&T(n,1)):(n=Td(r),n.c(),T(n,1),n.m(e.parentNode,e))},i(r){t||(T(n),t=!0)},o(r){N(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function C2(o,e,t){let n,r,i,s,a,l,c,u,d,{id:f}=e,{type:h="default"}=e,{source:_=""}=e,{target:b=""}=e,{data:v={}}=e,{style:m=void 0}=e,{zIndex:y=void 0}=e,{animated:w=!1}=e,{selected:I=!1}=e,{selectable:S=void 0}=e,{deletable:k=void 0}=e,{hidden:C=!1}=e,{label:R=void 0}=e,{labelStyle:D=void 0}=e,{markerStart:H=void 0}=e,{markerEnd:z=void 0}=e,{sourceHandle:W=void 0}=e,{targetHandle:K=void 0}=e,{sourceX:P}=e,{sourceY:V}=e,{targetX:L}=e,{targetY:q}=e,{sourcePosition:Z}=e,{targetPosition:Q}=e,{ariaLabel:Y=void 0}=e,{interactionWidth:te=void 0}=e,{class:F=""}=e;yi("svelteflow__edge_id",f);const{edgeLookup:j,edgeTypes:x,flowId:J,elementsSelectable:ve}=pn();fe(o,j,he=>t(44,l=he)),fe(o,x,he=>t(40,d=he)),fe(o,J,he=>t(39,u=he)),fe(o,ve,he=>t(38,c=he));const le=An(),me=rm();function X(he){const et=l.get(f);et&&(me(f),le("edgeclick",{event:he,edge:et}))}function ue(he,et){const ot=l.get(f);ot&&le(et,{event:he,edge:ot})}const be=he=>{ue(he,"edgecontextmenu")},Re=he=>{ue(he,"edgemouseenter")},Fe=he=>{ue(he,"edgemouseleave")};return o.$$set=he=>{"id"in he&&t(0,f=he.id),"type"in he&&t(34,h=he.type),"source"in he&&t(1,_=he.source),"target"in he&&t(2,b=he.target),"data"in he&&t(3,v=he.data),"style"in he&&t(4,m=he.style),"zIndex"in he&&t(5,y=he.zIndex),"animated"in he&&t(6,w=he.animated),"selected"in he&&t(7,I=he.selected),"selectable"in he&&t(35,S=he.selectable),"deletable"in he&&t(8,k=he.deletable),"hidden"in he&&t(9,C=he.hidden),"label"in he&&t(10,R=he.label),"labelStyle"in he&&t(11,D=he.labelStyle),"markerStart"in he&&t(36,H=he.markerStart),"markerEnd"in he&&t(37,z=he.markerEnd),"sourceHandle"in he&&t(12,W=he.sourceHandle),"targetHandle"in he&&t(13,K=he.targetHandle),"sourceX"in he&&t(14,P=he.sourceX),"sourceY"in he&&t(15,V=he.sourceY),"targetX"in he&&t(16,L=he.targetX),"targetY"in he&&t(17,q=he.targetY),"sourcePosition"in he&&t(18,Z=he.sourcePosition),"targetPosition"in he&&t(19,Q=he.targetPosition),"ariaLabel"in he&&t(20,Y=he.ariaLabel),"interactionWidth"in he&&t(21,te=he.interactionWidth),"class"in he&&t(22,F=he.class)},o.$$.update=()=>{o.$$.dirty[1]&8&&t(23,n=h||"default"),o.$$.dirty[0]&8388608|o.$$.dirty[1]&512&&t(27,r=d[n]||im),o.$$.dirty[1]&288&&t(26,i=H?`url('#${Xa(H,u)}')`:void 0),o.$$.dirty[1]&320&&t(25,s=z?`url('#${Xa(z,u)}')`:void 0),o.$$.dirty[1]&144&&t(24,a=S??c)},[f,_,b,v,m,y,w,I,k,C,R,D,W,K,P,V,L,q,Z,Q,Y,te,F,n,a,s,i,r,j,x,J,ve,X,ue,h,S,H,z,c,u,d,be,Re,Fe]}class E2 extends Ge{constructor(e){super(),We(this,e,C2,k2,Sf,{id:0,type:34,source:1,target:2,data:3,style:4,zIndex:5,animated:6,selected:7,selectable:35,deletable:8,hidden:9,label:10,labelStyle:11,markerStart:36,markerEnd:37,sourceHandle:12,targetHandle:13,sourceX:14,sourceY:15,targetX:16,targetY:17,sourcePosition:18,targetPosition:19,ariaLabel:20,interactionWidth:21,class:22},null,[-1,-1])}}function I2(o,e,t){let{onMount:n=void 0}=e,{onDestroy:r=void 0}=e;return Kn(()=>(n==null||n(),r)),o.$$set=i=>{"onMount"in i&&t(0,n=i.onMount),"onDestroy"in i&&t(1,r=i.onDestroy)},[n,r]}class T2 extends Ge{constructor(e){super(),We(this,e,I2,null,Ye,{onMount:0,onDestroy:1})}}function Sd(o,e,t){const n=o.slice();return n[2]=e[t],n}function Ad(o,e){let t,n,r;const i=[e[2]];let s={};for(let a=0;a<i.length;a+=1)s=wt(s,i[a]);return n=new D2({props:s}),{key:o,first:null,c(){t=qe(),oe(n.$$.fragment),this.h()},l(a){t=qe(),ae(n.$$.fragment,a),this.h()},h(){this.first=t},m(a,l){U(a,t,l),re(n,a,l),r=!0},p(a,l){e=a;const c=l&1?Yn(i,[wi(e[2])]):{};n.$set(c)},i(a){r||(T(n.$$.fragment,a),r=!0)},o(a){N(n.$$.fragment,a),r=!1},d(a){a&&p(t),ie(n,a)}}}function S2(o){let e,t=[],n=new Map,r,i=Ct(o[0]);const s=a=>a[2].id;for(let a=0;a<i.length;a+=1){let l=Sd(o,i,a),c=s(l);n.set(c,t[a]=Ad(c,l))}return{c(){e=Me("defs");for(let a=0;a<t.length;a+=1)t[a].c()},l(a){e=Oe(a,"defs",{});var l=A(e);for(let c=0;c<t.length;c+=1)t[c].l(l);l.forEach(p)},m(a,l){U(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);r=!0},p(a,[l]){l&1&&(i=Ct(a[0]),De(),t=Ps(t,l,s,1,a,i,n,e,Ns,Ad,null,Sd),He())},i(a){if(!r){for(let l=0;l<i.length;l+=1)T(t[l]);r=!0}},o(a){for(let l=0;l<t.length;l+=1)N(t[l]);r=!1},d(a){a&&p(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function A2(o,e,t){let n;const{markers:r}=pn();return fe(o,r,i=>t(0,n=i)),[n,r]}class R2 extends Ge{constructor(e){super(),We(this,e,A2,S2,Ye,{})}}function M2(o){let e;return{c(){e=Me("polyline"),this.h()},l(t){e=Oe(t,"polyline",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,fill:!0,points:!0}),A(e).forEach(p),this.h()},h(){g(e,"stroke",o[6]),g(e,"stroke-linecap","round"),g(e,"stroke-linejoin","round"),g(e,"stroke-width",o[7]),g(e,"fill",o[6]),g(e,"points","-5,-4 0,0 -5,4 -5,-4")},m(t,n){U(t,e,n)},p(t,n){n&64&&g(e,"stroke",t[6]),n&128&&g(e,"stroke-width",t[7]),n&64&&g(e,"fill",t[6])},d(t){t&&p(e)}}}function O2(o){let e;return{c(){e=Me("polyline"),this.h()},l(t){e=Oe(t,"polyline",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,fill:!0,points:!0}),A(e).forEach(p),this.h()},h(){g(e,"stroke",o[6]),g(e,"stroke-linecap","round"),g(e,"stroke-linejoin","round"),g(e,"stroke-width",o[7]),g(e,"fill","none"),g(e,"points","-5,-4 0,0 -5,4")},m(t,n){U(t,e,n)},p(t,n){n&64&&g(e,"stroke",t[6]),n&128&&g(e,"stroke-width",t[7])},d(t){t&&p(e)}}}function P2(o){let e,t,n;function r(a,l){if(a[1]===Ts.Arrow)return O2;if(a[1]===Ts.ArrowClosed)return M2}let i=r(o),s=i&&i(o);return{c(){e=Me("marker"),s&&s.c(),this.h()},l(a){e=Oe(a,"marker",{class:!0,id:!0,markerWidth:!0,markerHeight:!0,viewBox:!0,markerUnits:!0,orient:!0,refX:!0,refY:!0});var l=A(e);s&&s.l(l),l.forEach(p),this.h()},h(){g(e,"class","svelte-flow__arrowhead"),g(e,"id",o[0]),g(e,"markerWidth",t=`${o[2]}`),g(e,"markerHeight",n=`${o[3]}`),g(e,"viewBox","-10 -10 20 20"),g(e,"markerUnits",o[4]),g(e,"orient",o[5]),g(e,"refX","0"),g(e,"refY","0")},m(a,l){U(a,e,l),s&&s.m(e,null)},p(a,[l]){i===(i=r(a))&&s?s.p(a,l):(s&&s.d(1),s=i&&i(a),s&&(s.c(),s.m(e,null))),l&1&&g(e,"id",a[0]),l&4&&t!==(t=`${a[2]}`)&&g(e,"markerWidth",t),l&8&&n!==(n=`${a[3]}`)&&g(e,"markerHeight",n),l&16&&g(e,"markerUnits",a[4]),l&32&&g(e,"orient",a[5])},i:Le,o:Le,d(a){a&&p(e),s&&s.d()}}}function N2(o,e,t){let{id:n}=e,{type:r}=e,{width:i=12.5}=e,{height:s=12.5}=e,{markerUnits:a="strokeWidth"}=e,{orient:l="auto-start-reverse"}=e,{color:c=void 0}=e,{strokeWidth:u=void 0}=e;return o.$$set=d=>{"id"in d&&t(0,n=d.id),"type"in d&&t(1,r=d.type),"width"in d&&t(2,i=d.width),"height"in d&&t(3,s=d.height),"markerUnits"in d&&t(4,a=d.markerUnits),"orient"in d&&t(5,l=d.orient),"color"in d&&t(6,c=d.color),"strokeWidth"in d&&t(7,u=d.strokeWidth)},[n,r,i,s,a,l,c,u]}class D2 extends Ge{constructor(e){super(),We(this,e,N2,P2,Ye,{id:0,type:1,width:2,height:3,markerUnits:4,orient:5,color:6,strokeWidth:7})}}function Rd(o,e,t){const n=o.slice();return n[14]=e[t],n}function Md(o,e){let t,n,r;return n=new E2({props:{id:e[14].id,source:e[14].source,target:e[14].target,data:e[14].data,style:e[14].style,animated:e[14].animated,selected:e[14].selected,selectable:e[14].selectable??e[1],deletable:e[14].deletable,hidden:e[14].hidden,label:e[14].label,labelStyle:e[14].labelStyle,markerStart:e[14].markerStart,markerEnd:e[14].markerEnd,sourceHandle:e[14].sourceHandle,targetHandle:e[14].targetHandle,sourceX:e[14].sourceX,sourceY:e[14].sourceY,targetX:e[14].targetX,targetY:e[14].targetY,sourcePosition:e[14].sourcePosition,targetPosition:e[14].targetPosition,ariaLabel:e[14].ariaLabel,interactionWidth:e[14].interactionWidth,class:e[14].class,type:e[14].type||"default",zIndex:e[14].zIndex}}),n.$on("edgeclick",e[7]),n.$on("edgecontextmenu",e[8]),n.$on("edgemouseenter",e[9]),n.$on("edgemouseleave",e[10]),{key:o,first:null,c(){t=qe(),oe(n.$$.fragment),this.h()},l(i){t=qe(),ae(n.$$.fragment,i),this.h()},h(){this.first=t},m(i,s){U(i,t,s),re(n,i,s),r=!0},p(i,s){e=i;const a={};s&1&&(a.id=e[14].id),s&1&&(a.source=e[14].source),s&1&&(a.target=e[14].target),s&1&&(a.data=e[14].data),s&1&&(a.style=e[14].style),s&1&&(a.animated=e[14].animated),s&1&&(a.selected=e[14].selected),s&3&&(a.selectable=e[14].selectable??e[1]),s&1&&(a.deletable=e[14].deletable),s&1&&(a.hidden=e[14].hidden),s&1&&(a.label=e[14].label),s&1&&(a.labelStyle=e[14].labelStyle),s&1&&(a.markerStart=e[14].markerStart),s&1&&(a.markerEnd=e[14].markerEnd),s&1&&(a.sourceHandle=e[14].sourceHandle),s&1&&(a.targetHandle=e[14].targetHandle),s&1&&(a.sourceX=e[14].sourceX),s&1&&(a.sourceY=e[14].sourceY),s&1&&(a.targetX=e[14].targetX),s&1&&(a.targetY=e[14].targetY),s&1&&(a.sourcePosition=e[14].sourcePosition),s&1&&(a.targetPosition=e[14].targetPosition),s&1&&(a.ariaLabel=e[14].ariaLabel),s&1&&(a.interactionWidth=e[14].interactionWidth),s&1&&(a.class=e[14].class),s&1&&(a.type=e[14].type||"default"),s&1&&(a.zIndex=e[14].zIndex),n.$set(a)},i(i){r||(T(n.$$.fragment,i),r=!0)},o(i){N(n.$$.fragment,i),r=!1},d(i){i&&p(t),ie(n,i)}}}function Od(o){let e,t;return e=new T2({props:{onMount:o[11],onDestroy:o[12]}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&4&&(i.onMount=n[11]),r&4&&(i.onDestroy=n[12]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function H2(o){let e,t,n,r,i=[],s=new Map,a,l;n=new R2({});let c=Ct(o[0]);const u=f=>f[14].id;for(let f=0;f<c.length;f+=1){let h=Rd(o,c,f),_=u(h);s.set(_,i[f]=Md(_,h))}let d=o[0].length>0&&Od(o);return{c(){e=M("div"),t=Me("svg"),oe(n.$$.fragment),r=$();for(let f=0;f<i.length;f+=1)i[f].c();a=$(),d&&d.c(),this.h()},l(f){e=O(f,"DIV",{class:!0});var h=A(e);t=Oe(h,"svg",{class:!0});var _=A(t);ae(n.$$.fragment,_),_.forEach(p),r=ee(h);for(let b=0;b<i.length;b+=1)i[b].l(h);a=ee(h),d&&d.l(h),h.forEach(p),this.h()},h(){g(t,"class","svelte-flow__marker"),g(e,"class","svelte-flow__edges")},m(f,h){U(f,e,h),E(e,t),re(n,t,null),E(e,r);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(e,null);E(e,a),d&&d.m(e,null),l=!0},p(f,[h]){h&3&&(c=Ct(f[0]),De(),i=Ps(i,h,u,1,f,c,s,e,Ns,Md,a,Rd),He()),f[0].length>0?d?(d.p(f,h),h&1&&T(d,1)):(d=Od(f),d.c(),T(d,1),d.m(e,null)):d&&(De(),N(d,1,1,()=>{d=null}),He())},i(f){if(!l){T(n.$$.fragment,f);for(let h=0;h<c.length;h+=1)T(i[h]);T(d),l=!0}},o(f){N(n.$$.fragment,f);for(let h=0;h<i.length;h+=1)N(i[h]);N(d),l=!1},d(f){f&&p(e),ie(n);for(let h=0;h<i.length;h+=1)i[h].d();d&&d.d()}}}function L2(o,e,t){let n,r,i,{defaultEdgeOptions:s}=e;const{visibleEdges:a,edgesInitialized:l,edges:{setDefaultOptions:c},elementsSelectable:u}=pn();fe(o,a,m=>t(0,n=m)),fe(o,l,m=>t(2,i=m)),fe(o,u,m=>t(1,r=m)),Kn(()=>{s&&c(s)});function d(m){Mt.call(this,o,m)}function f(m){Mt.call(this,o,m)}function h(m){Mt.call(this,o,m)}function _(m){Mt.call(this,o,m)}const b=()=>{ls(l,i=!0,i)},v=()=>{ls(l,i=!1,i)};return o.$$set=m=>{"defaultEdgeOptions"in m&&t(6,s=m.defaultEdgeOptions)},[n,r,i,a,l,u,s,d,f,h,_,b,v]}class U2 extends Ge{constructor(e){super(),We(this,e,L2,H2,Ye,{defaultEdgeOptions:6})}}function Pd(o){let e;return{c(){e=M("div"),this.h()},l(t){e=O(t,"DIV",{class:!0}),A(e).forEach(p),this.h()},h(){g(e,"class","svelte-flow__selection svelte-1iugwpu"),lt(e,"width",typeof o[2]=="string"?o[2]:`${o[2]}px`),lt(e,"height",typeof o[3]=="string"?o[3]:`${o[3]}px`),lt(e,"transform",`translate(${o[0]}px, ${o[1]}px)`)},m(t,n){U(t,e,n)},p(t,n){n&4&&lt(e,"width",typeof t[2]=="string"?t[2]:`${t[2]}px`),n&8&&lt(e,"height",typeof t[3]=="string"?t[3]:`${t[3]}px`),n&3&&lt(e,"transform",`translate(${t[0]}px, ${t[1]}px)`)},d(t){t&&p(e)}}}function B2(o){let e,t=o[4]&&Pd(o);return{c(){t&&t.c(),e=qe()},l(n){t&&t.l(n),e=qe()},m(n,r){t&&t.m(n,r),U(n,e,r)},p(n,[r]){n[4]?t?t.p(n,r):(t=Pd(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Le,o:Le,d(n){n&&p(e),t&&t.d(n)}}}function z2(o,e,t){let{x:n=0}=e,{y:r=0}=e,{width:i=0}=e,{height:s=0}=e,{isVisible:a=!0}=e;return o.$$set=l=>{"x"in l&&t(0,n=l.x),"y"in l&&t(1,r=l.y),"width"in l&&t(2,i=l.width),"height"in l&&t(3,s=l.height),"isVisible"in l&&t(4,a=l.isVisible)},[n,r,i,s,a]}class um extends Ge{constructor(e){super(),We(this,e,z2,B2,Ye,{x:0,y:1,width:2,height:3,isVisible:4})}}function V2(o){var n,r,i,s;let e,t;return e=new um({props:{isVisible:!!(o[0]&&o[1]==="user"),width:(n=o[0])==null?void 0:n.width,height:(r=o[0])==null?void 0:r.height,x:(i=o[0])==null?void 0:i.x,y:(s=o[0])==null?void 0:s.y}}),{c(){oe(e.$$.fragment)},l(a){ae(e.$$.fragment,a)},m(a,l){re(e,a,l),t=!0},p(a,[l]){var u,d,f,h;const c={};l&3&&(c.isVisible=!!(a[0]&&a[1]==="user")),l&1&&(c.width=(u=a[0])==null?void 0:u.width),l&1&&(c.height=(d=a[0])==null?void 0:d.height),l&1&&(c.x=(f=a[0])==null?void 0:f.x),l&1&&(c.y=(h=a[0])==null?void 0:h.y),e.$set(c)},i(a){t||(T(e.$$.fragment,a),t=!0)},o(a){N(e.$$.fragment,a),t=!1},d(a){ie(e,a)}}}function F2(o,e,t){let n,r;const{selectionRect:i,selectionRectMode:s}=pn();return fe(o,i,a=>t(0,n=a)),fe(o,s,a=>t(1,r=a)),[n,r,i,s]}class K2 extends Ge{constructor(e){super(),We(this,e,F2,V2,Ye,{})}}function Nd(o){let e,t,n,r,i;return t=new um({props:{width:"100%",height:"100%",x:0,y:0}}),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(s){e=O(s,"DIV",{class:!0,style:!0,role:!0,tabindex:!0});var a=A(e);ae(t.$$.fragment,a),a.forEach(p),this.h()},h(){g(e,"class","selection-wrapper nopan svelte-5pxri"),lt(e,"width",o[1].width+"px"),lt(e,"height",o[1].height+"px"),lt(e,"transform","translate("+o[1].x+"px, "+o[1].y+"px)"),g(e,"role","button"),g(e,"tabindex","-1")},m(s,a){U(s,e,a),re(t,e,null),n=!0,r||(i=[wn(cm.call(null,e,{disabled:!1,store:o[2],onDrag:o[11],onDragStart:o[12],onDragStop:o[13]})),we(e,"contextmenu",o[7]),we(e,"click",o[8]),we(e,"keyup",W2)],r=!0)},p(s,a){(!n||a&2)&&lt(e,"width",s[1].width+"px"),(!n||a&2)&&lt(e,"height",s[1].height+"px"),(!n||a&2)&&lt(e,"transform","translate("+s[1].x+"px, "+s[1].y+"px)")},i(s){n||(T(t.$$.fragment,s),n=!0)},o(s){N(t.$$.fragment,s),n=!1},d(s){s&&p(e),ie(t),r=!1,cn(i)}}}function G2(o){let e=o[0]==="nodes"&&o[1]&&wo(o[1].x)&&wo(o[1].y),t,n,r=e&&Nd(o);return{c(){r&&r.c(),t=qe()},l(i){r&&r.l(i),t=qe()},m(i,s){r&&r.m(i,s),U(i,t,s),n=!0},p(i,[s]){s&3&&(e=i[0]==="nodes"&&i[1]&&wo(i[1].x)&&wo(i[1].y)),e?r?(r.p(i,s),s&3&&T(r,1)):(r=Nd(i),r.c(),T(r,1),r.m(t.parentNode,t)):r&&(De(),N(r,1,1,()=>{r=null}),He())},i(i){n||(T(r),n=!0)},o(i){N(r),n=!1},d(i){i&&p(t),r&&r.d(i)}}}const W2=()=>{};function q2(o,e,t){let n,r,i;const s=pn(),{selectionRectMode:a,nodes:l,nodeLookup:c}=s;fe(o,a,m=>t(0,i=m)),fe(o,l,m=>t(9,n=m)),fe(o,c,m=>t(10,r=m));const u=An();let d=null;function f(m){const y=n.filter(w=>w.selected);u("selectioncontextmenu",{nodes:y,event:m})}function h(m){const y=n.filter(w=>w.selected);u("selectionclick",{nodes:y,event:m})}const _=(m,y,w,I)=>{u("nodedrag",{event:m,targetNode:null,nodes:I})},b=(m,y,w,I)=>{u("nodedragstart",{event:m,targetNode:null,nodes:I})},v=(m,y,w,I)=>{u("nodedragstop",{event:m,targetNode:null,nodes:I})};return o.$$.update=()=>{o.$$.dirty&1537&&i==="nodes"&&t(1,d=Zs(r,{filter:m=>!!m.selected}))},[i,d,s,a,l,c,u,f,h,n,r,_,b,v]}class Y2 extends Ge{constructor(e){super(),We(this,e,q2,G2,Ye,{})}}function Mo(o,e){let{enabled:t=!0,trigger:n,type:r="keydown"}=e;function i(s){const a=Array.isArray(n)?n:[n],l={alt:s.altKey,ctrl:s.ctrlKey,shift:s.shiftKey,meta:s.metaKey};for(const c of a){const u={modifier:[],preventDefault:!1,enabled:!0,...c},{modifier:d,key:f,callback:h,preventDefault:_,enabled:b}=u;if(b){if(d.length&&!(Array.isArray(d)?d:[d]).map(y=>typeof y=="string"?[y]:y).some(y=>y.every(w=>l[w])))continue;if(s.key===f){_&&s.preventDefault();const v={node:o,trigger:u,originalEvent:s};o.dispatchEvent(new CustomEvent("shortcut",{detail:v})),h==null||h(v)}}}}return t&&o.addEventListener(r,i),{update:s=>{const{enabled:a=!0,type:l="keydown"}=s;t&&(!a||r!==l)?o.removeEventListener(r,i):!t&&a&&o.addEventListener(l,i),t=a,r=l,n=s.trigger},destroy:()=>{o.removeEventListener(r,i)}}}function j2(o){let e,t,n,r,i,s,a,l,c,u,d,f;return{c:Le,l:Le,m(h,_){d||(f=[wn(e=Mo.call(null,window,{trigger:vn(o[0],o[11]),type:"keydown"})),wn(t=Mo.call(null,window,{trigger:vn(o[0],o[12]),type:"keyup"})),wn(n=Mo.call(null,window,{trigger:vn(o[1],o[13]),type:"keydown"})),wn(r=Mo.call(null,window,{trigger:vn(o[1],o[14]),type:"keyup"})),wn(i=Mo.call(null,window,{trigger:vn(o[2],o[15]),type:"keydown"})),wn(s=Mo.call(null,window,{trigger:vn(o[2],o[16]),type:"keyup"})),wn(a=Mo.call(null,window,{trigger:vn(o[3],o[17]),type:"keydown"})),wn(l=Mo.call(null,window,{trigger:vn(o[3],o[18]),type:"keyup"})),wn(c=Mo.call(null,window,{trigger:vn(o[4],o[19]),type:"keydown"})),wn(u=Mo.call(null,window,{trigger:vn(o[4],o[20]),type:"keyup"})),we(window,"blur",o[10]),we(window,"contextmenu",o[10])],d=!0)},p(h,[_]){e&&In(e.update)&&_&1&&e.update.call(null,{trigger:vn(h[0],h[11]),type:"keydown"}),t&&In(t.update)&&_&1&&t.update.call(null,{trigger:vn(h[0],h[12]),type:"keyup"}),n&&In(n.update)&&_&2&&n.update.call(null,{trigger:vn(h[1],h[13]),type:"keydown"}),r&&In(r.update)&&_&2&&r.update.call(null,{trigger:vn(h[1],h[14]),type:"keyup"}),i&&In(i.update)&&_&4&&i.update.call(null,{trigger:vn(h[2],h[15]),type:"keydown"}),s&&In(s.update)&&_&4&&s.update.call(null,{trigger:vn(h[2],h[16]),type:"keyup"}),a&&In(a.update)&&_&8&&a.update.call(null,{trigger:vn(h[3],h[17]),type:"keydown"}),l&&In(l.update)&&_&8&&l.update.call(null,{trigger:vn(h[3],h[18]),type:"keyup"}),c&&In(c.update)&&_&16&&c.update.call(null,{trigger:vn(h[4],h[19]),type:"keydown"}),u&&In(u.update)&&_&16&&u.update.call(null,{trigger:vn(h[4],h[20]),type:"keyup"})},i:Le,o:Le,d(h){d=!1,cn(f)}}}function dm(o){return o!==null&&typeof o=="object"}function Q2(o){return dm(o)?o.modifier||[]:[]}function X2(o){return o==null?"":dm(o)?o.key:o}function vn(o,e){return(Array.isArray(o)?o:[o]).map(n=>{const r=X2(n);return{key:r,modifier:Q2(n),enabled:r!==null,callback:e}})}function J2(o,e,t){let{selectionKey:n="Shift"}=e,{multiSelectionKey:r=As()?"Meta":"Control"}=e,{deleteKey:i="Backspace"}=e,{panActivationKey:s=" "}=e,{zoomActivationKey:a=As()?"Meta":"Control"}=e;const{selectionKeyPressed:l,multiselectionKeyPressed:c,deleteKeyPressed:u,panActivationKeyPressed:d,zoomActivationKeyPressed:f,selectionRect:h}=pn();function _(){h.set(null),l.set(!1),c.set(!1),u.set(!1),d.set(!1),f.set(!1)}const b=()=>l.set(!0),v=()=>l.set(!1),m=()=>c.set(!0),y=()=>c.set(!1),w=D=>{!(D.originalEvent.ctrlKey||D.originalEvent.metaKey||D.originalEvent.shiftKey)&&!Nk(D.originalEvent)&&u.set(!0)},I=()=>u.set(!1),S=()=>d.set(!0),k=()=>d.set(!1),C=()=>f.set(!0),R=()=>f.set(!1);return o.$$set=D=>{"selectionKey"in D&&t(0,n=D.selectionKey),"multiSelectionKey"in D&&t(1,r=D.multiSelectionKey),"deleteKey"in D&&t(2,i=D.deleteKey),"panActivationKey"in D&&t(3,s=D.panActivationKey),"zoomActivationKey"in D&&t(4,a=D.zoomActivationKey)},[n,r,i,s,a,l,c,u,d,f,_,b,v,m,y,w,I,S,k,C,R]}class Z2 extends Ge{constructor(e){super(),We(this,e,J2,j2,Ye,{selectionKey:0,multiSelectionKey:1,deleteKey:2,panActivationKey:3,zoomActivationKey:4})}}const x2=o=>({}),Dd=o=>({});function Hd(o){let e,t,n,r;const i=o[13].connectionLine,s=Ft(i,o,o[12],Dd);let a=!o[2]&&Ld(o);return{c(){e=Me("svg"),t=Me("g"),s&&s.c(),a&&a.c(),this.h()},l(l){e=Oe(l,"svg",{width:!0,height:!0,class:!0,style:!0});var c=A(e);t=Oe(c,"g",{class:!0});var u=A(t);s&&s.l(u),a&&a.l(u),u.forEach(p),c.forEach(p),this.h()},h(){g(t,"class",n=nn(["svelte-flow__connection",id(o[3].isValid)])),g(e,"width",o[5]),g(e,"height",o[6]),g(e,"class","svelte-flow__connectionline"),g(e,"style",o[0])},m(l,c){U(l,e,c),E(e,t),s&&s.m(t,null),a&&a.m(t,null),r=!0},p(l,c){s&&s.p&&(!r||c&4096)&&Kt(s,i,l,l[12],r?Wt(i,l[12],c,x2):Gt(l[12]),Dd),l[2]?a&&(a.d(1),a=null):a?a.p(l,c):(a=Ld(l),a.c(),a.m(t,null)),(!r||c&8&&n!==(n=nn(["svelte-flow__connection",id(l[3].isValid)])))&&g(t,"class",n),(!r||c&32)&&g(e,"width",l[5]),(!r||c&64)&&g(e,"height",l[6]),(!r||c&1)&&g(e,"style",l[0])},i(l){r||(T(s,l),r=!0)},o(l){N(s,l),r=!1},d(l){l&&p(e),s&&s.d(l),a&&a.d()}}}function Ld(o){let e;return{c(){e=Me("path"),this.h()},l(t){e=Oe(t,"path",{d:!0,style:!0,fill:!0,class:!0}),A(e).forEach(p),this.h()},h(){g(e,"d",o[4]),g(e,"style",o[1]),g(e,"fill","none"),g(e,"class","svelte-flow__connection-path")},m(t,n){U(t,e,n)},p(t,n){n&16&&g(e,"d",t[4]),n&2&&g(e,"style",t[1])},d(t){t&&p(e)}}}function $2(o){let e,t,n=o[3].inProgress&&Hd(o);return{c(){n&&n.c(),e=qe()},l(r){n&&n.l(r),e=qe()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,[i]){r[3].inProgress?n?(n.p(r,i),i&8&&T(n,1)):(n=Hd(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(De(),N(n,1,1,()=>{n=null}),He())},i(r){t||(T(n),t=!0)},o(r){N(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function eE(o,e,t){let n,r,i,s,{$$slots:a={},$$scope:l}=e,{containerStyle:c=""}=e,{style:u=""}=e,{isCustomComponent:d=!1}=e;const{width:f,height:h,connection:_,connectionLineType:b}=pn();fe(o,f,m=>t(5,i=m)),fe(o,h,m=>t(6,s=m)),fe(o,_,m=>t(3,r=m)),fe(o,b,m=>t(11,n=m));let v=null;return o.$$set=m=>{"containerStyle"in m&&t(0,c=m.containerStyle),"style"in m&&t(1,u=m.style),"isCustomComponent"in m&&t(2,d=m.isCustomComponent),"$$scope"in m&&t(12,l=m.$$scope)},o.$$.update=()=>{if(o.$$.dirty&2060&&r.inProgress&&!d){const{from:m,to:y,fromPosition:w,toPosition:I}=r,S={sourceX:m.x,sourceY:m.y,sourcePosition:w,targetX:y.x,targetY:y.y,targetPosition:I};switch(n){case Wr.Bezier:t(4,[v]=Fg(S),v);break;case Wr.Step:t(4,[v]=Rs({...S,borderRadius:0}),v);break;case Wr.SmoothStep:t(4,[v]=Rs(S),v);break;default:t(4,[v]=Gg(S),v)}}},[c,u,d,r,v,i,s,f,h,_,b,n,l,a]}class tE extends Ge{constructor(e){super(),We(this,e,eE,$2,Ye,{containerStyle:0,style:1,isCustomComponent:2})}}function nE(o){let e,t,n;const r=o[8].default,i=Ft(r,o,o[7],null);let s=[{class:t=nn(["svelte-flow__panel",o[1],...o[2]])},{style:o[0]},o[5]],a={};for(let l=0;l<s.length;l+=1)a=wt(a,s[l]);return{c(){e=M("div"),i&&i.c(),this.h()},l(l){e=O(l,"DIV",{class:!0,style:!0});var c=A(e);i&&i.l(c),c.forEach(p),this.h()},h(){Sn(e,a),lt(e,"pointer-events",o[3]?"none":"")},m(l,c){U(l,e,c),i&&i.m(e,null),n=!0},p(l,[c]){i&&i.p&&(!n||c&128)&&Kt(i,r,l,l[7],n?Wt(r,l[7],c,null):Gt(l[7]),null),Sn(e,a=Yn(s,[(!n||c&6&&t!==(t=nn(["svelte-flow__panel",l[1],...l[2]])))&&{class:t},(!n||c&1)&&{style:l[0]},c&32&&l[5]])),lt(e,"pointer-events",l[3]?"none":"")},i(l){n||(T(i,l),n=!0)},o(l){N(i,l),n=!1},d(l){l&&p(e),i&&i.d(l)}}}function oE(o,e,t){let n;const r=["position","style","class"];let i=$t(e,r),s,{$$slots:a={},$$scope:l}=e,{position:c="top-right"}=e,{style:u=void 0}=e,{class:d=void 0}=e;const{selectionRectMode:f}=pn();return fe(o,f,h=>t(3,s=h)),o.$$set=h=>{e=wt(wt({},e),eo(h)),t(5,i=$t(e,r)),"position"in h&&t(6,c=h.position),"style"in h&&t(0,u=h.style),"class"in h&&t(1,d=h.class),"$$scope"in h&&t(7,l=h.$$scope)},o.$$.update=()=>{o.$$.dirty&64&&t(2,n=`${c}`.split("-"))},[u,d,n,s,f,i,c,l,a]}class fm extends Ge{constructor(e){super(),We(this,e,oE,nE,Ye,{position:6,style:0,class:1})}}function Ud(o){let e,t;return e=new fm({props:{position:o[1],class:"svelte-flow__attribution","data-message":"Feel free to remove the attribution or check out how you could support us: https://svelteflow.dev/support-us",$$slots:{default:[rE]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&2&&(i.position=n[1]),r&4&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function rE(o){let e,t="Svelte Flow";return{c(){e=M("a"),e.textContent=t,this.h()},l(n){e=O(n,"A",{href:!0,target:!0,rel:!0,"aria-label":!0,"data-svelte-h":!0}),yt(e)!=="svelte-2vm8e4"&&(e.textContent=t),this.h()},h(){g(e,"href","https://svelteflow.dev"),g(e,"target","_blank"),g(e,"rel","noopener noreferrer"),g(e,"aria-label","Svelte Flow attribution")},m(n,r){U(n,e,r)},p:Le,d(n){n&&p(e)}}}function iE(o){var r;let e,t,n=!((r=o[0])!=null&&r.hideAttribution)&&Ud(o);return{c(){n&&n.c(),e=qe()},l(i){n&&n.l(i),e=qe()},m(i,s){n&&n.m(i,s),U(i,e,s),t=!0},p(i,[s]){var a;(a=i[0])!=null&&a.hideAttribution?n&&(De(),N(n,1,1,()=>{n=null}),He()):n?(n.p(i,s),s&1&&T(n,1)):(n=Ud(i),n.c(),T(n,1),n.m(e.parentNode,e))},i(i){t||(T(n),t=!0)},o(i){N(n),t=!1},d(i){i&&p(e),n&&n.d(i)}}}function sE(o,e,t){let{proOptions:n=void 0}=e,{position:r="bottom-right"}=e;return o.$$set=i=>{"proOptions"in i&&t(0,n=i.proOptions),"position"in i&&t(1,r=i.position)},[n,r]}class aE extends Ge{constructor(e){super(),We(this,e,sE,iE,Ye,{proOptions:0,position:1})}}function Bd(o,{nodeTypes:e,edgeTypes:t,minZoom:n,maxZoom:r,translateExtent:i,paneClickDistance:s}){e!==void 0&&o.setNodeTypes(e),t!==void 0&&o.setEdgeTypes(t),n!==void 0&&o.setMinZoom(n),r!==void 0&&o.setMaxZoom(r),i!==void 0&&o.setTranslateExtent(i),s!==void 0&&o.setPaneClickDistance(s)}const lE=o=>Object.keys(o);function cE(o,e){lE(e).forEach(t=>{const n=e[t];n!==void 0&&o[t].set(n)})}function uE(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function dE(o="light"){return bo("light",t=>{if(o!=="system"){t(o);return}const n=uE(),r=()=>t(n!=null&&n.matches?"dark":"light");return t(n!=null&&n.matches?"dark":"light"),n==null||n.addEventListener("change",r),()=>{n==null||n.removeEventListener("change",r)}})}const fE=o=>({}),zd=o=>({slot:"connectionLine"});function hE(o){let e;const t=o[75].connectionLine,n=Ft(t,o,o[99],zd);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i[3]&64)&&Kt(n,t,r,r[99],e?Wt(t,r[99],i,fE):Gt(r[99]),zd)},i(r){e||(T(n,r),e=!0)},o(r){N(n,r),e=!1},d(r){n&&n.d(r)}}}function gE(o){let e,t,n,r,i,s,a,l,c,u,d,f;return e=new U2({props:{defaultEdgeOptions:o[21]}}),e.$on("edgeclick",o[78]),e.$on("edgecontextmenu",o[79]),e.$on("edgemouseenter",o[80]),e.$on("edgemouseleave",o[81]),n=new tE({props:{containerStyle:o[7],style:o[6],isCustomComponent:o[34].connectionLine,$$slots:{connectionLine:[hE]},$$scope:{ctx:o}}}),c=new w2({props:{nodeClickDistance:o[23]}}),c.$on("nodeclick",o[82]),c.$on("nodemouseenter",o[83]),c.$on("nodemousemove",o[84]),c.$on("nodemouseleave",o[85]),c.$on("nodedragstart",o[86]),c.$on("nodedrag",o[87]),c.$on("nodedragstop",o[88]),c.$on("nodecontextmenu",o[89]),d=new Y2({}),d.$on("selectionclick",o[90]),d.$on("selectioncontextmenu",o[91]),d.$on("nodedragstart",o[92]),d.$on("nodedrag",o[93]),d.$on("nodedragstop",o[94]),{c(){oe(e.$$.fragment),t=$(),oe(n.$$.fragment),r=$(),i=M("div"),s=$(),a=M("div"),l=$(),oe(c.$$.fragment),u=$(),oe(d.$$.fragment),this.h()},l(h){ae(e.$$.fragment,h),t=ee(h),ae(n.$$.fragment,h),r=ee(h),i=O(h,"DIV",{class:!0}),A(i).forEach(p),s=ee(h),a=O(h,"DIV",{class:!0}),A(a).forEach(p),l=ee(h),ae(c.$$.fragment,h),u=ee(h),ae(d.$$.fragment,h),this.h()},h(){g(i,"class","svelte-flow__edgelabel-renderer"),g(a,"class","svelte-flow__viewport-portal")},m(h,_){re(e,h,_),U(h,t,_),re(n,h,_),U(h,r,_),U(h,i,_),U(h,s,_),U(h,a,_),U(h,l,_),re(c,h,_),U(h,u,_),re(d,h,_),f=!0},p(h,_){const b={};_[0]&2097152&&(b.defaultEdgeOptions=h[21]),e.$set(b);const v={};_[0]&128&&(v.containerStyle=h[7]),_[0]&64&&(v.style=h[6]),_[1]&8&&(v.isCustomComponent=h[34].connectionLine),_[3]&64&&(v.$$scope={dirty:_,ctx:h}),n.$set(v);const m={};_[0]&8388608&&(m.nodeClickDistance=h[23]),c.$set(m)},i(h){f||(T(e.$$.fragment,h),T(n.$$.fragment,h),T(c.$$.fragment,h),T(d.$$.fragment,h),f=!0)},o(h){N(e.$$.fragment,h),N(n.$$.fragment,h),N(c.$$.fragment,h),N(d.$$.fragment,h),f=!1},d(h){h&&(p(t),p(r),p(i),p(s),p(a),p(l),p(u)),ie(e,h),ie(n,h),ie(c,h),ie(d,h)}}}function mE(o){let e,t,n,r;return e=new h2({props:{$$slots:{default:[gE]},$$scope:{ctx:o}}}),n=new K2({}),{c(){oe(e.$$.fragment),t=$(),oe(n.$$.fragment)},l(i){ae(e.$$.fragment,i),t=ee(i),ae(n.$$.fragment,i)},m(i,s){re(e,i,s),U(i,t,s),re(n,i,s),r=!0},p(i,s){const a={};s[0]&10485952|s[1]&8|s[3]&64&&(a.$$scope={dirty:s,ctx:i}),e.$set(a)},i(i){r||(T(e.$$.fragment,i),T(n.$$.fragment,i),r=!0)},o(i){N(e.$$.fragment,i),N(n.$$.fragment,i),r=!1},d(i){i&&p(t),ie(e,i),ie(n,i)}}}function pE(o){let e,t;return e=new u2({props:{panOnDrag:o[17]===void 0?!0:o[17],selectionOnDrag:o[18],$$slots:{default:[mE]},$$scope:{ctx:o}}}),e.$on("paneclick",o[95]),e.$on("panecontextmenu",o[96]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&131072&&(i.panOnDrag=n[17]===void 0?!0:n[17]),r[0]&262144&&(i.selectionOnDrag=n[18]),r[0]&10485952|r[1]&8|r[3]&64&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function _E(o){let e,t,n,r,i,s,a,l,c,u,d,f;t=new Z2({props:{selectionKey:o[1],deleteKey:o[5],panActivationKey:o[2],multiSelectionKey:o[3],zoomActivationKey:o[4]}}),r=new a2({props:{initialViewport:o[31],onMoveStart:o[8],onMove:o[9],onMoveEnd:o[10],panOnScrollMode:o[11]===void 0?Bo.Free:o[11],preventScrolling:o[12]===void 0?!0:o[12],zoomOnScroll:o[13]===void 0?!0:o[13],zoomOnDoubleClick:o[14]===void 0?!0:o[14],zoomOnPinch:o[15]===void 0?!0:o[15],panOnScroll:o[16]===void 0?!1:o[16],panOnDrag:o[17]===void 0?!0:o[17],paneClickDistance:o[22]===void 0?0:o[22],$$slots:{default:[pE]},$$scope:{ctx:o}}}),s=new aE({props:{proOptions:o[20],position:o[19]}});const h=o[75].default,_=Ft(h,o,o[99],null);let b=[{style:o[24]},{class:l=nn(["svelte-flow",o[25],o[30]])},{"data-testid":"svelte-flow__wrapper"},o[33],{role:"application"}],v={};for(let m=0;m<b.length;m+=1)v=wt(v,b[m]);return{c(){e=M("div"),oe(t.$$.fragment),n=$(),oe(r.$$.fragment),i=$(),oe(s.$$.fragment),a=$(),_&&_.c(),this.h()},l(m){e=O(m,"DIV",{style:!0,class:!0,"data-testid":!0,role:!0});var y=A(e);ae(t.$$.fragment,y),n=ee(y),ae(r.$$.fragment,y),i=ee(y),ae(s.$$.fragment,y),a=ee(y),_&&_.l(y),y.forEach(p),this.h()},h(){Sn(e,v),Do(()=>o[98].call(e)),gt(e,"svelte-12wlba6",!0)},m(m,y){U(m,e,y),re(t,e,null),E(e,n),re(r,e,null),E(e,i),re(s,e,null),E(e,a),_&&_.m(e,null),o[97](e),c=vm(e,o[98].bind(e)),u=!0,d||(f=[we(e,"dragover",o[76]),we(e,"drop",o[77])],d=!0)},p(m,y){const w={};y[0]&2&&(w.selectionKey=m[1]),y[0]&32&&(w.deleteKey=m[5]),y[0]&4&&(w.panActivationKey=m[2]),y[0]&8&&(w.multiSelectionKey=m[3]),y[0]&16&&(w.zoomActivationKey=m[4]),t.$set(w);const I={};y[0]&256&&(I.onMoveStart=m[8]),y[0]&512&&(I.onMove=m[9]),y[0]&1024&&(I.onMoveEnd=m[10]),y[0]&2048&&(I.panOnScrollMode=m[11]===void 0?Bo.Free:m[11]),y[0]&4096&&(I.preventScrolling=m[12]===void 0?!0:m[12]),y[0]&8192&&(I.zoomOnScroll=m[13]===void 0?!0:m[13]),y[0]&16384&&(I.zoomOnDoubleClick=m[14]===void 0?!0:m[14]),y[0]&32768&&(I.zoomOnPinch=m[15]===void 0?!0:m[15]),y[0]&65536&&(I.panOnScroll=m[16]===void 0?!1:m[16]),y[0]&131072&&(I.panOnDrag=m[17]===void 0?!0:m[17]),y[0]&4194304&&(I.paneClickDistance=m[22]===void 0?0:m[22]),y[0]&10879168|y[1]&8|y[3]&64&&(I.$$scope={dirty:y,ctx:m}),r.$set(I);const S={};y[0]&1048576&&(S.proOptions=m[20]),y[0]&524288&&(S.position=m[19]),s.$set(S),_&&_.p&&(!u||y[3]&64)&&Kt(_,h,m,m[99],u?Wt(h,m[99],y,null):Gt(m[99]),null),Sn(e,v=Yn(b,[(!u||y[0]&16777216)&&{style:m[24]},(!u||y[0]&1107296256&&l!==(l=nn(["svelte-flow",m[25],m[30]])))&&{class:l},{"data-testid":"svelte-flow__wrapper"},y[1]&4&&m[33],{role:"application"}])),gt(e,"svelte-12wlba6",!0)},i(m){u||(T(t.$$.fragment,m),T(r.$$.fragment,m),T(s.$$.fragment,m),T(_,m),u=!0)},o(m){N(t.$$.fragment,m),N(r.$$.fragment,m),N(s.$$.fragment,m),N(_,m),u=!1},d(m){m&&p(e),ie(t),ie(r),ie(s),_&&_.d(m),o[97](null),c(),d=!1,cn(f)}}}function bE(o,e,t){let n;const r=["id","nodes","edges","fitView","fitViewOptions","minZoom","maxZoom","initialViewport","viewport","nodeTypes","edgeTypes","selectionKey","selectionMode","panActivationKey","multiSelectionKey","zoomActivationKey","nodesDraggable","nodesConnectable","nodeDragThreshold","elementsSelectable","snapGrid","deleteKey","connectionRadius","connectionLineType","connectionMode","connectionLineStyle","connectionLineContainerStyle","onMoveStart","onMove","onMoveEnd","isValidConnection","translateExtent","nodeExtent","onlyRenderVisibleElements","panOnScrollMode","preventScrolling","zoomOnScroll","zoomOnDoubleClick","zoomOnPinch","panOnScroll","panOnDrag","selectionOnDrag","autoPanOnConnect","autoPanOnNodeDrag","onerror","ondelete","onedgecreate","attributionPosition","proOptions","defaultEdgeOptions","width","height","colorMode","onconnect","onconnectstart","onconnectend","onbeforedelete","oninit","nodeOrigin","paneClickDistance","nodeClickDistance","defaultMarkerColor","style","class"];let i=$t(e,r),s,a,l=Le,c=()=>(l(),l=$l(R,ne=>t(100,a=ne)),R),u,d=Le,f=()=>(d(),d=$l(n,ne=>t(30,u=ne)),n);o.$$.on_destroy.push(()=>l()),o.$$.on_destroy.push(()=>d());let{$$slots:h={},$$scope:_}=e;const b=wm(h);let{id:v="1"}=e,{nodes:m}=e,{edges:y}=e,{fitView:w=void 0}=e,{fitViewOptions:I=void 0}=e,{minZoom:S=void 0}=e,{maxZoom:k=void 0}=e,{initialViewport:C=void 0}=e,{viewport:R=void 0}=e;c();let{nodeTypes:D=void 0}=e,{edgeTypes:H=void 0}=e,{selectionKey:z=void 0}=e,{selectionMode:W=void 0}=e,{panActivationKey:K=void 0}=e,{multiSelectionKey:P=void 0}=e,{zoomActivationKey:V=void 0}=e,{nodesDraggable:L=void 0}=e,{nodesConnectable:q=void 0}=e,{nodeDragThreshold:Z=void 0}=e,{elementsSelectable:Q=void 0}=e,{snapGrid:Y=void 0}=e,{deleteKey:te=void 0}=e,{connectionRadius:F=void 0}=e,{connectionLineType:j=void 0}=e,{connectionMode:x=Ir.Strict}=e,{connectionLineStyle:J=""}=e,{connectionLineContainerStyle:ve=""}=e,{onMoveStart:le=void 0}=e,{onMove:me=void 0}=e,{onMoveEnd:X=void 0}=e,{isValidConnection:ue=void 0}=e,{translateExtent:be=void 0}=e,{nodeExtent:Re=void 0}=e,{onlyRenderVisibleElements:Fe=void 0}=e,{panOnScrollMode:he=Bo.Free}=e,{preventScrolling:et=!0}=e,{zoomOnScroll:ot=!0}=e,{zoomOnDoubleClick:Et=!0}=e,{zoomOnPinch:Dt=!0}=e,{panOnScroll:Yt=!1}=e,{panOnDrag:Pt=!0}=e,{selectionOnDrag:Zt=void 0}=e,{autoPanOnConnect:jt=!0}=e,{autoPanOnNodeDrag:Ht=!0}=e,{onerror:Qt=void 0}=e,{ondelete:se=void 0}=e,{onedgecreate:Qe=void 0}=e,{attributionPosition:rt=void 0}=e,{proOptions:pt=void 0}=e,{defaultEdgeOptions:Ue=void 0}=e,{width:en=void 0}=e,{height:At=void 0}=e,{colorMode:pe="light"}=e,{onconnect:Xe=void 0}=e,{onconnectstart:Be=void 0}=e,{onconnectend:Ze=void 0}=e,{onbeforedelete:Tt=void 0}=e,{oninit:St=void 0}=e,{nodeOrigin:Nt=void 0}=e,{paneClickDistance:_t=0}=e,{nodeClickDistance:yn=0}=e,{defaultMarkerColor:hn="#b1b1b7"}=e,{style:gn=void 0}=e,{class:xt=void 0}=e,on,kn,Rn;const rn=a||C,Bt=km(na)?pn():o2({nodes:ye(m),edges:ye(y),width:en,height:At,fitView:w,nodeOrigin:Nt,nodeExtent:Re});Kn(()=>(Bt.width.set(kn),Bt.height.set(Rn),Bt.domNode.set(on),Bt.syncNodeStores(m),Bt.syncEdgeStores(y),Bt.syncViewport(R),w!==void 0&&Bt.fitViewOnInit.set(w),I&&Bt.fitViewOptions.set(I),Bd(Bt,{nodeTypes:D,edgeTypes:H,minZoom:S,maxZoom:k,translateExtent:be,paneClickDistance:_t}),()=>{Bt.reset()}));const{initialized:to}=Bt;fe(o,to,ne=>t(74,s=ne));let Gn=!1;function no(ne){Mt.call(this,o,ne)}function fo(ne){Mt.call(this,o,ne)}function Io(ne){Mt.call(this,o,ne)}function Vo(ne){Mt.call(this,o,ne)}function oo(ne){Mt.call(this,o,ne)}function ro(ne){Mt.call(this,o,ne)}function G(ne){Mt.call(this,o,ne)}function Ne(ne){Mt.call(this,o,ne)}function Je(ne){Mt.call(this,o,ne)}function ht(ne){Mt.call(this,o,ne)}function Ve(ne){Mt.call(this,o,ne)}function ct(ne){Mt.call(this,o,ne)}function Lt(ne){Mt.call(this,o,ne)}function Ln(ne){Mt.call(this,o,ne)}function Wn(ne){Mt.call(this,o,ne)}function sn(ne){Mt.call(this,o,ne)}function Xt(ne){Mt.call(this,o,ne)}function qn(ne){Mt.call(this,o,ne)}function Un(ne){Mt.call(this,o,ne)}function ho(ne){Mt.call(this,o,ne)}function go(ne){Mt.call(this,o,ne)}function Sr(ne){ze[ne?"unshift":"push"](()=>{on=ne,t(28,on)})}function dr(){kn=this.clientWidth,Rn=this.clientHeight,t(26,kn),t(27,Rn)}return o.$$set=ne=>{e=wt(wt({},e),eo(ne)),t(33,i=$t(e,r)),"id"in ne&&t(35,v=ne.id),"nodes"in ne&&t(36,m=ne.nodes),"edges"in ne&&t(37,y=ne.edges),"fitView"in ne&&t(38,w=ne.fitView),"fitViewOptions"in ne&&t(39,I=ne.fitViewOptions),"minZoom"in ne&&t(40,S=ne.minZoom),"maxZoom"in ne&&t(41,k=ne.maxZoom),"initialViewport"in ne&&t(42,C=ne.initialViewport),"viewport"in ne&&c(t(0,R=ne.viewport)),"nodeTypes"in ne&&t(43,D=ne.nodeTypes),"edgeTypes"in ne&&t(44,H=ne.edgeTypes),"selectionKey"in ne&&t(1,z=ne.selectionKey),"selectionMode"in ne&&t(45,W=ne.selectionMode),"panActivationKey"in ne&&t(2,K=ne.panActivationKey),"multiSelectionKey"in ne&&t(3,P=ne.multiSelectionKey),"zoomActivationKey"in ne&&t(4,V=ne.zoomActivationKey),"nodesDraggable"in ne&&t(46,L=ne.nodesDraggable),"nodesConnectable"in ne&&t(47,q=ne.nodesConnectable),"nodeDragThreshold"in ne&&t(48,Z=ne.nodeDragThreshold),"elementsSelectable"in ne&&t(49,Q=ne.elementsSelectable),"snapGrid"in ne&&t(50,Y=ne.snapGrid),"deleteKey"in ne&&t(5,te=ne.deleteKey),"connectionRadius"in ne&&t(51,F=ne.connectionRadius),"connectionLineType"in ne&&t(52,j=ne.connectionLineType),"connectionMode"in ne&&t(53,x=ne.connectionMode),"connectionLineStyle"in ne&&t(6,J=ne.connectionLineStyle),"connectionLineContainerStyle"in ne&&t(7,ve=ne.connectionLineContainerStyle),"onMoveStart"in ne&&t(8,le=ne.onMoveStart),"onMove"in ne&&t(9,me=ne.onMove),"onMoveEnd"in ne&&t(10,X=ne.onMoveEnd),"isValidConnection"in ne&&t(54,ue=ne.isValidConnection),"translateExtent"in ne&&t(55,be=ne.translateExtent),"nodeExtent"in ne&&t(56,Re=ne.nodeExtent),"onlyRenderVisibleElements"in ne&&t(57,Fe=ne.onlyRenderVisibleElements),"panOnScrollMode"in ne&&t(11,he=ne.panOnScrollMode),"preventScrolling"in ne&&t(12,et=ne.preventScrolling),"zoomOnScroll"in ne&&t(13,ot=ne.zoomOnScroll),"zoomOnDoubleClick"in ne&&t(14,Et=ne.zoomOnDoubleClick),"zoomOnPinch"in ne&&t(15,Dt=ne.zoomOnPinch),"panOnScroll"in ne&&t(16,Yt=ne.panOnScroll),"panOnDrag"in ne&&t(17,Pt=ne.panOnDrag),"selectionOnDrag"in ne&&t(18,Zt=ne.selectionOnDrag),"autoPanOnConnect"in ne&&t(58,jt=ne.autoPanOnConnect),"autoPanOnNodeDrag"in ne&&t(59,Ht=ne.autoPanOnNodeDrag),"onerror"in ne&&t(60,Qt=ne.onerror),"ondelete"in ne&&t(61,se=ne.ondelete),"onedgecreate"in ne&&t(62,Qe=ne.onedgecreate),"attributionPosition"in ne&&t(19,rt=ne.attributionPosition),"proOptions"in ne&&t(20,pt=ne.proOptions),"defaultEdgeOptions"in ne&&t(21,Ue=ne.defaultEdgeOptions),"width"in ne&&t(63,en=ne.width),"height"in ne&&t(64,At=ne.height),"colorMode"in ne&&t(65,pe=ne.colorMode),"onconnect"in ne&&t(66,Xe=ne.onconnect),"onconnectstart"in ne&&t(67,Be=ne.onconnectstart),"onconnectend"in ne&&t(68,Ze=ne.onconnectend),"onbeforedelete"in ne&&t(69,Tt=ne.onbeforedelete),"oninit"in ne&&t(70,St=ne.oninit),"nodeOrigin"in ne&&t(71,Nt=ne.nodeOrigin),"paneClickDistance"in ne&&t(22,_t=ne.paneClickDistance),"nodeClickDistance"in ne&&t(23,yn=ne.nodeClickDistance),"defaultMarkerColor"in ne&&t(72,hn=ne.defaultMarkerColor),"style"in ne&&t(24,gn=ne.style),"class"in ne&&t(25,xt=ne.class),"$$scope"in ne&&t(99,_=ne.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&201326592&&kn!==void 0&&Rn!==void 0&&(Bt.width.set(kn),Bt.height.set(Rn)),o.$$.dirty[2]&6400&&!Gn&&s&&(St==null||St(),t(73,Gn=!0)),o.$$.dirty[1]&2097135632|o.$$.dirty[2]&1777&&cE(Bt,{flowId:v,connectionLineType:j,connectionRadius:F,selectionMode:W,snapGrid:Y,defaultMarkerColor:hn,nodesDraggable:L,nodesConnectable:q,elementsSelectable:Q,onlyRenderVisibleElements:Fe,isValidConnection:ue,autoPanOnConnect:jt,autoPanOnNodeDrag:Ht,onerror:Qt,ondelete:se,onedgecreate:Qe,connectionMode:x,nodeDragThreshold:Z,onconnect:Xe,onconnectstart:Be,onconnectend:Ze,onbeforedelete:Tt,nodeOrigin:Nt}),o.$$.dirty[0]&4194304|o.$$.dirty[1]&16791040&&Bd(Bt,{nodeTypes:D,edgeTypes:H,minZoom:S,maxZoom:k,translateExtent:be,paneClickDistance:_t}),o.$$.dirty[2]&8&&f(t(29,n=dE(pe)))},[R,z,K,P,V,te,J,ve,le,me,X,he,et,ot,Et,Dt,Yt,Pt,Zt,rt,pt,Ue,_t,yn,gn,xt,kn,Rn,on,n,u,rn,to,i,b,v,m,y,w,I,S,k,C,D,H,W,L,q,Z,Q,Y,F,j,x,ue,be,Re,Fe,jt,Ht,Qt,se,Qe,en,At,pe,Xe,Be,Ze,Tt,St,Nt,hn,Gn,s,h,no,fo,Io,Vo,oo,ro,G,Ne,Je,ht,Ve,ct,Lt,Ln,Wn,sn,Xt,qn,Un,ho,go,Sr,dr,_]}class yE extends Ge{constructor(e){super(),We(this,e,bE,_E,Ye,{id:35,nodes:36,edges:37,fitView:38,fitViewOptions:39,minZoom:40,maxZoom:41,initialViewport:42,viewport:0,nodeTypes:43,edgeTypes:44,selectionKey:1,selectionMode:45,panActivationKey:2,multiSelectionKey:3,zoomActivationKey:4,nodesDraggable:46,nodesConnectable:47,nodeDragThreshold:48,elementsSelectable:49,snapGrid:50,deleteKey:5,connectionRadius:51,connectionLineType:52,connectionMode:53,connectionLineStyle:6,connectionLineContainerStyle:7,onMoveStart:8,onMove:9,onMoveEnd:10,isValidConnection:54,translateExtent:55,nodeExtent:56,onlyRenderVisibleElements:57,panOnScrollMode:11,preventScrolling:12,zoomOnScroll:13,zoomOnDoubleClick:14,zoomOnPinch:15,panOnScroll:16,panOnDrag:17,selectionOnDrag:18,autoPanOnConnect:58,autoPanOnNodeDrag:59,onerror:60,ondelete:61,onedgecreate:62,attributionPosition:19,proOptions:20,defaultEdgeOptions:21,width:63,height:64,colorMode:65,onconnect:66,onconnectstart:67,onconnectend:68,onbeforedelete:69,oninit:70,nodeOrigin:71,paneClickDistance:22,nodeClickDistance:23,defaultMarkerColor:72,style:24,class:25},null,[-1,-1,-1,-1])}}function vE(o){let e;const t=o[7].default,n=Ft(t,o,o[6],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,[i]){n&&n.p&&(!e||i&64)&&Kt(n,t,r,r[6],e?Wt(t,r[6],i,null):Gt(r[6]),null)},i(r){e||(T(n,r),e=!0)},o(r){N(n,r),e=!1},d(r){n&&n.d(r)}}}function wE(o,e,t){let{$$slots:n={},$$scope:r}=e,{initialNodes:i=void 0}=e,{initialEdges:s=void 0}=e,{initialWidth:a=void 0}=e,{initialHeight:l=void 0}=e,{fitView:c=void 0}=e,{nodeOrigin:u=void 0}=e;const d=lm({nodes:i,edges:s,width:a,height:l,nodeOrigin:u,fitView:c});return yi(na,{getStore:()=>d}),ur(()=>{d.reset()}),o.$$set=f=>{"initialNodes"in f&&t(0,i=f.initialNodes),"initialEdges"in f&&t(1,s=f.initialEdges),"initialWidth"in f&&t(2,a=f.initialWidth),"initialHeight"in f&&t(3,l=f.initialHeight),"fitView"in f&&t(4,c=f.fitView),"nodeOrigin"in f&&t(5,u=f.nodeOrigin),"$$scope"in f&&t(6,r=f.$$scope)},[i,s,a,l,c,u,r,n]}class kE extends Ge{constructor(e){super(),We(this,e,wE,vE,Ye,{initialNodes:0,initialEdges:1,initialWidth:2,initialHeight:3,fitView:4,nodeOrigin:5})}}const CE=o=>({}),Vd=o=>({class:"button-svg"});function EE(o){let e,t,n,r,i;const s=o[8].default,a=Ft(s,o,o[7],Vd);let l=[{type:"button"},{class:t=nn(["svelte-flow__controls-button",o[0]])},o[6]],c={};for(let u=0;u<l.length;u+=1)c=wt(c,l[u]);return{c(){e=M("button"),a&&a.c(),this.h()},l(u){e=O(u,"BUTTON",{type:!0,class:!0});var d=A(e);a&&a.l(d),d.forEach(p),this.h()},h(){Sn(e,c),lt(e,"--xy-controls-button-background-color-props",o[1]),lt(e,"--xy-controls-button-background-color-hover-props",o[2]),lt(e,"--xy-controls-button-color-props",o[3]),lt(e,"--xy-controls-button-color-hover-props",o[4]),lt(e,"--xy-controls-button-border-color-props",o[5])},m(u,d){U(u,e,d),a&&a.m(e,null),e.autofocus&&e.focus(),n=!0,r||(i=we(e,"click",o[9]),r=!0)},p(u,[d]){a&&a.p&&(!n||d&128)&&Kt(a,s,u,u[7],n?Wt(s,u[7],d,CE):Gt(u[7]),Vd),Sn(e,c=Yn(l,[{type:"button"},(!n||d&1&&t!==(t=nn(["svelte-flow__controls-button",u[0]])))&&{class:t},d&64&&u[6]])),lt(e,"--xy-controls-button-background-color-props",u[1]),lt(e,"--xy-controls-button-background-color-hover-props",u[2]),lt(e,"--xy-controls-button-color-props",u[3]),lt(e,"--xy-controls-button-color-hover-props",u[4]),lt(e,"--xy-controls-button-border-color-props",u[5])},i(u){n||(T(a,u),n=!0)},o(u){N(a,u),n=!1},d(u){u&&p(e),a&&a.d(u),r=!1,i()}}}function IE(o,e,t){const n=["class"];let r=$t(e,n),{$$slots:i={},$$scope:s}=e,{class:a=void 0}=e,l,c,u,d,f;function h(_){Mt.call(this,o,_)}return o.$$set=_=>{e=wt(wt({},e),eo(_)),t(6,r=$t(e,n)),"class"in _&&t(0,a=_.class),"$$scope"in _&&t(7,s=_.$$scope)},[a,l,c,u,d,f,r,s,i,h]}class Ms extends Ge{constructor(e){super(),We(this,e,IE,EE,Ye,{class:0})}}function TE(o){let e,t;return{c(){e=Me("svg"),t=Me("path"),this.h()},l(n){e=Oe(n,"svg",{xmlns:!0,viewBox:!0});var r=A(e);t=Oe(r,"path",{d:!0}),A(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"d","M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 32 32")},m(n,r){U(n,e,r),E(e,t)},p:Le,i:Le,o:Le,d(n){n&&p(e)}}}class SE extends Ge{constructor(e){super(),We(this,e,null,TE,Ye,{})}}function AE(o){let e,t;return{c(){e=Me("svg"),t=Me("path"),this.h()},l(n){e=Oe(n,"svg",{xmlns:!0,viewBox:!0});var r=A(e);t=Oe(r,"path",{d:!0}),A(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"d","M0 0h32v4.2H0z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 32 5")},m(n,r){U(n,e,r),E(e,t)},p:Le,i:Le,o:Le,d(n){n&&p(e)}}}class RE extends Ge{constructor(e){super(),We(this,e,null,AE,Ye,{})}}function ME(o){let e,t;return{c(){e=Me("svg"),t=Me("path"),this.h()},l(n){e=Oe(n,"svg",{xmlns:!0,viewBox:!0});var r=A(e);t=Oe(r,"path",{d:!0}),A(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"d","M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 32 30")},m(n,r){U(n,e,r),E(e,t)},p:Le,i:Le,o:Le,d(n){n&&p(e)}}}class OE extends Ge{constructor(e){super(),We(this,e,null,ME,Ye,{})}}function PE(o){let e,t;return{c(){e=Me("svg"),t=Me("path"),this.h()},l(n){e=Oe(n,"svg",{xmlns:!0,viewBox:!0});var r=A(e);t=Oe(r,"path",{d:!0}),A(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"d","M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 25 32")},m(n,r){U(n,e,r),E(e,t)},p:Le,i:Le,o:Le,d(n){n&&p(e)}}}class NE extends Ge{constructor(e){super(),We(this,e,null,PE,Ye,{})}}function DE(o){let e,t;return{c(){e=Me("svg"),t=Me("path"),this.h()},l(n){e=Oe(n,"svg",{xmlns:!0,viewBox:!0});var r=A(e);t=Oe(r,"path",{d:!0}),A(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"d","M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 25 32")},m(n,r){U(n,e,r),E(e,t)},p:Le,i:Le,o:Le,d(n){n&&p(e)}}}class HE extends Ge{constructor(e){super(),We(this,e,null,DE,Ye,{})}}const LE=o=>({}),Fd=o=>({}),UE=o=>({}),Kd=o=>({});function Gd(o){let e,t,n,r;const i=[{class:"svelte-flow__controls-zoomin"},{title:"zoom in"},{"aria-label":"zoom in"},{disabled:o[9]},o[17]];let s={$$slots:{default:[BE]},$$scope:{ctx:o}};for(let c=0;c<i.length;c+=1)s=wt(s,i[c]);e=new Ms({props:s}),e.$on("click",o[18]);const a=[{class:"svelte-flow__controls-zoomout"},{title:"zoom out"},{"aria-label":"zoom out"},{disabled:o[10]},o[17]];let l={$$slots:{default:[zE]},$$scope:{ctx:o}};for(let c=0;c<a.length;c+=1)l=wt(l,a[c]);return n=new Ms({props:l}),n.$on("click",o[19]),{c(){oe(e.$$.fragment),t=$(),oe(n.$$.fragment)},l(c){ae(e.$$.fragment,c),t=ee(c),ae(n.$$.fragment,c)},m(c,u){re(e,c,u),U(c,t,u),re(n,c,u),r=!0},p(c,u){const d=u[0]&131584?Yn(i,[i[0],i[1],i[2],u[0]&512&&{disabled:c[9]},u[0]&131072&&wi(c[17])]):{};u[1]&32&&(d.$$scope={dirty:u,ctx:c}),e.$set(d);const f=u[0]&132096?Yn(a,[a[0],a[1],a[2],u[0]&1024&&{disabled:c[10]},u[0]&131072&&wi(c[17])]):{};u[1]&32&&(f.$$scope={dirty:u,ctx:c}),n.$set(f)},i(c){r||(T(e.$$.fragment,c),T(n.$$.fragment,c),r=!0)},o(c){N(e.$$.fragment,c),N(n.$$.fragment,c),r=!1},d(c){c&&p(t),ie(e,c),ie(n,c)}}}function BE(o){let e,t;return e=new SE({}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function zE(o){let e,t;return e=new RE({}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function Wd(o){let e,t;const n=[{class:"svelte-flow__controls-fitview"},{title:"fit view"},{"aria-label":"fit view"},o[17]];let r={$$slots:{default:[VE]},$$scope:{ctx:o}};for(let i=0;i<n.length;i+=1)r=wt(r,n[i]);return e=new Ms({props:r}),e.$on("click",o[20]),{c(){oe(e.$$.fragment)},l(i){ae(e.$$.fragment,i)},m(i,s){re(e,i,s),t=!0},p(i,s){const a=s[0]&131072?Yn(n,[n[0],n[1],n[2],wi(i[17])]):{};s[1]&32&&(a.$$scope={dirty:s,ctx:i}),e.$set(a)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){N(e.$$.fragment,i),t=!1},d(i){ie(e,i)}}}function VE(o){let e,t;return e=new OE({}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function qd(o){let e,t;const n=[{class:"svelte-flow__controls-interactive"},{title:"toggle interactivity"},{"aria-label":"toggle interactivity"},o[17]];let r={$$slots:{default:[GE]},$$scope:{ctx:o}};for(let i=0;i<n.length;i+=1)r=wt(r,n[i]);return e=new Ms({props:r}),e.$on("click",o[21]),{c(){oe(e.$$.fragment)},l(i){ae(e.$$.fragment,i)},m(i,s){re(e,i,s),t=!0},p(i,s){const a=s[0]&131072?Yn(n,[n[0],n[1],n[2],wi(i[17])]):{};s[0]&256|s[1]&32&&(a.$$scope={dirty:s,ctx:i}),e.$set(a)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){N(e.$$.fragment,i),t=!1},d(i){ie(e,i)}}}function FE(o){let e,t;return e=new NE({}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function KE(o){let e,t;return e=new HE({}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function GE(o){let e,t,n,r;const i=[KE,FE],s=[];function a(l,c){return l[8]?0:1}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=qe()},l(l){t.l(l),n=qe()},m(l,c){s[e].m(l,c),U(l,n,c),r=!0},p(l,c){let u=e;e=a(l),e!==u&&(De(),N(s[u],1,1,()=>{s[u]=null}),He(),t=s[e],t||(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){N(t),r=!1},d(l){l&&p(n),s[e].d(l)}}}function WE(o){let e,t,n,r,i,s;const a=o[35].before,l=Ft(a,o,o[36],Kd);let c=o[1]&&Gd(o),u=o[2]&&Wd(o),d=o[3]&&qd(o);const f=o[35].default,h=Ft(f,o,o[36],null),_=o[35].after,b=Ft(_,o,o[36],Fd);return{c(){l&&l.c(),e=$(),c&&c.c(),t=$(),u&&u.c(),n=$(),d&&d.c(),r=$(),h&&h.c(),i=$(),b&&b.c()},l(v){l&&l.l(v),e=ee(v),c&&c.l(v),t=ee(v),u&&u.l(v),n=ee(v),d&&d.l(v),r=ee(v),h&&h.l(v),i=ee(v),b&&b.l(v)},m(v,m){l&&l.m(v,m),U(v,e,m),c&&c.m(v,m),U(v,t,m),u&&u.m(v,m),U(v,n,m),d&&d.m(v,m),U(v,r,m),h&&h.m(v,m),U(v,i,m),b&&b.m(v,m),s=!0},p(v,m){l&&l.p&&(!s||m[1]&32)&&Kt(l,a,v,v[36],s?Wt(a,v[36],m,UE):Gt(v[36]),Kd),v[1]?c?(c.p(v,m),m[0]&2&&T(c,1)):(c=Gd(v),c.c(),T(c,1),c.m(t.parentNode,t)):c&&(De(),N(c,1,1,()=>{c=null}),He()),v[2]?u?(u.p(v,m),m[0]&4&&T(u,1)):(u=Wd(v),u.c(),T(u,1),u.m(n.parentNode,n)):u&&(De(),N(u,1,1,()=>{u=null}),He()),v[3]?d?(d.p(v,m),m[0]&8&&T(d,1)):(d=qd(v),d.c(),T(d,1),d.m(r.parentNode,r)):d&&(De(),N(d,1,1,()=>{d=null}),He()),h&&h.p&&(!s||m[1]&32)&&Kt(h,f,v,v[36],s?Wt(f,v[36],m,null):Gt(v[36]),null),b&&b.p&&(!s||m[1]&32)&&Kt(b,_,v,v[36],s?Wt(_,v[36],m,LE):Gt(v[36]),Fd)},i(v){s||(T(l,v),T(c),T(u),T(d),T(h,v),T(b,v),s=!0)},o(v){N(l,v),N(c),N(u),N(d),N(h,v),N(b,v),s=!1},d(v){v&&(p(e),p(t),p(n),p(r),p(i)),l&&l.d(v),c&&c.d(v),u&&u.d(v),d&&d.d(v),h&&h.d(v),b&&b.d(v)}}}function qE(o){let e,t;return e=new fm({props:{class:nn(["svelte-flow__controls",o[7],o[6]]),position:o[0],"data-testid":"svelte-flow__controls","aria-label":o[4]??"Svelte Flow controls",style:o[5],$$slots:{default:[WE]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&192&&(i.class=nn(["svelte-flow__controls",n[7],n[6]])),r[0]&1&&(i.position=n[0]),r[0]&16&&(i["aria-label"]=n[4]??"Svelte Flow controls"),r[0]&32&&(i.style=n[5]),r[0]&1806|r[1]&32&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function YE(o,e,t){let n,r,i,s,a,l,c,u,d,f,{$$slots:h={},$$scope:_}=e,{position:b="bottom-left"}=e,{showZoom:v=!0}=e,{showFitView:m=!0}=e,{showLock:y=!0}=e,{buttonBgColor:w=void 0}=e,{buttonBgColorHover:I=void 0}=e,{buttonColor:S=void 0}=e,{buttonColorHover:k=void 0}=e,{buttonBorderColor:C=void 0}=e,{ariaLabel:R=void 0}=e,{style:D=void 0}=e,{orientation:H="vertical"}=e,{fitViewOptions:z=void 0}=e,{class:W=""}=e;const{zoomIn:K,zoomOut:P,fitView:V,viewport:L,minZoom:q,maxZoom:Z,nodesDraggable:Q,nodesConnectable:Y,elementsSelectable:te}=pn();fe(o,L,le=>t(30,l=le)),fe(o,q,le=>t(31,c=le)),fe(o,Z,le=>t(29,a=le)),fe(o,Q,le=>t(34,f=le)),fe(o,Y,le=>t(33,d=le)),fe(o,te,le=>t(32,u=le));const F={bgColor:w,bgColorHover:I,color:S,colorHover:k,borderColor:C},j=()=>{K()},x=()=>{P()},J=()=>{V(z)},ve=()=>{t(8,n=!n),Q.set(n),Y.set(n),te.set(n)};return o.$$set=le=>{"position"in le&&t(0,b=le.position),"showZoom"in le&&t(1,v=le.showZoom),"showFitView"in le&&t(2,m=le.showFitView),"showLock"in le&&t(3,y=le.showLock),"buttonBgColor"in le&&t(22,w=le.buttonBgColor),"buttonBgColorHover"in le&&t(23,I=le.buttonBgColorHover),"buttonColor"in le&&t(24,S=le.buttonColor),"buttonColorHover"in le&&t(25,k=le.buttonColorHover),"buttonBorderColor"in le&&t(26,C=le.buttonBorderColor),"ariaLabel"in le&&t(4,R=le.ariaLabel),"style"in le&&t(5,D=le.style),"orientation"in le&&t(27,H=le.orientation),"fitViewOptions"in le&&t(28,z=le.fitViewOptions),"class"in le&&t(6,W=le.class),"$$scope"in le&&t(36,_=le.$$scope)},o.$$.update=()=>{o.$$.dirty[1]&14&&t(8,n=f||d||u),o.$$.dirty[0]&1073741824|o.$$.dirty[1]&1&&t(10,r=l.zoom<=c),o.$$.dirty[0]&1610612736&&t(9,i=l.zoom>=a),o.$$.dirty[0]&134217728&&t(7,s=H==="horizontal"?"horizontal":"vertical")},[b,v,m,y,R,D,W,s,n,i,r,L,q,Z,Q,Y,te,F,j,x,J,ve,w,I,S,k,C,H,z,a,l,c,u,d,f,h,_]}let jE=class extends Ge{constructor(e){super(),We(this,e,YE,qE,Ye,{position:0,showZoom:1,showFitView:2,showLock:3,buttonBgColor:22,buttonBgColorHover:23,buttonColor:24,buttonColorHover:25,buttonBorderColor:26,ariaLabel:4,style:5,orientation:27,fitViewOptions:28,class:6},null,[-1,-1])}};var Zo;(function(o){o.Lines="lines",o.Dots="dots",o.Cross="cross"})(Zo||(Zo={}));function QE(o){let e,t;return{c(){e=Me("circle"),this.h()},l(n){e=Oe(n,"circle",{cx:!0,cy:!0,r:!0,class:!0}),A(e).forEach(p),this.h()},h(){g(e,"cx",o[0]),g(e,"cy",o[0]),g(e,"r",o[0]),g(e,"class",t=nn(["svelte-flow__background-pattern","dots",o[1]]))},m(n,r){U(n,e,r)},p(n,[r]){r&1&&g(e,"cx",n[0]),r&1&&g(e,"cy",n[0]),r&1&&g(e,"r",n[0]),r&2&&t!==(t=nn(["svelte-flow__background-pattern","dots",n[1]]))&&g(e,"class",t)},i:Le,o:Le,d(n){n&&p(e)}}}function XE(o,e,t){let{radius:n=5}=e,{class:r=""}=e;return o.$$set=i=>{"radius"in i&&t(0,n=i.radius),"class"in i&&t(1,r=i.class)},[n,r]}class JE extends Ge{constructor(e){super(),We(this,e,XE,QE,Ye,{radius:0,class:1})}}function ZE(o){let e,t,n;return{c(){e=Me("path"),this.h()},l(r){e=Oe(r,"path",{"stroke-width":!0,d:!0,class:!0}),A(e).forEach(p),this.h()},h(){g(e,"stroke-width",o[0]),g(e,"d",t=`M${o[1][0]/2} 0 V${o[1][1]} M0 ${o[1][1]/2} H${o[1][0]}`),g(e,"class",n=nn(["svelte-flow__background-pattern",o[2],o[3]]))},m(r,i){U(r,e,i)},p(r,[i]){i&1&&g(e,"stroke-width",r[0]),i&2&&t!==(t=`M${r[1][0]/2} 0 V${r[1][1]} M0 ${r[1][1]/2} H${r[1][0]}`)&&g(e,"d",t),i&12&&n!==(n=nn(["svelte-flow__background-pattern",r[2],r[3]]))&&g(e,"class",n)},i:Le,o:Le,d(r){r&&p(e)}}}function xE(o,e,t){let{lineWidth:n=1}=e,{dimensions:r}=e,{variant:i=void 0}=e,{class:s=""}=e;return o.$$set=a=>{"lineWidth"in a&&t(0,n=a.lineWidth),"dimensions"in a&&t(1,r=a.dimensions),"variant"in a&&t(2,i=a.variant),"class"in a&&t(3,s=a.class)},[n,r,i,s]}class $E extends Ge{constructor(e){super(),We(this,e,xE,ZE,Ye,{lineWidth:0,dimensions:1,variant:2,class:3})}}function eI(o){let e,t;return e=new $E({props:{dimensions:o[6],variant:o[0],lineWidth:o[1],class:o[4]}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&64&&(i.dimensions=n[6]),r&1&&(i.variant=n[0]),r&2&&(i.lineWidth=n[1]),r&16&&(i.class=n[4]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function tI(o){let e,t;return e=new JE({props:{radius:o[7]/2,class:o[4]}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&128&&(i.radius=n[7]/2),r&16&&(i.class=n[4]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function nI(o){let e,t,n,r,i,s,a,l,c,u,d,f,h;const _=[tI,eI],b=[];function v(m,y){return m[14]?0:1}return n=v(o),r=b[n]=_[n](o),{c(){e=Me("svg"),t=Me("pattern"),r.c(),u=Me("rect"),this.h()},l(m){e=Oe(m,"svg",{class:!0,"data-testid":!0});var y=A(e);t=Oe(y,"pattern",{id:!0,x:!0,y:!0,width:!0,height:!0,patternUnits:!0,patternTransform:!0});var w=A(t);r.l(w),w.forEach(p),u=Oe(y,"rect",{x:!0,y:!0,width:!0,height:!0,fill:!0}),A(u).forEach(p),y.forEach(p),this.h()},h(){g(t,"id",o[11]),g(t,"x",i=o[9].x%o[8][0]),g(t,"y",s=o[9].y%o[8][1]),g(t,"width",a=o[8][0]),g(t,"height",l=o[8][1]),g(t,"patternUnits","userSpaceOnUse"),g(t,"patternTransform",c=`translate(-${o[10][0]},-${o[10][1]})`),g(u,"x","0"),g(u,"y","0"),g(u,"width","100%"),g(u,"height","100%"),g(u,"fill",d=`url(#${o[11]})`),g(e,"class",f=ec(nn(["svelte-flow__background",o[5]]))+" svelte-1r7pe8d"),g(e,"data-testid","svelte-flow__background"),lt(e,"--xy-background-color-props",o[2]),lt(e,"--xy-background-pattern-color-props",o[3])},m(m,y){U(m,e,y),E(e,t),b[n].m(t,null),E(e,u),h=!0},p(m,[y]){r.p(m,y),(!h||y&2048)&&g(t,"id",m[11]),(!h||y&768&&i!==(i=m[9].x%m[8][0]))&&g(t,"x",i),(!h||y&768&&s!==(s=m[9].y%m[8][1]))&&g(t,"y",s),(!h||y&256&&a!==(a=m[8][0]))&&g(t,"width",a),(!h||y&256&&l!==(l=m[8][1]))&&g(t,"height",l),(!h||y&1024&&c!==(c=`translate(-${m[10][0]},-${m[10][1]})`))&&g(t,"patternTransform",c),(!h||y&2048&&d!==(d=`url(#${m[11]})`))&&g(u,"fill",d),(!h||y&32&&f!==(f=ec(nn(["svelte-flow__background",m[5]]))+" svelte-1r7pe8d"))&&g(e,"class",f),y&4&&lt(e,"--xy-background-color-props",m[2]),y&8&&lt(e,"--xy-background-pattern-color-props",m[3])},i(m){h||(T(r),h=!0)},o(m){N(r),h=!1},d(m){m&&p(e),b[n].d()}}}const oI={[Zo.Dots]:1,[Zo.Lines]:1,[Zo.Cross]:6};function rI(o,e,t){let n,r,i,s,a,l,c,{id:u=void 0}=e,{variant:d=Zo.Dots}=e,{gap:f=20}=e,{size:h=1}=e,{lineWidth:_=1}=e,{bgColor:b=void 0}=e,{patternColor:v=void 0}=e,{patternClass:m=void 0}=e,{class:y=""}=e;const{viewport:w,flowId:I}=pn();fe(o,w,D=>t(9,l=D)),fe(o,I,D=>t(18,c=D));const S=h||oI[d],k=d===Zo.Dots,C=d===Zo.Cross,R=Array.isArray(f)?f:[f,f];return o.$$set=D=>{"id"in D&&t(15,u=D.id),"variant"in D&&t(0,d=D.variant),"gap"in D&&t(16,f=D.gap),"size"in D&&t(17,h=D.size),"lineWidth"in D&&t(1,_=D.lineWidth),"bgColor"in D&&t(2,b=D.bgColor),"patternColor"in D&&t(3,v=D.patternColor),"patternClass"in D&&t(4,m=D.patternClass),"class"in D&&t(5,y=D.class)},o.$$.update=()=>{o.$$.dirty&294912&&t(11,n=`background-pattern-${c}-${u||""}`),o.$$.dirty&512&&t(8,r=[R[0]*l.zoom||1,R[1]*l.zoom||1]),o.$$.dirty&512&&t(7,i=S*l.zoom),o.$$.dirty&384&&t(6,s=C?[i,i]:r),o.$$.dirty&192&&t(10,a=k?[i/2,i/2]:[s[0]/2,s[1]/2])},[d,_,b,v,m,y,s,i,r,l,a,n,w,I,k,u,f,h,c]}class iI extends Ge{constructor(e){super(),We(this,e,rI,nI,Ye,{id:15,variant:0,gap:16,size:17,lineWidth:1,bgColor:2,patternColor:3,patternClass:4,class:5})}}const Yd=o=>Ik(o);function sI(){const{zoomIn:o,zoomOut:e,fitView:t,onbeforedelete:n,snapGrid:r,viewport:i,width:s,height:a,minZoom:l,maxZoom:c,panZoom:u,nodes:d,edges:f,domNode:h,nodeLookup:_,nodeOrigin:b,edgeLookup:v,connectionLookup:m}=pn(),y=S=>{var H,z;const k=ye(_),C=Yd(S)?S:k.get(S.id),R=C.parentId?Mk(C.position,C.measured,C.parentId,k,ye(b)):C.position,D={id:C.id,position:R,width:((H=C.measured)==null?void 0:H.width)??C.width,height:((z=C.measured)==null?void 0:z.height)??C.height,data:C.data};return $r(D)},w=(S,k,C={replace:!1})=>{var H;const R=(H=ye(_).get(S))==null?void 0:H.internals.userNode;if(!R)return;const D=typeof k=="function"?k(R):k;C.replace?d.update(z=>z.map(W=>W.id===S?Yd(D)?D:{...W,...D}:W)):(Object.assign(R,D),d.update(z=>z))},I=S=>ye(_).get(S);return{zoomIn:o,zoomOut:e,getInternalNode:I,getNode:S=>{var k;return(k=I(S))==null?void 0:k.internals.userNode},getNodes:S=>S===void 0?ye(d):jd(ye(_),S),getEdge:S=>ye(v).get(S),getEdges:S=>S===void 0?ye(f):jd(ye(v),S),setZoom:(S,k)=>{const C=ye(u);return C?C.scaleTo(S,{duration:k==null?void 0:k.duration}):Promise.resolve(!1)},getZoom:()=>ye(i).zoom,setViewport:async(S,k)=>{const C=ye(i),R=ye(u);return R?(await R.setViewport({x:S.x??C.x,y:S.y??C.y,zoom:S.zoom??C.zoom},{duration:k==null?void 0:k.duration}),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>ye(i),setCenter:async(S,k,C)=>{const R=typeof(C==null?void 0:C.zoom)<"u"?C.zoom:ye(c),D=ye(u);return D?(await D.setViewport({x:ye(s)/2-S*R,y:ye(a)/2-k*R,zoom:R},{duration:C==null?void 0:C.duration}),Promise.resolve(!0)):Promise.resolve(!1)},fitView:t,fitBounds:async(S,k)=>{const C=ye(u);if(!C)return Promise.resolve(!1);const R=Ql(S,ye(s),ye(a),ye(l),ye(c),(k==null?void 0:k.padding)??.1);return await C.setViewport(R,{duration:k==null?void 0:k.duration}),Promise.resolve(!0)},getIntersectingNodes:(S,k=!0,C)=>{const R=cd(S),D=R?S:y(S);return D?(C||ye(d)).filter(H=>{const z=ye(_).get(H.id);if(!z||!R&&H.id===S.id)return!1;const W=$r(z),K=Si(W,D);return k&&K>0||K>=D.width*D.height}):[]},isNodeIntersecting:(S,k,C=!0)=>{const D=cd(S)?S:y(S);if(!D)return!1;const H=Si(D,k);return C&&H>0||H>=D.width*D.height},deleteElements:async({nodes:S=[],edges:k=[]})=>{const{nodes:C,edges:R}=await Hg({nodesToRemove:S,edgesToRemove:k,nodes:ye(d),edges:ye(f),onBeforeDelete:ye(n)});return C&&d.update(D=>D.filter(H=>!C.some(({id:z})=>z===H.id))),R&&f.update(D=>D.filter(H=>!R.some(({id:z})=>z===H.id))),{deletedNodes:C,deletedEdges:R}},screenToFlowPosition:(S,k={snapToGrid:!0})=>{const C=ye(h);if(!C)return S;const R=k.snapToGrid?ye(r):!1,{x:D,y:H,zoom:z}=ye(i),{x:W,y:K}=C.getBoundingClientRect(),P={x:S.x-W,y:S.y-K};return Ui(P,[D,H,z],R!==null,R||[1,1])},flowToScreenPosition:S=>{const k=ye(h);if(!k)return S;const{x:C,y:R,zoom:D}=ye(i),{x:H,y:z}=k.getBoundingClientRect(),W=Bg(S,[C,R,D]);return{x:W.x+H,y:W.y+z}},toObject:()=>({nodes:ye(d).map(S=>({...S,position:{...S.position},data:{...S.data}})),edges:ye(f).map(S=>({...S})),viewport:{...ye(i)}}),updateNode:w,updateNodeData:(S,k,C)=>{var H;const R=(H=ye(_).get(S))==null?void 0:H.internals.userNode;if(!R)return;const D=typeof k=="function"?k(R):k;R.data=C!=null&&C.replace?D:{...R.data,...D},d.update(z=>z)},getNodesBounds:S=>{const k=ye(_),C=ye(b);return Tk(S,{nodeLookup:k,nodeOrigin:C})},getHandleConnections:({type:S,id:k,nodeId:C})=>{var R;return Array.from(((R=ye(m).get(`${C}-${S}-${k??null}`))==null?void 0:R.values())??[])},viewport:i}}function jd(o,e){var n;const t=[];for(const r of e){const i=o.get(r);if(i){const s="internals"in i?(n=i.internals)==null?void 0:n.userNode:i;t.push(s)}}return t}function aI(){const{nodesInitialized:o}=pn();return{subscribe:o.subscribe}}function Qd(o,e,t){const n=o.slice();return n[25]=e[t],n[27]=t,n}function Xd(o,e,t){const n=o.slice();return n[22]=e[t],n[24]=t,n}function lI(o){let e,t;return e=new Hs({props:{className:"size-4"}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p:Le,i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function cI(o){let e,t,n,r,i,s,a,l=o[8].t("Tools")+"",c,u,d=o[8].t("Functions")+"",f,h,_,b,v,m,y,w;function I(R,D){if(R[1]==="tools")return dI;if(R[1]==="functions")return uI}let S=I(o),k=S&&S(o),C=o[2]&&xd(o);return{c(){e=M("form"),t=M("div"),n=M("div"),r=M("div"),i=M("div"),s=M("select"),a=M("option"),c=Ie(l),u=M("option"),f=Ie(d),h=$(),_=M("div"),b=M("select"),k&&k.c(),v=$(),C&&C.c(),this.h()},l(R){e=O(R,"FORM",{class:!0});var D=A(e);t=O(D,"DIV",{class:!0});var H=A(t);n=O(H,"DIV",{class:!0});var z=A(n);r=O(z,"DIV",{class:!0});var W=A(r);i=O(W,"DIV",{class:!0});var K=A(i);s=O(K,"SELECT",{class:!0,placeholder:!0});var P=A(s);a=O(P,"OPTION",{class:!0});var V=A(a);c=Te(V,l),V.forEach(p),u=O(P,"OPTION",{class:!0});var L=A(u);f=Te(L,d),L.forEach(p),P.forEach(p),K.forEach(p),h=ee(W),_=O(W,"DIV",{class:!0});var q=A(_);b=O(q,"SELECT",{class:!0});var Z=A(b);k&&k.l(Z),Z.forEach(p),q.forEach(p),W.forEach(p),z.forEach(p),v=ee(H),C&&C.l(H),H.forEach(p),D.forEach(p),this.h()},h(){a.__value="tools",uo(a,a.__value),g(a,"class","bg-gray-100 dark:bg-gray-800"),u.__value="functions",uo(u,u.__value),g(u,"class","bg-gray-100 dark:bg-gray-800"),g(s,"class","w-full rounded-sm text-xs py-2 px-1 bg-transparent outline-hidden"),g(s,"placeholder","Select"),o[1]===void 0&&Do(()=>o[13].call(s)),g(i,"class","flex-1"),g(b,"class","w-full rounded-sm py-2 px-1 text-xs bg-transparent outline-hidden"),o[2]===void 0&&Do(()=>o[14].call(b)),g(_,"class","flex-1"),g(r,"class","flex gap-2"),g(n,"class","space-y-1"),g(t,"class","flex flex-col"),g(e,"class","flex flex-col h-full justify-between space-y-3 text-sm")},m(R,D){U(R,e,D),E(e,t),E(t,n),E(n,r),E(r,i),E(i,s),E(s,a),E(a,c),E(s,u),E(u,f),Ki(s,o[1],!0),E(r,h),E(r,_),E(_,b),k&&k.m(b,null),Ki(b,o[2],!0),E(t,v),C&&C.m(t,null),m=!0,y||(w=[we(s,"change",o[13]),we(b,"change",o[14]),we(b,"change",o[15]),we(e,"submit",Os(o[18]))],y=!0)},p(R,D){(!m||D&256)&&l!==(l=R[8].t("Tools")+"")&&Pe(c,l),(!m||D&256)&&d!==(d=R[8].t("Functions")+"")&&Pe(f,d),D&2&&Ki(s,R[1]),S===(S=I(R))&&k?k.p(R,D):(k&&k.d(1),k=S&&S(R),k&&(k.c(),k.m(b,null))),D&196&&Ki(b,R[2]),R[2]?C?(C.p(R,D),D&4&&T(C,1)):(C=xd(R),C.c(),T(C,1),C.m(t,null)):C&&(De(),N(C,1,1,()=>{C=null}),He())},i(R){m||(T(C),m=!0)},o(R){N(C),m=!1},d(R){R&&p(e),k&&k.d(),C&&C.d(),y=!1,cn(w)}}}function uI(o){let e,t=o[8].t("Select a function")+"",n,r,i=Ct(o[7]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Jd(Qd(o,i,a));return{c(){e=M("option"),n=Ie(t);for(let a=0;a<s.length;a+=1)s[a].c();r=qe(),this.h()},l(a){e=O(a,"OPTION",{class:!0});var l=A(e);n=Te(l,t),l.forEach(p);for(let c=0;c<s.length;c+=1)s[c].l(a);r=qe(),this.h()},h(){e.__value="",uo(e,e.__value),e.selected=!0,e.disabled=!0,g(e,"class","bg-gray-100 dark:bg-gray-800")},m(a,l){U(a,e,l),E(e,n);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(a,l);U(a,r,l)},p(a,l){if(l&256&&t!==(t=a[8].t("Select a function")+"")&&Pe(n,t),l&128){i=Ct(a[7]);let c;for(c=0;c<i.length;c+=1){const u=Qd(a,i,c);s[c]?s[c].p(u,l):(s[c]=Jd(u),s[c].c(),s[c].m(r.parentNode,r))}for(;c<s.length;c+=1)s[c].d(1);s.length=i.length}},d(a){a&&(p(e),p(r)),Fn(s,a)}}}function dI(o){let e,t=o[8].t("Select a tool")+"",n,r,i=Ct(o[6]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Zd(Xd(o,i,a));return{c(){e=M("option"),n=Ie(t);for(let a=0;a<s.length;a+=1)s[a].c();r=qe(),this.h()},l(a){e=O(a,"OPTION",{class:!0});var l=A(e);n=Te(l,t),l.forEach(p);for(let c=0;c<s.length;c+=1)s[c].l(a);r=qe(),this.h()},h(){e.__value="",uo(e,e.__value),e.selected=!0,e.disabled=!0,g(e,"class","bg-gray-100 dark:bg-gray-800")},m(a,l){U(a,e,l),E(e,n);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(a,l);U(a,r,l)},p(a,l){if(l&256&&t!==(t=a[8].t("Select a tool")+"")&&Pe(n,t),l&64){i=Ct(a[6]);let c;for(c=0;c<i.length;c+=1){const u=Xd(a,i,c);s[c]?s[c].p(u,l):(s[c]=Zd(u),s[c].c(),s[c].m(r.parentNode,r))}for(;c<s.length;c+=1)s[c].d(1);s.length=i.length}},d(a){a&&(p(e),p(r)),Fn(s,a)}}}function Jd(o){let e,t=o[25].name+"",n,r;return{c(){e=M("option"),n=Ie(t),this.h()},l(i){e=O(i,"OPTION",{class:!0});var s=A(e);n=Te(s,t),s.forEach(p),this.h()},h(){e.__value=r=o[25].id,uo(e,e.__value),g(e,"class","bg-gray-100 dark:bg-gray-800")},m(i,s){U(i,e,s),E(e,n)},p(i,s){s&128&&t!==(t=i[25].name+"")&&Pe(n,t),s&128&&r!==(r=i[25].id)&&(e.__value=r,uo(e,e.__value))},d(i){i&&p(e)}}}function Zd(o){let e,t=o[22].name+"",n,r;return{c(){e=M("option"),n=Ie(t),this.h()},l(i){e=O(i,"OPTION",{class:!0});var s=A(e);n=Te(s,t),s.forEach(p),this.h()},h(){e.__value=r=o[22].id,uo(e,e.__value),g(e,"class","bg-gray-100 dark:bg-gray-800")},m(i,s){U(i,e,s),E(e,n)},p(i,s){s&64&&t!==(t=i[22].name+"")&&Pe(n,t),s&64&&r!==(r=i[22].id)&&(e.__value=r,uo(e,e.__value))},d(i){i&&p(e)}}}function xd(o){let e,t,n,r,i,s;const a=[hI,fI],l=[];function c(u,d){return u[3]?1:0}return r=c(o),i=l[r]=a[r](o),{c(){e=M("hr"),t=$(),n=M("div"),i.c(),this.h()},l(u){e=O(u,"HR",{class:!0}),t=ee(u),n=O(u,"DIV",{class:!0});var d=A(n);i.l(d),d.forEach(p),this.h()},h(){g(e,"class","dark:border-gray-800 my-1 w-full"),g(n,"class","my-2 text-xs")},m(u,d){U(u,e,d),U(u,t,d),U(u,n,d),l[r].m(n,null),s=!0},p(u,d){let f=r;r=c(u),r===f?l[r].p(u,d):(De(),N(l[f],1,1,()=>{l[f]=null}),He(),i=l[r],i?i.p(u,d):(i=l[r]=a[r](u),i.c()),T(i,1),i.m(n,null))},i(u){s||(T(i),s=!0)},o(u){N(i),s=!1},d(u){u&&(p(e),p(t),p(n)),l[r].d()}}}function fI(o){let e,t;return e=new Hs({props:{className:"size-5"}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p:Le,i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function hI(o){let e,t,n;function r(s){o[16](s)}let i={valvesSpec:o[4]};return o[5]!==void 0&&(i.valves=o[5]),e=new g_({props:i}),ze.push(()=>nt(e,"valves",r)),e.$on("change",o[17]),{c(){oe(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){re(e,s,a),n=!0},p(s,a){const l={};a&16&&(l.valvesSpec=s[4]),!t&&a&32&&(t=!0,l.valves=s[5],tt(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){N(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function gI(o){let e,t,n,r;const i=[cI,lI],s=[];function a(l,c){return l[0]&&!l[3]?0:1}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=qe()},l(l){t.l(l),n=qe()},m(l,c){s[e].m(l,c),U(l,n,c),r=!0},p(l,[c]){let u=e;e=a(l),e===u?s[e].p(l,c):(De(),N(s[u],1,1,()=>{s[u]=null}),He(),t=s[e],t?t.p(l,c):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){N(t),r=!1},d(l){l&&p(n),s[e].d(l)}}}function mI(o,e,t){let n,r,i;fe(o,yr,D=>t(6,n=D)),fe(o,rc,D=>t(7,r=D));const s=An(),a=fn("i18n");fe(o,a,D=>t(8,i=D));let{show:l=!1}=e,c="tools",u="",d=!1,f=null,h={},_;const b=async()=>{_&&clearTimeout(_),_=setTimeout(()=>{m()},500)},v=async()=>{var D;if(t(3,d=!0),c==="tools"?(t(5,h=await bp(localStorage.token,u)),t(4,f=await yp(localStorage.token,u))):c==="functions"&&(t(5,h=await d_(localStorage.token,u)),t(4,f=await f_(localStorage.token,u))),f)for(const H in f.properties)((D=f.properties[H])==null?void 0:D.type)==="array"&&t(5,h[H]=(h[H]??[]).join(","),h);t(3,d=!1)},m=async()=>{var D;if(f){for(const H in f.properties)((D=f.properties[H])==null?void 0:D.type)==="array"&&t(5,h[H]=(h[H]??"").split(",").map(z=>z.trim()),h);if(c==="tools"){const H=await vp(localStorage.token,u,h).catch(z=>($e.error(`${z}`),null));H&&($e.success(i.t("Valves updated")),t(5,h=H))}else if(c==="functions"){const H=await h_(localStorage.token,u,h).catch(z=>($e.error(`${z}`),null));H&&($e.success(i.t("Valves updated")),t(5,h=H))}}},y=async()=>{t(3,d=!0),r===null&&rc.set(await u_(localStorage.token)),n===null&&yr.set(await xa(localStorage.token)),t(3,d=!1)};function w(){c=tc(this),t(1,c)}function I(){u=tc(this),t(2,u),t(1,c)}const S=async()=>{await it()};function k(D){h=D,t(5,h)}const C=()=>{b()},R=()=>{m(),s("save")};return o.$$set=D=>{"show"in D&&t(0,l=D.show)},o.$$.update=()=>{o.$$.dirty&2&&c&&t(2,u=""),o.$$.dirty&4&&u&&v(),o.$$.dirty&1&&l&&y()},[l,c,u,d,f,h,n,r,i,s,a,b,m,w,I,S,k,C,R]}class pI extends Ge{constructor(e){super(),We(this,e,mI,gI,Ye,{show:0})}}function $d(o,e,t){const n=o.slice();return n[14]=e[t],n[16]=t,n}function _I(o){let e,t=o[3].t("You do not have permission to access this feature.")+"",n;return{c(){e=M("div"),n=Ie(t),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);n=Te(i,t),i.forEach(p),this.h()},h(){g(e,"class","text-sm dark:text-gray-300 text-center py-2 px-10")},m(r,i){U(r,e,i),E(e,n)},p(r,i){i&8&&t!==(t=r[3].t("You do not have permission to access this feature.")+"")&&Pe(n,t)},i:Le,o:Le,d(r){r&&p(e)}}}function bI(o){let e,t,n,r,i,s,a,l,c,u,d,f,h,_=o[0].length>0&&ef(o);function b(m){o[11](m)}let v={title:o[3].t("Valves"),buttonClassName:"w-full",$$slots:{content:[vI]},$$scope:{ctx:o}};return o[2]!==void 0&&(v.open=o[2]),n=new ss({props:v}),ze.push(()=>nt(n,"open",b)),l=new ss({props:{title:o[3].t("System Prompt"),open:!0,buttonClassName:"w-full",$$slots:{content:[wI]},$$scope:{ctx:o}}}),f=new ss({props:{title:o[3].t("Advanced Params"),open:!0,buttonClassName:"w-full",$$slots:{content:[kI]},$$scope:{ctx:o}}}),{c(){e=M("div"),_&&_.c(),t=$(),oe(n.$$.fragment),i=$(),s=M("hr"),a=$(),oe(l.$$.fragment),c=$(),u=M("hr"),d=$(),oe(f.$$.fragment),this.h()},l(m){e=O(m,"DIV",{class:!0});var y=A(e);_&&_.l(y),t=ee(y),ae(n.$$.fragment,y),i=ee(y),s=O(y,"HR",{class:!0}),a=ee(y),ae(l.$$.fragment,y),c=ee(y),u=O(y,"HR",{class:!0}),d=ee(y),ae(f.$$.fragment,y),y.forEach(p),this.h()},h(){g(s,"class","my-2 border-gray-50 dark:border-gray-700/10"),g(u,"class","my-2 border-gray-50 dark:border-gray-700/10"),g(e,"class","dark:text-gray-200 text-sm font-primary py-0.5 px-0.5")},m(m,y){U(m,e,y),_&&_.m(e,null),E(e,t),re(n,e,null),E(e,i),E(e,s),E(e,a),re(l,e,null),E(e,c),E(e,u),E(e,d),re(f,e,null),h=!0},p(m,y){m[0].length>0?_?(_.p(m,y),y&1&&T(_,1)):(_=ef(m),_.c(),T(_,1),_.m(e,t)):_&&(De(),N(_,1,1,()=>{_=null}),He());const w={};y&8&&(w.title=m[3].t("Valves")),y&131076&&(w.$$scope={dirty:y,ctx:m}),!r&&y&4&&(r=!0,w.open=m[2],tt(()=>r=!1)),n.$set(w);const I={};y&8&&(I.title=m[3].t("System Prompt")),y&131082&&(I.$$scope={dirty:y,ctx:m}),l.$set(I);const S={};y&8&&(S.title=m[3].t("Advanced Params")),y&131090&&(S.$$scope={dirty:y,ctx:m}),f.$set(S)},i(m){h||(T(_),T(n.$$.fragment,m),T(l.$$.fragment,m),T(f.$$.fragment,m),h=!0)},o(m){N(_),N(n.$$.fragment,m),N(l.$$.fragment,m),N(f.$$.fragment,m),h=!1},d(m){m&&p(e),_&&_.d(),ie(n),ie(l),ie(f)}}}function ef(o){let e,t,n,r;return e=new ss({props:{title:o[3].t("Files"),open:!0,buttonClassName:"w-full",$$slots:{content:[yI]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment),t=$(),n=M("hr"),this.h()},l(i){ae(e.$$.fragment,i),t=ee(i),n=O(i,"HR",{class:!0}),this.h()},h(){g(n,"class","my-2 border-gray-50 dark:border-gray-700/10")},m(i,s){re(e,i,s),U(i,t,s),U(i,n,s),r=!0},p(i,s){const a={};s&8&&(a.title=i[3].t("Files")),s&131073&&(a.$$scope={dirty:s,ctx:i}),e.$set(a)},i(i){r||(T(e.$$.fragment,i),r=!0)},o(i){N(e.$$.fragment,i),r=!1},d(i){i&&(p(t),p(n)),ie(e,i)}}}function tf(o){var i,s;let e,t;function n(){return o[9](o[16])}function r(){return o[10](o[14])}return e=new Lf({props:{className:"w-full",item:o[14],edit:!0,url:(i=o[14])!=null&&i.url?o[14].url:null,name:o[14].name,type:o[14].type,size:(s=o[14])==null?void 0:s.size,dismissible:!0}}),e.$on("dismiss",n),e.$on("click",r),{c(){oe(e.$$.fragment)},l(a){ae(e.$$.fragment,a)},m(a,l){re(e,a,l),t=!0},p(a,l){var u,d;o=a;const c={};l&1&&(c.item=o[14]),l&1&&(c.url=(u=o[14])!=null&&u.url?o[14].url:null),l&1&&(c.name=o[14].name),l&1&&(c.type=o[14].type),l&1&&(c.size=(d=o[14])==null?void 0:d.size),e.$set(c)},i(a){t||(T(e.$$.fragment,a),t=!0)},o(a){N(e.$$.fragment,a),t=!1},d(a){ie(e,a)}}}function yI(o){let e,t,n=Ct(o[0]),r=[];for(let s=0;s<n.length;s+=1)r[s]=tf($d(o,n,s));const i=s=>N(r[s],1,1,()=>{r[s]=null});return{c(){e=M("div");for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=O(s,"DIV",{class:!0,slot:!0});var a=A(e);for(let l=0;l<r.length;l+=1)r[l].l(a);a.forEach(p),this.h()},h(){g(e,"class","flex flex-col gap-1 mt-1.5"),g(e,"slot","content")},m(s,a){U(s,e,a);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(e,null);t=!0},p(s,a){if(a&1){n=Ct(s[0]);let l;for(l=0;l<n.length;l+=1){const c=$d(s,n,l);r[l]?(r[l].p(c,a),T(r[l],1)):(r[l]=tf(c),r[l].c(),T(r[l],1),r[l].m(e,null))}for(De(),l=n.length;l<r.length;l+=1)i(l);He()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)T(r[a]);t=!0}},o(s){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)N(r[a]);t=!1},d(s){s&&p(e),Fn(r,s)}}}function vI(o){let e,t,n;return t=new pI({props:{show:o[2]}}),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(r){e=O(r,"DIV",{class:!0,slot:!0});var i=A(e);ae(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"class","text-sm"),g(e,"slot","content")},m(r,i){U(r,e,i),re(t,e,null),n=!0},p(r,i){const s={};i&4&&(s.show=r[2]),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){N(t.$$.fragment,r),n=!1},d(r){r&&p(e),ie(t)}}}function wI(o){let e,t,n,r,i;return{c(){e=M("div"),t=M("textarea"),this.h()},l(s){e=O(s,"DIV",{class:!0,slot:!0});var a=A(e);t=O(a,"TEXTAREA",{class:!0,rows:!0,placeholder:!0}),A(t).forEach(p),a.forEach(p),this.h()},h(){g(t,"class","w-full text-xs py-1.5 bg-transparent outline-hidden resize-none"),g(t,"rows","4"),g(t,"placeholder",n=o[3].t("Enter system prompt")),g(e,"class",""),g(e,"slot","content")},m(s,a){U(s,e,a),E(e,t),uo(t,o[1].system),r||(i=we(t,"input",o[12]),r=!0)},p(s,a){a&8&&n!==(n=s[3].t("Enter system prompt"))&&g(t,"placeholder",n),a&2&&uo(t,s[1].system)},d(s){s&&p(e),r=!1,i()}}}function kI(o){var l;let e,t,n,r,i;function s(c){o[13](c)}let a={admin:((l=o[4])==null?void 0:l.role)==="admin"};return o[1]!==void 0&&(a.params=o[1]),n=new c_({props:a}),ze.push(()=>nt(n,"params",s)),{c(){e=M("div"),t=M("div"),oe(n.$$.fragment),this.h()},l(c){e=O(c,"DIV",{class:!0,slot:!0});var u=A(e);t=O(u,"DIV",{});var d=A(t);ae(n.$$.fragment,d),d.forEach(p),u.forEach(p),this.h()},h(){g(e,"class","text-sm mt-1.5"),g(e,"slot","content")},m(c,u){U(c,e,u),E(e,t),re(n,t,null),i=!0},p(c,u){var f;const d={};u&16&&(d.admin=((f=c[4])==null?void 0:f.role)==="admin"),!r&&u&2&&(r=!0,d.params=c[1],tt(()=>r=!1)),n.$set(d)},i(c){i||(T(n.$$.fragment,c),i=!0)},o(c){N(n.$$.fragment,c),i=!1},d(c){c&&p(e),ie(n)}}}function CI(o){let e,t,n,r=o[3].t("Chat Controls")+"",i,s,a,l,c,u,d,f,h,_;l=new Ls({props:{className:"size-3.5"}});const b=[bI,_I],v=[];function m(y,w){var I,S;return y[4].role==="admin"||(S=(I=y[4])==null?void 0:I.permissions.chat)!=null&&S.controls?0:1}return u=m(o),d=v[u]=b[u](o),{c(){e=M("div"),t=M("div"),n=M("div"),i=Ie(r),s=$(),a=M("button"),oe(l.$$.fragment),c=$(),d.c(),this.h()},l(y){e=O(y,"DIV",{class:!0});var w=A(e);t=O(w,"DIV",{class:!0});var I=A(t);n=O(I,"DIV",{class:!0});var S=A(n);i=Te(S,r),S.forEach(p),s=ee(I),a=O(I,"BUTTON",{class:!0});var k=A(a);ae(l.$$.fragment,k),k.forEach(p),I.forEach(p),c=ee(w),d.l(w),w.forEach(p),this.h()},h(){g(n,"class","text-lg font-medium self-center font-primary"),g(a,"class","self-center"),g(t,"class","flex items-center justify-between dark:text-gray-100 mb-2"),g(e,"class","dark:text-white")},m(y,w){U(y,e,w),E(e,t),E(t,n),E(n,i),E(t,s),E(t,a),re(l,a,null),E(e,c),v[u].m(e,null),f=!0,h||(_=we(a,"click",o[8]),h=!0)},p(y,[w]){(!f||w&8)&&r!==(r=y[3].t("Chat Controls")+"")&&Pe(i,r);let I=u;u=m(y),u===I?v[u].p(y,w):(De(),N(v[I],1,1,()=>{v[I]=null}),He(),d=v[u],d?d.p(y,w):(d=v[u]=b[u](y),d.c()),T(d,1),d.m(e,null))},i(y){f||(T(l.$$.fragment,y),T(d),f=!0)},o(y){N(l.$$.fragment,y),N(d),f=!1},d(y){y&&p(e),ie(l),v[u].d(),h=!1,_()}}}function EI(o,e,t){let n,r;fe(o,er,m=>t(4,r=m));const i=An(),s=fn("i18n");fe(o,s,m=>t(3,n=m));let{models:a=[]}=e,{chatFiles:l=[]}=e,{params:c={}}=e,u=!1;const d=()=>{i("close")},f=m=>{l.splice(m,1),t(0,l)},h=m=>{console.log(m)};function _(m){u=m,t(2,u)}function b(){c.system=this.value,t(1,c)}function v(m){c=m,t(1,c)}return o.$$set=m=>{"models"in m&&t(7,a=m.models),"chatFiles"in m&&t(0,l=m.chatFiles),"params"in m&&t(1,c=m.params)},[l,c,u,n,r,i,s,a,d,f,h,_,b,v]}class hm extends Ge{constructor(e){super(),We(this,e,EI,CI,Ye,{models:7,chatFiles:0,params:1})}}function nf(o,e,t){const n=o.slice();return n[10]=e[t],n}function II(o){let e;const t=o[4].default,n=Ft(t,o,o[8],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i&256)&&Kt(n,t,r,r[8],e?Wt(t,r[8],i,null):Gt(r[8]),null)},i(r){e||(T(n,r),e=!0)},o(r){N(n,r),e=!1},d(r){n&&n.d(r)}}}function TI(o){var s;let e,t,n=(((s=o[10])==null?void 0:s.label)??"Camera")+"",r,i;return{c(){e=M("div"),t=M("div"),r=Ie(n),i=$(),this.h()},l(a){e=O(a,"DIV",{class:!0});var l=A(e);t=O(l,"DIV",{class:!0});var c=A(t);r=Te(c,n),c.forEach(p),l.forEach(p),i=ee(a),this.h()},h(){g(t,"class","line-clamp-1"),g(e,"class","flex items-center")},m(a,l){U(a,e,l),E(e,t),E(t,r),U(a,i,l)},p(a,l){var c;l&2&&n!==(n=(((c=a[10])==null?void 0:c.label)??"Camera")+"")&&Pe(r,n)},d(a){a&&(p(e),p(i))}}}function of(o){let e,t;function n(){return o[5](o[10])}return e=new co({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[TI]},$$scope:{ctx:o}}}),e.$on("click",n),{c(){oe(e.$$.fragment)},l(r){ae(e.$$.fragment,r)},m(r,i){re(e,r,i),t=!0},p(r,i){o=r;const s={};i&258&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(r){t||(T(e.$$.fragment,r),t=!0)},o(r){N(e.$$.fragment,r),t=!1},d(r){ie(e,r)}}}function SI(o){let e,t,n=Ct(o[1]),r=[];for(let s=0;s<n.length;s+=1)r[s]=of(nf(o,n,s));const i=s=>N(r[s],1,1,()=>{r[s]=null});return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=qe()},l(s){for(let a=0;a<r.length;a+=1)r[a].l(s);e=qe()},m(s,a){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(s,a);U(s,e,a),t=!0},p(s,a){if(a&10){n=Ct(s[1]);let l;for(l=0;l<n.length;l+=1){const c=nf(s,n,l);r[l]?(r[l].p(c,a),T(r[l],1)):(r[l]=of(c),r[l].c(),T(r[l],1),r[l].m(e.parentNode,e))}for(De(),l=n.length;l<r.length;l+=1)i(l);He()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)T(r[a]);t=!0}},o(s){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)N(r[a]);t=!1},d(s){s&&p(e),Fn(r,s)}}}function AI(o){let e,t,n;return t=new Ds({props:{class:"w-full max-w-[180px] rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-9999 bg-white dark:bg-gray-900 dark:text-white shadow-xs",sideOffset:6,side:"top",align:"start",transition:Oi,$$slots:{default:[SI]},$$scope:{ctx:o}}}),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(r){e=O(r,"DIV",{slot:!0});var i=A(e);ae(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"slot","content")},m(r,i){U(r,e,i),re(t,e,null),n=!0},p(r,i){const s={};i&258&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){N(t.$$.fragment,r),n=!1},d(r){r&&p(e),ie(t)}}}function RI(o){let e,t,n;function r(s){o[6](s)}let i={$$slots:{content:[AI],default:[II]},$$scope:{ctx:o}};return o[2]!==void 0&&(i.show=o[2]),e=new el({props:i}),ze.push(()=>nt(e,"show",r)),e.$on("change",o[7]),{c(){oe(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){re(e,s,a),n=!0},p(s,[a]){const l={};a&258&&(l.$$scope={dirty:a,ctx:s}),!t&&a&4&&(t=!0,l.show=s[2],tt(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){N(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function MI(o,e,t){let{$$slots:n={},$$scope:r}=e;fn("i18n");const i=An();let{onClose:s=()=>{}}=e,{devices:a}=e,l=!1;const c=f=>{i("change",f.deviceId)};function u(f){l=f,t(2,l)}const d=f=>{f.detail===!1&&s()};return o.$$set=f=>{"onClose"in f&&t(0,s=f.onClose),"devices"in f&&t(1,a=f.devices),"$$scope"in f&&t(8,r=f.$$scope)},[s,a,l,i,n,c,u,d,r]}class OI extends Ge{constructor(e){super(),We(this,e,MI,RI,Ye,{onClose:0,devices:1})}}function rf(o){let e,t,n,r,i,s,a,l,c,u,d,f,h,_,b,v='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"></path></svg>',m,y,w,I=o[4]&&sf(o);function S(P,V){return P[4]?HI:LI}let k=S(o),C=k(o);const R=[FI,VI],D=[];function H(P,V){return P[4]?0:1}a=H(o),l=D[a]=R[a](o);function z(P,V){return P[1]?YI:P[2]?qI:WI}let W=z(o),K=W(o);return{c(){e=M("div"),I&&I.c(),t=$(),n=M("div"),C.c(),r=$(),i=M("div"),s=M("div"),l.c(),c=$(),u=M("div"),d=M("button"),f=M("div"),K.c(),h=$(),_=M("div"),b=M("button"),b.innerHTML=v,this.h()},l(P){e=O(P,"DIV",{class:!0});var V=A(e);I&&I.l(V),t=ee(V),n=O(V,"DIV",{class:!0});var L=A(n);C.l(L),L.forEach(p),r=ee(V),i=O(V,"DIV",{class:!0});var q=A(i);s=O(q,"DIV",{});var Z=A(s);l.l(Z),Z.forEach(p),c=ee(q),u=O(q,"DIV",{});var Q=A(u);d=O(Q,"BUTTON",{type:!0});var Y=A(d);f=O(Y,"DIV",{class:!0});var te=A(f);K.l(te),te.forEach(p),Y.forEach(p),Q.forEach(p),h=ee(q),_=O(q,"DIV",{});var F=A(_);b=O(F,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),yt(b)!=="svelte-1k5eavb"&&(b.innerHTML=v),F.forEach(p),q.forEach(p),V.forEach(p),this.h()},h(){g(n,"class","flex justify-center items-center flex-1 h-full w-full max-h-full"),g(f,"class","line-clamp-1 text-sm font-medium"),g(d,"type","button"),g(b,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),g(b,"type","button"),g(i,"class","flex justify-between items-center pb-2 w-full"),g(e,"class","max-w-lg w-full h-full max-h-[100dvh] flex flex-col justify-between p-3 md:p-6")},m(P,V){U(P,e,V),I&&I.m(e,null),E(e,t),E(e,n),C.m(n,null),E(e,r),E(e,i),E(i,s),D[a].m(s,null),E(i,c),E(i,u),E(u,d),E(d,f),K.m(f,null),E(i,h),E(i,_),E(_,b),m=!0,y||(w=[we(d,"click",o[31]),we(b,"click",o[32])],y=!0)},p(P,V){P[4]?I?I.p(P,V):(I=sf(P),I.c(),I.m(e,t)):I&&(I.d(1),I=null),k===(k=S(P))&&C?C.p(P,V):(C.d(1),C=k(P),C&&(C.c(),C.m(n,null)));let L=a;a=H(P),a===L?D[a].p(P,V):(De(),N(D[L],1,1,()=>{D[L]=null}),He(),l=D[a],l?l.p(P,V):(l=D[a]=R[a](P),l.c()),T(l,1),l.m(s,null)),W===(W=z(P))&&K?K.p(P,V):(K.d(1),K=W(P),K&&(K.c(),K.m(f,null)))},i(P){m||(T(l),m=!0)},o(P){N(l),m=!1},d(P){P&&p(e),I&&I.d(),C.d(),D[a].d(),K.d(),y=!1,cn(w)}}}function sf(o){let e,t,n;function r(a,l){return a[3]?DI:a[1]||a[2]?NI:PI}let i=r(o),s=i(o);return{c(){e=M("button"),s.c(),this.h()},l(a){e=O(a,"BUTTON",{type:!0,class:!0});var l=A(e);s.l(l),l.forEach(p),this.h()},h(){g(e,"type","button"),g(e,"class","flex justify-center items-center w-full h-20 min-h-20")},m(a,l){U(a,e,l),s.m(e,null),t||(n=we(e,"click",o[26]),t=!0)},p(a,l){i===(i=r(a))&&s?s.p(a,l):(s.d(1),s=i(a),s&&(s.c(),s.m(e,null)))},d(a){a&&p(e),s.d(),t=!1,n()}}}function PI(o){let e,t,n;return{c(){e=M("div"),this.h()},l(r){e=O(r,"DIV",{class:!0,style:!0}),A(e).forEach(p),this.h()},h(){var r,i,s,a,l,c,u,d,f;g(e,"class",t=(o[6]*100>4?" size-[4.5rem]":o[6]*100>2?" size-16":o[6]*100>1?"size-14":"size-12")+" transition-all rounded-full "+((((s=(i=(r=o[0])==null?void 0:r.info)==null?void 0:i.meta)==null?void 0:s.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?" bg-cover bg-center bg-no-repeat":"bg-black dark:bg-white")+" bg-black dark:bg-white"),g(e,"style",n=(((c=(l=(a=o[0])==null?void 0:a.info)==null?void 0:l.meta)==null?void 0:c.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?`background-image: url('${(f=(d=(u=o[0])==null?void 0:u.info)==null?void 0:d.meta)==null?void 0:f.profile_image_url}');`:"")},m(r,i){U(r,e,i)},p(r,i){var s,a,l,c,u,d,f,h,_;i[0]&65&&t!==(t=(r[6]*100>4?" size-[4.5rem]":r[6]*100>2?" size-16":r[6]*100>1?"size-14":"size-12")+" transition-all rounded-full "+((((l=(a=(s=r[0])==null?void 0:s.info)==null?void 0:a.meta)==null?void 0:l.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?" bg-cover bg-center bg-no-repeat":"bg-black dark:bg-white")+" bg-black dark:bg-white")&&g(e,"class",t),i[0]&1&&n!==(n=(((d=(u=(c=r[0])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?`background-image: url('${(_=(h=(f=r[0])==null?void 0:f.info)==null?void 0:h.meta)==null?void 0:_.profile_image_url}');`:"")&&g(e,"style",n)},d(r){r&&p(e)}}}function NI(o){let e,t,n,r,i,s;return{c(){e=Me("svg"),t=Me("style"),n=Ie(`.spinner_qM83 {
								animation: spinner_8HQG 1.05s infinite;
							}
							.spinner_oXPr {
								animation-delay: 0.1s;
							}
							.spinner_ZTLf {
								animation-delay: 0.2s;
							}
							@keyframes spinner_8HQG {
								0%,
								57.14% {
									animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
									transform: translate(0);
								}
								28.57% {
									animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
									transform: translateY(-6px);
								}
								100% {
									transform: translate(0);
								}
							}
						`),r=Me("circle"),i=Me("circle"),s=Me("circle"),this.h()},l(a){e=Oe(a,"svg",{class:!0,viewBox:!0,fill:!0,xmlns:!0});var l=A(e);t=Oe(l,"style",{});var c=A(t);n=Te(c,`.spinner_qM83 {
								animation: spinner_8HQG 1.05s infinite;
							}
							.spinner_oXPr {
								animation-delay: 0.1s;
							}
							.spinner_ZTLf {
								animation-delay: 0.2s;
							}
							@keyframes spinner_8HQG {
								0%,
								57.14% {
									animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
									transform: translate(0);
								}
								28.57% {
									animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
									transform: translateY(-6px);
								}
								100% {
									transform: translate(0);
								}
							}
						`),c.forEach(p),r=Oe(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),A(r).forEach(p),i=Oe(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),A(i).forEach(p),s=Oe(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),A(s).forEach(p),l.forEach(p),this.h()},h(){g(r,"class","spinner_qM83"),g(r,"cx","4"),g(r,"cy","12"),g(r,"r","3"),g(i,"class","spinner_qM83 spinner_oXPr"),g(i,"cx","12"),g(i,"cy","12"),g(i,"r","3"),g(s,"class","spinner_qM83 spinner_ZTLf"),g(s,"cx","20"),g(s,"cy","12"),g(s,"r","3"),g(e,"class","size-12 text-gray-900 dark:text-gray-400"),g(e,"viewBox","0 0 24 24"),g(e,"fill","currentColor"),g(e,"xmlns","http://www.w3.org/2000/svg")},m(a,l){U(a,e,l),E(e,t),E(t,n),E(e,r),E(e,i),E(e,s)},p:Le,d(a){a&&p(e)}}}function DI(o){let e,t;return{c(){e=M("div"),t=Ie(o[3]),this.h()},l(n){e=O(n,"DIV",{class:!0,style:!0});var r=A(e);t=Te(r,o[3]),r.forEach(p),this.h()},h(){g(e,"class","transition-all rounded-full"),lt(e,"font-size",(o[6]*100>4?"4.5":o[6]*100>2?"4.25":o[6]*100>1?"3.75":"3.5")+"rem"),lt(e,"width","100%"),lt(e,"text-align","center")},m(n,r){U(n,e,r),E(e,t)},p(n,r){r[0]&8&&Pe(t,n[3]),r[0]&64&&lt(e,"font-size",(n[6]*100>4?"4.5":n[6]*100>2?"4.25":n[6]*100>1?"3.75":"3.5")+"rem")},d(n){n&&p(e)}}}function HI(o){let e,t,n,r,i,s,a,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-6"><path d="M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"></path></svg>',c,u;return{c(){e=M("div"),t=M("video"),n=$(),r=M("canvas"),i=$(),s=M("div"),a=M("button"),a.innerHTML=l,this.h()},l(d){e=O(d,"DIV",{class:!0});var f=A(e);t=O(f,"VIDEO",{id:!0,class:!0}),A(t).forEach(p),n=ee(f),r=O(f,"CANVAS",{id:!0,style:!0}),A(r).forEach(p),i=ee(f),s=O(f,"DIV",{class:!0});var h=A(s);a=O(h,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),yt(a)!=="svelte-16ul42n"&&(a.innerHTML=l),h.forEach(p),f.forEach(p),this.h()},h(){g(t,"id","camera-feed"),t.autoplay=!0,g(t,"class","rounded-2xl h-full min-w-full object-cover object-center"),t.playsInline=!0,g(r,"id","camera-canvas"),lt(r,"display","none"),g(a,"type","button"),g(a,"class","p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full"),g(s,"class","absolute top-4 md:top-8 left-4"),g(e,"class","relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full")},m(d,f){U(d,e,f),E(e,t),E(e,n),E(e,r),E(e,i),E(e,s),E(s,a),c||(u=we(a,"click",o[28]),c=!0)},p:Le,d(d){d&&p(e),c=!1,u()}}}function LI(o){let e,t,n;function r(a,l){return a[3]?zI:a[1]||a[2]?BI:UI}let i=r(o),s=i(o);return{c(){e=M("button"),s.c(),this.h()},l(a){e=O(a,"BUTTON",{type:!0});var l=A(e);s.l(l),l.forEach(p),this.h()},h(){g(e,"type","button")},m(a,l){U(a,e,l),s.m(e,null),t||(n=we(e,"click",o[27]),t=!0)},p(a,l){i===(i=r(a))&&s?s.p(a,l):(s.d(1),s=i(a),s&&(s.c(),s.m(e,null)))},d(a){a&&p(e),s.d(),t=!1,n()}}}function UI(o){let e,t,n;return{c(){e=M("div"),this.h()},l(r){e=O(r,"DIV",{class:!0,style:!0}),A(e).forEach(p),this.h()},h(){var r,i,s,a,l,c,u,d,f;g(e,"class",t=(o[6]*100>4?" size-52":o[6]*100>2?"size-48":o[6]*100>1?"size-44":"size-40")+" transition-all rounded-full "+((((s=(i=(r=o[0])==null?void 0:r.info)==null?void 0:i.meta)==null?void 0:s.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?" bg-cover bg-center bg-no-repeat":"bg-black dark:bg-white")),g(e,"style",n=(((c=(l=(a=o[0])==null?void 0:a.info)==null?void 0:l.meta)==null?void 0:c.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?`background-image: url('${(f=(d=(u=o[0])==null?void 0:u.info)==null?void 0:d.meta)==null?void 0:f.profile_image_url}');`:"")},m(r,i){U(r,e,i)},p(r,i){var s,a,l,c,u,d,f,h,_;i[0]&65&&t!==(t=(r[6]*100>4?" size-52":r[6]*100>2?"size-48":r[6]*100>1?"size-44":"size-40")+" transition-all rounded-full "+((((l=(a=(s=r[0])==null?void 0:s.info)==null?void 0:a.meta)==null?void 0:l.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?" bg-cover bg-center bg-no-repeat":"bg-black dark:bg-white"))&&g(e,"class",t),i[0]&1&&n!==(n=(((d=(u=(c=r[0])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?`background-image: url('${(_=(h=(f=r[0])==null?void 0:f.info)==null?void 0:h.meta)==null?void 0:_.profile_image_url}');`:"")&&g(e,"style",n)},d(r){r&&p(e)}}}function BI(o){let e,t,n,r,i,s;return{c(){e=Me("svg"),t=Me("style"),n=Ie(`.spinner_qM83 {
									animation: spinner_8HQG 1.05s infinite;
								}
								.spinner_oXPr {
									animation-delay: 0.1s;
								}
								.spinner_ZTLf {
									animation-delay: 0.2s;
								}
								@keyframes spinner_8HQG {
									0%,
									57.14% {
										animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
										transform: translate(0);
									}
									28.57% {
										animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
										transform: translateY(-6px);
									}
									100% {
										transform: translate(0);
									}
								}
							`),r=Me("circle"),i=Me("circle"),s=Me("circle"),this.h()},l(a){e=Oe(a,"svg",{class:!0,viewBox:!0,fill:!0,xmlns:!0});var l=A(e);t=Oe(l,"style",{});var c=A(t);n=Te(c,`.spinner_qM83 {
									animation: spinner_8HQG 1.05s infinite;
								}
								.spinner_oXPr {
									animation-delay: 0.1s;
								}
								.spinner_ZTLf {
									animation-delay: 0.2s;
								}
								@keyframes spinner_8HQG {
									0%,
									57.14% {
										animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
										transform: translate(0);
									}
									28.57% {
										animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
										transform: translateY(-6px);
									}
									100% {
										transform: translate(0);
									}
								}
							`),c.forEach(p),r=Oe(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),A(r).forEach(p),i=Oe(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),A(i).forEach(p),s=Oe(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),A(s).forEach(p),l.forEach(p),this.h()},h(){g(r,"class","spinner_qM83"),g(r,"cx","4"),g(r,"cy","12"),g(r,"r","3"),g(i,"class","spinner_qM83 spinner_oXPr"),g(i,"cx","12"),g(i,"cy","12"),g(i,"r","3"),g(s,"class","spinner_qM83 spinner_ZTLf"),g(s,"cx","20"),g(s,"cy","12"),g(s,"r","3"),g(e,"class","size-44 text-gray-900 dark:text-gray-400"),g(e,"viewBox","0 0 24 24"),g(e,"fill","currentColor"),g(e,"xmlns","http://www.w3.org/2000/svg")},m(a,l){U(a,e,l),E(e,t),E(t,n),E(e,r),E(e,i),E(e,s)},p:Le,d(a){a&&p(e)}}}function zI(o){let e,t;return{c(){e=M("div"),t=Ie(o[3]),this.h()},l(n){e=O(n,"DIV",{class:!0,style:!0});var r=A(e);t=Te(r,o[3]),r.forEach(p),this.h()},h(){g(e,"class","transition-all rounded-full"),lt(e,"font-size",(o[6]*100>4?"13":o[6]*100>2?"12":o[6]*100>1?"11.5":"11")+"rem"),lt(e,"width","100%"),lt(e,"text-align","center")},m(n,r){U(n,e,r),E(e,t)},p(n,r){r[0]&8&&Pe(t,n[3]),r[0]&64&&lt(e,"font-size",(n[6]*100>4?"13":n[6]*100>2?"12":n[6]*100>1?"11.5":"11")+"rem")},d(n){n&&p(e)}}}function VI(o){let e,t;return e=new qt({props:{content:o[11].t("Camera"),$$slots:{default:[KI]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&2048&&(i.content=n[11].t("Camera")),r[2]&16&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function FI(o){let e,t;return e=new OI({props:{devices:o[8],$$slots:{default:[GI]},$$scope:{ctx:o}}}),e.$on("change",o[29]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&256&&(i.devices=n[8]),r[2]&16&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function KI(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"></path></svg>',n,r;return{c(){e=M("button"),e.innerHTML=t,this.h()},l(i){e=O(i,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),yt(e)!=="svelte-1n1gs9g"&&(e.innerHTML=t),this.h()},h(){g(e,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),g(e,"type","button")},m(i,s){U(i,e,s),n||(r=we(e,"click",o[30]),n=!0)},p:Le,d(i){i&&p(e),n=!1,r()}}}function GI(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z" clip-rule="evenodd"></path></svg>';return{c(){e=M("button"),e.innerHTML=t,this.h()},l(n){e=O(n,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),yt(e)!=="svelte-5e0pue"&&(e.innerHTML=t),this.h()},h(){g(e,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),g(e,"type","button")},m(n,r){U(n,e,r)},p:Le,d(n){n&&p(e)}}}function WI(o){let e=o[11].t("Listening...")+"",t;return{c(){t=Ie(e)},l(n){t=Te(n,e)},m(n,r){U(n,t,r)},p(n,r){r[0]&2048&&e!==(e=n[11].t("Listening...")+"")&&Pe(t,e)},d(n){n&&p(t)}}}function qI(o){let e=o[11].t("Tap to interrupt")+"",t;return{c(){t=Ie(e)},l(n){t=Te(n,e)},m(n,r){U(n,t,r)},p(n,r){r[0]&2048&&e!==(e=n[11].t("Tap to interrupt")+"")&&Pe(t,e)},d(n){n&&p(t)}}}function YI(o){let e=o[11].t("Thinking...")+"",t;return{c(){t=Ie(e)},l(n){t=Te(n,e)},m(n,r){U(n,t,r)},p(n,r){r[0]&2048&&e!==(e=n[11].t("Thinking...")+"")&&Pe(t,e)},d(n){n&&p(t)}}}function jI(o){let e,t,n=o[10]&&rf(o);return{c(){n&&n.c(),e=qe()},l(r){n&&n.l(r),e=qe()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,i){r[10]?n?(n.p(r,i),i[0]&1024&&T(n,1)):(n=rf(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(De(),N(n,1,1,()=>{n=null}),He())},i(r){t||(T(n),t=!0)},o(r){N(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function QI(o,e,t){let n,r,i,s,a,l;fe(o,Tr,pe=>t(45,n=pe)),fe(o,ti,pe=>t(46,r=pe)),fe(o,qo,pe=>t(47,i=pe)),fe(o,wa,pe=>t(48,s=pe)),fe(o,Zn,pe=>t(10,a=pe));const c=An(),u=fn("i18n");fe(o,u,pe=>t(11,l=pe));let{eventTarget:d}=e,{submitPrompt:f}=e,{stopResponse:h}=e,{files:_}=e,{chatId:b}=e,{modelId:v}=e,m=null,y=null,w=!1,I=!1,S=!1,k=null,C=!1,R=null,D=!1,H=0,z=!1,W,K=null,P=[],V=[],L=null;const q=async()=>{const pe=await navigator.mediaDevices.enumerateDevices();t(8,V=pe.filter(Xe=>Xe.kind==="videoinput")),navigator.mediaDevices.getDisplayMedia&&t(8,V=[...V,{deviceId:"screen",label:"Screen Share"}]),console.log(V),L===null&&V.length>0&&t(9,L=V[0].deviceId)},Z=async()=>{if(await q(),R===null){t(4,C=!0),await it();try{await Q()}catch(pe){console.error("Error accessing webcam: ",pe)}}},Q=async()=>{const pe=document.getElementById("camera-feed");pe&&(L==="screen"?t(5,R=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1})):t(5,R=await navigator.mediaDevices.getUserMedia({video:{deviceId:L?{exact:L}:void 0}})),R&&(await q(),pe.srcObject=R,await pe.play()))},Y=async()=>{R&&R.getTracks().forEach(Xe=>Xe.stop()),t(5,R=null)},te=()=>{const pe=document.getElementById("camera-feed"),Xe=document.getElementById("camera-canvas");if(!Xe)return;const Be=Xe.getContext("2d");Xe.width=pe.videoWidth,Xe.height=pe.videoHeight,Be.drawImage(pe,0,0,pe.videoWidth,pe.videoHeight);const Ze=Xe.toDataURL("image/png");return console.log(Ze),Ze},F=async()=>{await Y(),t(4,C=!1)},j=-55,x=async pe=>{await it();const Xe=Zm(pe,"recording.wav"),Be=await Sp(localStorage.token,Xe).catch(Ze=>($e.error(`${Ze}`),null));if(Be&&(console.log(Be.text),Be.text!=="")){const Ze=await f(Be.text,{_raw:!0});console.log(Ze)}},J=async(pe=!0)=>{if(a){console.log("%c%s","color: red; font-size: 20px;"," stopRecordingCallback ");const Xe=P.slice(0);if(P=[],W=!1,pe&&ve(),I){if(t(1,w=!0),t(3,k=null),R){const Ze=te();t(20,_=[{type:"image",url:Ze}])}const Be=new Blob(Xe,{type:"audio/wav"});await x(Be),I=!1,t(1,w=!1)}}else P=[],W=!1,K&&K.getTracks().forEach(Be=>Be.stop()),t(7,K=null)},ve=async()=>{a&&(K||t(7,K=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})),W=new MediaRecorder(K),W.onstart=()=>{console.log("Recording started"),P=[]},W.ondataavailable=pe=>{z&&P.push(pe.data)},W.onstop=pe=>{console.log("Recording stopped",K,pe),J()},X(K))},le=async()=>{try{W&&W.stop()}catch(pe){console.log("Error stopping audio stream:",pe)}K&&(K.getAudioTracks().forEach(function(pe){pe.stop()}),t(7,K=null))},me=pe=>{let Xe=0;for(let Be=0;Be<pe.length;Be++){const Ze=(pe[Be]-128)/128;Xe+=Ze*Ze}return Math.sqrt(Xe/pe.length)},X=pe=>{const Xe=new AudioContext,Be=Xe.createMediaStreamSource(pe),Ze=Xe.createAnalyser();Ze.minDecibels=j,Be.connect(Ze);const Tt=Ze.frequencyBinCount,St=new Uint8Array(Tt),Nt=new Uint8Array(Ze.fftSize);let _t=Date.now();z=!1,console.log(" Sound detection started",_t,z),(()=>{const hn=()=>{if(!W||!a)return;if(S&&!((i==null?void 0:i.voiceInterruption)??!1)?(Ze.maxDecibels=0,Ze.minDecibels=-1):(Ze.minDecibels=j,Ze.maxDecibels=-30),Ze.getByteTimeDomainData(Nt),Ze.getByteFrequencyData(St),t(6,H=me(Nt)),St.some(xt=>xt>0)&&(console.log("%c%s","color: red; font-size: 20px;"," Sound detected"),W&&W.state!=="recording"&&W.start(),z||(z=!0,et()),_t=Date.now()),z&&Date.now()-_t>2e3&&(I=!0,W)){console.log("%c%s","color: red; font-size: 20px;"," Silence detected"),W.stop();return}window.requestAnimationFrame(hn)};window.requestAnimationFrame(hn)})()};let ue={},be=null,Re=null;const Fe=pe=>a?new Promise(Xe=>{let Be=[];const Ze=setInterval(async()=>{var Tt,St,Nt;if(Be=await speechSynthesis.getVoices(),Be.length>0){clearInterval(Ze);const _t=((Tt=Be==null?void 0:Be.filter(yn=>{var hn,gn,xt,on;return yn.voiceURI===(((gn=(hn=i==null?void 0:i.audio)==null?void 0:hn.tts)==null?void 0:gn.voice)??((on=(xt=r==null?void 0:r.audio)==null?void 0:xt.tts)==null?void 0:on.voice))}))==null?void 0:Tt.at(0))??void 0;Re=new SpeechSynthesisUtterance(pe),Re.rate=((Nt=(St=i.audio)==null?void 0:St.tts)==null?void 0:Nt.playbackRate)??1,_t&&(Re.voice=_t),speechSynthesis.speak(Re),Re.onend=async yn=>{await new Promise(hn=>setTimeout(hn,200)),Xe(yn)}}},100)}):Promise.resolve(),he=pe=>a?new Promise(Xe=>{var Ze,Tt;const Be=document.getElementById("audioElement");Be&&(Be.src=pe.src,Be.muted=!0,Be.playbackRate=((Tt=(Ze=i.audio)==null?void 0:Ze.tts)==null?void 0:Tt.playbackRate)??1,Be.play().then(()=>{Be.muted=!1}).catch(St=>{console.error(St)}),Be.onended=async St=>{await new Promise(Nt=>setTimeout(Nt,100)),Xe(St)})}):Promise.resolve(),et=async()=>{t(2,S=!1),D&&h(),Re&&(speechSynthesis.cancel(),Re=null);const pe=document.getElementById("audioElement");pe&&(pe.muted=!0,pe.pause(),pe.currentTime=0)};let ot=new AbortController;const Et=new Map,Dt=new Map,Yt=async pe=>{var Xe,Be,Ze,Tt,St,Nt,_t,yn,hn,gn,xt,on,kn,Rn;if(!Et.has(pe))try{if((i==null?void 0:i.showEmojiInCall)??!1){const rn=await gp(localStorage.token,v,pe,b);rn&&Dt.set(pe,rn)}if(((Be=(Xe=i.audio)==null?void 0:Xe.tts)==null?void 0:Be.engine)==="browser-kokoro"){const rn=await s.generate({text:pe,voice:((Tt=(Ze=i==null?void 0:i.audio)==null?void 0:Ze.tts)==null?void 0:Tt.voice)??((Nt=(St=r==null?void 0:r.audio)==null?void 0:St.tts)==null?void 0:Nt.voice)}).catch(Bt=>{console.error(Bt),$e.error(`${Bt}`)});rn&&Et.set(pe,new Audio(rn))}else if(r.audio.tts.engine!==""){const rn=await Tp(localStorage.token,((yn=(_t=i==null?void 0:i.audio)==null?void 0:_t.tts)==null?void 0:yn.defaultVoice)===r.audio.tts.voice?((gn=(hn=i==null?void 0:i.audio)==null?void 0:hn.tts)==null?void 0:gn.voice)??((on=(xt=r==null?void 0:r.audio)==null?void 0:xt.tts)==null?void 0:on.voice):(Rn=(kn=r==null?void 0:r.audio)==null?void 0:kn.tts)==null?void 0:Rn.voice,pe).catch(Bt=>(console.error(Bt),null));if(rn){const Bt=await rn.blob(),to=URL.createObjectURL(Bt);Et.set(pe,new Audio(to))}}else Et.set(pe,!0)}catch(rn){console.error("Error synthesizing speech:",rn)}return Et.get(pe)};let Pt={};const Zt=async(pe,Xe)=>{for(;!Xe.aborted;)if(Pt[pe]&&Pt[pe].length>0){const Be=Pt[pe].shift();if(Et.has(Be))if(((i==null?void 0:i.showEmojiInCall)??!1)&&Dt.has(Be)?t(3,k=Dt.get(Be)):t(3,k=null),r.audio.tts.engine!=="")try{console.log("%c%s","color: red; font-size: 20px;",`Playing audio for content: ${Be}`);const Ze=Et.get(Be);await he(Ze),console.log(`Played audio for content: ${Be}`),await new Promise(Tt=>setTimeout(Tt,200))}catch(Ze){console.error("Error playing audio:",Ze)}else await Fe(Be);else Pt[pe].unshift(Be),console.log(`Audio for "${Be}" not yet available in the cache, re-queued...`),await new Promise(Ze=>setTimeout(Ze,200))}else if(ue[pe]&&Pt[pe]&&Pt[pe].length===0){t(2,S=!1);break}else await new Promise(Be=>setTimeout(Be,200));console.log(`Audio monitoring and playing stopped for message ID ${pe}`)},jt=async pe=>{const{id:Xe}=pe.detail;D=!0,be!==Xe&&(console.log(`Received chat start event for message ID ${Xe}`),be=Xe,ot&&ot.abort(),ot=new AbortController,t(2,S=!0),Zt(Xe,ot.signal))},Ht=async pe=>{const{id:Xe,content:Be}=pe.detail;if(be===Xe){console.log(`Received chat event for message ID ${Xe}: ${Be}`);try{Pt[Xe]===void 0?Pt[Xe]=[Be]:Pt[Xe].push(Be),console.log(Be),Yt(Be)}catch(Ze){console.error("Failed to fetch or play audio:",Ze)}}},Qt=async pe=>{const{id:Xe,content:Be}=pe.detail;ue[Xe]=!0,D=!1};Kn(async()=>{const pe=async()=>{try{m=await navigator.wakeLock.request("screen")}catch(Xe){console.log(Xe)}m&&m.addEventListener("release",()=>{console.log("Wake Lock released")})};return"wakeLock"in navigator&&(await pe(),document.addEventListener("visibilitychange",async()=>{m!==null&&document.visibilityState==="visible"&&await pe()})),t(0,y=n.find(Xe=>Xe.id===v)),ve(),d.addEventListener("chat:start",jt),d.addEventListener("chat",Ht),d.addEventListener("chat:finish",Qt),async()=>{await et(),le(),d.removeEventListener("chat:start",jt),d.removeEventListener("chat",Ht),d.removeEventListener("chat:finish",Qt),ot.abort(),await it(),await et(),await J(!1),await F()}}),ur(async()=>{await et(),await J(!1),await F(),await le(),d.removeEventListener("chat:start",jt),d.removeEventListener("chat",Ht),d.removeEventListener("chat:finish",Qt),ot.abort(),await it(),await et()});const se=()=>{S&&et()},Qe=()=>{S&&et()},rt=()=>{F()},pt=async pe=>{console.log(pe.detail),t(9,L=pe.detail),await Y(),await Q()},Ue=async()=>{await navigator.mediaDevices.getUserMedia({video:!0}),Z()},en=()=>{S&&et()},At=async()=>{await le(),await Y(),console.log(K),console.log(R),Zn.set(!1),c("close")};return o.$$set=pe=>{"eventTarget"in pe&&t(21,d=pe.eventTarget),"submitPrompt"in pe&&t(22,f=pe.submitPrompt),"stopResponse"in pe&&t(23,h=pe.stopResponse),"files"in pe&&t(20,_=pe.files),"chatId"in pe&&t(24,b=pe.chatId),"modelId"in pe&&t(25,v=pe.modelId)},[y,w,S,k,C,R,H,K,V,L,a,l,c,u,Z,Q,Y,F,le,et,_,d,f,h,b,v,se,Qe,rt,pt,Ue,en,At]}class gm extends Ge{constructor(e){super(),We(this,e,QI,jI,Ye,{eventTarget:21,submitPrompt:22,stopResponse:23,files:20,chatId:24,modelId:25},null,[-1,-1,-1])}}function XI(o){var I,S,k,C,R,D,H,z,W,K;let e,t,n,r,i,s,a=(((S=(I=o[0])==null?void 0:I.model)==null?void 0:S.name)??((C=(k=o[0])==null?void 0:k.message)==null?void 0:C.model)??"Assistant")+"",l,c,u,d,f,h,_,b,v;t=new Bf({props:{src:((z=(H=(D=(R=o[0])==null?void 0:R.model)==null?void 0:D.info)==null?void 0:H.meta)==null?void 0:z.profile_image_url)??"",className:"size-5 -translate-y-[1px]"}}),d=new m_({props:{className:"size-3 "+((K=(W=o[0])==null?void 0:W.message)!=null&&K.favorite?"fill-red-500 stroke-red-500":"hover:fill-red-500 hover:stroke-red-500")+" ",strokeWidth:"2.5"}});function m(P,V){var L,q;return(q=(L=P[0])==null?void 0:L.message)!=null&&q.error?xI:ZI}let y=m(o),w=y(o);return{c(){e=M("div"),oe(t.$$.fragment),n=$(),r=M("div"),i=M("div"),s=M("div"),l=Ie(a),c=$(),u=M("button"),oe(d.$$.fragment),h=$(),w.c(),this.h()},l(P){e=O(P,"DIV",{class:!0});var V=A(e);ae(t.$$.fragment,V),n=ee(V),r=O(V,"DIV",{class:!0});var L=A(r);i=O(L,"DIV",{class:!0});var q=A(i);s=O(q,"DIV",{class:!0});var Z=A(s);l=Te(Z,a),Z.forEach(p),c=ee(q),u=O(q,"BUTTON",{class:!0});var Q=A(u);ae(d.$$.fragment,Q),Q.forEach(p),q.forEach(p),h=ee(L),w.l(L),L.forEach(p),V.forEach(p),this.h()},h(){var P,V;g(s,"class","text-xs text-black dark:text-white font-medium line-clamp-1"),g(u,"class",f=(V=(P=o[0])==null?void 0:P.message)!=null&&V.favorite?"":"invisible group-hover:visible"),g(i,"class","flex justify-between items-center"),g(r,"class","ml-2"),g(e,"class","flex w-full")},m(P,V){U(P,e,V),re(t,e,null),E(e,n),E(e,r),E(r,i),E(i,s),E(s,l),E(i,c),E(i,u),re(d,u,null),E(r,h),w.m(r,null),_=!0,b||(v=we(u,"click",o[1]),b=!0)},p(P,V){var Z,Q,Y,te,F,j,x,J,ve,le,me,X;const L={};V&1&&(L.src=((te=(Y=(Q=(Z=P[0])==null?void 0:Z.model)==null?void 0:Q.info)==null?void 0:Y.meta)==null?void 0:te.profile_image_url)??""),t.$set(L),(!_||V&1)&&a!==(a=(((j=(F=P[0])==null?void 0:F.model)==null?void 0:j.name)??((J=(x=P[0])==null?void 0:x.message)==null?void 0:J.model)??"Assistant")+"")&&Pe(l,a);const q={};V&1&&(q.className="size-3 "+((le=(ve=P[0])==null?void 0:ve.message)!=null&&le.favorite?"fill-red-500 stroke-red-500":"hover:fill-red-500 hover:stroke-red-500")+" "),d.$set(q),(!_||V&1&&f!==(f=(X=(me=P[0])==null?void 0:me.message)!=null&&X.favorite?"":"invisible group-hover:visible"))&&g(u,"class",f),y===(y=m(P))&&w?w.p(P,V):(w.d(1),w=y(P),w&&(w.c(),w.m(r,null)))},i(P){_||(T(t.$$.fragment,P),T(d.$$.fragment,P),_=!0)},o(P){N(t.$$.fragment,P),N(d.$$.fragment,P),_=!1},d(P){P&&p(e),ie(t),ie(d),w.d(),b=!1,v()}}}function JI(o){var _,b,v;let e,t,n,r,i,s,a=(((b=(_=o[0])==null?void 0:_.user)==null?void 0:b.name)??"User")+"",l,c,u;t=new Bf({props:{src:((v=o[0].user)==null?void 0:v.profile_image_url)??"/user.png",className:"size-5 -translate-y-[1px]"}});function d(m,y){var w,I;return(I=(w=m[0])==null?void 0:w.message)!=null&&I.error?eT:$I}let f=d(o),h=f(o);return{c(){e=M("div"),oe(t.$$.fragment),n=$(),r=M("div"),i=M("div"),s=M("div"),l=Ie(a),c=$(),h.c(),this.h()},l(m){e=O(m,"DIV",{class:!0});var y=A(e);ae(t.$$.fragment,y),n=ee(y),r=O(y,"DIV",{class:!0});var w=A(r);i=O(w,"DIV",{class:!0});var I=A(i);s=O(I,"DIV",{class:!0});var S=A(s);l=Te(S,a),S.forEach(p),I.forEach(p),c=ee(w),h.l(w),w.forEach(p),y.forEach(p),this.h()},h(){g(s,"class","text-xs text-black dark:text-white font-medium line-clamp-1"),g(i,"class","flex justify-between items-center"),g(r,"class","ml-2"),g(e,"class","flex w-full")},m(m,y){U(m,e,y),re(t,e,null),E(e,n),E(e,r),E(r,i),E(i,s),E(s,l),E(r,c),h.m(r,null),u=!0},p(m,y){var I,S,k;const w={};y&1&&(w.src=((I=m[0].user)==null?void 0:I.profile_image_url)??"/user.png"),t.$set(w),(!u||y&1)&&a!==(a=(((k=(S=m[0])==null?void 0:S.user)==null?void 0:k.name)??"User")+"")&&Pe(l,a),f===(f=d(m))&&h?h.p(m,y):(h.d(1),h=f(m),h&&(h.c(),h.m(r,null)))},i(m){u||(T(t.$$.fragment,m),u=!0)},o(m){N(t.$$.fragment,m),u=!1},d(m){m&&p(e),ie(t),h.d()}}}function ZI(o){let e,t=o[0].message.content+"",n;return{c(){e=M("div"),n=Ie(t),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);n=Te(i,t),i.forEach(p),this.h()},h(){g(e,"class","text-gray-500 line-clamp-2 text-xs mt-0.5")},m(r,i){U(r,e,i),E(e,n)},p(r,i){i&1&&t!==(t=r[0].message.content+"")&&Pe(n,t)},d(r){r&&p(e)}}}function xI(o){let e,t=o[0].message.error.content+"",n;return{c(){e=M("div"),n=Ie(t),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);n=Te(i,t),i.forEach(p),this.h()},h(){g(e,"class","text-red-500 line-clamp-2 text-xs mt-0.5")},m(r,i){U(r,e,i),E(e,n)},p(r,i){i&1&&t!==(t=r[0].message.error.content+"")&&Pe(n,t)},d(r){r&&p(e)}}}function $I(o){let e,t=o[0].message.content+"",n;return{c(){e=M("div"),n=Ie(t),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);n=Te(i,t),i.forEach(p),this.h()},h(){g(e,"class","text-gray-500 line-clamp-2 text-xs mt-0.5")},m(r,i){U(r,e,i),E(e,n)},p(r,i){i&1&&t!==(t=r[0].message.content+"")&&Pe(n,t)},d(r){r&&p(e)}}}function eT(o){let e,t=o[0].message.error.content+"",n;return{c(){e=M("div"),n=Ie(t),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);n=Te(i,t),i.forEach(p),this.h()},h(){g(e,"class","text-red-500 line-clamp-2 text-xs mt-0.5")},m(r,i){U(r,e,i),E(e,n)},p(r,i){i&1&&t!==(t=r[0].message.error.content+"")&&Pe(n,t)},d(r){r&&p(e)}}}function tT(o){let e,t,n,r;const i=[JI,XI],s=[];function a(l,c){return l[0].message.role==="user"?0:1}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=qe()},l(l){t.l(l),n=qe()},m(l,c){s[e].m(l,c),U(l,n,c),r=!0},p(l,c){let u=e;e=a(l),e===u?s[e].p(l,c):(De(),N(s[u],1,1,()=>{s[u]=null}),He(),t=s[e],t?t.p(l,c):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){N(t),r=!1},d(l){l&&p(n),s[e].d(l)}}}function nT(o){var l,c;let e,t,n,r,i,s,a;return t=new qt({props:{content:(c=(l=o[0])==null?void 0:l.message)!=null&&c.error?o[0].message.error.content:o[0].message.content,class:"w-full",allowHTML:!1,$$slots:{default:[tT]},$$scope:{ctx:o}}}),r=new ei({props:{type:"target",position:mt.Top,class:"w-2 rounded-full dark:bg-gray-900"}}),s=new ei({props:{type:"source",position:mt.Bottom,class:"w-2 rounded-full dark:bg-gray-900"}}),{c(){e=M("div"),oe(t.$$.fragment),n=$(),oe(r.$$.fragment),i=$(),oe(s.$$.fragment),this.h()},l(u){e=O(u,"DIV",{class:!0});var d=A(e);ae(t.$$.fragment,d),n=ee(d),ae(r.$$.fragment,d),i=ee(d),ae(s.$$.fragment,d),d.forEach(p),this.h()},h(){g(e,"class","px-4 py-3 shadow-md rounded-xl dark:bg-black bg-white border dark:border-gray-900 w-60 h-20 group")},m(u,d){U(u,e,d),re(t,e,null),E(e,n),re(r,e,null),E(e,i),re(s,e,null),a=!0},p(u,[d]){var h,_;const f={};d&1&&(f.content=(_=(h=u[0])==null?void 0:h.message)!=null&&_.error?u[0].message.error.content:u[0].message.content),d&5&&(f.$$scope={dirty:d,ctx:u}),t.$set(f)},i(u){a||(T(t.$$.fragment,u),T(r.$$.fragment,u),T(s.$$.fragment,u),a=!0)},o(u){N(t.$$.fragment,u),N(r.$$.fragment,u),N(s.$$.fragment,u),a=!1},d(u){u&&p(e),ie(t),ie(r),ie(s)}}}function oT(o,e,t){let{data:n}=e;const r=()=>{var i;t(0,n.message.favorite=!(((i=n==null?void 0:n.message)==null?void 0:i.favorite)??!1),n)};return o.$$set=i=>{"data"in i&&t(0,n=i.data)},[n,r]}class rT extends Ge{constructor(e){super(),We(this,e,oT,nT,Ye,{data:0})}}function iT(o){let e,t,n,r;return e=new jE({props:{showLock:!1}}),n=new iI({props:{variant:Zo.Dots}}),{c(){oe(e.$$.fragment),t=$(),oe(n.$$.fragment)},l(i){ae(e.$$.fragment,i),t=ee(i),ae(n.$$.fragment,i)},m(i,s){re(e,i,s),U(i,t,s),re(n,i,s),r=!0},p:Le,i(i){r||(T(e.$$.fragment,i),T(n.$$.fragment,i),r=!0)},o(i){N(e.$$.fragment,i),N(n.$$.fragment,i),r=!1},d(i){i&&p(t),ie(e,i),ie(n,i)}}}function sT(o){let e,t;return e=new yE({props:{nodes:o[0],nodeTypes:o[1],edges:o[2],fitView:!0,minZoom:.001,colorMode:o[3].includes("dark")||o[3]==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",nodesConnectable:!1,nodesDraggable:!1,oninit:o[5],$$slots:{default:[iT]},$$scope:{ctx:o}}}),e.$on("nodeclick",o[6]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,[r]){const i={};r&1&&(i.nodes=n[0]),r&2&&(i.nodeTypes=n[1]),r&4&&(i.edges=n[2]),r&8&&(i.colorMode=n[3].includes("dark")||n[3]==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),r&128&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function aT(o,e,t){let n;fe(o,Lm,u=>t(3,n=u));const r=An();let{nodes:i}=e,{nodeTypes:s}=e,{edges:a}=e;const l=()=>{console.log("Flow initialized")},c=u=>r("nodeclick",u.detail);return o.$$set=u=>{"nodes"in u&&t(0,i=u.nodes),"nodeTypes"in u&&t(1,s=u.nodeTypes),"edges"in u&&t(2,a=u.edges)},[i,s,a,n,r,l,c]}class lT extends Ge{constructor(e){super(),We(this,e,aT,sT,Ye,{nodes:0,nodeTypes:1,edges:2})}}function cT(o){let e,t;return{c(){e=Me("svg"),t=Me("path"),this.h()},l(n){e=Oe(n,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=A(e);t=Oe(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){U(n,e,r),E(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Le,o:Le,d(n){n&&p(e)}}}function uT(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="1.5"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class mm extends Ge{constructor(e){super(),We(this,e,uT,cT,Ye,{className:0,strokeWidth:1})}}function af(o){let e,t;return e=new lT({props:{nodes:o[6],nodeTypes:o[8],edges:o[7]}}),e.$on("nodeclick",o[12]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p:Le,i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function dT(o){let e,t,n,r,i,s,a,l=o[1].t("Chat Overview")+"",c,u,d,f,h,_,b,v;i=new mm({props:{className:"size-3.5"}}),f=new Ls({props:{className:"size-3.5"}});let m=o[2].length>0&&af(o);return{c(){e=M("div"),t=M("div"),n=M("div"),r=M("button"),oe(i.$$.fragment),s=$(),a=M("div"),c=Ie(l),u=$(),d=M("button"),oe(f.$$.fragment),h=$(),m&&m.c(),this.h()},l(y){e=O(y,"DIV",{class:!0});var w=A(e);t=O(w,"DIV",{class:!0});var I=A(t);n=O(I,"DIV",{class:!0});var S=A(n);r=O(S,"BUTTON",{class:!0});var k=A(r);ae(i.$$.fragment,k),k.forEach(p),s=ee(S),a=O(S,"DIV",{class:!0});var C=A(a);c=Te(C,l),C.forEach(p),S.forEach(p),u=ee(I),d=O(I,"BUTTON",{class:!0});var R=A(d);ae(f.$$.fragment,R),R.forEach(p),I.forEach(p),h=ee(w),m&&m.l(w),w.forEach(p),this.h()},h(){g(r,"class","self-center p-0.5"),g(a,"class","text-lg font-medium self-center font-primary"),g(n,"class","flex items-center gap-2.5"),g(d,"class","self-center p-0.5"),g(t,"class","absolute z-50 w-full flex justify-between dark:text-gray-100 px-4 py-3.5"),g(e,"class","w-full h-full relative")},m(y,w){U(y,e,w),E(e,t),E(t,n),E(n,r),re(i,r,null),E(n,s),E(n,a),E(a,c),E(t,u),E(t,d),re(f,d,null),E(e,h),m&&m.m(e,null),_=!0,b||(v=[we(r,"click",o[10]),we(d,"click",o[11])],b=!0)},p(y,[w]){(!_||w&2)&&l!==(l=y[1].t("Chat Overview")+"")&&Pe(c,l),y[2].length>0?m?(m.p(y,w),w&4&&T(m,1)):(m=af(y),m.c(),T(m,1),m.m(e,null)):m&&(De(),N(m,1,1,()=>{m=null}),He())},i(y){_||(T(i.$$.fragment,y),T(f.$$.fragment,y),T(m),_=!0)},o(y){N(i.$$.fragment,y),N(f.$$.fragment,y),N(m),_=!1},d(y){y&&p(e),ie(i),ie(f),m&&m.d(),b=!1,cn(v)}}}function fT(o,e,t){let n,r,i,s;fe(o,Tr,D=>t(13,n=D)),fe(o,er,D=>t(14,r=D));const a=An(),l=fn("i18n");fe(o,l,D=>t(1,i=D));const{width:c,height:u}=pn(),{fitView:d,getViewport:f}=sI(),h=aI();let{history:_}=e,b=null;const v=st([]);fe(o,v,D=>t(2,s=D));const m=st([]),y={custom:rT},w=async()=>{b===null?await d({nodes:[{id:_.currentId}]}):await d({nodes:[{id:b}]}),t(0,b=null)},I=async()=>{const D=[],H=[];let K=new Map,P={};Object.keys(_.messages).forEach(V=>{var Z;const L=_.messages[V],q=L.parentId?(((Z=K.get(L.parentId))==null?void 0:Z.level)??-1)+1:0;P[q]||(P[q]=0),K.set(V,{id:L.id,level:q,position:P[q]++})}),Object.keys(_.messages).forEach(V=>{const L=K.get(V),q=L.position*250,Z=L.level*150,Q=q;D.push({id:L.id,type:"custom",data:{user:r,message:_.messages[V],model:n.find(te=>te.id===_.messages[V].model)},position:{x:Q,y:Z}});const Y=_.messages[V].parentId;Y&&H.push({id:Y+"-"+L.id,source:Y,target:L.id,selectable:!1,class:" dark:fill-gray-300 fill-gray-300",type:"smoothstep",animated:_.currentId===V||S(V,_.currentId)})}),await m.set([...H]),await v.set([...D])},S=(D,H)=>{const z=_.messages[D];return z.childrenIds&&z.childrenIds.some(W=>W===H||S(W,H))};Kn(()=>{I(),h.subscribe(async D=>{D&&(await it(),await d({nodes:[{id:_.currentId}]}))}),c.subscribe(D=>{D&&d({nodes:[{id:_.currentId}]})}),u.subscribe(D=>{D&&d({nodes:[{id:_.currentId}]})})}),ur(()=>{console.log("Overview destroyed"),v.set([]),m.set([])});const k=()=>{jo.set(!1)},C=()=>{a("close"),jo.set(!1)},R=D=>{console.log(D.detail.node.data),a("nodeclick",D.detail),t(0,b=D.detail.node.data.message.id),d({nodes:[{id:b}]})};return o.$$set=D=>{"history"in D&&t(9,_=D.history)},o.$$.update=()=>{o.$$.dirty&512&&_&&I(),o.$$.dirty&512&&_&&_.currentId&&w()},[b,i,s,a,l,d,v,m,y,_,k,C,R]}class pm extends Ge{constructor(e){super(),We(this,e,fT,dT,Ye,{history:9})}}function hT(o){let e,t;return{c(){e=Me("svg"),t=Me("path"),this.h()},l(n){e=Oe(n,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=A(e);t=Oe(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){U(n,e,r),E(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Le,o:Le,d(n){n&&p(e)}}}function gT(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="1.5"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class mT extends Ge{constructor(e){super(),We(this,e,gT,hT,Ye,{className:0,strokeWidth:1})}}function lf(o){let e;return{c(){e=M("div"),this.h()},l(t){e=O(t,"DIV",{class:!0}),A(e).forEach(p),this.h()},h(){g(e,"class","absolute top-0 left-0 right-0 bottom-0 z-10")},m(t,n){U(t,e,n)},d(t){t&&p(e)}}}function pT(o){let e,t=o[5].t("No HTML, CSS, or JavaScript content found.")+"",n;return{c(){e=M("div"),n=Ie(t),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);n=Te(i,t),i.forEach(p),this.h()},h(){g(e,"class","m-auto font-medium text-xs text-gray-900 dark:text-white")},m(r,i){U(r,e,i),E(e,n)},p(r,i){i&32&&t!==(t=r[5].t("No HTML, CSS, or JavaScript content found.")+"")&&Pe(n,t)},i:Le,o:Le,d(r){r&&p(e)}}}function _T(o){let e,t,n,r;const i=[yT,bT],s=[];function a(l,c){return l[1][l[2]].type==="iframe"?0:l[1][l[2]].type==="svg"?1:-1}return~(t=a(o))&&(n=s[t]=i[t](o)),{c(){e=M("div"),n&&n.c(),this.h()},l(l){e=O(l,"DIV",{class:!0});var c=A(e);n&&n.l(c),c.forEach(p),this.h()},h(){g(e,"class","max-w-full w-full h-full")},m(l,c){U(l,e,c),~t&&s[t].m(e,null),r=!0},p(l,c){let u=t;t=a(l),t===u?~t&&s[t].p(l,c):(n&&(De(),N(s[u],1,1,()=>{s[u]=null}),He()),~t?(n=s[t],n?n.p(l,c):(n=s[t]=i[t](l),n.c()),T(n,1),n.m(e,null)):n=null)},i(l){r||(T(n),r=!0)},o(l){N(n),r=!1},d(l){l&&p(e),~t&&s[t].d()}}}function bT(o){let e,t;return e=new Yp({props:{className:" w-full h-full max-h-full overflow-hidden",svg:o[1][o[2]].content}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&6&&(i.svg=n[1][n[2]].content),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function yT(o){let e,t,n,r;return{c(){e=M("iframe"),this.h()},l(i){e=O(i,"IFRAME",{title:!0,srcdoc:!0,class:!0,sandbox:!0}),A(e).forEach(p),this.h()},h(){g(e,"title","Content"),g(e,"srcdoc",t=o[1][o[2]].content),g(e,"class","w-full border-0 h-full rounded-none"),g(e,"sandbox","allow-scripts allow-forms allow-same-origin")},m(i,s){U(i,e,s),o[14](e),n||(r=we(e,"load",o[9]),n=!0)},p(i,s){s&6&&t!==(t=i[1][i[2]].content)&&g(e,"srcdoc",t)},i:Le,o:Le,d(i){i&&p(e),o[14](null),n=!1,r()}}}function cf(o){let e,t,n,r,i,s,a,l,c,u=o[5].t("Version {{selectedVersion}} of {{totalVersions}}",{selectedVersion:o[2]+1,totalVersions:o[1].length})+"",d,f,h,_,b,v,m,y,w,I=(o[3]?o[5].t("Copied"):o[5].t("Copy"))+"",S,k,C,R,D,H=o[1][o[2]].type==="iframe"&&uf(o);return{c(){e=M("div"),t=M("div"),n=M("div"),r=M("button"),i=Me("svg"),s=Me("path"),l=$(),c=M("div"),d=Ie(u),f=$(),h=M("button"),_=Me("svg"),b=Me("path"),m=$(),y=M("div"),w=M("button"),S=Ie(I),k=$(),H&&H.c(),this.h()},l(z){e=O(z,"DIV",{class:!0});var W=A(e);t=O(W,"DIV",{class:!0});var K=A(t);n=O(K,"DIV",{class:!0,dir:!0});var P=A(n);r=O(P,"BUTTON",{class:!0});var V=A(r);i=Oe(V,"svg",{xmlns:!0,fill:!0,viewBox:!0,stroke:!0,"stroke-width":!0,class:!0});var L=A(i);s=Oe(L,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(s).forEach(p),L.forEach(p),V.forEach(p),l=ee(P),c=O(P,"DIV",{class:!0});var q=A(c);d=Te(q,u),q.forEach(p),f=ee(P),h=O(P,"BUTTON",{class:!0});var Z=A(h);_=Oe(Z,"svg",{xmlns:!0,fill:!0,viewBox:!0,stroke:!0,"stroke-width":!0,class:!0});var Q=A(_);b=Oe(Q,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(b).forEach(p),Q.forEach(p),Z.forEach(p),P.forEach(p),K.forEach(p),m=ee(W),y=O(W,"DIV",{class:!0});var Y=A(y);w=O(Y,"BUTTON",{class:!0});var te=A(w);S=Te(te,I),te.forEach(p),k=ee(Y),H&&H.l(Y),Y.forEach(p),W.forEach(p),this.h()},h(){g(s,"stroke-linecap","round"),g(s,"stroke-linejoin","round"),g(s,"d","M15.75 19.5 8.25 12l7.5-7.5"),g(i,"xmlns","http://www.w3.org/2000/svg"),g(i,"fill","none"),g(i,"viewBox","0 0 24 24"),g(i,"stroke","currentColor"),g(i,"stroke-width","2.5"),g(i,"class","size-3.5"),g(r,"class","self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed"),r.disabled=a=o[1].length<=1,g(c,"class","text-xs self-center dark:text-gray-100 min-w-fit"),g(b,"stroke-linecap","round"),g(b,"stroke-linejoin","round"),g(b,"d","m8.25 4.5 7.5 7.5-7.5 7.5"),g(_,"xmlns","http://www.w3.org/2000/svg"),g(_,"fill","none"),g(_,"viewBox","0 0 24 24"),g(_,"stroke","currentColor"),g(_,"stroke-width","2.5"),g(_,"class","size-3.5"),g(h,"class","self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed"),h.disabled=v=o[1].length<=1,g(n,"class","flex items-center gap-0.5 self-center min-w-fit"),g(n,"dir","ltr"),g(t,"class","flex items-center space-x-2"),g(w,"class","copy-code-button bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md px-1.5 py-0.5"),g(y,"class","flex items-center gap-1"),g(e,"class","flex justify-between items-center p-2.5 font-primar text-gray-900 dark:text-white")},m(z,W){U(z,e,W),E(e,t),E(t,n),E(n,r),E(r,i),E(i,s),E(n,l),E(n,c),E(c,d),E(n,f),E(n,h),E(h,_),E(_,b),E(e,m),E(e,y),E(y,w),E(w,S),E(y,k),H&&H.m(y,null),C=!0,R||(D=[we(r,"click",o[15]),we(h,"click",o[16]),we(w,"click",o[17])],R=!0)},p(z,W){(!C||W&2&&a!==(a=z[1].length<=1))&&(r.disabled=a),(!C||W&38)&&u!==(u=z[5].t("Version {{selectedVersion}} of {{totalVersions}}",{selectedVersion:z[2]+1,totalVersions:z[1].length})+"")&&Pe(d,u),(!C||W&2&&v!==(v=z[1].length<=1))&&(h.disabled=v),(!C||W&40)&&I!==(I=(z[3]?z[5].t("Copied"):z[5].t("Copy"))+"")&&Pe(S,I),z[1][z[2]].type==="iframe"?H?(H.p(z,W),W&6&&T(H,1)):(H=uf(z),H.c(),T(H,1),H.m(y,null)):H&&(De(),N(H,1,1,()=>{H=null}),He())},i(z){C||(T(H),C=!0)},o(z){N(H),C=!1},d(z){z&&p(e),H&&H.d(),R=!1,cn(D)}}}function uf(o){let e,t;return e=new qt({props:{content:o[5].t("Open in full screen"),$$slots:{default:[vT]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r&32&&(i.content=n[5].t("Open in full screen")),r&1048576&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function vT(o){let e,t,n,r,i;return t=new mT({props:{className:"size-3.5"}}),{c(){e=M("button"),oe(t.$$.fragment),this.h()},l(s){e=O(s,"BUTTON",{class:!0});var a=A(e);ae(t.$$.fragment,a),a.forEach(p),this.h()},h(){g(e,"class","bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md p-0.5")},m(s,a){U(s,e,a),re(t,e,null),n=!0,r||(i=we(e,"click",o[10]),r=!0)},p:Le,i(s){n||(T(t.$$.fragment,s),n=!0)},o(s){N(t.$$.fragment,s),n=!1},d(s){s&&p(e),ie(t),r=!1,i()}}}function wT(o){let e,t,n,r,i,s,a,l,c,u,d,f,h,_,b,v,m,y,w,I=o[0]&&lf();s=new mm({props:{className:"size-3.5  text-gray-900 dark:text-white"}}),u=new Ls({props:{className:"size-3.5 text-gray-900 dark:text-white"}});const S=[_T,pT],k=[];function C(D,H){return D[1].length>0?0:1}_=C(o),b=k[_]=S[_](o);let R=o[1].length>0&&cf(o);return{c(){e=M("div"),t=M("div"),I&&I.c(),n=$(),r=M("div"),i=M("button"),oe(s.$$.fragment),a=$(),l=M("div"),c=M("button"),oe(u.$$.fragment),d=$(),f=M("div"),h=M("div"),b.c(),v=$(),R&&R.c(),this.h()},l(D){e=O(D,"DIV",{class:!0});var H=A(e);t=O(H,"DIV",{class:!0});var z=A(t);I&&I.l(z),n=ee(z),r=O(z,"DIV",{class:!0});var W=A(r);i=O(W,"BUTTON",{class:!0});var K=A(i);ae(s.$$.fragment,K),K.forEach(p),W.forEach(p),a=ee(z),l=O(z,"DIV",{class:!0});var P=A(l);c=O(P,"BUTTON",{class:!0});var V=A(c);ae(u.$$.fragment,V),V.forEach(p),P.forEach(p),d=ee(z),f=O(z,"DIV",{class:!0});var L=A(f);h=O(L,"DIV",{class:!0});var q=A(h);b.l(q),q.forEach(p),L.forEach(p),z.forEach(p),v=ee(H),R&&R.l(H),H.forEach(p),this.h()},h(){g(i,"class","self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850"),g(r,"class","absolute pointer-events-none z-50 w-full flex items-center justify-start p-4"),g(c,"class","self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850"),g(l,"class","absolute pointer-events-none z-50 w-full flex items-center justify-end p-4"),g(h,"class","h-full flex flex-col"),g(f,"class","flex-1 w-full h-full"),g(t,"class","w-full h-full flex-1 relative"),g(e,"class","w-full h-full relative flex flex-col bg-gray-50 dark:bg-gray-850")},m(D,H){U(D,e,H),E(e,t),I&&I.m(t,null),E(t,n),E(t,r),E(r,i),re(s,i,null),E(t,a),E(t,l),E(l,c),re(u,c,null),E(t,d),E(t,f),E(f,h),k[_].m(h,null),E(e,v),R&&R.m(e,null),m=!0,y||(w=[we(i,"click",o[12]),we(c,"click",o[13])],y=!0)},p(D,[H]){D[0]?I||(I=lf(),I.c(),I.m(t,n)):I&&(I.d(1),I=null);let z=_;_=C(D),_===z?k[_].p(D,H):(De(),N(k[z],1,1,()=>{k[z]=null}),He(),b=k[_],b?b.p(D,H):(b=k[_]=S[_](D),b.c()),T(b,1),b.m(h,null)),D[1].length>0?R?(R.p(D,H),H&2&&T(R,1)):(R=cf(D),R.c(),T(R,1),R.m(e,null)):R&&(De(),N(R,1,1,()=>{R=null}),He())},i(D){m||(T(s.$$.fragment,D),T(u.$$.fragment,D),T(b),T(R),m=!0)},o(D){N(s.$$.fragment,D),N(u.$$.fragment,D),N(b),N(R),m=!1},d(D){D&&p(e),I&&I.d(),ie(s),ie(u),k[_].d(),R&&R.d(),y=!1,cn(w)}}}function kT(o,e,t){let n;const r=fn("i18n");fe(o,r,C=>t(5,n=C));const i=An();let{overlay:s=!1}=e,{history:a}=e,l=[],c=[],u=0,d=!1,f;const h=()=>{t(1,c=[]),l.forEach(C=>{if((C==null?void 0:C.role)!=="user"&&(C!=null&&C.content)){const R=C.content.match(/```[\s\S]*?```/g);let D=[];R&&R.forEach(L=>{const q=L.split(`
`)[0].replace("```","").trim().toLowerCase(),Z=L.replace(/```[\s\S]*?\n/,"").replace(/```$/,"");D.push({lang:q,code:Z})});let H="",z="",W="";D.forEach(L=>{const{lang:q,code:Z}=L;q==="html"?H+=Z+`
`:q==="css"?z+=Z+`
`:(q==="javascript"||q==="js")&&(W+=Z+`
`)});const K=C.content.match(/<html>[\s\S]*?<\/html>/gi),P=C.content.match(/<style>[\s\S]*?<\/style>/gi),V=C.content.match(/<script>[\s\S]*?<\/script>/gi);if(K&&K.forEach(L=>{const q=L.replace(/<\/?html>/gi,"");H+=q+`
`}),P&&P.forEach(L=>{const q=L.replace(/<\/?style>/gi,"");z+=q+`
`}),V&&V.forEach(L=>{const q=L.replace(/<\/?script>/gi,"");W+=q+`
`}),H||z||W){const L=`
                        <!DOCTYPE html>
                        <html lang="en">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
							<style>
								body {
									background-color: white; /* Ensure the iframe has a white background */
								}

								${z}
							</style>
                        </head>
                        <body>
                            ${H}

							<script>
                            	${W}
							<\/script>
                        </body>
                        </html>
                    `;t(1,c=[...c,{type:"iframe",content:L}])}else for(const L of D)(L.lang==="svg"||L.lang==="xml"&&L.code.includes("<svg"))&&t(1,c=[...c,{type:"svg",content:L.code}])}}),c.length===0&&(dn.set(!1),Lo.set(!1)),t(2,u=c?c.length-1:0)};function _(C){console.log(u),t(2,u=C==="prev"?Math.max(u-1,0):Math.min(u+1,c.length-1)),console.log(u)}const b=()=>{f.contentWindow.addEventListener("click",function(C){const R=C.target.closest("a");if(R&&R.href){C.preventDefault();const D=new URL(R.href,f.baseURI);D.origin===window.location.origin?f.contentWindow.history.pushState(null,"",D.pathname+D.search+D.hash):console.log("External navigation blocked:",D.href)}},!0),f.contentWindow.addEventListener("mouseenter",function(C){C.preventDefault(),f.contentWindow.addEventListener("dragstart",R=>{R.preventDefault()})})},v=()=>{f.requestFullscreen?f.requestFullscreen():f.webkitRequestFullscreen?f.webkitRequestFullscreen():f.msRequestFullscreen&&f.msRequestFullscreen()};Kn(()=>{});const m=()=>{Lo.set(!1)},y=()=>{i("close"),dn.set(!1),Lo.set(!1)};function w(C){ze[C?"unshift":"push"](()=>{f=C,t(4,f)})}const I=()=>_("prev"),S=()=>_("next"),k=()=>{Za(c[u].content),t(3,d=!0),setTimeout(()=>{t(3,d=!1)},2e3)};return o.$$set=C=>{"overlay"in C&&t(0,s=C.overlay),"history"in C&&t(11,a=C.history)},o.$$.update=()=>{o.$$.dirty&2048&&(a?(l=ao(a,a.currentId),h()):(l=[],h()))},[s,c,u,d,f,n,r,i,_,b,v,a,m,y,w,I,S,k]}class _m extends Ge{constructor(e){super(),We(this,e,kT,wT,Ye,{overlay:0,history:11})}}function CT(o){let e,t,n,r,i=o[16]&&df(o);function s(l){o[37](l)}let a={defaultSize:0,onResize:o[35],onCollapse:o[36],collapsible:!0,class:"pt-8",$$slots:{default:[MT]},$$scope:{ctx:o}};return o[4]!==void 0&&(a.pane=o[4]),t=new Mf({props:a}),ze.push(()=>nt(t,"pane",s)),{c(){i&&i.c(),e=$(),oe(t.$$.fragment)},l(l){i&&i.l(l),e=ee(l),ae(t.$$.fragment,l)},m(l,c){i&&i.m(l,c),U(l,e,c),re(t,l,c),r=!0},p(l,c){l[16]?i?c[0]&65536&&T(i,1):(i=df(l),i.c(),T(i,1),i.m(e.parentNode,e)):i&&(De(),N(i,1,1,()=>{i=null}),He());const u={};c[0]&81936&&(u.onResize=l[35]),c[0]&503791|c[1]&4096&&(u.$$scope={dirty:c,ctx:l}),!n&&c[0]&16&&(n=!0,u.pane=l[4],tt(()=>n=!1)),t.$set(u)},i(l){r||(T(i),T(t.$$.fragment,l),r=!0)},o(l){N(i),N(t.$$.fragment,l),r=!1},d(l){l&&p(e),i&&i.d(l),ie(t,l)}}}function ET(o){let e,t,n=o[16]&&hf(o);return{c(){n&&n.c(),e=qe()},l(r){n&&n.l(r),e=qe()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,i){r[16]?n?(n.p(r,i),i[0]&65536&&T(n,1)):(n=hf(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(De(),N(n,1,1,()=>{n=null}),He())},i(r){t||(T(n),t=!0)},o(r){N(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function df(o){let e,t;return e=new Mm({props:{class:"relative flex w-2 items-center justify-center bg-background group",$$slots:{default:[IT]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function IT(o){let e,t,n;return t=new __({props:{className:"size-4 invisible group-hover:visible"}}),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(r){e=O(r,"DIV",{class:!0});var i=A(e);ae(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"class","z-10 flex h-7 w-5 items-center justify-center rounded-xs")},m(r,i){U(r,e,i),re(t,e,null),n=!0},p:Le,i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){N(t.$$.fragment,r),n=!1},d(r){r&&p(e),ie(t)}}}function ff(o){let e,t,n,r,i,s;const a=[RT,AT,ST,TT],l=[];function c(u,d){return u[15]?0:u[18]?1:u[17]?2:3}return n=c(o),r=l[n]=a[n](o),{c(){e=M("div"),t=M("div"),r.c(),this.h()},l(u){e=O(u,"DIV",{class:!0});var d=A(e);t=O(d,"DIV",{class:!0});var f=A(t);r.l(f),f.forEach(p),d.forEach(p),this.h()},h(){g(t,"class",i="w-full "+((o[17]||o[18])&&!o[15]?" ":"px-4 py-4 bg-white dark:shadow-lg dark:bg-gray-850  border border-gray-100 dark:border-gray-850")+" rounded-xl z-40 pointer-events-auto overflow-y-auto scrollbar-hidden"),g(e,"class","pr-4 pb-8 flex max-h-full min-h-full")},m(u,d){U(u,e,d),E(e,t),l[n].m(t,null),s=!0},p(u,d){let f=n;n=c(u),n===f?l[n].p(u,d):(De(),N(l[f],1,1,()=>{l[f]=null}),He(),r=l[n],r?r.p(u,d):(r=l[n]=a[n](u),r.c()),T(r,1),r.m(t,null)),(!s||d[0]&425984&&i!==(i="w-full "+((u[17]||u[18])&&!u[15]?" ":"px-4 py-4 bg-white dark:shadow-lg dark:bg-gray-850  border border-gray-100 dark:border-gray-850")+" rounded-xl z-40 pointer-events-auto overflow-y-auto scrollbar-hidden"))&&g(t,"class",i)},i(u){s||(T(r),s=!0)},o(u){N(r),s=!1},d(u){u&&p(e),l[n].d()}}}function TT(o){let e,t,n,r;function i(l){o[32](l)}function s(l){o[33](l)}let a={models:o[5]};return o[1]!==void 0&&(a.chatFiles=o[1]),o[2]!==void 0&&(a.params=o[2]),e=new hm({props:a}),ze.push(()=>nt(e,"chatFiles",i)),ze.push(()=>nt(e,"params",s)),e.$on("close",o[34]),{c(){oe(e.$$.fragment)},l(l){ae(e.$$.fragment,l)},m(l,c){re(e,l,c),r=!0},p(l,c){const u={};c[0]&32&&(u.models=l[5]),!t&&c[0]&2&&(t=!0,u.chatFiles=l[1],tt(()=>t=!1)),!n&&c[0]&4&&(n=!0,u.params=l[2],tt(()=>n=!1)),e.$set(u)},i(l){r||(T(e.$$.fragment,l),r=!0)},o(l){N(e.$$.fragment,l),r=!1},d(l){ie(e,l)}}}function ST(o){let e,t;return e=new pm({props:{history:o[0]}}),e.$on("nodeclick",o[30]),e.$on("close",o[31]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&1&&(i.history=n[0]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function AT(o){let e,t;return e=new _m({props:{history:o[0],overlay:o[13]}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&1&&(i.history=n[0]),r[0]&8192&&(i.overlay=n[13]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function RT(o){let e,t,n,r;function i(a){o[28](a)}let s={submitPrompt:o[8],stopResponse:o[9],modelId:o[11],chatId:o[6],eventTarget:o[7]};return o[3]!==void 0&&(s.files=o[3]),t=new gm({props:s}),ze.push(()=>nt(t,"files",i)),t.$on("close",o[29]),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(a){e=O(a,"DIV",{class:!0});var l=A(e);ae(t.$$.fragment,l),l.forEach(p),this.h()},h(){g(e,"class","w-full h-full flex justify-center")},m(a,l){U(a,e,l),re(t,e,null),r=!0},p(a,l){const c={};l[0]&256&&(c.submitPrompt=a[8]),l[0]&512&&(c.stopResponse=a[9]),l[0]&2048&&(c.modelId=a[11]),l[0]&64&&(c.chatId=a[6]),l[0]&128&&(c.eventTarget=a[7]),!n&&l[0]&8&&(n=!0,c.files=a[3],tt(()=>n=!1)),t.$set(c)},i(a){r||(T(t.$$.fragment,a),r=!0)},o(a){N(t.$$.fragment,a),r=!1},d(a){a&&p(e),ie(t)}}}function MT(o){let e,t,n=o[16]&&ff(o);return{c(){n&&n.c(),e=qe()},l(r){n&&n.l(r),e=qe()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,i){r[16]?n?(n.p(r,i),i[0]&65536&&T(n,1)):(n=ff(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(De(),N(n,1,1,()=>{n=null}),He())},i(r){t||(T(n),t=!0)},o(r){N(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function hf(o){let e,t;return e=new p_({props:{show:o[16],$$slots:{default:[HT]},$$scope:{ctx:o}}}),e.$on("close",o[27]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&65536&&(i.show=n[16]),r[0]&430063|r[1]&4096&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function OT(o){let e,t,n,r;function i(l){o[24](l)}function s(l){o[25](l)}let a={models:o[5]};return o[1]!==void 0&&(a.chatFiles=o[1]),o[2]!==void 0&&(a.params=o[2]),e=new hm({props:a}),ze.push(()=>nt(e,"chatFiles",i)),ze.push(()=>nt(e,"params",s)),e.$on("close",o[26]),{c(){oe(e.$$.fragment)},l(l){ae(e.$$.fragment,l)},m(l,c){re(e,l,c),r=!0},p(l,c){const u={};c[0]&32&&(u.models=l[5]),!t&&c[0]&2&&(t=!0,u.chatFiles=l[1],tt(()=>t=!1)),!n&&c[0]&4&&(n=!0,u.params=l[2],tt(()=>n=!1)),e.$set(u)},i(l){r||(T(e.$$.fragment,l),r=!0)},o(l){N(e.$$.fragment,l),r=!1},d(l){ie(e,l)}}}function PT(o){let e,t;return e=new pm({props:{history:o[0]}}),e.$on("nodeclick",o[22]),e.$on("close",o[23]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&1&&(i.history=n[0]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function NT(o){let e,t;return e=new _m({props:{history:o[0]}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&1&&(i.history=n[0]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function DT(o){let e,t,n,r;function i(a){o[20](a)}let s={submitPrompt:o[8],stopResponse:o[9],modelId:o[11],chatId:o[6],eventTarget:o[7]};return o[3]!==void 0&&(s.files=o[3]),t=new gm({props:s}),ze.push(()=>nt(t,"files",i)),t.$on("close",o[21]),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(a){e=O(a,"DIV",{class:!0});var l=A(e);ae(t.$$.fragment,l),l.forEach(p),this.h()},h(){g(e,"class","h-full max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center")},m(a,l){U(a,e,l),re(t,e,null),r=!0},p(a,l){const c={};l[0]&256&&(c.submitPrompt=a[8]),l[0]&512&&(c.stopResponse=a[9]),l[0]&2048&&(c.modelId=a[11]),l[0]&64&&(c.chatId=a[6]),l[0]&128&&(c.eventTarget=a[7]),!n&&l[0]&8&&(n=!0,c.files=a[3],tt(()=>n=!1)),t.$set(c)},i(a){r||(T(t.$$.fragment,a),r=!0)},o(a){N(t.$$.fragment,a),r=!1},d(a){a&&p(e),ie(t)}}}function HT(o){let e,t,n,r,i;const s=[DT,NT,PT,OT],a=[];function l(c,u){return c[15]?0:c[18]?1:c[17]?2:3}return t=l(o),n=a[t]=s[t](o),{c(){e=M("div"),n.c(),this.h()},l(c){e=O(c,"DIV",{class:!0});var u=A(e);n.l(u),u.forEach(p),this.h()},h(){g(e,"class",r=(o[15]||o[17]||o[18]?" h-screen  w-full":"px-6 py-4")+" h-full")},m(c,u){U(c,e,u),a[t].m(e,null),i=!0},p(c,u){let d=t;t=l(c),t===d?a[t].p(c,u):(De(),N(a[d],1,1,()=>{a[d]=null}),He(),n=a[t],n?n.p(c,u):(n=a[t]=s[t](c),n.c()),T(n,1),n.m(e,null)),(!i||u[0]&425984&&r!==(r=(c[15]||c[17]||c[18]?" h-screen  w-full":"px-6 py-4")+" h-full"))&&g(e,"class",r)},i(c){i||(T(n),i=!0)},o(c){N(n),i=!1},d(c){c&&p(e),a[t].d()}}}function LT(o){let e,t,n,r;const i=[ET,CT],s=[];function a(l,c){return l[12]?1:0}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=qe()},l(l){t.l(l),n=qe()},m(l,c){s[e].m(l,c),U(l,n,c),r=!0},p(l,c){let u=e;e=a(l),e===u?s[e].p(l,c):(De(),N(s[u],1,1,()=>{s[u]=null}),He(),t=s[e],t?t.p(l,c):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){N(t),r=!1},d(l){l&&p(n),s[e].d(l)}}}function UT(o){let e,t;return e=new kE({props:{$$slots:{default:[LT]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&524287|r[1]&4096&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function BT(o,e,t){let n,r,i,s;fe(o,Zn,ue=>t(15,n=ue)),fe(o,dn,ue=>t(16,r=ue)),fe(o,jo,ue=>t(17,i=ue)),fe(o,Lo,ue=>t(18,s=ue));let{history:a}=e,{models:l=[]}=e,{chatId:c=null}=e,{chatFiles:u=[]}=e,{params:d={}}=e,{eventTarget:f}=e,{submitPrompt:h}=e,{stopResponse:_}=e,{showMessage:b}=e,{files:v}=e,{modelId:m}=e,{pane:y}=e,w,I=!1,S=!1,k=0;const C=()=>{parseInt(localStorage==null?void 0:localStorage.chatControlsSize)?y.resize(parseInt(localStorage==null?void 0:localStorage.chatControlsSize)):y.resize(k)},R=async ue=>{ue.matches?(t(12,I=!0),n&&(Zn.set(!1),await it(),Zn.set(!0))):(t(12,I=!1),n&&(Zn.set(!1),await it(),Zn.set(!0)),t(4,y=null))},D=ue=>{t(13,S=!0)},H=ue=>{t(13,S=!1)};Kn(()=>{w=window.matchMedia("(min-width: 1024px)"),w.addEventListener("change",R),R(w);const ue=document.getElementById("chat-container");t(14,k=Math.floor(350/ue.clientWidth*100)),new ResizeObserver(Re=>{for(let Fe of Re){const et=350/Fe.contentRect.width*100;t(14,k=Math.floor(et)),r&&y&&y.isExpanded()&&y.getSize()<k&&y.resize(k)}}).observe(ue),document.addEventListener("mousedown",D),document.addEventListener("mouseup",H)}),ur(()=>{dn.set(!1),w.removeEventListener("change",R),document.removeEventListener("mousedown",D),document.removeEventListener("mouseup",H)});const z=()=>{dn.set(!1),jo.set(!1),Lo.set(!1),n&&Zn.set(!1)};function W(ue){v=ue,t(3,v)}const K=()=>{dn.set(!1)},P=ue=>{b(ue.detail.node.data.message)},V=()=>{dn.set(!1)};function L(ue){u=ue,t(1,u)}function q(ue){d=ue,t(2,d)}const Z=()=>{dn.set(!1)},Q=()=>{dn.set(!1)};function Y(ue){v=ue,t(3,v)}const te=()=>{dn.set(!1)},F=ue=>{ue.detail.node.data.message.favorite?t(0,a.messages[ue.detail.node.data.message.id].favorite=!0,a):t(0,a.messages[ue.detail.node.data.message.id].favorite=null,a),b(ue.detail.node.data.message)},j=()=>{dn.set(!1)};function x(ue){u=ue,t(1,u)}function J(ue){d=ue,t(2,d)}const ve=()=>{dn.set(!1)},le=ue=>{console.log("size",ue,k),r&&y.isExpanded()&&(ue<k&&y.resize(k),ue<k?localStorage.chatControlsSize=0:localStorage.chatControlsSize=ue)},me=()=>{dn.set(!1)};function X(ue){y=ue,t(4,y)}return o.$$set=ue=>{"history"in ue&&t(0,a=ue.history),"models"in ue&&t(5,l=ue.models),"chatId"in ue&&t(6,c=ue.chatId),"chatFiles"in ue&&t(1,u=ue.chatFiles),"params"in ue&&t(2,d=ue.params),"eventTarget"in ue&&t(7,f=ue.eventTarget),"submitPrompt"in ue&&t(8,h=ue.submitPrompt),"stopResponse"in ue&&t(9,_=ue.stopResponse),"showMessage"in ue&&t(10,b=ue.showMessage),"files"in ue&&t(3,v=ue.files),"modelId"in ue&&t(11,m=ue.modelId),"pane"in ue&&t(4,y=ue.pane)},o.$$.update=()=>{o.$$.dirty[0]&64&&(c||z())},[a,u,d,v,y,l,c,f,h,_,b,m,I,S,k,n,r,i,s,C,W,K,P,V,L,q,Z,Q,Y,te,F,j,x,J,ve,le,me,X]}class zT extends Ge{constructor(e){super(),We(this,e,BT,UT,Ye,{history:0,models:5,chatId:6,chatFiles:1,params:2,eventTarget:7,submitPrompt:8,stopResponse:9,showMessage:10,files:3,modelId:11,pane:4,openPane:19},null,[-1,-1])}get openPane(){return this.$$.ctx[19]}}function gf(o,e,t){const n=o.slice();return n[36]=e[t],n[38]=t,n}function mf(o){let e,t;return e=new qt({props:{content:"This chat won't appear in history and your messages will not be saved.",className:"w-full flex justify-center mb-0.5",placement:"top",$$slots:{default:[VT]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function VT(o){let e,t,n,r;return t=new Jp({props:{strokeWidth:"2.5",className:"size-5"}}),{c(){e=M("div"),oe(t.$$.fragment),n=Ie(" Temporary Chat"),this.h()},l(i){e=O(i,"DIV",{class:!0});var s=A(e);ae(t.$$.fragment,s),n=Te(s," Temporary Chat"),s.forEach(p),this.h()},h(){g(e,"class","flex items-center gap-2 text-gray-500 font-medium text-lg my-2 w-fit")},m(i,s){U(i,e,s),re(t,e,null),E(e,n),r=!0},p:Le,i(i){r||(T(t.$$.fragment,i),r=!0)},o(i){N(t.$$.fragment,i),r=!1},d(i){i&&p(e),ie(t)}}}function FT(o){let e,t,n,r,i,s;function a(){return o[23](o[38])}return{c(){e=M("button"),t=M("img"),r=$(),this.h()},l(l){e=O(l,"BUTTON",{});var c=A(e);t=O(c,"IMG",{crossorigin:!0,src:!0,class:!0,alt:!0,draggable:!0}),c.forEach(p),r=ee(l),this.h()},h(){var l,c,u;g(t,"crossorigin","anonymous"),xo(t.src,n=((u=(c=(l=o[36])==null?void 0:l.info)==null?void 0:c.meta)==null?void 0:u.profile_image_url)??(o[15].language==="dg-DG"?"/doge.png":`${vi}/static/favicon.png`))||g(t,"src",n),g(t,"class","size-9 @sm:size-10 rounded-full border-[1px] border-gray-100 dark:border-none"),g(t,"alt","logo"),g(t,"draggable","false")},m(l,c){U(l,e,c),E(e,t),U(l,r,c),i||(s=we(e,"click",a),i=!0)},p(l,c){var u,d,f;o=l,c[0]&40960&&!xo(t.src,n=((f=(d=(u=o[36])==null?void 0:u.info)==null?void 0:d.meta)==null?void 0:f.profile_image_url)??(o[15].language==="dg-DG"?"/doge.png":`${vi}/static/favicon.png`))&&g(t,"src",n)},d(l){l&&(p(e),p(r)),i=!1,s()}}}function pf(o){var n,r,i;let e,t;return e=new qt({props:{content:(((i=(r=(n=o[13][o[38]])==null?void 0:n.info)==null?void 0:r.meta)==null?void 0:i.tags)??[]).map(yf).join(", "),placement:"top",$$slots:{default:[FT]},$$scope:{ctx:o}}}),{c(){oe(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){re(e,s,a),t=!0},p(s,a){var c,u,d;const l={};a[0]&8192&&(l.content=(((d=(u=(c=s[13][s[38]])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.tags)??[]).map(yf).join(", ")),a[0]&57344|a[1]&256&&(l.$$scope={dirty:a,ctx:s}),e.$set(l)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){ie(e,s)}}}function KT(o){let e=o[15].t("Hello, {{name}}",{name:o[17].name})+"",t;return{c(){t=Ie(e)},l(n){t=Te(n,e)},m(n,r){U(n,t,r)},p(n,r){r[0]&163840&&e!==(e=n[15].t("Hello, {{name}}",{name:n[17].name})+"")&&Pe(t,e)},d(n){n&&p(t)}}}function GT(o){var n;let e=((n=o[13][o[14]])==null?void 0:n.name)+"",t;return{c(){t=Ie(e)},l(r){t=Te(r,e)},m(r,i){U(r,t,i)},p(r,i){var s;i[0]&24576&&e!==(e=((s=r[13][r[14]])==null?void 0:s.name)+"")&&Pe(t,e)},d(r){r&&p(t)}}}function _f(o){var s,a,l,c,u,d;let e,t,n,r;e=new qt({props:{className:" w-fit",content:jr.parse(Yr(((l=(a=(s=o[13][o[14]])==null?void 0:s.info)==null?void 0:a.meta)==null?void 0:l.description)??"")),placement:"top",$$slots:{default:[WT]},$$scope:{ctx:o}}});let i=((d=(u=(c=o[13][o[14]])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.user)&&bf(o);return{c(){oe(e.$$.fragment),t=$(),i&&i.c(),n=qe()},l(f){ae(e.$$.fragment,f),t=ee(f),i&&i.l(f),n=qe()},m(f,h){re(e,f,h),U(f,t,h),i&&i.m(f,h),U(f,n,h),r=!0},p(f,h){var b,v,m,y,w,I;const _={};h[0]&24576&&(_.content=jr.parse(Yr(((m=(v=(b=f[13][f[14]])==null?void 0:b.info)==null?void 0:v.meta)==null?void 0:m.description)??""))),h[0]&24576|h[1]&256&&(_.$$scope={dirty:h,ctx:f}),e.$set(_),(I=(w=(y=f[13][f[14]])==null?void 0:y.info)==null?void 0:w.meta)!=null&&I.user?i?i.p(f,h):(i=bf(f),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},i(f){r||(T(e.$$.fragment,f),r=!0)},o(f){N(e.$$.fragment,f),r=!1},d(f){f&&(p(t),p(n)),ie(e,f),i&&i.d(f)}}}function WT(o){var r,i,s;let e,t,n=jr.parse(Yr((s=(i=(r=o[13][o[14]])==null?void 0:r.info)==null?void 0:i.meta)==null?void 0:s.description))+"";return{c(){e=M("div"),t=new Cm(!1),this.h()},l(a){e=O(a,"DIV",{class:!0});var l=A(e);t=Em(l,!1),l.forEach(p),this.h()},h(){t.a=null,g(e,"class","mt-0.5 px-2 text-sm font-normal text-gray-500 dark:text-gray-400 line-clamp-2 max-w-xl markdown")},m(a,l){U(a,e,l),t.m(n,e)},p(a,l){var c,u,d;l[0]&24576&&n!==(n=jr.parse(Yr((d=(u=(c=a[13][a[14]])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.description))+"")&&t.p(n)},d(a){a&&p(e)}}}function bf(o){let e,t;function n(s,a){var l,c,u;return(u=(c=(l=s[13][s[14]])==null?void 0:l.info)==null?void 0:c.meta)!=null&&u.user.community?YT:qT}let r=n(o),i=r(o);return{c(){e=M("div"),t=Ie(`By
								`),i.c(),this.h()},l(s){e=O(s,"DIV",{class:!0});var a=A(e);t=Te(a,`By
								`),i.l(a),a.forEach(p),this.h()},h(){g(e,"class","mt-0.5 text-sm font-normal text-gray-400 dark:text-gray-500")},m(s,a){U(s,e,a),E(e,t),i.m(e,null)},p(s,a){r===(r=n(s))&&i?i.p(s,a):(i.d(1),i=r(s),i&&(i.c(),i.m(e,null)))},d(s){s&&p(e),i.d()}}}function qT(o){var n,r,i;let e=((i=(r=(n=o[13][o[14]])==null?void 0:n.info)==null?void 0:r.meta)==null?void 0:i.user.name)+"",t;return{c(){t=Ie(e)},l(s){t=Te(s,e)},m(s,a){U(s,t,a)},p(s,a){var l,c,u;a[0]&24576&&e!==(e=((u=(c=(l=s[13][s[14]])==null?void 0:l.info)==null?void 0:c.meta)==null?void 0:u.user.name)+"")&&Pe(t,e)},d(s){s&&p(t)}}}function YT(o){var i,s,a,l,c,u,d,f,h;let e,t=((a=(s=(i=o[13][o[14]])==null?void 0:i.info)==null?void 0:s.meta)!=null&&a.user.name?(u=(c=(l=o[13][o[14]])==null?void 0:l.info)==null?void 0:c.meta)==null?void 0:u.user.name:`@${(h=(f=(d=o[13][o[14]])==null?void 0:d.info)==null?void 0:f.meta)==null?void 0:h.user.username}`)+"",n,r;return{c(){e=M("a"),n=Ie(t),this.h()},l(_){e=O(_,"A",{href:!0});var b=A(e);n=Te(b,t),b.forEach(p),this.h()},h(){var _,b,v;g(e,"href",r="https://openwebui.com/m/"+((v=(b=(_=o[13][o[14]])==null?void 0:_.info)==null?void 0:b.meta)==null?void 0:v.user.username))},m(_,b){U(_,e,b),E(e,n)},p(_,b){var v,m,y,w,I,S,k,C,R,D,H,z;b[0]&24576&&t!==(t=((y=(m=(v=_[13][_[14]])==null?void 0:v.info)==null?void 0:m.meta)!=null&&y.user.name?(S=(I=(w=_[13][_[14]])==null?void 0:w.info)==null?void 0:I.meta)==null?void 0:S.user.name:`@${(R=(C=(k=_[13][_[14]])==null?void 0:k.info)==null?void 0:C.meta)==null?void 0:R.user.username}`)+"")&&Pe(n,t),b[0]&24576&&r!==(r="https://openwebui.com/m/"+((z=(H=(D=_[13][_[14]])==null?void 0:D.info)==null?void 0:H.meta)==null?void 0:z.user.username))&&g(e,"href",r)},d(_){_&&p(e)}}}function jT(o){var et,ot,Et,Dt,Yt,Pt,Zt,jt,Ht,Qt;let e,t,n,r,i,s,a,l,c,u,d,f,h,_,b,v,m,y,w,I,S,k,C,R,D,H,z,W,K,P,V,L,q,Z=o[16]&&mf(o),Q=Ct(o[13]),Y=[];for(let se=0;se<Q.length;se+=1)Y[se]=pf(gf(o,Q,se));const te=se=>N(Y[se],1,1,()=>{Y[se]=null});function F(se,Qe){var rt;return(rt=se[13][se[14]])!=null&&rt.name?GT:KT}let j=F(o),x=j(o),J=(((Et=(ot=(et=o[13][o[14]])==null?void 0:et.info)==null?void 0:ot.meta)==null?void 0:Et.description)??null)&&_f(o);function ve(se){o[24](se)}function le(se){o[25](se)}function me(se){o[26](se)}function X(se){o[27](se)}function ue(se){o[28](se)}function be(se){o[29](se)}function Re(se){o[30](se)}function Fe(se){o[31](se)}let he={history:o[12],selectedModels:o[11],transparentBackground:o[8],stopResponse:o[10],createMessagePair:o[9],placeholder:o[15].t("How can I help you today?")};return o[3]!==void 0&&(he.files=o[3]),o[2]!==void 0&&(he.prompt=o[2]),o[0]!==void 0&&(he.autoScroll=o[0]),o[4]!==void 0&&(he.selectedToolIds=o[4]),o[5]!==void 0&&(he.imageGenerationEnabled=o[5]),o[6]!==void 0&&(he.codeInterpreterEnabled=o[6]),o[7]!==void 0&&(he.webSearchEnabled=o[7]),o[1]!==void 0&&(he.atSelectedModel=o[1]),y=new Ng({props:he}),ze.push(()=>nt(y,"files",ve)),ze.push(()=>nt(y,"prompt",le)),ze.push(()=>nt(y,"autoScroll",me)),ze.push(()=>nt(y,"selectedToolIds",X)),ze.push(()=>nt(y,"imageGenerationEnabled",ue)),ze.push(()=>nt(y,"codeInterpreterEnabled",be)),ze.push(()=>nt(y,"webSearchEnabled",Re)),ze.push(()=>nt(y,"atSelectedModel",Fe)),y.$on("upload",o[32]),y.$on("submit",o[33]),y.$on("createNewChat",o[34]),V=new Xp({props:{suggestionPrompts:((Pt=(Yt=(Dt=o[1])==null?void 0:Dt.info)==null?void 0:Yt.meta)==null?void 0:Pt.suggestion_prompts)??((Ht=(jt=(Zt=o[13][o[14]])==null?void 0:Zt.info)==null?void 0:jt.meta)==null?void 0:Ht.suggestion_prompts)??((Qt=o[18])==null?void 0:Qt.default_prompt_suggestions)??[],inputValue:o[2]}}),V.$on("select",o[35]),{c(){e=M("div"),Z&&Z.c(),t=$(),n=M("div"),r=M("div"),i=M("div"),s=M("div"),a=M("div");for(let se=0;se<Y.length;se+=1)Y[se].c();c=$(),u=M("div"),x.c(),f=$(),h=M("div"),_=M("div"),J&&J.c(),v=$(),m=M("div"),oe(y.$$.fragment),W=$(),K=M("div"),P=M("div"),oe(V.$$.fragment),this.h()},l(se){e=O(se,"DIV",{class:!0});var Qe=A(e);Z&&Z.l(Qe),t=ee(Qe),n=O(Qe,"DIV",{class:!0});var rt=A(n);r=O(rt,"DIV",{class:!0});var pt=A(r);i=O(pt,"DIV",{class:!0});var Ue=A(i);s=O(Ue,"DIV",{class:!0});var en=A(s);a=O(en,"DIV",{class:!0});var At=A(a);for(let Nt=0;Nt<Y.length;Nt+=1)Y[Nt].l(At);At.forEach(p),en.forEach(p),c=ee(Ue),u=O(Ue,"DIV",{class:!0});var pe=A(u);x.l(pe),pe.forEach(p),Ue.forEach(p),f=ee(pt),h=O(pt,"DIV",{class:!0});var Xe=A(h);_=O(Xe,"DIV",{});var Be=A(_);J&&J.l(Be),Be.forEach(p),Xe.forEach(p),v=ee(pt),m=O(pt,"DIV",{class:!0});var Ze=A(m);ae(y.$$.fragment,Ze),Ze.forEach(p),pt.forEach(p),rt.forEach(p),W=ee(Qe),K=O(Qe,"DIV",{class:!0});var Tt=A(K);P=O(Tt,"DIV",{class:!0});var St=A(P);ae(V.$$.fragment,St),St.forEach(p),Tt.forEach(p),Qe.forEach(p),this.h()},h(){g(a,"class","flex -space-x-4 mb-0.5"),g(s,"class","flex shrink-0 justify-center"),g(u,"class","text-3xl @sm:text-4xl line-clamp-1"),g(i,"class","flex flex-row justify-center gap-3 @sm:gap-3.5 w-fit px-5"),g(h,"class","flex mt-1 mb-2"),g(m,"class",z="text-base font-normal @md:max-w-3xl w-full py-3 "+(o[1]?"mt-2":"")),g(r,"class","w-full flex flex-col justify-center items-center"),g(n,"class","w-full text-3xl text-gray-800 dark:text-gray-100 text-center flex items-center gap-4 font-primary"),g(P,"class","mx-5"),g(K,"class","mx-auto max-w-2xl font-primary"),g(e,"class","m-auto w-full max-w-6xl px-2 @2xl:px-20 translate-y-6 py-24 text-center")},m(se,Qe){U(se,e,Qe),Z&&Z.m(e,null),E(e,t),E(e,n),E(n,r),E(r,i),E(i,s),E(s,a);for(let rt=0;rt<Y.length;rt+=1)Y[rt]&&Y[rt].m(a,null);E(i,c),E(i,u),x.m(u,null),E(r,f),E(r,h),E(h,_),J&&J.m(_,null),E(r,v),E(r,m),re(y,m,null),E(e,W),E(e,K),E(K,P),re(V,P,null),q=!0},p(se,Qe){var Ue,en,At,pe,Xe,Be,Ze,Tt,St,Nt;if(se[16]?Z?Qe[0]&65536&&T(Z,1):(Z=mf(se),Z.c(),T(Z,1),Z.m(e,t)):Z&&(De(),N(Z,1,1,()=>{Z=null}),He()),Qe[0]&57344){Q=Ct(se[13]);let _t;for(_t=0;_t<Q.length;_t+=1){const yn=gf(se,Q,_t);Y[_t]?(Y[_t].p(yn,Qe),T(Y[_t],1)):(Y[_t]=pf(yn),Y[_t].c(),T(Y[_t],1),Y[_t].m(a,null))}for(De(),_t=Q.length;_t<Y.length;_t+=1)te(_t);He()}j===(j=F(se))&&x?x.p(se,Qe):(x.d(1),x=j(se),x&&(x.c(),x.m(u,null))),((At=(en=(Ue=se[13][se[14]])==null?void 0:Ue.info)==null?void 0:en.meta)==null?void 0:At.description)??null?J?(J.p(se,Qe),Qe[0]&24576&&T(J,1)):(J=_f(se),J.c(),T(J,1),J.m(_,null)):J&&(De(),N(J,1,1,()=>{J=null}),He());const rt={};Qe[0]&4096&&(rt.history=se[12]),Qe[0]&2048&&(rt.selectedModels=se[11]),Qe[0]&256&&(rt.transparentBackground=se[8]),Qe[0]&1024&&(rt.stopResponse=se[10]),Qe[0]&512&&(rt.createMessagePair=se[9]),Qe[0]&32768&&(rt.placeholder=se[15].t("How can I help you today?")),!w&&Qe[0]&8&&(w=!0,rt.files=se[3],tt(()=>w=!1)),!I&&Qe[0]&4&&(I=!0,rt.prompt=se[2],tt(()=>I=!1)),!S&&Qe[0]&1&&(S=!0,rt.autoScroll=se[0],tt(()=>S=!1)),!k&&Qe[0]&16&&(k=!0,rt.selectedToolIds=se[4],tt(()=>k=!1)),!C&&Qe[0]&32&&(C=!0,rt.imageGenerationEnabled=se[5],tt(()=>C=!1)),!R&&Qe[0]&64&&(R=!0,rt.codeInterpreterEnabled=se[6],tt(()=>R=!1)),!D&&Qe[0]&128&&(D=!0,rt.webSearchEnabled=se[7],tt(()=>D=!1)),!H&&Qe[0]&2&&(H=!0,rt.atSelectedModel=se[1],tt(()=>H=!1)),y.$set(rt),(!q||Qe[0]&2&&z!==(z="text-base font-normal @md:max-w-3xl w-full py-3 "+(se[1]?"mt-2":"")))&&g(m,"class",z);const pt={};Qe[0]&286722&&(pt.suggestionPrompts=((Be=(Xe=(pe=se[1])==null?void 0:pe.info)==null?void 0:Xe.meta)==null?void 0:Be.suggestion_prompts)??((St=(Tt=(Ze=se[13][se[14]])==null?void 0:Ze.info)==null?void 0:Tt.meta)==null?void 0:St.suggestion_prompts)??((Nt=se[18])==null?void 0:Nt.default_prompt_suggestions)??[]),Qe[0]&4&&(pt.inputValue=se[2]),V.$set(pt)},i(se){if(!q){T(Z);for(let Qe=0;Qe<Q.length;Qe+=1)T(Y[Qe]);se&&(l||Do(()=>{l=Ur(a,Wi,{duration:100}),l.start()})),se&&(d||Do(()=>{d=Ur(u,Wi,{duration:100}),d.start()})),T(J),se&&(b||Do(()=>{b=Ur(_,Wi,{duration:100,delay:50}),b.start()})),T(y.$$.fragment,se),T(V.$$.fragment,se),se&&(L||Do(()=>{L=Ur(K,Wi,{duration:200,delay:200}),L.start()})),q=!0}},o(se){N(Z),Y=Y.filter(Boolean);for(let Qe=0;Qe<Y.length;Qe+=1)N(Y[Qe]);N(J),N(y.$$.fragment,se),N(V.$$.fragment,se),q=!1},d(se){se&&p(e),Z&&Z.d(),Fn(Y,se),x.d(),J&&J.d(),ie(y),ie(V)}}}const yf=o=>o.name.toUpperCase();function QT(o,e,t){let n,r,i,s,a;fe(o,Tr,j=>t(22,n=j)),fe(o,qr,j=>t(16,i=j)),fe(o,er,j=>t(17,s=j)),fe(o,ti,j=>t(18,a=j));const l=An(),c=fn("i18n");fe(o,c,j=>t(15,r=j));let{transparentBackground:u=!1}=e,{createMessagePair:d}=e,{stopResponse:f}=e,{autoScroll:h=!1}=e,{atSelectedModel:_}=e,{selectedModels:b}=e,{history:v}=e,{prompt:m=""}=e,{files:y=[]}=e,{selectedToolIds:w=[]}=e,{imageGenerationEnabled:I=!1}=e,{codeInterpreterEnabled:S=!1}=e,{webSearchEnabled:k=!1}=e,C=[];const R=async j=>{let x=j;if(j.includes("{{CLIPBOARD}}")){const le=await navigator.clipboard.readText().catch(me=>($e.error(r.t("Failed to read clipboard contents")),"{{CLIPBOARD}}"));x=j.replaceAll("{{CLIPBOARD}}",le),console.log("Clipboard text:",le,x)}t(2,m=x),console.log(m),await it();const J=document.getElementById("chat-input-container"),ve=document.getElementById("chat-input");J&&(J.style.height="",J.style.height=Math.min(J.scrollHeight,200)+"px"),await it(),ve&&(ve.focus(),ve.dispatchEvent(new Event("input"))),await it()};let D=0;Kn(()=>{});const H=j=>{t(14,D=j)};function z(j){y=j,t(3,y)}function W(j){m=j,t(2,m)}function K(j){h=j,t(0,h)}function P(j){w=j,t(4,w)}function V(j){I=j,t(5,I)}function L(j){S=j,t(6,S)}function q(j){k=j,t(7,k)}function Z(j){_=j,t(1,_)}const Q=j=>{l("upload",j.detail)},Y=j=>{l("submit",j.detail)},te=async j=>{l("createNewChat",j.detail)},F=j=>{R(j.detail)};return o.$$set=j=>{"transparentBackground"in j&&t(8,u=j.transparentBackground),"createMessagePair"in j&&t(9,d=j.createMessagePair),"stopResponse"in j&&t(10,f=j.stopResponse),"autoScroll"in j&&t(0,h=j.autoScroll),"atSelectedModel"in j&&t(1,_=j.atSelectedModel),"selectedModels"in j&&t(11,b=j.selectedModels),"history"in j&&t(12,v=j.history),"prompt"in j&&t(2,m=j.prompt),"files"in j&&t(3,y=j.files),"selectedToolIds"in j&&t(4,w=j.selectedToolIds),"imageGenerationEnabled"in j&&t(5,I=j.imageGenerationEnabled),"codeInterpreterEnabled"in j&&t(6,S=j.codeInterpreterEnabled),"webSearchEnabled"in j&&t(7,k=j.webSearchEnabled)},o.$$.update=()=>{o.$$.dirty[0]&4196352&&t(13,C=b.map(j=>n.find(x=>x.id===j))),o.$$.dirty[0]&10240&&b.length>0&&t(14,D=C.length-1)},[h,_,m,y,w,I,S,k,u,d,f,b,v,C,D,r,i,s,a,l,c,R,n,H,z,W,K,P,V,L,q,Z,Q,Y,te,F]}class XT extends Ge{constructor(e){super(),We(this,e,QT,jT,Ye,{transparentBackground:8,createMessagePair:9,stopResponse:10,autoScroll:0,atSelectedModel:1,selectedModels:11,history:12,prompt:2,files:3,selectedToolIds:4,imageGenerationEnabled:5,codeInterpreterEnabled:6,webSearchEnabled:7},null,[-1,-1])}}const{document:ya}=Rf;function vf(o,e,t){const n=o.slice();return n[122]=e[t],n}function JT(o){let e,t,n,r;return n=new Hs({}),{c(){e=M("div"),t=M("div"),oe(n.$$.fragment),this.h()},l(i){e=O(i,"DIV",{class:!0});var s=A(e);t=O(s,"DIV",{class:!0});var a=A(t);ae(n.$$.fragment,a),a.forEach(p),s.forEach(p),this.h()},h(){g(t,"class","m-auto"),g(e,"class","flex items-center justify-center h-full w-full")},m(i,s){U(i,e,s),E(e,t),re(n,t,null),r=!0},p:Le,i(i){r||(T(n.$$.fragment,i),r=!0)},o(i){N(n.$$.fragment,i),r=!1},d(i){i&&p(e),ie(n)}}}function ZT(o){var u;let e,t,n,r,i,s,a=(((u=o[28])==null?void 0:u.backgroundImageUrl)??null)&&wf(o);function l(d){o[57](d)}let c={chat:{id:o[27],chat:{title:o[32],models:o[2],system:o[28].system??void 0,params:o[26],history:o[22],timestamp:Date.now()}},title:o[32],shareEnabled:!!o[22].currentId,initNewChat:o[42]};return o[2]!==void 0&&(c.selectedModels=o[2]),t=new kk({props:c}),o[56](t),ze.push(()=>nt(t,"selectedModels",l)),i=new Om({props:{direction:"horizontal",class:"w-full h-full",$$slots:{default:[tS]},$$scope:{ctx:o}}}),{c(){a&&a.c(),e=$(),oe(t.$$.fragment),r=$(),oe(i.$$.fragment)},l(d){a&&a.l(d),e=ee(d),ae(t.$$.fragment,d),r=ee(d),ae(i.$$.fragment,d)},m(d,f){a&&a.m(d,f),U(d,e,f),re(t,d,f),U(d,r,f),re(i,d,f),s=!0},p(d,f){var b;((b=d[28])==null?void 0:b.backgroundImageUrl)??null?a?a.p(d,f):(a=wf(d),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null);const h={};f[0]&473956356|f[1]&2&&(h.chat={id:d[27],chat:{title:d[32],models:d[2],system:d[28].system??void 0,params:d[26],history:d[22],timestamp:Date.now()}}),f[1]&2&&(h.title=d[32]),f[0]&4194304&&(h.shareEnabled=!!d[22].currentId),!n&&f[0]&4&&(n=!0,h.selectedModels=d[2],tt(()=>n=!1)),t.$set(h);const _={};f[0]&2147353068|f[1]&17|f[4]&2&&(_.$$scope={dirty:f,ctx:d}),i.$set(_)},i(d){s||(T(t.$$.fragment,d),T(i.$$.fragment,d),s=!0)},o(d){N(t.$$.fragment,d),N(i.$$.fragment,d),s=!1},d(d){d&&(p(e),p(r)),a&&a.d(d),o[56](null),ie(t,d),ie(i,d)}}}function wf(o){let e,t,n,r;return{c(){e=M("div"),n=$(),r=M("div"),this.h()},l(i){e=O(i,"DIV",{class:!0,style:!0}),A(e).forEach(p),n=ee(i),r=O(i,"DIV",{class:!0}),A(r).forEach(p),this.h()},h(){g(e,"class",t="absolute "+(o[34]?"md:max-w-[calc(100%-260px)] md:translate-x-[260px]":"")+" top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat"),lt(e,"background-image","url("+o[28].backgroundImageUrl+")"),g(r,"class","absolute top-0 left-0 w-full h-full bg-linear-to-t from-white to-white/85 dark:from-gray-900 dark:to-gray-900/90 z-0")},m(i,s){U(i,e,s),U(i,n,s),U(i,r,s)},p(i,s){s[1]&8&&t!==(t="absolute "+(i[34]?"md:max-w-[calc(100%-260px)] md:translate-x-[260px]":"")+" top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat")&&g(e,"class",t),s[0]&268435456&&lt(e,"background-image","url("+i[28].backgroundImageUrl+")")},d(i){i&&(p(e),p(n),p(r))}}}function kf(o){var d,f,h,_,b,v,m;let e,t,n,r,i,s=(((f=(d=o[31])==null?void 0:d.license_metadata)==null?void 0:f.type)??null)==="trial"&&Cf(o),a=(((_=(h=o[31])==null?void 0:h.license_metadata)==null?void 0:_.seats)??null)!==null&&((b=o[31])==null?void 0:b.user_count)>((m=(v=o[31])==null?void 0:v.license_metadata)==null?void 0:m.seats)&&Ef(o),l=Ct(o[35].filter(o[58])),c=[];for(let y=0;y<l.length;y+=1)c[y]=If(vf(o,l,y));const u=y=>N(c[y],1,1,()=>{c[y]=null});return{c(){e=M("div"),t=M("div"),s&&s.c(),n=$(),a&&a.c(),r=$();for(let y=0;y<c.length;y+=1)c[y].c();this.h()},l(y){e=O(y,"DIV",{class:!0});var w=A(e);t=O(w,"DIV",{class:!0});var I=A(t);s&&s.l(I),n=ee(I),a&&a.l(I),r=ee(I);for(let S=0;S<c.length;S+=1)c[S].l(I);I.forEach(p),w.forEach(p),this.h()},h(){g(t,"class","flex flex-col gap-1 w-full"),g(e,"class","absolute top-12 left-0 right-0 w-full z-30")},m(y,w){U(y,e,w),E(e,t),s&&s.m(t,null),E(t,n),a&&a.m(t,null),E(t,r);for(let I=0;I<c.length;I+=1)c[I]&&c[I].m(t,null);i=!0},p(y,w){var I,S,k,C,R,D,H;if((((S=(I=y[31])==null?void 0:I.license_metadata)==null?void 0:S.type)??null)==="trial"?s?(s.p(y,w),w[1]&1&&T(s,1)):(s=Cf(y),s.c(),T(s,1),s.m(t,n)):s&&(De(),N(s,1,1,()=>{s=null}),He()),(((C=(k=y[31])==null?void 0:k.license_metadata)==null?void 0:C.seats)??null)!==null&&((R=y[31])==null?void 0:R.user_count)>((H=(D=y[31])==null?void 0:D.license_metadata)==null?void 0:H.seats)?a?(a.p(y,w),w[1]&1&&T(a,1)):(a=Ef(y),a.c(),T(a,1),a.m(t,r)):a&&(De(),N(a,1,1,()=>{a=null}),He()),w[1]&16){l=Ct(y[35].filter(y[58]));let z;for(z=0;z<l.length;z+=1){const W=vf(y,l,z);c[z]?(c[z].p(W,w),T(c[z],1)):(c[z]=If(W),c[z].c(),T(c[z],1),c[z].m(t,null))}for(De(),z=l.length;z<c.length;z+=1)u(z);He()}},i(y){if(!i){T(s),T(a);for(let w=0;w<l.length;w+=1)T(c[w]);i=!0}},o(y){N(s),N(a),c=c.filter(Boolean);for(let w=0;w<c.length;w+=1)N(c[w]);i=!1},d(y){y&&p(e),s&&s.d(),a&&a.d(),Fn(c,y)}}}function Cf(o){let e,t;return e=new $a({props:{banner:{type:"info",title:"Trial License",content:o[29].t("You are currently using a trial license. Please contact support to upgrade your license.")}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&536870912&&(i.banner={type:"info",title:"Trial License",content:n[29].t("You are currently using a trial license. Please contact support to upgrade your license.")}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function Ef(o){let e,t;return e=new $a({props:{banner:{type:"error",title:"License Error",content:o[29].t("Exceeded the number of seats in your license. Please contact support to increase the number of seats.")}}}),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[0]&536870912&&(i.banner={type:"error",title:"License Error",content:n[29].t("Exceeded the number of seats in your license. Please contact support to increase the number of seats.")}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function If(o){let e,t;return e=new $a({props:{banner:o[122]}}),e.$on("dismiss",o[59]),{c(){oe(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,r){re(e,n,r),t=!0},p(n,r){const i={};r[1]&16&&(i.banner=n[122]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function xT(o){var S;let e,t,n,r,i,s,a,l,c,u,d;function f(k){o[77](k)}function h(k){o[78](k)}function _(k){o[79](k)}function b(k){o[80](k)}function v(k){o[81](k)}function m(k){o[82](k)}function y(k){o[83](k)}function w(k){o[84](k)}let I={history:o[22],selectedModels:o[2],transparentBackground:((S=o[28])==null?void 0:S.backgroundImageUrl)??!1,stopResponse:o[48],createMessagePair:o[44]};return o[25]!==void 0&&(I.files=o[25]),o[23]!==void 0&&(I.prompt=o[23]),o[7]!==void 0&&(I.autoScroll=o[7]),o[18]!==void 0&&(I.selectedToolIds=o[18]),o[19]!==void 0&&(I.imageGenerationEnabled=o[19]),o[21]!==void 0&&(I.codeInterpreterEnabled=o[21]),o[20]!==void 0&&(I.webSearchEnabled=o[20]),o[3]!==void 0&&(I.atSelectedModel=o[3]),t=new XT({props:I}),ze.push(()=>nt(t,"files",f)),ze.push(()=>nt(t,"prompt",h)),ze.push(()=>nt(t,"autoScroll",_)),ze.push(()=>nt(t,"selectedToolIds",b)),ze.push(()=>nt(t,"imageGenerationEnabled",v)),ze.push(()=>nt(t,"codeInterpreterEnabled",m)),ze.push(()=>nt(t,"webSearchEnabled",y)),ze.push(()=>nt(t,"atSelectedModel",w)),t.$on("upload",o[85]),t.$on("submit",o[86]),t.$on("createNewChat",o[87]),{c(){e=M("div"),oe(t.$$.fragment),this.h()},l(k){e=O(k,"DIV",{class:!0});var C=A(e);ae(t.$$.fragment,C),C.forEach(p),this.h()},h(){g(e,"class","overflow-auto w-full h-full flex items-center")},m(k,C){U(k,e,C),re(t,e,null),d=!0},p(k,C){var D;const R={};C[0]&4194304&&(R.history=k[22]),C[0]&4&&(R.selectedModels=k[2]),C[0]&268435456&&(R.transparentBackground=((D=k[28])==null?void 0:D.backgroundImageUrl)??!1),!n&&C[0]&33554432&&(n=!0,R.files=k[25],tt(()=>n=!1)),!r&&C[0]&8388608&&(r=!0,R.prompt=k[23],tt(()=>r=!1)),!i&&C[0]&128&&(i=!0,R.autoScroll=k[7],tt(()=>i=!1)),!s&&C[0]&262144&&(s=!0,R.selectedToolIds=k[18],tt(()=>s=!1)),!a&&C[0]&524288&&(a=!0,R.imageGenerationEnabled=k[19],tt(()=>a=!1)),!l&&C[0]&2097152&&(l=!0,R.codeInterpreterEnabled=k[21],tt(()=>l=!1)),!c&&C[0]&1048576&&(c=!0,R.webSearchEnabled=k[20],tt(()=>c=!1)),!u&&C[0]&8&&(u=!0,R.atSelectedModel=k[3],tt(()=>u=!1)),t.$set(R)},i(k){d||(T(t.$$.fragment,k),d=!0)},o(k){N(t.$$.fragment,k),d=!1},d(k){k&&p(e),ie(t)}}}function $T(o){var te;let e,t,n,r,i,s,a,l,c,u,d,f,h,_,b,v,m,y,w,I="",S,k,C;function R(F){o[60](F)}function D(F){o[61](F)}function H(F){o[62](F)}let z={chatId:o[27],selectedModels:o[2],atSelectedModel:o[3],sendPrompt:o[47],showMessage:o[38],submitMessage:o[49],continueResponse:o[51],regenerateResponse:o[50],mergeResponses:o[52],chatActionHandler:o[43],addMessages:o[45],bottomPadding:o[25].length>0};o[22]!==void 0&&(z.history=o[22]),o[7]!==void 0&&(z.autoScroll=o[7]),o[23]!==void 0&&(z.prompt=o[23]),n=new Zp({props:z}),ze.push(()=>nt(n,"history",R)),ze.push(()=>nt(n,"autoScroll",D)),ze.push(()=>nt(n,"prompt",H));function W(F){o[66](F)}function K(F){o[67](F)}function P(F){o[68](F)}function V(F){o[69](F)}function L(F){o[70](F)}function q(F){o[71](F)}function Z(F){o[72](F)}function Q(F){o[73](F)}let Y={history:o[22],selectedModels:o[2],transparentBackground:((te=o[28])==null?void 0:te.backgroundImageUrl)??!1,stopResponse:o[48],createMessagePair:o[44],onChange:o[65]};return o[25]!==void 0&&(Y.files=o[25]),o[23]!==void 0&&(Y.prompt=o[23]),o[7]!==void 0&&(Y.autoScroll=o[7]),o[18]!==void 0&&(Y.selectedToolIds=o[18]),o[19]!==void 0&&(Y.imageGenerationEnabled=o[19]),o[21]!==void 0&&(Y.codeInterpreterEnabled=o[21]),o[20]!==void 0&&(Y.webSearchEnabled=o[20]),o[3]!==void 0&&(Y.atSelectedModel=o[3]),c=new Ng({props:Y}),ze.push(()=>nt(c,"files",W)),ze.push(()=>nt(c,"prompt",K)),ze.push(()=>nt(c,"autoScroll",P)),ze.push(()=>nt(c,"selectedToolIds",V)),ze.push(()=>nt(c,"imageGenerationEnabled",L)),ze.push(()=>nt(c,"codeInterpreterEnabled",q)),ze.push(()=>nt(c,"webSearchEnabled",Z)),ze.push(()=>nt(c,"atSelectedModel",Q)),c.$on("upload",o[74]),c.$on("submit",o[75]),c.$on("createNewChat",o[76]),{c(){e=M("div"),t=M("div"),oe(n.$$.fragment),a=$(),l=M("div"),oe(c.$$.fragment),y=$(),w=M("div"),w.innerHTML=I,this.h()},l(F){e=O(F,"DIV",{class:!0,id:!0});var j=A(e);t=O(j,"DIV",{class:!0});var x=A(t);ae(n.$$.fragment,x),x.forEach(p),j.forEach(p),a=ee(F),l=O(F,"DIV",{class:!0});var J=A(l);ae(c.$$.fragment,J),y=ee(J),w=O(J,"DIV",{class:!0,"data-svelte-h":!0}),yt(w)!=="svelte-1t2gtm5"&&(w.innerHTML=I),J.forEach(p),this.h()},h(){g(t,"class","h-full w-full flex flex-col"),g(e,"class","pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full z-10 scrollbar-hidden"),g(e,"id","messages-container"),g(w,"class","absolute bottom-1 text-xs text-gray-500 text-center line-clamp-1 right-0 left-0"),g(l,"class","pb-[1rem]")},m(F,j){U(F,e,j),E(e,t),re(n,t,null),o[63](e),U(F,a,j),U(F,l,j),re(c,l,null),E(l,y),E(l,w),S=!0,k||(C=we(e,"scroll",o[64]),k=!0)},p(F,j){var ve;const x={};j[0]&134217728&&(x.chatId=F[27]),j[0]&4&&(x.selectedModels=F[2]),j[0]&8&&(x.atSelectedModel=F[3]),j[0]&33554432&&(x.bottomPadding=F[25].length>0),!r&&j[0]&4194304&&(r=!0,x.history=F[22],tt(()=>r=!1)),!i&&j[0]&128&&(i=!0,x.autoScroll=F[7],tt(()=>i=!1)),!s&&j[0]&8388608&&(s=!0,x.prompt=F[23],tt(()=>s=!1)),n.$set(x);const J={};j[0]&4194304&&(J.history=F[22]),j[0]&4&&(J.selectedModels=F[2]),j[0]&268435456&&(J.transparentBackground=((ve=F[28])==null?void 0:ve.backgroundImageUrl)??!1),j[0]&134217728&&(J.onChange=F[65]),!u&&j[0]&33554432&&(u=!0,J.files=F[25],tt(()=>u=!1)),!d&&j[0]&8388608&&(d=!0,J.prompt=F[23],tt(()=>d=!1)),!f&&j[0]&128&&(f=!0,J.autoScroll=F[7],tt(()=>f=!1)),!h&&j[0]&262144&&(h=!0,J.selectedToolIds=F[18],tt(()=>h=!1)),!_&&j[0]&524288&&(_=!0,J.imageGenerationEnabled=F[19],tt(()=>_=!1)),!b&&j[0]&2097152&&(b=!0,J.codeInterpreterEnabled=F[21],tt(()=>b=!1)),!v&&j[0]&1048576&&(v=!0,J.webSearchEnabled=F[20],tt(()=>v=!1)),!m&&j[0]&8&&(m=!0,J.atSelectedModel=F[3],tt(()=>m=!1)),c.$set(J)},i(F){S||(T(n.$$.fragment,F),T(c.$$.fragment,F),S=!0)},o(F){N(n.$$.fragment,F),N(c.$$.fragment,F),S=!1},d(F){F&&(p(e),p(a),p(l)),ie(n),o[63](null),ie(c),k=!1,C()}}}function eS(o){var d,f,h,_,b,v,m;let e,t,n,r,i,s,a=!o[22].currentId&&!o[27]&&o[2].length<=1&&(o[35].length>0||(((f=(d=o[31])==null?void 0:d.license_metadata)==null?void 0:f.type)??null)==="trial"||(((_=(h=o[31])==null?void 0:h.license_metadata)==null?void 0:_.seats)??null)!==null&&((b=o[31])==null?void 0:b.user_count)>((m=(v=o[31])==null?void 0:v.license_metadata)==null?void 0:m.seats))&&kf(o);const l=[$T,xT],c=[];function u(y,w){var I;return w[0]&272629760&&(n=null),n==null&&(n=((I=y[28])==null?void 0:I.landingPageMode)==="chat"||ao(y[22],y[22].currentId).length>0),n?0:1}return r=u(o,[-1,-1,-1,-1,-1]),i=c[r]=l[r](o),{c(){a&&a.c(),e=$(),t=M("div"),i.c(),this.h()},l(y){a&&a.l(y),e=ee(y),t=O(y,"DIV",{class:!0});var w=A(t);i.l(w),w.forEach(p),this.h()},h(){g(t,"class","flex flex-col flex-auto z-10 w-full @container")},m(y,w){a&&a.m(y,w),U(y,e,w),U(y,t,w),c[r].m(t,null),s=!0},p(y,w){var S,k,C,R,D,H,z;!y[22].currentId&&!y[27]&&y[2].length<=1&&(y[35].length>0||(((k=(S=y[31])==null?void 0:S.license_metadata)==null?void 0:k.type)??null)==="trial"||(((R=(C=y[31])==null?void 0:C.license_metadata)==null?void 0:R.seats)??null)!==null&&((D=y[31])==null?void 0:D.user_count)>((z=(H=y[31])==null?void 0:H.license_metadata)==null?void 0:z.seats))?a?(a.p(y,w),w[0]&138412036|w[1]&17&&T(a,1)):(a=kf(y),a.c(),T(a,1),a.m(e.parentNode,e)):a&&(De(),N(a,1,1,()=>{a=null}),He());let I=r;r=u(y,w),r===I?c[r].p(y,w):(De(),N(c[I],1,1,()=>{c[I]=null}),He(),i=c[r],i?i.p(y,w):(i=c[r]=l[r](y),i.c()),T(i,1),i.m(t,null))},i(y){s||(T(a),T(i),s=!0)},o(y){N(a),N(i),s=!1},d(y){y&&(p(e),p(t)),a&&a.d(y),c[r].d()}}}function tS(o){var v;let e,t,n,r,i,s,a,l,c;e=new Mf({props:{defaultSize:50,class:"h-full flex w-full relative",$$slots:{default:[eS]},$$scope:{ctx:o}}});function u(m){o[90](m)}function d(m){o[91](m)}function f(m){o[92](m)}function h(m){o[93](m)}function _(m){o[94](m)}let b={chatId:o[27],modelId:((v=o[17])==null?void 0:v.at(0))??null,models:o[17].reduce(o[88],[]),submitPrompt:o[46],stopResponse:o[48],showMessage:o[38],eventTarget:o[37]};return o[22]!==void 0&&(b.history=o[22]),o[24]!==void 0&&(b.chatFiles=o[24]),o[26]!==void 0&&(b.params=o[26]),o[25]!==void 0&&(b.files=o[25]),o[5]!==void 0&&(b.pane=o[5]),n=new zT({props:b}),o[89](n),ze.push(()=>nt(n,"history",u)),ze.push(()=>nt(n,"chatFiles",d)),ze.push(()=>nt(n,"params",f)),ze.push(()=>nt(n,"files",h)),ze.push(()=>nt(n,"pane",_)),{c(){oe(e.$$.fragment),t=$(),oe(n.$$.fragment)},l(m){ae(e.$$.fragment,m),t=ee(m),ae(n.$$.fragment,m)},m(m,y){re(e,m,y),U(m,t,y),re(n,m,y),c=!0},p(m,y){var S;const w={};y[0]&989593996|y[1]&17|y[4]&2&&(w.$$scope={dirty:y,ctx:m}),e.$set(w);const I={};y[0]&134217728&&(I.chatId=m[27]),y[0]&131072&&(I.modelId=((S=m[17])==null?void 0:S.at(0))??null),y[0]&1073872896&&(I.models=m[17].reduce(m[88],[])),!r&&y[0]&4194304&&(r=!0,I.history=m[22],tt(()=>r=!1)),!i&&y[0]&16777216&&(i=!0,I.chatFiles=m[24],tt(()=>i=!1)),!s&&y[0]&67108864&&(s=!0,I.params=m[26],tt(()=>s=!1)),!a&&y[0]&33554432&&(a=!0,I.files=m[25],tt(()=>a=!1)),!l&&y[0]&32&&(l=!0,I.pane=m[5],tt(()=>l=!1)),n.$set(I)},i(m){c||(T(e.$$.fragment,m),T(n.$$.fragment,m),c=!0)},o(m){N(e.$$.fragment,m),N(n.$$.fragment,m),c=!1},d(m){m&&p(t),ie(e,m),o[89](null),ie(n,m)}}}function nS(o){let e,t,n,r,i,s,a,l,c,u,d,f,h;ya.title=e=`
		`+(o[32]?`${o[32].length>30?`${o[32].slice(0,30)}...`:o[32]} | ${o[33]}`:`${o[33]}`)+`
	`;function _(w){o[53](w)}let b={title:o[11],message:o[12],input:o[13],inputPlaceholder:o[14],inputValue:o[15]};o[10]!==void 0&&(b.show=o[10]),s=new b_({props:b}),ze.push(()=>nt(s,"show",_)),s.$on("confirm",o[54]),s.$on("cancel",o[55]);const v=[ZT,JT],m=[];function y(w,I){return w[0]===""||!w[4]&&w[0]?0:w[4]?1:-1}return~(u=y(o))&&(d=m[u]=v[u](o)),{c(){t=$(),n=M("audio"),i=$(),oe(s.$$.fragment),l=$(),c=M("div"),d&&d.c(),this.h()},l(w){Im("svelte-8uu834",ya.head).forEach(p),t=ee(w),n=O(w,"AUDIO",{id:!0,src:!0,style:!0}),A(n).forEach(p),i=ee(w),ae(s.$$.fragment,w),l=ee(w),c=O(w,"DIV",{class:!0,id:!0});var S=A(c);d&&d.l(S),S.forEach(p),this.h()},h(){g(n,"id","audioElement"),xo(n.src,r="")||g(n,"src",r),lt(n,"display","none"),g(c,"class",f="h-screen max-h-[100dvh] transition-width duration-200 ease-in-out "+(o[34]?"  md:max-w-[calc(100%-260px)]":" ")+" w-full max-w-full flex flex-col"),g(c,"id","chat-container")},m(w,I){U(w,t,I),U(w,n,I),U(w,i,I),re(s,w,I),U(w,l,I),U(w,c,I),~u&&m[u].m(c,null),h=!0},p(w,I){(!h||I[1]&6)&&e!==(e=`
		`+(w[32]?`${w[32].length>30?`${w[32].slice(0,30)}...`:w[32]} | ${w[33]}`:`${w[33]}`)+`
	`)&&(ya.title=e);const S={};I[0]&2048&&(S.title=w[11]),I[0]&4096&&(S.message=w[12]),I[0]&8192&&(S.input=w[13]),I[0]&16384&&(S.inputPlaceholder=w[14]),I[0]&32768&&(S.inputValue=w[15]),!a&&I[0]&1024&&(a=!0,S.show=w[10],tt(()=>a=!1)),s.$set(S);let k=u;u=y(w),u===k?~u&&m[u].p(w,I):(d&&(De(),N(m[k],1,1,()=>{m[k]=null}),He()),~u?(d=m[u],d?d.p(w,I):(d=m[u]=v[u](w),d.c()),T(d,1),d.m(c,null)):d=null),(!h||I[1]&8&&f!==(f="h-screen max-h-[100dvh] transition-width duration-200 ease-in-out "+(w[34]?"  md:max-w-[calc(100%-260px)]":" ")+" w-full max-w-full flex flex-col"))&&g(c,"class",f)},i(w){h||(T(s.$$.fragment,w),T(d),h=!0)},o(w){N(s.$$.fragment,w),N(d),h=!1},d(w){w&&(p(t),p(n),p(i),p(l),p(c)),ie(s,w),~u&&m[u].d()}}}function oS(o,e,t){let n,r,i,s,a,l,c,u,d,f,h,_,b,v,m,y,w;fe(o,Or,B=>t(100,n=B)),fe(o,qr,B=>t(101,r=B)),fe(o,so,B=>t(27,i=B)),fe(o,qo,B=>t(28,s=B)),fe(o,Tr,B=>t(30,l=B)),fe(o,Um,B=>t(102,c=B)),fe(o,er,B=>t(103,u=B)),fe(o,ti,B=>t(31,d=B)),fe(o,Zn,B=>t(104,f=B)),fe(o,Pm,B=>t(105,h=B)),fe(o,Mi,B=>t(106,_=B)),fe(o,yr,B=>t(107,b=B)),fe(o,Gi,B=>t(32,v=B)),fe(o,Nf,B=>t(33,m=B)),fe(o,ka,B=>t(34,y=B)),fe(o,Bm,B=>t(35,w=B));const I=fn("i18n");fe(o,I,B=>t(29,a=B));let{chatIdProp:S=""}=e,k=!1;const C=new EventTarget;let R,D,H=!0,z,W,K=!1,P="",V="",L=!1,q="",Z="",Q=null,Y,te=[ra],F,j=[ra],x=[],J=!1,ve=!1,le=!1,me=null,X={messages:{},currentId:null},ue=null,be="",Re=[],Fe=[],he={},et=null,ot=Date.now();const Et=async()=>{if(et&&(await et.disconnect(),et=null),!i)return;et=new f1(`${zm}/message-stream/${i}/${Vm}`,Fm);let B="";et.messages.subscribe(async de=>{var Rt,un,Nn,Cn;if(de.length===0)return;const ke=de[de.length-1],Ke=ke.type,ge=Ke==="new_token",Ae=Ke==="message_end",Ce=Ke==="message_start";if((!ge||!((Rt=ke.data)!=null&&Rt.gid))&&!Ae&&!Ce)return;const je=(un=X.currentId)!=null&&un.includes("-")?X.currentId:(Nn=ke.data)==null?void 0:Nn.gid;if(!X.messages[je]){console.error("[streamClient.messages.subscribe]showed message is null");return}if(Ce){B="";return}const vt=((Cn=ke.data)==null?void 0:Cn.token)??"";ge?B+=vt:Ae&&console.log("Received message end:",B);const It={chat_id:i,message_id:je,data:{type:"chat:completion",data:{content:B,...Ae&&{done:!0}}}},Ut=Date.now();(Ut-ot>=100||Ae)&&(await Zt(It,mo=>{console.log("Chat event handled:",mo)}),ot=Ut),await it()}),et.error.subscribe(de=>{if(de===null){console.log("Connection closed");return}console.error("Error:",de),chatError.set(de),et.retryConnection()}),et.connect()},Dt=()=>{te.length===0||te.length===1&&te[0]===""||(sessionStorage.selectedModels=JSON.stringify(te),console.log("saveSessionSelectedModels",te,sessionStorage.selectedModels))},Yt=async()=>{var de,ke;if(b||yr.set(await xa(localStorage.token)),te.length!==1&&!F)return;const B=F??l.find(Ke=>Ke.id===te[0]);B&&t(18,x=(((ke=(de=B==null?void 0:B.info)==null?void 0:de.meta)==null?void 0:ke.toolIds)??[]).filter(Ke=>b.find(ge=>ge.id===Ke)))},Pt=async B=>{const de=JSON.parse(JSON.stringify(i));let ke=JSON.parse(JSON.stringify(B.id)),Ke=X.messages[ke].childrenIds;for(;Ke.length!==0;)ke=Ke.at(-1),Ke=X.messages[ke].childrenIds;t(22,X.currentId=ke,X),await it(),await it(),await it();const ge=document.getElementById(`message-${B.id}`);ge&&ge.scrollIntoView({behavior:"smooth"}),await it(),on(de,X)},Zt=async(B,de)=>{var ke,Ke;if(B.chat_id===i){await it();let ge=X.messages[B.message_id];if(ge){const Ae=((ke=B==null?void 0:B.data)==null?void 0:ke.type)??null,Ce=((Ke=B==null?void 0:B.data)==null?void 0:Ke.data)??null;if(Ae==="status")ge!=null&&ge.statusHistory?ge.statusHistory.push(Ce):ge.statusHistory=[Ce];else if(Ae==="source"||Ae==="citation")if((Ce==null?void 0:Ce.type)==="code_execution"){ge!=null&&ge.code_executions||(ge.code_executions=[]);const je=ge.code_executions.findIndex(dt=>dt.id===Ce.id);je!==-1?ge.code_executions[je]=Ce:ge.code_executions.push(Ce),ge.code_executions=ge.code_executions}else ge!=null&&ge.sources?ge.sources.push(Ce):ge.sources=[Ce];else if(Ae==="chat:completion")Xe(Ce,ge,B.chat_id);else if(Ae==="chat:title")Gi.set(Ce),Or.set(1),await Pr.set(await di(localStorage.token,n));else if(Ae==="chat:tags")me=await Ea(localStorage.token,i),va.set(await Ca(localStorage.token));else if(Ae==="message")ge.content+=Ce.content;else if(Ae==="replace")ge.content=Ce.content;else if(Ae==="action"){if(Ce.action==="continue"){const je=document.getElementById("continue-response-button");je&&je.click()}}else if(Ae==="confirmation")t(16,Q=de),t(13,L=!1),t(10,K=!0),t(11,P=Ce.title),t(12,V=Ce.message);else if(Ae==="execute"){t(16,Q=de);try{const dt=await new Function(`return (async () => { ${Ce.code} })()`)();de&&de(dt)}catch(je){console.error("Error executing code:",je)}}else if(Ae==="input")t(16,Q=de),t(13,L=!0),t(10,K=!0),t(11,P=Ce.title),t(12,V=Ce.message),t(14,q=Ce.placeholder),t(15,Z=(Ce==null?void 0:Ce.value)??"");else if(Ae==="notification"){const je=(Ce==null?void 0:Ce.type)??"info",dt=(Ce==null?void 0:Ce.content)??"";je==="success"?$e.success(dt):je==="error"?$e.error(dt):je==="warning"?$e.warning(dt):$e.info(dt)}else console.log("Unknown message type",Ce);t(22,X.messages[B.message_id]=ge,X)}}},jt=async B=>{if(B.origin===window.origin){if(B.data.type==="input:prompt"){console.debug(B.data.text);const de=document.getElementById("chat-input");de&&(t(23,be=B.data.text),de.focus())}B.data.type==="action:submit"&&(console.debug(B.data.text),be!==""&&(await it(),Be(be))),B.data.type==="input:prompt:submit"&&(console.debug(B.data.text),be!==""&&(await it(),Be(B.data.text)))}};so.subscribe(async B=>{B.length>0&&Et()}),Kn(async()=>{if(console.log("mounted"),window.addEventListener("message",jt),c==null||c.on("chat-events",Zt),i?r&&await rs("/"):Y=so.subscribe(async de=>{de||await Qe()}),localStorage.getItem(`chat-input-${S}`))try{const de=JSON.parse(localStorage.getItem(`chat-input-${S}`));t(23,be=de.prompt),t(25,Fe=de.files),t(18,x=de.selectedToolIds),t(20,ve=de.webSearchEnabled),t(19,J=de.imageGenerationEnabled)}catch{t(23,be=""),t(25,Fe=[]),t(18,x=[]),t(20,ve=!1),t(19,J=!1)}dn.subscribe(async de=>{if(R&&!_)try{de?D.openPane():R.collapse()}catch{}de||(Zn.set(!1),jo.set(!1),Lo.set(!1))});const B=document.getElementById("chat-input");B==null||B.focus(),Pr.subscribe(()=>{})}),ur(async()=>{Y==null||Y(),window.removeEventListener("message",jt),c==null||c.off("chat-events",Zt),et&&await et.disconnect()});const Ht=async B=>{var Ke,ge;if(console.log("Starting uploadGoogleDriveFile with:",{id:B.id,name:B.name,url:B.url,headers:{Authorization:`Bearer ${token}`}}),!(B!=null&&B.id)||!(B!=null&&B.name)||!(B!=null&&B.url)||!((Ke=B==null?void 0:B.headers)!=null&&Ke.Authorization))throw new Error("Invalid file data provided");const de=Go(),ke={type:"file",file:"",id:null,url:B.url,name:B.name,collection_name:"",status:"uploading",error:"",itemId:de,size:0};try{t(25,Fe=[...Fe,ke]),console.log("Processing web file with URL:",B.url);const Ae={headers:{Authorization:B.headers.Authorization,Accept:"*/*"},method:"GET"};console.log("Fetching file content from Google Drive...");const Ce=await Ja(B.url,Ae);if(!Ce.ok){const Ut=await Ce.text();throw new Error(`Failed to fetch file (${Ce.status}): ${Ut}`)}const je=Ce.headers.get("content-type")||"application/octet-stream";console.log("Response received with content-type:",je),console.log("Converting response to blob...");const dt=await Ce.blob();if(dt.size===0)throw new Error("Retrieved file is empty");console.log("Blob created:",{size:dt.size,type:dt.type||je});const vt=new File([dt],B.name,{type:dt.type||je});if(console.log("File object created:",{name:vt.name,size:vt.size,type:vt.type}),vt.size===0)throw new Error("Created file is empty");console.log("Uploading file to server...");const It=await uploadFile(localStorage.token,vt);if(!It)throw new Error("Server returned null response for file upload");console.log("File uploaded successfully:",It),ke.status="uploaded",ke.file=It,ke.id=It.id,ke.size=vt.size,ke.collection_name=(ge=It==null?void 0:It.meta)==null?void 0:ge.collection_name,ke.url=`${WEBUI_API_BASE_URL}/files/${It.id}`,t(25,Fe),t(0,S),$e.success(a.t("File uploaded successfully"))}catch(Ae){console.error("Error uploading file:",Ae),t(25,Fe=Fe.filter(Ce=>Ce.itemId!==de)),$e.error(a.t("Error uploading file: {{error}}",{error:Ae.message||"Unknown error"}))}},Qt=async B=>{console.log(B);const de={type:"doc",name:B,collection_name:"",status:"uploading",url:B,error:""};try{t(25,Fe=[...Fe,de]);const ke=await ap(localStorage.token,"",B);ke&&(de.status="uploaded",de.collection_name=ke.collection_name,de.file={...ke.file,...de.file},t(25,Fe),t(0,S))}catch(ke){t(25,Fe=Fe.filter(Ke=>Ke.name!==B)),$e.error(JSON.stringify(ke))}},se=async B=>{console.log(B);const de={type:"doc",name:B,collection_name:"",status:"uploading",context:"full",url:B,error:""};try{t(25,Fe=[...Fe,de]);const ke=await lp(localStorage.token,B);ke&&(de.status="uploaded",de.collection_name=ke.collection_name,de.file={...ke.file,...de.file},t(25,Fe),t(0,S))}catch(ke){t(25,Fe=Fe.filter(Ke=>Ke.name!==B)),$e.error(`${ke}`)}},Qe=async()=>{var ke,Ke,ge,Ae;if(h.url.searchParams.get("models"))t(2,te=(ke=h.url.searchParams.get("models"))==null?void 0:ke.split(","));else if(h.url.searchParams.get("model")){const Ce=(Ke=h.url.searchParams.get("model"))==null?void 0:Ke.split(",");if(Ce.length===1)if(l.find(dt=>dt.id===Ce[0]))t(2,te=Ce);else{const dt=document.getElementById("model-selector-0-button");if(dt){dt.click(),await it();const vt=document.getElementById("model-search-input");vt&&(vt.focus(),vt.value=Ce[0],vt.dispatchEvent(new Event("input")))}}else t(2,te=Ce)}else sessionStorage.selectedModels?(t(2,te=JSON.parse(sessionStorage.selectedModels)),sessionStorage.removeItem("selectedModels")):s!=null&&s.models?t(2,te=s==null?void 0:s.models):d!=null&&d.default_models&&(console.log((d==null?void 0:d.default_models.split(","))??""),t(2,te=d==null?void 0:d.default_models.split(",")));t(2,te=te.filter(Ce=>l.map(je=>je.id).includes(Ce))),(te.length===0||te.length===1&&te[0]==="")&&(l.length>0?t(2,te=[l[0].id]):t(2,te=[""])),await dn.set(!1),await Zn.set(!1),await jo.set(!1),await Lo.set(!1),h.url.pathname.includes("/c/")&&window.history.replaceState(X.state,"","/"),t(7,H=!0),await so.set(""),await Gi.set(""),t(22,X={messages:{},currentId:null}),t(24,Re=[]),t(26,he={}),h.url.searchParams.get("youtube")&&se(`https://www.youtube.com/watch?v=${h.url.searchParams.get("youtube")}`),h.url.searchParams.get("web-search")==="true"&&t(20,ve=!0),h.url.searchParams.get("image-generation")==="true"&&t(19,J=!0),h.url.searchParams.get("tools")?t(18,x=(ge=h.url.searchParams.get("tools"))==null?void 0:ge.split(",").map(Ce=>Ce.trim()).filter(Ce=>Ce)):h.url.searchParams.get("tool-ids")&&t(18,x=(Ae=h.url.searchParams.get("tool-ids"))==null?void 0:Ae.split(",").map(Ce=>Ce.trim()).filter(Ce=>Ce)),h.url.searchParams.get("call")==="true"&&(Zn.set(!0),dn.set(!0)),h.url.searchParams.get("q")&&(t(23,be=h.url.searchParams.get("q")??""),be&&(await it(),Be(be))),t(2,te=te.map(Ce=>l.map(je=>je.id).includes(Ce)?Ce:""));const B=await sc(localStorage.token);B?qo.set(B.ui):qo.set(JSON.parse(localStorage.getItem("settings")??"{}"));const de=document.getElementById("chat-input");setTimeout(()=>de==null?void 0:de.focus(),0)},rt=async()=>{if(so.set(S),me=await Ea(localStorage.token,i).catch(async B=>(await rs("/"),null)),me){const B=me.chat;if(B){console.log(B),t(2,te=((B==null?void 0:B.models)??void 0)!==void 0?B.models:[B.models??""]),t(22,X=((B==null?void 0:B.history)??void 0)!==void 0?B.history:tp(B.messages)),Gi.set(B.title);const de=await sc(localStorage.token);return de?await qo.set(de.ui):await qo.set(JSON.parse(localStorage.getItem("settings")??"{}")),t(26,he=(B==null?void 0:B.params)??{}),t(24,Re=(B==null?void 0:B.files)??[]),t(7,H=!0),await it(),X.currentId&&t(22,X.messages[X.currentId].done=!0,X),await it(),!0}else return null}},pt=async()=>{await it(),z&&t(8,z.scrollTop=z.scrollHeight,z)},Ue=async(B,de,ke,Ke,ge=null)=>{const Ae=ao(X,Ke),Ce=await mp(localStorage.token,de,{model:ke,messages:Ae.map(je=>({id:je.id,role:je.role,content:je.content,info:je.info?je.info:void 0,timestamp:je.timestamp,...je.sources?{sources:je.sources}:{}})),...ge?{event:ge}:{},model_item:l.find(je=>je.id===ke),chat_id:B,session_id:c==null?void 0:c.id,id:Ke}).catch(je=>($e.error(`${je}`),Ae.at(-1).error={content:je},null));if(Ce!==null&&Ce.messages)for(const je of Ce.messages)t(22,X.messages[je.id]={...X.messages[je.id],...X.messages[je.id].content!==je.content?{originalContent:X.messages[je.id].content}:{},...je},X);i==B&&(r||(me=await ds(localStorage.token,B,{models:te,messages:Ae,history:X,params:he,files:Re}),Or.set(1),await Pr.set(await di(localStorage.token,n))))},en=async(B,de="")=>setInterval(()=>{c==null||c.emit("usage",{action:"chat",model:B,chat_id:de})},1e3),At=async B=>{if(t(23,be=""),te.length===0)$e.error(a.t("Model not selected"));else{const de=te[0],ke=l.filter(vt=>vt.id===de).at(0),Ke=ao(X,X.currentId),ge=Ke.length!==0?Ke.at(-1):null,Ae=Go(),Ce=Go(),je={id:Ae,parentId:ge?ge.id:null,childrenIds:[Ce],role:"user",content:B||`[PROMPT] ${Ae}`,timestamp:Math.floor(Date.now()/1e3)},dt={id:Ce,parentId:Ae,childrenIds:[],role:"assistant",content:`[RESPONSE] ${Ce}`,done:!0,model:de,modelName:ke.name??ke.id,modelIdx:0,timestamp:Math.floor(Date.now()/1e3)};ge&&(ge.childrenIds.push(Ae),t(22,X.messages[ge.id]=ge,X)),t(22,X.messages[Ae]=je,X),t(22,X.messages[Ce]=dt,X),t(22,X.currentId=Ce,X),await it(),H&&pt(),Ke.length===0?await xt(X):await on(i,X)}},pe=async({modelId:B,parentId:de,messages:ke})=>{const Ke=l.filter(Ce=>Ce.id===B).at(0);let ge=X.messages[de],Ae=ge?ge.id:null;for(const Ce of ke){let je=Go();if(Ce.role==="user"){const dt={id:je,parentId:Ae,childrenIds:[],timestamp:Math.floor(Date.now()/1e3),...Ce};ge&&(ge.childrenIds.push(je),t(22,X.messages[ge.id]=ge,X)),t(22,X.messages[je]=dt,X),ge=dt,Ae=je}else{const dt={id:je,parentId:Ae,childrenIds:[],done:!0,model:Ke.id,modelName:Ke.name??Ke.id,modelIdx:0,timestamp:Math.floor(Date.now()/1e3),...Ce};ge&&(ge.childrenIds.push(je),t(22,X.messages[ge.id]=ge,X)),t(22,X.messages[je]=dt,X),ge=dt,Ae=je}}t(22,X.currentId=Ae,X),await it(),H&&pt(),ke.length===0?await xt(X):await on(i,X)},Xe=async(B,de,ke)=>{var Ut,Rt,un,Nn,Cn,mo,jn,So,Bn,po,_n,Mn,io,Qn;const{id:Ke,done:ge,choices:Ae,content:Ce,sources:je,selected_model_id:dt,error:vt,usage:It}=B;if(vt&&await St(vt,de),je&&(de.sources=je),Ae)if((Rt=(Ut=Ae[0])==null?void 0:Ut.message)!=null&&Rt.content)de.content+=(Nn=(un=Ae[0])==null?void 0:un.message)==null?void 0:Nn.content;else{let mn=((mo=(Cn=Ae[0])==null?void 0:Cn.delta)==null?void 0:mo.content)??"";if(de.content==""&&mn==`
`)console.log("Empty response");else{de.content+=mn,navigator.vibrate&&((s==null?void 0:s.hapticFeedback)??!1)&&navigator.vibrate(5);const En=ia(de.content,((So=(jn=d==null?void 0:d.audio)==null?void 0:jn.tts)==null?void 0:So.split_on)??"punctuation");En.pop(),En.length>0&&En[En.length-1]!==de.lastSentence&&(de.lastSentence=En[En.length-1],C.dispatchEvent(new CustomEvent("chat",{detail:{id:de.id,content:En[En.length-1]}})))}}if(Ce){de.content=Ce,navigator.vibrate&&((s==null?void 0:s.hapticFeedback)??!1)&&navigator.vibrate(5);const mn=ia(de.content,((po=(Bn=d==null?void 0:d.audio)==null?void 0:Bn.tts)==null?void 0:po.split_on)??"punctuation");mn.pop(),mn.length>0&&mn[mn.length-1]!==de.lastSentence&&(de.lastSentence=mn[mn.length-1],C.dispatchEvent(new CustomEvent("chat",{detail:{id:de.id,content:mn[mn.length-1]}})))}if(dt&&(de.selectedModelId=dt,de.arena=!0),It&&(de.usage=It),t(22,X.messages[de.id]=de,X),ge){de.done=!0,s.responseAutoCopy&&Za(de.content),s.responseAutoPlayback&&!f&&(await it(),(_n=document.getElementById(`speak-button-${de.id}`))==null||_n.click());let mn=((Qn=ia(de.content,((io=(Mn=d==null?void 0:d.audio)==null?void 0:Mn.tts)==null?void 0:io.split_on)??"punctuation"))==null?void 0:Qn.at(-1))??"";mn&&C.dispatchEvent(new CustomEvent("chat",{detail:{id:de.id,content:mn}})),C.dispatchEvent(new CustomEvent("chat:finish",{detail:{id:de.id,content:de.content}})),t(22,X.messages[de.id]=de,X)}H&&pt()},Be=async(B,{_raw:de=!1}={})=>{var vt,It,Ut;console.log("submitPrompt",B,i);const ke=ao(X,X.currentId);t(2,te=[ra]);const Ke=te.map(Rt=>l.map(un=>un.id).includes(Rt)?Rt:"");if(JSON.stringify(te)!==JSON.stringify(Ke)&&t(2,te=Ke),B===""&&Fe.length===0){$e.error(a.t("Please enter a prompt"));return}if(te.includes("")){$e.error(a.t("Model not selected"));return}if(ke.length!=0&&ke.at(-1).done!=!0)return;if(ke.length!=0&&ke.at(-1).error&&!ke.at(-1).content){$e.error(a.t("Oops! There was an error in the previous response."));return}if(Fe.length>0&&Fe.filter(Rt=>Rt.type!=="image"&&Rt.status==="uploading").length>0){$e.error(a.t("Oops! There are files still uploading. Please wait for the upload to complete."));return}if((((vt=d==null?void 0:d.file)==null?void 0:vt.max_count)??null)!==null&&Fe.length+Re.length>((It=d==null?void 0:d.file)==null?void 0:It.max_count)){$e.error(a.t("You can only chat with a maximum of {{maxCount}} file(s) at a time.",{maxCount:(Ut=d==null?void 0:d.file)==null?void 0:Ut.max_count}));return}t(23,be="");const ge=document.getElementById("chat-input");ge&&(await it(),ge.style.height="",ge.style.height=Math.min(ge.scrollHeight,320)+"px");const Ae=JSON.parse(JSON.stringify(Fe));Re.push(...Ae.filter(Rt=>["doc","file","collection"].includes(Rt.type))),t(24,Re=Re.filter((Rt,un,Nn)=>Nn.findIndex(Cn=>JSON.stringify(Cn)===JSON.stringify(Rt))===un)),t(25,Fe=[]),t(23,be="");let Ce=Go(),je={id:Ce,parentId:ke.length!==0?ke.at(-1).id:null,childrenIds:[],role:"user",content:B,files:Ae.length>0?Ae:void 0,timestamp:Math.floor(Date.now()/1e3),models:te};t(22,X.messages[Ce]=je,X),t(22,X.currentId=Ce,X),ke.length!==0&&X.messages[ke.at(-1).id].childrenIds.push(Ce);const dt=document.getElementById("chat-input");dt==null||dt.focus(),Dt(),await Ze(X,B,Ce,{newChat:!0})},Ze=async(B,de,ke,{modelId:Ke=null,modelIdx:ge=null,newChat:Ae=!1}={})=>{let Ce=JSON.parse(JSON.stringify(i));B=JSON.parse(JSON.stringify(B));const je={};let dt=Ke?[Ke]:F!==void 0?[F.id]:te;for(const[vt,It]of dt.entries()){const Ut=l.filter(Rt=>Rt.id===It).at(0);if(Ut){let Rt=Go(),un={parentId:ke,id:Rt,childrenIds:[],role:"assistant",content:"",model:Ut.id,modelName:Ut.name??Ut.id,modelIdx:ge||vt,userContext:null,timestamp:Math.floor(Date.now()/1e3)};t(22,X.messages[Rt]=un,X),t(22,X.currentId=Rt,X),ke!==null&&X.messages[ke]&&t(22,X.messages[ke].childrenIds=[...X.messages[ke].childrenIds,Rt],X),je[`${It}-${ge||vt}`]=Rt}}t(22,X),Ae&&B.messages[B.currentId].parentId===null&&(Ce=await xt(B)),await it(),B=JSON.parse(JSON.stringify(X)),await on(Ce,B),await Promise.all(dt.map(async(vt,It)=>{var Rt,un,Nn;console.log("modelId",vt);const Ut=l.filter(Cn=>Cn.id===vt).at(0);if(Ut){ao(B,ke).some(_n=>{var Mn;return(Mn=_n.files)==null?void 0:Mn.some(io=>io.type==="image")})&&!(((Nn=(un=(Rt=Ut.info)==null?void 0:Rt.meta)==null?void 0:un.capabilities)==null?void 0:Nn.vision)??!0)&&$e.error(a.t("Model {{modelName}} is not vision capable",{modelName:Ut.name??Ut.id}));let jn=je[`${vt}-${ge||It}`],So=B.messages[jn],Bn=null;if(((s==null?void 0:s.memory)??!1)&&Bn===null){const _n=await dp(localStorage.token,de).catch(Mn=>($e.error(`${Mn}`),null));_n&&(_n.documents[0].length>0&&(Bn=_n.documents[0].reduce((Mn,io,Qn)=>{const mn=_n.metadatas[0][Qn].created_at,En=new Date(mn*1e3).toISOString().split("T")[0];return`${Mn}${Qn+1}. [${En}]. ${io}
`},"")),console.log(Bn))}So.userContext=Bn;const po=await en(Ut.id,Ce);pt(),await Tt(B,Ut,jn),po&&clearInterval(po)}else $e.error(a.t("Model {{modelId}} not found",{modelId:vt}))})),Or.set(1),Pr.set(await di(localStorage.token,n))},Tt=async(B,de,ke,Ke)=>{var It,Ut,Rt,un,Nn,Cn,mo,jn,So,Bn,po,_n,Mn,io,Qn,mn,En,li,gr;const ge=B.messages[ke],Ae=B.messages[ge.parentId];let Ce=JSON.parse(JSON.stringify(Re));Ce.push(...((Ae==null?void 0:Ae.files)??[]).filter(ft=>["doc","file","collection"].includes(ft.type)),...((ge==null?void 0:ge.files)??[]).filter(ft=>["web_search_results"].includes(ft.type))),Ce=Ce.filter((ft,or,ci)=>ci.findIndex(mr=>JSON.stringify(mr)===JSON.stringify(ft))===or),pt(),C.dispatchEvent(new CustomEvent("chat:start",{detail:{id:ke}})),await it();const je=((Ut=(It=de==null?void 0:de.info)==null?void 0:It.params)==null?void 0:Ut.stream_response)??((Rt=s==null?void 0:s.params)==null?void 0:Rt.stream_response)??(he==null?void 0:he.stream_response)??!0;let dt=[he!=null&&he.system||s.system||((ge==null?void 0:ge.userContext)??null)?{role:"system",content:`${xm((he==null?void 0:he.system)??(s==null?void 0:s.system)??"",u.name,s!=null&&s.userLocation?await ac(localStorage.token).catch(ft=>{console.error(ft)}):void 0)}${(ge==null?void 0:ge.userContext)??null?`

User Context:
${(ge==null?void 0:ge.userContext)??""}`:""}`}:void 0,...ao(B,ke).map(ft=>({...ft,content:$m(ft.content,["reasoning","code_interpreter"])}))].filter(ft=>ft);dt=dt.map((ft,or,ci)=>{var mr,ui,_o;return{role:ft.role,...((mr=ft.files)==null?void 0:mr.filter(Ao=>Ao.type==="image").length)>0&&ft.role==="user"?{content:[{type:"text",text:((ui=ft==null?void 0:ft.merged)==null?void 0:ui.content)??ft.content},...ft.files.filter(Ao=>Ao.type==="image").map(Ao=>({type:"image_url",image_url:{url:Ao.url}}))]}:{content:((_o=ft==null?void 0:ft.merged)==null?void 0:_o.content)??ft.content}}}).filter(ft=>{var or;return(ft==null?void 0:ft.role)==="user"||((or=ft==null?void 0:ft.content)==null?void 0:or.trim())});const vt=await sp(localStorage.token,{stream:je,model:de.id,messages:dt,params:{...s==null?void 0:s.params,...he,format:s.requestFormat??void 0,keep_alive:s.keepAlive??void 0,stop:(he==null?void 0:he.stop)??((un=s==null?void 0:s.params)==null?void 0:un.stop)??void 0?((he==null?void 0:he.stop.split(",").map(ft=>ft.trim()))??s.params.stop).map(ft=>decodeURIComponent(JSON.parse('"'+ft.replace(/\"/g,'\\"')+'"'))):void 0},files:((Ce==null?void 0:Ce.length)??0)>0?Ce:void 0,tool_ids:x.length>0?x:void 0,features:{image_generation:(Nn=d==null?void 0:d.features)!=null&&Nn.enable_image_generation&&(u.role==="admin"||(mo=(Cn=u==null?void 0:u.permissions)==null?void 0:Cn.features)!=null&&mo.image_generation)?J:!1,code_interpreter:(jn=d==null?void 0:d.features)!=null&&jn.enable_code_interpreter&&(u.role==="admin"||(Bn=(So=u==null?void 0:u.permissions)==null?void 0:So.features)!=null&&Bn.code_interpreter)?le:!1,web_search:(po=d==null?void 0:d.features)!=null&&po.enable_web_search&&(u.role==="admin"||(Mn=(_n=u==null?void 0:u.permissions)==null?void 0:_n.features)!=null&&Mn.web_search)?ve||((s==null?void 0:s.webSearch)??!1)==="always":!1},variables:{...ep(u.name,s!=null&&s.userLocation?await ac(localStorage.token).catch(ft=>{console.error(ft)}):void 0)},model_item:l.find(ft=>ft.id===de.id),session_id:c==null?void 0:c.id,chat_id:i,id:ke,...!r&&(dt.length==1||dt.length==2&&((io=dt.at(0))==null?void 0:io.role)==="system"&&((Qn=dt.at(1))==null?void 0:Qn.role)==="user")&&(te[0]===de.id||F!==void 0)?{background_tasks:{title_generation:((mn=s==null?void 0:s.title)==null?void 0:mn.auto)??!0,tags_generation:(s==null?void 0:s.autoTags)??!0}}:{},...je&&(((gr=(li=(En=de.info)==null?void 0:En.meta)==null?void 0:li.capabilities)==null?void 0:gr.usage)??!1)?{stream_options:{include_usage:!0}}:{}},`${vi}/api`).catch(ft=>($e.error(`${ft}`),ge.error={content:ft},ge.done=!0,t(22,X.messages[ke]=ge,X),t(22,X.currentId=ke,X),null));if(console.log(vt),vt){ue=vt.task_id,ge.id=ue,B.messages[ue]=ge,B.currentId=ue;const ft=ge.parentId;ft!==null&&B.messages[ft]&&(B.messages[ft].childrenIds=[...B.messages[ft].childrenIds,ue],delete B.messages[ke])}await it(),pt()},St=async(B,de)=>{let ke="",Ke;B&&(Ke=B),console.error(Ke),"detail"in Ke?($e.error(Ke.detail),ke=Ke.detail):"error"in Ke?"message"in Ke.error?($e.error(Ke.error.message),ke=Ke.error.message):($e.error(Ke.error),ke=Ke.error):"message"in Ke&&($e.error(Ke.message),ke=Ke.message),de.error={content:a.t("Uh-oh! There was an issue with the response.")+`
`+ke},de.done=!0,de.statusHistory&&(de.statusHistory=de.statusHistory.filter(ge=>ge.action!=="knowledge_search")),t(22,X.messages[de.id]=de,X)},Nt=()=>{if(ue&&pp().catch(de=>null)){ue=null;const de=X.messages[X.currentId];de.done=!0,t(22,X.messages[X.currentId]=de,X),H&&pt()}},_t=async(B,de)=>{let ke=de,Ke=Go(),ge={id:Ke,parentId:B,childrenIds:[],role:"user",content:ke,models:te};B!==null&&t(22,X.messages[B].childrenIds=[...X.messages[B].childrenIds,Ke],X),t(22,X.messages[Ke]=ge,X),t(22,X.currentId=Ke,X),await it(),await Ze(X,ke,Ke)},yn=async B=>{if(console.log("regenerateResponse"),X.currentId){let de=X.messages[B.parentId],ke=de.content;((de==null?void 0:de.models)??[...te]).length==1?await Ze(X,ke,de.id):await Ze(X,ke,de.id,{modelId:B.model,modelIdx:B.modelIdx})}},hn=async()=>{if(console.log("continueResponse"),JSON.parse(JSON.stringify(i)),X.currentId&&X.messages[X.currentId].done==!0){const B=X.messages[X.currentId];B.done=!1,await it();const de=l.filter(ke=>ke.id===((B==null?void 0:B.selectedModelId)??B.model)).at(0);de&&await Tt(X,de,B.id)}},gn=async(B,de,ke)=>{console.log("mergeResponses",B,de);const Ke=X.messages[B],ge={status:!0,content:""};Ke.merged=ge,t(22,X.messages[B]=Ke,X);try{const[Ae,Ce]=await _p(localStorage.token,Ke.model,X.messages[Ke.parentId].content,de);if(Ae&&Ae.ok&&Ae.body){const je=await p1(Ae.body,s.splitLargeChunks);for await(const dt of je){const{value:vt,done:It,sources:Ut,error:Rt,usage:un}=dt;if(Rt||It)break;ge.content==""&&vt==`
`||(ge.content+=vt,t(22,X.messages[B]=Ke,X),H&&pt())}await on(ke,X)}else console.error(Ae)}catch(Ae){console.error(Ae)}},xt=async B=>{let de=i;return r?(de="local",await so.set("local")):(me=await ip(localStorage.token,{id:de,title:a.t("New Chat"),models:te,system:s.system??void 0,params:he,history:B,messages:ao(B,B.currentId),tags:[],timestamp:Date.now()}),de=me.id,await so.set(de),await Pr.set(await di(localStorage.token,n)),Or.set(1),window.history.replaceState(B.state,"",`/c/${de}`)),await it(),de},on=async(B,de)=>{i==B&&(r||(me=await ds(localStorage.token,B,{models:te,history:de,messages:ao(de,de.currentId),params:he,files:Re}),Or.set(1),await Pr.set(await di(localStorage.token,n))))};function kn(B){K=B,t(10,K)}const Rn=B=>{B.detail?Q(B.detail):Q(!0)},rn=()=>{Q(!1)};function Bt(B){ze[B?"unshift":"push"](()=>{W=B,t(9,W)})}function to(B){te=B,t(2,te)}const Gn=B=>B.dismissible?!JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]").includes(B.id):!0,no=B=>{const de=B.detail;localStorage.setItem("dismissedBannerIds",JSON.stringify([de,...JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]")].filter(ke=>w.find(Ke=>Ke.id===ke))))};function fo(B){X=B,t(22,X)}function Io(B){H=B,t(7,H)}function Vo(B){be=B,t(23,be),t(0,S)}function oo(B){ze[B?"unshift":"push"](()=>{z=B,t(8,z)})}const ro=B=>{t(7,H=z.scrollHeight-z.scrollTop<=z.clientHeight+5)},G=B=>{B.prompt?localStorage.setItem(`chat-input-${i}`,JSON.stringify(B)):localStorage.removeItem(`chat-input-${i}`)};function Ne(B){Fe=B,t(25,Fe),t(0,S)}function Je(B){be=B,t(23,be),t(0,S)}function ht(B){H=B,t(7,H)}function Ve(B){x=B,t(18,x),t(0,S)}function ct(B){J=B,t(19,J),t(0,S)}function Lt(B){le=B,t(21,le)}function Ln(B){ve=B,t(20,ve),t(0,S)}function Wn(B){F=B,t(3,F)}const sn=async B=>{const{type:de,data:ke}=B.detail;de==="web"?await Qt(ke):de==="youtube"?await se(ke):de==="google-drive"&&await Ht(ke)},Xt=async B=>{(B.detail||Fe.length>0)&&(await it(),Be((s==null?void 0:s.richTextInput)??!0?B.detail.replaceAll(`

`,`
`):B.detail))},qn=async B=>{console.log("createNewChat",B),ye(so).length===0&&await xt([])};function Un(B){Fe=B,t(25,Fe),t(0,S)}function ho(B){be=B,t(23,be),t(0,S)}function go(B){H=B,t(7,H)}function Sr(B){x=B,t(18,x),t(0,S)}function dr(B){J=B,t(19,J),t(0,S)}function ne(B){le=B,t(21,le)}function tr(B){ve=B,t(20,ve),t(0,S)}function fr(B){F=B,t(3,F)}const Ar=async B=>{const{type:de,data:ke}=B.detail;de==="web"?await Qt(ke):de==="youtube"&&await se(ke)},ii=async B=>{(B.detail||Fe.length>0)&&(await it(),Be((s==null?void 0:s.richTextInput)??!0?B.detail.replaceAll(`

`,`
`):B.detail))},Fo=async B=>{ye(so).length===0&&await xt({currentId:null,messages:{}})},Bi=(B,de,ke,Ke)=>{const ge=l.find(Ae=>Ae.id===de);return ge?[...B,ge]:B};function si(B){ze[B?"unshift":"push"](()=>{D=B,t(6,D)})}function To(B){X=B,t(22,X)}function nr(B){Re=B,t(24,Re)}function hr(B){he=B,t(26,he)}function Rr(B){Fe=B,t(25,Fe),t(0,S)}function ai(B){R=B,t(5,R)}return o.$$set=B=>{"chatIdProp"in B&&t(0,S=B.chatIdProp)},o.$$.update=()=>{o.$$.dirty[0]&12&&t(17,j=F!==void 0?[F.id]:te),o.$$.dirty[0]&1&&S&&(async()=>{if(t(4,k=!0),console.log(S),t(23,be=""),t(25,Fe=[]),t(18,x=[]),t(20,ve=!1),t(19,J=!1),S&&await rt()){if(await it(),t(4,k=!1),localStorage.getItem(`chat-input-${S}`))try{const de=JSON.parse(localStorage.getItem(`chat-input-${S}`));t(23,be=de.prompt),t(25,Fe=de.files),t(18,x=de.selectedToolIds),t(20,ve=de.webSearchEnabled),t(19,J=de.imageGenerationEnabled)}catch{}window.setTimeout(()=>pt(),0);const B=document.getElementById("chat-input");B==null||B.focus()}else await rs("/")})(),o.$$.dirty[0]&5&&te&&S!==""&&Dt(),o.$$.dirty[0]&4&&te&&Yt(),o.$$.dirty[0]&12&&(F||te)&&Yt()},[S,xt,te,F,k,R,D,H,z,W,K,P,V,L,q,Z,Q,j,x,J,ve,le,X,be,Re,Fe,he,i,s,a,l,d,v,m,y,w,I,C,Pt,Ht,Qt,se,Qe,Ue,At,pe,Be,Ze,Nt,_t,yn,hn,gn,kn,Rn,rn,Bt,to,Gn,no,fo,Io,Vo,oo,ro,G,Ne,Je,ht,Ve,ct,Lt,Ln,Wn,sn,Xt,qn,Un,ho,go,Sr,dr,ne,tr,fr,Ar,ii,Fo,Bi,si,To,nr,hr,Rr,ai]}class pA extends Ge{constructor(e){super(),We(this,e,oS,nS,Ye,{chatIdProp:0,initChatHandler:1},null,[-1,-1,-1,-1,-1])}get initChatHandler(){return this.$$.ctx[1]}}function rS(o){let e,t,n,r=o[1].t("Keyboard shortcuts")+"",i,s,a,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg>',c,u,d,f,h,_,b=o[1].t("Open new chat")+"",v,m,y,w='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">O</div>',I,S,k,C=o[1].t("Focus chat input")+"",R,D,H,z='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Esc</div>',W,K,P,V=o[1].t("Copy last code block")+"",L,q,Z,Q='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">;</div>',Y,te,F,j=o[1].t("Copy last response")+"",x,J,ve,le='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">C</div>',me,X,ue,be=o[1].t("Generate prompt pair")+"",Re,Fe,he,et='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Enter</div>',ot,Et,Dt,Yt,Pt=o[1].t("Toggle settings")+"",Zt,jt,Ht,Qt='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">.</div>',se,Qe,rt,pt=o[1].t("Toggle sidebar")+"",Ue,en,At,pe='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">S</div>',Xe,Be,Ze,Tt=o[1].t("Delete chat")+"",St,Nt,_t,yn='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">/Delete</div>',hn,gn,xt,on=o[1].t("Show shortcuts")+"",kn,Rn,rn,Bt='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">/</div>',to,Gn,no,fo=o[1].t("Input commands")+"",Io,Vo,oo,ro,G,Ne,Je,ht=o[1].t("Attach file from knowledge")+"",Ve,ct,Lt,Ln='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">#</div>',Wn,sn,Xt,qn=o[1].t("Add custom prompt")+"",Un,ho,go,Sr='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">/</div>',dr,ne,tr,fr=o[1].t("Talk to model")+"",Ar,ii,Fo,Bi='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">@</div>',si,To,nr,hr=o[1].t("Accept autocomplete generation / Jump to prompt variable")+"",Rr,ai,B,de='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">TAB</div>',ke,Ke;return{c(){e=M("div"),t=M("div"),n=M("div"),i=Ie(r),s=$(),a=M("button"),a.innerHTML=l,c=$(),u=M("div"),d=M("div"),f=M("div"),h=M("div"),_=M("div"),v=Ie(b),m=$(),y=M("div"),y.innerHTML=w,I=$(),S=M("div"),k=M("div"),R=Ie(C),D=$(),H=M("div"),H.innerHTML=z,W=$(),K=M("div"),P=M("div"),L=Ie(V),q=$(),Z=M("div"),Z.innerHTML=Q,Y=$(),te=M("div"),F=M("div"),x=Ie(j),J=$(),ve=M("div"),ve.innerHTML=le,me=$(),X=M("div"),ue=M("div"),Re=Ie(be),Fe=$(),he=M("div"),he.innerHTML=et,ot=$(),Et=M("div"),Dt=M("div"),Yt=M("div"),Zt=Ie(Pt),jt=$(),Ht=M("div"),Ht.innerHTML=Qt,se=$(),Qe=M("div"),rt=M("div"),Ue=Ie(pt),en=$(),At=M("div"),At.innerHTML=pe,Xe=$(),Be=M("div"),Ze=M("div"),St=Ie(Tt),Nt=$(),_t=M("div"),_t.innerHTML=yn,hn=$(),gn=M("div"),xt=M("div"),kn=Ie(on),Rn=$(),rn=M("div"),rn.innerHTML=Bt,to=$(),Gn=M("div"),no=M("div"),Io=Ie(fo),Vo=$(),oo=M("div"),ro=M("div"),G=M("div"),Ne=M("div"),Je=M("div"),Ve=Ie(ht),ct=$(),Lt=M("div"),Lt.innerHTML=Ln,Wn=$(),sn=M("div"),Xt=M("div"),Un=Ie(qn),ho=$(),go=M("div"),go.innerHTML=Sr,dr=$(),ne=M("div"),tr=M("div"),Ar=Ie(fr),ii=$(),Fo=M("div"),Fo.innerHTML=Bi,si=$(),To=M("div"),nr=M("div"),Rr=Ie(hr),ai=$(),B=M("div"),B.innerHTML=de,this.h()},l(ge){e=O(ge,"DIV",{class:!0});var Ae=A(e);t=O(Ae,"DIV",{class:!0});var Ce=A(t);n=O(Ce,"DIV",{class:!0});var je=A(n);i=Te(je,r),je.forEach(p),s=ee(Ce),a=O(Ce,"BUTTON",{class:!0,"data-svelte-h":!0}),yt(a)!=="svelte-745w2y"&&(a.innerHTML=l),Ce.forEach(p),c=ee(Ae),u=O(Ae,"DIV",{class:!0});var dt=A(u);d=O(dt,"DIV",{class:!0});var vt=A(d);f=O(vt,"DIV",{class:!0});var It=A(f);h=O(It,"DIV",{class:!0});var Ut=A(h);_=O(Ut,"DIV",{class:!0});var Rt=A(_);v=Te(Rt,b),Rt.forEach(p),m=ee(Ut),y=O(Ut,"DIV",{class:!0,"data-svelte-h":!0}),yt(y)!=="svelte-1ykt4pq"&&(y.innerHTML=w),Ut.forEach(p),I=ee(It),S=O(It,"DIV",{class:!0});var un=A(S);k=O(un,"DIV",{class:!0});var Nn=A(k);R=Te(Nn,C),Nn.forEach(p),D=ee(un),H=O(un,"DIV",{class:!0,"data-svelte-h":!0}),yt(H)!=="svelte-9s7il5"&&(H.innerHTML=z),un.forEach(p),W=ee(It),K=O(It,"DIV",{class:!0});var Cn=A(K);P=O(Cn,"DIV",{class:!0});var mo=A(P);L=Te(mo,V),mo.forEach(p),q=ee(Cn),Z=O(Cn,"DIV",{class:!0,"data-svelte-h":!0}),yt(Z)!=="svelte-1rhjj6y"&&(Z.innerHTML=Q),Cn.forEach(p),Y=ee(It),te=O(It,"DIV",{class:!0});var jn=A(te);F=O(jn,"DIV",{class:!0});var So=A(F);x=Te(So,j),So.forEach(p),J=ee(jn),ve=O(jn,"DIV",{class:!0,"data-svelte-h":!0}),yt(ve)!=="svelte-88t2mq"&&(ve.innerHTML=le),jn.forEach(p),me=ee(It),X=O(It,"DIV",{class:!0});var Bn=A(X);ue=O(Bn,"DIV",{class:!0});var po=A(ue);Re=Te(po,be),po.forEach(p),Fe=ee(Bn),he=O(Bn,"DIV",{class:!0,"data-svelte-h":!0}),yt(he)!=="svelte-71xcgz"&&(he.innerHTML=et),Bn.forEach(p),It.forEach(p),ot=ee(vt),Et=O(vt,"DIV",{class:!0});var _n=A(Et);Dt=O(_n,"DIV",{class:!0});var Mn=A(Dt);Yt=O(Mn,"DIV",{class:!0});var io=A(Yt);Zt=Te(io,Pt),io.forEach(p),jt=ee(Mn),Ht=O(Mn,"DIV",{class:!0,"data-svelte-h":!0}),yt(Ht)!=="svelte-sstb0e"&&(Ht.innerHTML=Qt),Mn.forEach(p),se=ee(_n),Qe=O(_n,"DIV",{class:!0});var Qn=A(Qe);rt=O(Qn,"DIV",{class:!0});var mn=A(rt);Ue=Te(mn,pt),mn.forEach(p),en=ee(Qn),At=O(Qn,"DIV",{class:!0,"data-svelte-h":!0}),yt(At)!=="svelte-shqiv6"&&(At.innerHTML=pe),Qn.forEach(p),Xe=ee(_n),Be=O(_n,"DIV",{class:!0});var En=A(Be);Ze=O(En,"DIV",{class:!0});var li=A(Ze);St=Te(li,Tt),li.forEach(p),Nt=ee(En),_t=O(En,"DIV",{class:!0,"data-svelte-h":!0}),yt(_t)!=="svelte-1czc2xm"&&(_t.innerHTML=yn),En.forEach(p),hn=ee(_n),gn=O(_n,"DIV",{class:!0});var gr=A(gn);xt=O(gr,"DIV",{class:!0});var ft=A(xt);kn=Te(ft,on),ft.forEach(p),Rn=ee(gr),rn=O(gr,"DIV",{class:!0,"data-svelte-h":!0}),yt(rn)!=="svelte-10s6aob"&&(rn.innerHTML=Bt),gr.forEach(p),_n.forEach(p),vt.forEach(p),dt.forEach(p),to=ee(Ae),Gn=O(Ae,"DIV",{class:!0});var or=A(Gn);no=O(or,"DIV",{class:!0});var ci=A(no);Io=Te(ci,fo),ci.forEach(p),or.forEach(p),Vo=ee(Ae),oo=O(Ae,"DIV",{class:!0});var mr=A(oo);ro=O(mr,"DIV",{class:!0});var ui=A(ro);G=O(ui,"DIV",{class:!0});var _o=A(G);Ne=O(_o,"DIV",{class:!0});var Ao=A(Ne);Je=O(Ao,"DIV",{class:!0});var Xl=A(Je);Ve=Te(Xl,ht),Xl.forEach(p),ct=ee(Ao),Lt=O(Ao,"DIV",{class:!0,"data-svelte-h":!0}),yt(Lt)!=="svelte-npid8c"&&(Lt.innerHTML=Ln),Ao.forEach(p),Wn=ee(_o),sn=O(_o,"DIV",{class:!0});var zi=A(sn);Xt=O(zi,"DIV",{class:!0});var Jl=A(Xt);Un=Te(Jl,qn),Jl.forEach(p),ho=ee(zi),go=O(zi,"DIV",{class:!0,"data-svelte-h":!0}),yt(go)!=="svelte-1x4z9aw"&&(go.innerHTML=Sr),zi.forEach(p),dr=ee(_o),ne=O(_o,"DIV",{class:!0});var Vi=A(ne);tr=O(Vi,"DIV",{class:!0});var Zl=A(tr);Ar=Te(Zl,fr),Zl.forEach(p),ii=ee(Vi),Fo=O(Vi,"DIV",{class:!0,"data-svelte-h":!0}),yt(Fo)!=="svelte-1ia95ih"&&(Fo.innerHTML=Bi),Vi.forEach(p),si=ee(_o),To=O(_o,"DIV",{class:!0});var Fi=A(To);nr=O(Fi,"DIV",{class:!0});var xl=A(nr);Rr=Te(xl,hr),xl.forEach(p),ai=ee(Fi),B=O(Fi,"DIV",{class:!0,"data-svelte-h":!0}),yt(B)!=="svelte-1hbxzzi"&&(B.innerHTML=de),Fi.forEach(p),_o.forEach(p),ui.forEach(p),mr.forEach(p),Ae.forEach(p),this.h()},h(){g(n,"class","text-lg font-medium self-center"),g(a,"class","self-center"),g(t,"class","flex justify-between dark:text-gray-300 px-5 pt-4"),g(_,"class","text-sm"),g(y,"class","flex space-x-1 text-xs"),g(h,"class","w-full flex justify-between items-center"),g(k,"class","text-sm"),g(H,"class","flex space-x-1 text-xs"),g(S,"class","w-full flex justify-between items-center"),g(P,"class","text-sm"),g(Z,"class","flex space-x-1 text-xs"),g(K,"class","w-full flex justify-between items-center"),g(F,"class","text-sm"),g(ve,"class","flex space-x-1 text-xs"),g(te,"class","w-full flex justify-between items-center"),g(ue,"class","text-sm"),g(he,"class","flex space-x-1 text-xs"),g(X,"class","w-full flex justify-between items-center"),g(f,"class","flex flex-col space-y-3 w-full self-start"),g(Yt,"class","text-sm"),g(Ht,"class","flex space-x-1 text-xs"),g(Dt,"class","w-full flex justify-between items-center"),g(rt,"class","text-sm"),g(At,"class","flex space-x-1 text-xs"),g(Qe,"class","w-full flex justify-between items-center"),g(Ze,"class","text-sm"),g(_t,"class","flex space-x-1 text-xs"),g(Be,"class","w-full flex justify-between items-center"),g(xt,"class","text-sm"),g(rn,"class","flex space-x-1 text-xs"),g(gn,"class","w-full flex justify-between items-center"),g(Et,"class","flex flex-col space-y-3 w-full self-start"),g(d,"class","flex flex-col w-full sm:flex-row sm:justify-center sm:space-x-6"),g(u,"class","flex flex-col md:flex-row w-full p-5 md:space-x-4 dark:text-gray-200"),g(no,"class","text-lg font-medium self-center"),g(Gn,"class","flex justify-between dark:text-gray-300 px-5"),g(Je,"class","text-sm"),g(Lt,"class","flex space-x-1 text-xs"),g(Ne,"class","w-full flex justify-between items-center"),g(Xt,"class","text-sm"),g(go,"class","flex space-x-1 text-xs"),g(sn,"class","w-full flex justify-between items-center"),g(tr,"class","text-sm"),g(Fo,"class","flex space-x-1 text-xs"),g(ne,"class","w-full flex justify-between items-center"),g(nr,"class","text-sm"),g(B,"class","flex space-x-1 text-xs"),g(To,"class","w-full flex justify-between items-center"),g(G,"class","flex flex-col space-y-3 w-full self-start"),g(ro,"class","flex flex-col w-full sm:flex-row sm:justify-center sm:space-x-6"),g(oo,"class","flex flex-col md:flex-row w-full p-5 md:space-x-4 dark:text-gray-200"),g(e,"class","text-gray-700 dark:text-gray-100")},m(ge,Ae){U(ge,e,Ae),E(e,t),E(t,n),E(n,i),E(t,s),E(t,a),E(e,c),E(e,u),E(u,d),E(d,f),E(f,h),E(h,_),E(_,v),E(h,m),E(h,y),E(f,I),E(f,S),E(S,k),E(k,R),E(S,D),E(S,H),E(f,W),E(f,K),E(K,P),E(P,L),E(K,q),E(K,Z),E(f,Y),E(f,te),E(te,F),E(F,x),E(te,J),E(te,ve),E(f,me),E(f,X),E(X,ue),E(ue,Re),E(X,Fe),E(X,he),E(d,ot),E(d,Et),E(Et,Dt),E(Dt,Yt),E(Yt,Zt),E(Dt,jt),E(Dt,Ht),E(Et,se),E(Et,Qe),E(Qe,rt),E(rt,Ue),E(Qe,en),E(Qe,At),E(Et,Xe),E(Et,Be),E(Be,Ze),E(Ze,St),E(Be,Nt),E(Be,_t),E(Et,hn),E(Et,gn),E(gn,xt),E(xt,kn),E(gn,Rn),E(gn,rn),E(e,to),E(e,Gn),E(Gn,no),E(no,Io),E(e,Vo),E(e,oo),E(oo,ro),E(ro,G),E(G,Ne),E(Ne,Je),E(Je,Ve),E(Ne,ct),E(Ne,Lt),E(G,Wn),E(G,sn),E(sn,Xt),E(Xt,Un),E(sn,ho),E(sn,go),E(G,dr),E(G,ne),E(ne,tr),E(tr,Ar),E(ne,ii),E(ne,Fo),E(G,si),E(G,To),E(To,nr),E(nr,Rr),E(To,ai),E(To,B),ke||(Ke=we(a,"click",o[3]),ke=!0)},p(ge,Ae){Ae&2&&r!==(r=ge[1].t("Keyboard shortcuts")+"")&&Pe(i,r),Ae&2&&b!==(b=ge[1].t("Open new chat")+"")&&Pe(v,b),Ae&2&&C!==(C=ge[1].t("Focus chat input")+"")&&Pe(R,C),Ae&2&&V!==(V=ge[1].t("Copy last code block")+"")&&Pe(L,V),Ae&2&&j!==(j=ge[1].t("Copy last response")+"")&&Pe(x,j),Ae&2&&be!==(be=ge[1].t("Generate prompt pair")+"")&&Pe(Re,be),Ae&2&&Pt!==(Pt=ge[1].t("Toggle settings")+"")&&Pe(Zt,Pt),Ae&2&&pt!==(pt=ge[1].t("Toggle sidebar")+"")&&Pe(Ue,pt),Ae&2&&Tt!==(Tt=ge[1].t("Delete chat")+"")&&Pe(St,Tt),Ae&2&&on!==(on=ge[1].t("Show shortcuts")+"")&&Pe(kn,on),Ae&2&&fo!==(fo=ge[1].t("Input commands")+"")&&Pe(Io,fo),Ae&2&&ht!==(ht=ge[1].t("Attach file from knowledge")+"")&&Pe(Ve,ht),Ae&2&&qn!==(qn=ge[1].t("Add custom prompt")+"")&&Pe(Un,qn),Ae&2&&fr!==(fr=ge[1].t("Talk to model")+"")&&Pe(Ar,fr),Ae&2&&hr!==(hr=ge[1].t("Accept autocomplete generation / Jump to prompt variable")+"")&&Pe(Rr,hr)},d(ge){ge&&p(e),ke=!1,Ke()}}}function iS(o){let e,t,n;function r(s){o[4](s)}let i={$$slots:{default:[rS]},$$scope:{ctx:o}};return o[0]!==void 0&&(i.show=o[0]),e=new l_({props:i}),ze.push(()=>nt(e,"show",r)),{c(){oe(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){re(e,s,a),n=!0},p(s,[a]){const l={};a&35&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.show=s[0],tt(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){N(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function sS(o,e,t){let n;const r=fn("i18n");fe(o,r,l=>t(1,n=l));let{show:i=!1}=e;const s=()=>{t(0,i=!1)};function a(l){i=l,t(0,i)}return o.$$set=l=>{"show"in l&&t(0,i=l.show)},[i,n,r,s,a]}class aS extends Ge{constructor(e){super(),We(this,e,sS,iS,Ye,{show:0})}}function lS(o){let e,t,n,r,i,s,a,l,c,u=us;function d(h){o[6](h)}let f={};return o[0]!==void 0&&(f.show=o[0]),i=new aS({props:f}),ze.push(()=>nt(i,"show",d)),{c(){e=M("div"),t=M("button"),n=$(),r=$(),oe(i.$$.fragment),this.h()},l(h){e=O(h,"DIV",{class:!0});var _=A(e);t=O(_,"BUTTON",{id:!0,class:!0}),A(t).forEach(p),n=ee(_),_.forEach(p),r=ee(h),ae(i.$$.fragment,h),this.h()},h(){g(t,"id","show-shortcuts-button"),g(t,"class","hidden"),g(e,"class","hidden lg:flex fixed bottom-0 right-0 px-1 py-1 z-20")},m(h,_){U(h,e,_),E(e,t),E(e,n),U(h,r,_),re(i,h,_),a=!0,l||(c=we(t,"click",o[3]),l=!0)},p(h,[_]){const b={};!s&&_&1&&(s=!0,b.show=h[0],tt(()=>s=!1)),i.$set(b)},i(h){a||(T(u),T(i.$$.fragment,h),a=!0)},o(h){N(u),N(i.$$.fragment,h),a=!1},d(h){h&&(p(e),p(r)),ie(i,h),l=!1,c()}}}function cS(o,e,t){let n;const r=fn("i18n");fe(o,r,u=>t(1,n=u));let i=!1;const s=()=>{t(0,i=!i)},a=()=>{t(0,i=!i)},l=()=>{t(0,i=!i)};function c(u){i=u,t(0,i)}return[i,n,r,s,a,l,c]}class _A extends Ge{constructor(e){super(),We(this,e,cS,lS,Ye,{})}}export{pA as C,_A as H};
